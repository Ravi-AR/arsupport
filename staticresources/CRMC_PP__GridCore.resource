var crmc;!function(){if(!crmc||!crmc.requirejs){crmc?t=crmc:crmc={};var e,t,i;!function(n){function a(e,t){return k.call(e,t)}function o(e,t){var i,n,a,o,r,s,l,d,c,u,f,p=t&&t.split("/"),h=b.map,g=h&&h["*"]||{};if(e&&"."===e.charAt(0))if(t){for(p=p.slice(0,p.length-1),e=e.split("/"),r=e.length-1,b.nodeIdCompat&&x.test(e[r])&&(e[r]=e[r].replace(x,"")),e=p.concat(e),c=0;c<e.length;c+=1)if(f=e[c],"."===f)e.splice(c,1),c-=1;else if(".."===f){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||g)&&h){for(i=e.split("/"),c=i.length;c>0;c-=1){if(n=i.slice(0,c).join("/"),p)for(u=p.length;u>0;u-=1)if(a=h[p.slice(0,u).join("/")],a&&(a=a[n])){o=a,s=c;break}if(o)break;!l&&g&&g[n]&&(l=g[n],d=c)}!o&&l&&(o=l,s=d),o&&(i.splice(0,s,o),e=i.join("/"))}return e}function r(e,t){return function(){return p.apply(n,w.call(arguments,0).concat([e,t]))}}function s(e){return function(t){return o(t,e)}}function l(e){return function(t){m[e]=t}}function d(e){if(a(v,e)){var t=v[e];delete v[e],y[e]=!0,f.apply(n,t)}if(!a(m,e)&&!a(y,e))throw new Error("No "+e);return m[e]}function c(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function u(e){return function(){return b&&b.config&&b.config[e]||{}}}var f,p,h,g,m={},v={},b={},y={},k=Object.prototype.hasOwnProperty,w=[].slice,x=/\.js$/;h=function(e,t){var i,n=c(e),a=n[0];return e=n[1],a&&(a=o(a,t),i=d(a)),a?e=i&&i.normalize?i.normalize(e,s(t)):o(e,t):(e=o(e,t),n=c(e),a=n[0],e=n[1],a&&(i=d(a))),{f:a?a+"!"+e:e,n:e,pr:a,p:i}},g={require:function(e){return r(e)},exports:function(e){var t=m[e];return"undefined"!=typeof t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:u(e)}}},f=function(e,t,i,o){var s,c,u,f,p,b,k=[],w=typeof i;if(o=o||e,"undefined"===w||"function"===w){for(t=!t.length&&i.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(f=h(t[p],o),c=f.f,"require"===c)k[p]=g.require(e);else if("exports"===c)k[p]=g.exports(e),b=!0;else if("module"===c)s=k[p]=g.module(e);else if(a(m,c)||a(v,c)||a(y,c))k[p]=d(c);else{if(!f.p)throw new Error(e+" missing "+c);f.p.load(f.n,r(o,!0),l(c),{}),k[p]=m[c]}u=i?i.apply(m[e],k):void 0,e&&(s&&s.exports!==n&&s.exports!==m[e]?m[e]=s.exports:u===n&&b||(m[e]=u))}else e&&(m[e]=i)},e=t=p=function(e,t,i,a,o){if("string"==typeof e)return g[e]?g[e](t):d(h(e,t).f);if(!e.splice){if(b=e,b.deps&&p(b.deps,b.callback),!t)return;t.splice?(e=t,t=i,i=null):e=n}return t=t||function(){},"function"==typeof i&&(i=a,a=o),a?f(n,e,t,i):setTimeout(function(){f(n,e,t,i)},4),p},p.config=function(e){return p(e)},e._defined=m,i=function(e,t,i){t.splice||(i=t,t=[]),a(m,e)||a(v,e)||(v[e]=[e,t,i])},i.amd={jQuery:!0}}(),crmc.requirejs=e,crmc.require=t,crmc.define=i}}(),crmc.define("../Util/almond",function(){}),crmc.define("GridConstantsProd",[],function(){return{namespace:"CRMC_PP",VF_PAGE_NAME:"crmc_grid",VF_APEX_CONTROLLER:"AGComponentController",RELATED_LIST_OFFSET_PX:0,SFDC_HEADER_PX:225,UNIQUE_ID:0,viewContext:{pageLayout:"Page Layout",vfPage:"Visualforce Page",explorer:"Explorer"},viewPrivacy:{private:"Private",public:"Public",publicReadOnly:"Public Read-Only"},localStorageKeys:{getUserInfo:"getUserInfo",SFRestCache:"SFRestCache"},ignoreRequiredFields:["CreatedDate","CreatedById","LastModifiedById","LastModifiedDate"],operators:{string:{contains:"Contains",doesnotcontain:"Does not contain",eq:"Is equal to",neq:"Is not equal to",startswith:"Starts with",endswith:"Ends with",includes:"Includes (',' delimited)",excludes:"Excludes (',' delimited)",isnull:"Is empty",isnotnull:"Is not empty"},number:{gte:"Is greater or equal to",gt:"Is greater than",lte:"Is less or equal to",lt:"Is less than",eq:"Is equal to",neq:"Is not equal to",isnull:"Is empty",isnotnull:"Is not empty"},date:{eq:"Is equal to",neq:"Is not equal to",gte:"Is greater or equal to",gt:"Is greater than",lte:"Is less or equal to",lt:"Is less than",isnull:"Is empty",isnotnull:"Is not empty"},enums:{eq:"Is equal to",neq:"Is not equal to",isnull:"Is empty",isnotnull:"Is not empty"},multipicklist:{eq:"Is equal to",neq:"Is not equal to",includes:"Includes (',' delimited)",excludes:"Excludes (',' delimited)"},Object:{contains:"Contains",doesnotcontain:"Does not contain",eq:"Is equal to",neq:"Is not equal to",startswith:"Starts with",endswith:"Ends with",notexists:"Doesn't Exist",exists:"Exists"}},dateParts:{DAY_IN_MONTH:"Day",CALENDAR_MONTH:"Month",CALENDAR_YEAR:"Year",CALENDAR_QUARTER:"Quarter"},relativeDates:[{displayName:"Blank",dateLiteral:"NULL",period:"",requiresN:!1},{displayName:"Yesterday",dateLiteral:"YESTERDAY",period:"Day",requiresN:!1},{displayName:"Today",dateLiteral:"TODAY",period:"Day",requiresN:!1},{displayName:"Next Day",dateLiteral:"TOMORROW",period:"Day",requiresN:!1},{displayName:"Last 90 Days",dateLiteral:"LAST_90_DAYS",period:"Day",requiresN:!1},{displayName:"Next 90 Days",dateLiteral:"NEXT_90_DAYS",period:"Day",requiresN:!1},{displayName:"Last Week",dateLiteral:"LAST_WEEK",period:"Week",requiresN:!1},{displayName:"Next Week",dateLiteral:"NEXT_WEEK",period:"Week",requiresN:!1},{displayName:"Last n Days",formatText:"Last {0} Days",dateLiteral:"LAST_N_DAYS",period:"Day",requiresN:!0},{displayName:"Next n Days",formatText:"Next {0} Days",dateLiteral:"NEXT_N_DAYS",period:"Day",requiresN:!0},{displayName:"n Days Ago",formatText:"{0} Days Ago",dateLiteral:"N_DAYS_AGO",period:"Day",requiresN:!0},{displayName:"This Week",dateLiteral:"THIS_WEEK",period:"Week",requiresN:!1},{displayName:"Last n Weeks",formatText:"Last {0} Weeks",dateLiteral:"LAST_N_WEEKS",period:"Week",requiresN:!0},{displayName:"Next n Weeks",formatText:"Next {0} Weeks",dateLiteral:"NEXT_N_WEEKS",period:"Week",requiresN:!0},{displayName:"n Weeks Ago",formatText:"{0} Weeks Ago",dateLiteral:"N_WEEKS_AGO",period:"Week",requiresN:!0},{displayName:"Last Month",dateLiteral:"LAST_MONTH",period:"Month",requiresN:!1},{displayName:"This Month",dateLiteral:"THIS_MONTH",period:"Month",requiresN:!1},{displayName:"Next Month",dateLiteral:"NEXT_MONTH",period:"Month",requiresN:!1},{displayName:"Next n Months",formatText:"Next {0} Months",dateLiteral:"NEXT_N_MONTHS",period:"Month",requiresN:!0},{displayName:"Last n Months",formatText:"Last {0} Months",dateLiteral:"LAST_N_MONTHS",period:"Month",requiresN:!0},{displayName:"n Months Ago",formatText:"{0} Months Ago",dateLiteral:"N_MONTHS_AGO",period:"Month",requiresN:!0},{displayName:"Last Quarter",dateLiteral:"LAST_QUARTER",period:"Quarter",requiresN:!1},{displayName:"This Quarter",dateLiteral:"THIS_QUARTER",period:"Quarter",requiresN:!1},{displayName:"Next Quarter",dateLiteral:"NEXT_QUARTER",period:"Quarter",requiresN:!1},{displayName:"Next n Quarters",formatText:"Next {0} Quarters",dateLiteral:"NEXT_N_QUARTERS",period:"Quarter",requiresN:!0},{displayName:"Last n Quarters",formatText:"Last {0} Quarters",dateLiteral:"LAST_N_QUARTERS",period:"Quarter",requiresN:!0},{displayName:"n Quarters Ago",formatText:"{0} Quarters Ago",dateLiteral:"N_QUARTERS_AGO",period:"Quarter",requiresN:!0},{displayName:"Last Year",dateLiteral:"LAST_YEAR",period:"Year",requiresN:!1},{displayName:"This Year",dateLiteral:"THIS_YEAR",period:"Year",requiresN:!1},{displayName:"Next Year",dateLiteral:"NEXT_YEAR",period:"Year",requiresN:!1},{displayName:"Next n Years",formatText:"Next {0} Years",dateLiteral:"NEXT_N_YEARS",period:"Year",requiresN:!0},{displayName:"Last n Years",formatText:"Last {0} Years",dateLiteral:"LAST_N_YEARS",period:"Year",requiresN:!0},{displayName:"n Years Ago",formatText:"{0} Years Ago",dateLiteral:"N_YEARS_AGO",period:"Year",requiresN:!0},{displayName:"Last Fiscal Quarter",dateLiteral:"LAST_FISCAL_QUARTER",period:"Fiscal Quarter",requiresN:!1},{displayName:"This Fiscal Quarter",dateLiteral:"THIS_FISCAL_QUARTER",period:"Fiscal Quarter",requiresN:!1},{displayName:"Next Fiscal Quarter",dateLiteral:"NEXT_FISCAL_QUARTER",period:"Fiscal Quarter",requiresN:!1},{displayName:"Next n Fiscal Quarters",formatText:"Next {0} Fiscal Quarters",dateLiteral:"NEXT_N_FISCAL_QUARTERS",period:"Fiscal Quarter",requiresN:!0},{displayName:"Last n Fiscal Quarters",formatText:"Last {0} Fiscal Quarters",dateLiteral:"LAST_N_FISCAL_QUARTERS",period:"Fiscal Quarter",requiresN:!0},{displayName:"n Fiscal Quarters Ago",formatText:"{0} Fiscal Quarters Ago",dateLiteral:"N_FISCAL_QUARTERS_AGO",period:"Fiscal Quarter",requiresN:!0},{displayName:"Last Fiscal Year",dateLiteral:"LAST_FISCAL_YEAR",period:"Fiscal Year",requiresN:!1},{displayName:"This Fiscal Year",dateLiteral:"THIS_FISCAL_YEAR",period:"Fiscal Year",requiresN:!1},{displayName:"Next Fiscal Year",dateLiteral:"NEXT_FISCAL_YEAR",period:"Fiscal Year",requiresN:!1},{displayName:"Next n Fiscal Years",formatText:"Next {0} Fiscal Years",dateLiteral:"NEXT_N_FISCAL_YEARS",period:"Fiscal Year",requiresN:!0},{displayName:"Last n Fiscal Years",formatText:"Last {0} Fiscal Years",dateLiteral:"LAST_N_FISCAL_YEARS",period:"Fiscal Year",requiresN:!0},{displayName:"n Fiscal Years Ago",formatText:"{0} Fiscal Years Ago",dateLiteral:"N_FISCAL_YEARS_AGO",period:"Fiscal Year",requiresN:!0}]}}),crmc.define("GridConstants",["GridConstantsProd"],function(e){return e}),crmc.define("KendoPopup",["GridConstants"],function(e){var t={popup:function(e,t,i,n,a,o){this.popupWithButtons(e,t,[{label:a||"Dismiss"},{label:i,click:n}],o)},popupWithButtons:function(t,i,n,a){var o=e.UNIQUE_ID++,r=kendo.template("<div id='KendoPopupBox#=uniqueid#' style='display:none; height:100%'>#= val #<p/><div style='float:right; clear:left; max-height: 50px;'># buttons.map(function(item) { if(item.label) {#<span id='#=item.label.replace(/\\s+/g, '')##=uniqueid#' class='k-button'>#=item.label#</span>&nbsp;# }}) #</div></div>"),s={val:i,uniqueid:o,buttons:n},l=r(s);$("body").append(l);var d=$("#KendoPopupBox"+o);n&&n.length>0&&n.map(function(e){if(e.label){var t=$("#"+e.label.replace(/\s+/g,"")+o);t.bind("click",function(){"function"==typeof e.click?e.click()!==!1&&d.data("kendoWindow").close():d.data("kendoWindow").close()})}}),d.data("kendoWindow")||d.kendoWindow({width:a&&a.width?a.width:void 0,height:a&&a.height?a.height:void 0,draggable:!0,modal:!0,resizable:!(!a||!a.resizable),actions:["Close"],title:t,maxHeight:a&&a.maxHeight?a.maxHeight:$(window).height()-100,maxWidth:$(window).width()-100,minHeight:a&&a.minHeight?a.minHeight:void 0,close:function(e){if(d.data("kendoWindow").destroy(),a&&a.grid&&a.grid.setKeyboardFocus(),a&&a.hasOwnProperty("close")){var t=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},i=a.close;t(i)?i.call(this,e):i.hasOwnProperty("handler")&&i.hasOwnProperty("scope")&&t(i.handler)&&i.handler.call(i.scope,arguments)}}}),d.data("kendoWindow").center().open()}};return t}),crmc.define("RestService",[],function(){var e={endpoint:"",cacheKey:"",clientId:"",sessionId:sforce.connection.sessionId,getSessionId:function(t){window.addEventListener("gotSessionId",function(i){var n=i.detail;e.sessionId=n,"function"==typeof t&&t()}),$(window).trigger("getSessionId")},promiseRequest:function(t,i){return new Promise(function(n,a){e.getRequest(t,n,a,i)})},getRequest:function(t,i,n,a){var o=!a&&localStorage&&localStorage.getItem(this.cacheKey);this.cacheObject||(this.cacheObject={});var r=this.cacheObject;r=o?JSON.parse(o):r;var s={Authorization:"Bearer "+e.sessionId,"Sforce-Call-Options":"client=CRMCulture/ActionGrid/"};r[t]&&r[t].dateRetrieved&&(s["If-Modified-Since"]=r[t].dateRetrieved);var l=this;$.ajax({url:t,type:"GET",headers:s,success:function(e,n,o){var s=o.getResponseHeader("Date");if(e&&s&&!a){if(r[t]={value:e,dateRetrieved:s},localStorage&&localStorage.setItem)try{localStorage.setItem(l.cacheKey,JSON.stringify(r))}catch(e){e&&"QuotaExceededError"==e.name&&localStorage.removeItem(l.cacheKey)}}else"notmodified"!=n||a||(e=r[t]&&r[t].value);"function"==typeof i&&i(e)}}).fail(function(o,r,s){var l=o.responseJSON||JSON.parse(o.responseText);if(l.length&&1==l.length&&(l=l[0]),l&&l.errorCode)switch(l.errorCode){case"API_DISABLED_FOR_ORG":e.getSessionId(function(){e.getRequest(t,i,n,a)})}}).fail(n)},postRequest:function(t,i,n,a){var o={"Content-Type":"application/json",Authorization:"Bearer "+e.sessionId,"Sforce-Call-Options":"client=CRMCulture/ActionGrid/"};$.ajax({url:t,type:"POST",dataType:"json",data:JSON.stringify(i),headers:o,success:function(e,t,i){"function"==typeof n&&n(e)}}).fail(function(i,o,r){var s=i.responseJSON||JSON.parse(i.responseText);if(s.length&&1==s.length&&(s=s[0]),s&&s.errorCode)switch(s.errorCode){case"API_DISABLED_FOR_ORG":e.getSessionId(function(){e.getRequest(t,n,a,disableCache)})}}).fail(a)}};return e}),crmc.define("SFRest",["GridConstants","RestService"],function(e,t){var i={},n={},a=Object.create(t);return a.endpoint="/services/data/v37.0/",a.cacheKey=e.localStorageKeys.SFRestCache,a.query=function(e,t,i){var n=[],a=this.endpoint+"query/?q="+encodeURIComponent(e),o=this,r=function(e){var a=!0;n=n.concat(e.records),e.done?(a=!1,t(n)):o.getRequest(e.nextRecordsUrl,r,i,!0)};return"function"!=typeof t?this.promiseRequest(a,!0):void this.getRequest(a,r,i,!0)},a.getSObjectDescribe=function(e,t,n){var a=function(n){i[e]=n,t(n)};this.getRequest(this.endpoint+"sobjects/"+encodeURIComponent(e)+"/describe",a,n)},a.getCachedDescribe=function(e,t,n){if(i[e])t(i[e]);else{var o=function(n){i[e]=n,t(n)};a.getSObjectDescribe(e,o,n)}},a.getCachedDescribeById=function(e,t,i){var o=e.substring(0,3);n[o]?a.getCachedDescribe(n[o],t,i):a.getGlobalDescribes(function(e){Object.each(e.sobjects,function(e){n[e.keyPrefix]=e.name}),n[o]?a.getCachedDescribe(n[o],t,i):"function"==typeof i&&i("Unknown Object Prefix: "+o)},i)},a.getDescribeLayout=function(e,t,i){this.getRequest(kendo.format("{0}sobjects/{1}/describe/layouts",this.endpoint,encodeURIComponent(e)),t,i)},a.getBinaryField=function(e,t,i,n,a){this.getRequest(kendo.format("{0}sobjects/{1}/{2}/{3}",this.endpoint,encodeURIComponent(e),encodeURIComponent(t),encodeURIComponent(i)),n,a)},a.getGlobalDescribes=function(e,t){this.getRequest(this.endpoint+"sobjects",e,t)},a.search=function(e,t,i){this.getRequest(kendo.format("{0}search?q={1}",this.endpoint,encodeURIComponent(e)),t,i)},a.getListViews=function(e,t,i){this.getRequest(this.endpoint+"sobjects/"+e+"/listviews/",t,i)},a.getListView=function(e,t,i,n){this.getRequest(this.endpoint+"sobjects/"+e+"/listviews/"+t+"/describe",i,n)},a.getReport=function(e,t,i){this.getRequest(this.endpoint+"analytics/reports/"+e,t,i)},a}),crmc.define("dateExt",[],function(){Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",MDT:"-0700",PDT:"-0800"}},Date.getMonthNumberFromName=function(e){for(var t=Date.CultureInfo.monthNames,i=Date.CultureInfo.abbreviatedMonthNames,n=e.toLowerCase(),a=0;a<t.length;a++)if(t[a].toLowerCase()==n||i[a].toLowerCase()==n)return a;return-1},Date.getDayNumberFromName=function(e){for(var t=Date.CultureInfo.dayNames,i=Date.CultureInfo.abbreviatedDayNames,n=(Date.CultureInfo.shortestDayNames,e.toLowerCase()),a=0;a<t.length;a++)if(t[a].toLowerCase()==n||i[a].toLowerCase()==n)return a;return-1},Date.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0},Date.getDaysInMonth=function(e,t){return[31,Date.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},Date.getTimezoneOffset=function(e,t){return t?Date.CultureInfo.abbreviatedTimeZoneDST[e.toUpperCase()]:Date.CultureInfo.abbreviatedTimeZoneStandard[e.toUpperCase()]},Date.getTimezoneAbbreviation=function(e,t){var i,n=t?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard;for(i in n)if(n[i]===e)return i;return null},Date.prototype.clone=function(){return new Date(this.getTime())},Date.prototype.compareTo=function(e){if(isNaN(this))throw new Error(this);if(e instanceof Date&&!isNaN(e))return this>e?1:this<e?-1:0;throw new TypeError(e)},Date.prototype.equals=function(e){return 0===this.compareTo(e)},Date.prototype.between=function(e,t){var i=this.getTime();return i>=e.getTime()&&i<=t.getTime()},Date.prototype.addMilliseconds=function(e){return this.setMilliseconds(this.getMilliseconds()+e),this},Date.prototype.addSeconds=function(e){return this.addMilliseconds(1e3*e)},Date.prototype.addMinutes=function(e){return this.addMilliseconds(6e4*e)},Date.prototype.addHours=function(e){return this.addMilliseconds(36e5*e)},Date.prototype.addDays=function(e){return this.addMilliseconds(864e5*e)},Date.prototype.addWeeks=function(e){return this.addMilliseconds(6048e5*e)},Date.prototype.addMonths=function(e){var t=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+e),this.setDate(Math.min(t,this.getDaysInMonth())),this},Date.prototype.addYears=function(e){return this.addMonths(12*e)},Date.prototype.add=function(e){if("number"==typeof e)return this._orient=e,this;var t=e;return(t.millisecond||t.milliseconds)&&this.addMilliseconds(t.millisecond||t.milliseconds),(t.second||t.seconds)&&this.addSeconds(t.second||t.seconds),(t.minute||t.minutes)&&this.addMinutes(t.minute||t.minutes),(t.hour||t.hours)&&this.addHours(t.hour||t.hours),(t.month||t.months)&&this.addMonths(t.month||t.months),(t.year||t.years)&&this.addYears(t.year||t.years),(t.day||t.days)&&this.addDays(t.day||t.days),this},Date._validate=function(e,t,i,n){if("number"!=typeof e)throw new TypeError(e+" is not a Number.");if(e<t||e>i)throw new RangeError(e+" is not a valid value for "+n+".");return!0},Date.validateMillisecond=function(e){return Date._validate(e,0,999,"milliseconds")},Date.validateSecond=function(e){return Date._validate(e,0,59,"seconds")},Date.validateMinute=function(e){return Date._validate(e,0,59,"minutes")},Date.validateHour=function(e){return Date._validate(e,0,23,"hours")},Date.validateDay=function(e,t,i){return Date._validate(e,1,Date.getDaysInMonth(t,i),"days")},Date.validateMonth=function(e){return Date._validate(e,0,11,"months")},Date.validateYear=function(e){return Date._validate(e,1,9999,"seconds")},Date.prototype.set=function(e){var t=e;return t.millisecond||0===t.millisecond||(t.millisecond=-1),t.second||0===t.second||(t.second=-1),t.minute||0===t.minute||(t.minute=-1),t.hour||0===t.hour||(t.hour=-1),t.day||0===t.day||(t.day=-1),t.month||0===t.month||(t.month=-1),t.year||0===t.year||(t.year=-1),t.millisecond!=-1&&Date.validateMillisecond(t.millisecond)&&this.addMilliseconds(t.millisecond-this.getMilliseconds()),t.second!=-1&&Date.validateSecond(t.second)&&this.addSeconds(t.second-this.getSeconds()),t.minute!=-1&&Date.validateMinute(t.minute)&&this.addMinutes(t.minute-this.getMinutes()),t.hour!=-1&&Date.validateHour(t.hour)&&this.addHours(t.hour-this.getHours()),t.month!==-1&&Date.validateMonth(t.month)&&this.addMonths(t.month-this.getMonth()),t.year!=-1&&Date.validateYear(t.year)&&this.addYears(t.year-this.getFullYear()),t.day!=-1&&Date.validateDay(t.day,this.getFullYear(),this.getMonth())&&this.addDays(t.day-this.getDate()),t.timezone&&this.setTimezone(t.timezone),t.timezoneOffset&&this.setTimezoneOffset(t.timezoneOffset),this},Date.prototype.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},Date.prototype.isLeapYear=function(){var e=this.getFullYear();return e%4===0&&e%100!==0||e%400===0},Date.prototype.isWeekday=function(){return!(this.is().sat()||this.is().sun())},Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())},Date.prototype.moveToFirstDayOfMonth=function(){return this.set({day:1})},Date.prototype.moveToLastDayOfMonth=function(){return this.set({day:this.getDaysInMonth()})},Date.prototype.moveToDayOfWeek=function(e,t){var i=(e-this.getDay()+7*(t||1))%7;return this.addDays(0===i?i+=7*(t||1):i)},Date.prototype.moveToMonth=function(e,t){var i=(e-this.getMonth()+12*(t||1))%12;return this.addMonths(0===i?i+=12*(t||1):i)},Date.prototype.getDayOfYear=function(){return Math.floor((this-new Date(this.getFullYear(),0,1))/864e5)},Date.prototype.getWeekOfYear=function(e){var t=this.getFullYear(),i=this.getMonth(),n=this.getDate(),a=e||Date.CultureInfo.firstDayOfWeek,o=8-new Date(t,0,1).getDay();8==o&&(o=1);var r=(Date.UTC(t,i,n,0,0,0)-Date.UTC(t,0,1,0,0,0))/864e5+1,s=Math.floor((r-o+7)/7);if(s===a){t--;var l=8-new Date(t,0,1).getDay();s=2==l||8==l?53:52}return s},Date.prototype.isDST=function(){return console.log("isDST"),"D"==this.toString().match(/(E|C|M|P)(S|D)T/)[2]},Date.prototype.getTimezone=function(){return Date.getTimezoneAbbreviation(this.getUTCOffset,this.isDST())},Date.prototype.setTimezoneOffset=function(e){var t=this.getTimezoneOffset(),i=Number(e)*-6/10;return this.addMinutes(i-t),this},Date.prototype.setTimezone=function(e){return this.setTimezoneOffset(Date.getTimezoneOffset(e))},Date.prototype.getUTCOffset=function(){var e,t=this.getTimezoneOffset()*-10/6;return t<0?(e=(t-1e4).toString(),e[0]+e.substr(2)):(e=(t+1e4).toString(),"+"+e.substr(1))},Date.prototype.getDayName=function(e){return e?Date.CultureInfo.abbreviatedDayNames[this.getDay()]:Date.CultureInfo.dayNames[this.getDay()]},Date.prototype.getMonthName=function(e){return e?Date.CultureInfo.abbreviatedMonthNames[this.getMonth()]:Date.CultureInfo.monthNames[this.getMonth()]},Date.prototype._toString=Date.prototype.toString,Date.prototype.toString=function(e){var t=this,i=function(e){return 1==e.toString().length?"0"+e:e};return e?e.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?/g,function(e){switch(e){case"hh":return i(t.getHours()<13?t.getHours():t.getHours()-12);case"h":return t.getHours()<13?t.getHours():t.getHours()-12;case"HH":return i(t.getHours());case"H":return t.getHours();case"mm":return i(t.getMinutes());case"m":return t.getMinutes();case"ss":return i(t.getSeconds());case"s":return t.getSeconds();case"yyyy":return t.getFullYear();case"yy":return t.getFullYear().toString().substring(2,4);case"dddd":return t.getDayName();case"ddd":return t.getDayName(!0);case"dd":return i(t.getDate());case"d":return t.getDate().toString();case"MMMM":return t.getMonthName();case"MMM":return t.getMonthName(!0);case"MM":return i(t.getMonth()+1);case"M":return t.getMonth()+1;case"t":return t.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"zzz":case"zz":case"z":return""}}):this._toString()},Date._now=function(){return new Date},Date.today=function(){return Date._now().clearTime()},Date.prototype._orient=1,Date.prototype.next=function(){return this._orient=1,this},Date.prototype.last=Date.prototype.prev=Date.prototype.previous=function(){return this._orient=-1,this},Date.prototype._is=!1,Date.prototype.is=function(){return this._is=!0,this},Number.prototype._dateElement="day",Number.prototype.fromNow=function(){var e={};return e[this._dateElement]=this,Date._now().add(e)},Number.prototype.ago=function(){var e={};return e[this._dateElement]=this*-1,Date._now().add(e)},function(){for(var e,t=Date.prototype,i=Number.prototype,n="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),a="january february march april may june july august september october november december".split(/\s/),o="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),r=function(e){return function(){return this._is?(this._is=!1,this.getDay()==e):this.moveToDayOfWeek(e,this._orient)}},s=0;s<n.length;s++)t[n[s]]=t[n[s].substring(0,3)]=r(s);for(var l=function(e){return function(){return this._is?(this._is=!1,this.getMonth()===e):this.moveToMonth(e,this._orient)}},d=0;d<a.length;d++)t[a[d]]=t[a[d].substring(0,3)]=l(d);for(var c=function(e){return function(){return"s"!=e.substring(e.length-1)&&(e+="s"),this["add"+e](this._orient)}},u=function(e){return function(){return this._dateElement=e,this}},f=0;f<o.length;f++)e=o[f].toLowerCase(),t[e]=t[e+"s"]=c(o[f]),i[e]=i[e+"s"]=u(e)}(),Date.prototype.toJSONString=function(){return this.toString("yyyy-MM-ddThh:mm:ssZ")},Date.prototype.toShortDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortDatePattern)},Date.prototype.toLongDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.longDatePattern)},Date.prototype.toShortTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortTimePattern)},Date.prototype.toLongTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.longTimePattern)},Date.prototype.getOrdinal=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},function(){Date.Parsing={Exception:function(e){this.message="Parse error at '"+e.substring(0,10)+" ...'"}};for(var e=Date.Parsing,t=e.Operators={rtoken:function(t){return function(i){var n=i.match(t);if(n)return[n[0],i.substring(n[0].length)];throw new e.Exception(i)}},token:function(e){return function(e){return t.rtoken(new RegExp("^s*"+e+"s*"))(e)}},stoken:function(e){return t.rtoken(new RegExp("^"+e))},until:function(e){return function(t){for(var i=[],n=null;t.length;){try{n=e.call(this,t)}catch(e){i.push(n[0]),t=n[1];continue}break}return[i,t]}},many:function(e){return function(t){for(var i=[],n=null;t.length;){try{n=e.call(this,t)}catch(e){return[i,t]}i.push(n[0]),t=n[1]}return[i,t]}},optional:function(e){return function(t){var i=null;try{i=e.call(this,t)}catch(e){return[null,t]}return[i[0],i[1]]}},not:function(t){return function(i){try{t.call(this,i)}catch(e){return[null,i]}throw new e.Exception(i)}},ignore:function(e){return e?function(t){var i=null;return i=e.call(this,t),[null,i[1]]}:null},product:function(){for(var e=arguments[0],i=Array.prototype.slice.call(arguments,1),n=[],a=0;a<e.length;a++)n.push(t.each(e[a],i));return n},cache:function(t){var i={},n=null;return function(a){try{n=i[a]=i[a]||t.call(this,a)}catch(e){n=i[a]=e}if(n instanceof e.Exception)throw n;return n}},any:function(){var t=arguments;return function(i){for(var n=null,a=0;a<t.length;a++)if(null!=t[a]){try{n=t[a].call(this,i)}catch(e){n=null}if(n)return n}throw new e.Exception(i)}},each:function(){var t=arguments;return function(i){for(var n=[],a=null,o=0;o<t.length;o++)if(null!=t[o]){try{a=t[o].call(this,i)}catch(t){throw new e.Exception(i)}n.push(a[0]),i=a[1]}return[n,i]}},all:function(){var e=arguments,t=t;return t.each(t.optional(e))},sequence:function(i,n,a){return n=n||t.rtoken(/^\s*/),a=a||null,1==i.length?i[0]:function(t){for(var o=null,r=null,s=[],l=0;l<i.length;l++){try{o=i[l].call(this,t)}catch(e){break}s.push(o[0]);try{r=n.call(this,o[1])}catch(e){r=null;break}t=r[1]}if(!o)throw new e.Exception(t);if(r)throw new e.Exception(r[1]);if(a)try{o=a.call(this,o[1])}catch(t){throw new e.Exception(o[1])}return[s,o?o[1]:t]}},between:function(e,i,n){n=n||e;var a=t.each(t.ignore(e),i,t.ignore(n));return function(e){var t=a.call(this,e);return[[t[0][0],r[0][2]],t[1]]}},list:function(e,i,n){return i=i||t.rtoken(/^\s*/),n=n||null,e instanceof Array?t.each(t.product(e.slice(0,-1),t.ignore(i)),e.slice(-1),t.ignore(n)):t.each(t.many(t.each(e,t.ignore(i))),px,t.ignore(n))},set:function(i,n,a){return n=n||t.rtoken(/^\s*/),a=a||null,function(o){for(var r=null,s=null,l=null,d=null,c=[[],o],u=!1,f=0;f<i.length;f++){l=null,s=null,r=null,u=1==i.length;try{r=i[f].call(this,o)}catch(e){continue}if(d=[[r[0]],r[1]],r[1].length>0&&!u)try{l=n.call(this,r[1])}catch(e){u=!0}else u=!0;if(u||0!==l[1].length||(u=!0),!u){for(var p=[],h=0;h<i.length;h++)f!=h&&p.push(i[h]);s=t.set(p,n).call(this,l[1]),s[0].length>0&&(d[0]=d[0].concat(s[0]),d[1]=s[1])}if(d[1].length<c[1].length&&(c=d),0===c[1].length)break}if(0===c[0].length)return c;if(a){try{l=a.call(this,c[1])}catch(t){throw new e.Exception(c[1])}c[1]=l[1]}return c}},forward:function(e,t){return function(i){return e[t].call(this,i)}},replace:function(e,t){return function(i){var n=e.call(this,i);return[t,n[1]]}},process:function(e,t){return function(i){var n=e.call(this,i);return[t.call(this,n[0]),n[1]]}},min:function(t,i){return function(n){var a=i.call(this,n);if(a[0].length<t)throw new e.Exception(n);return a}}},i=function(e){return function(){var t=null,i=[];if(arguments.length>1?t=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(t=arguments[0]),!t)return e.apply(null,arguments);for(var n=0,a=t.shift();n<a.length;n++)return t.unshift(a[n]),i.push(e.apply(null,t)),t.shift(),i}},n="optional not ignore cache".split(/\s/),a=0;a<n.length;a++)t[n[a]]=i(t[n[a]]);for(var o=function(e){return function(){return arguments[0]instanceof Array?e.apply(null,arguments[0]):e.apply(null,arguments)}},s="each any all".split(/\s/),l=0;l<s.length;l++)t[s[l]]=o(t[s[l]])}(),function(){var e=function(t){for(var i=[],n=0;n<t.length;n++)t[n]instanceof Array?i=i.concat(e(t[n])):t[n]&&i.push(t[n]);return i};Date.Grammar={},Date.Translator={hour:function(e){return function(){this.hour=Number(e)}},minute:function(e){return function(){this.minute=Number(e)}},second:function(e){return function(){this.second=Number(e)}},meridian:function(e){return function(){this.meridian=e.slice(0,1).toLowerCase()}},timezone:function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},day:function(e){var t=e[0];return function(){this.day=Number(t.match(/\d+/)[0])}},month:function(e){return function(){this.month=3==e.length?Date.getMonthNumberFromName(e):Number(e)-1}},year:function(e){return function(){var t=Number(e);this.year=e.length>2?t:t+(t+2e3<Date.CultureInfo.twoDigitYearMax?2e3:1900)}},rday:function(e){return function(){switch(e){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(e){e=e instanceof Array?e:[e];var t=new Date;this.year=t.getFullYear(),this.month=t.getMonth(),this.day=1,this.hour=0,this.minute=0,this.second=0;for(var i=0;i<e.length;i++)e[i]&&e[i].call(this);if(this.hour="p"==this.meridian&&this.hour<13?this.hour+12:this.hour,this.day>Date.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");
var n=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return this.timezone?n.set({timezone:this.timezone}):this.timezoneOffset&&n.set({timezoneOffset:this.timezoneOffset}),n},finish:function(t){if(t=t instanceof Array?e(t):[t],0===t.length)return null;for(var i=0;i<t.length;i++)"function"==typeof t[i]&&t[i].call(this);if(this.now)return new Date;var n=Date.today(),a=!(null==this.days&&!this.orient&&!this.operator);if(a){var o,r,s;return s="past"==this.orient||"subtract"==this.operator?-1:1,this.weekday&&(this.unit="day",o=Date.getDayNumberFromName(this.weekday)-n.getDay(),r=7,this.days=o?(o+s*r)%r:s*r),this.month&&(this.unit="month",o=this.month-n.getMonth(),r=12,this.months=o?(o+s*r)%r:s*r,this.month=null),this.unit||(this.unit="day"),null!=this[this.unit+"s"]&&null==this.operator||(this.value||(this.value=1),"week"==this.unit&&(this.unit="day",this.value=7*this.value),this[this.unit+"s"]=this.value*s),n.add(this)}return this.meridian&&this.hour&&(this.hour=this.hour<13&&"p"==this.meridian?this.hour+12:this.hour),this.weekday&&!this.day&&(this.day=n.addDays(Date.getDayNumberFromName(this.weekday)-n.getDay()).getDate()),this.month&&!this.day&&(this.day=1),n.set(this)}};var t,i=Date.Parsing.Operators,n=Date.Grammar,a=Date.Translator;n.datePartDelimiter=i.rtoken(/^([\s\-\.\,\/\x27]+)/),n.timePartDelimiter=i.stoken(":"),n.whiteSpace=i.rtoken(/^\s*/),n.generalDelimiter=i.rtoken(/^(([\s\,]|at|on)+)/);var o={};n.ctoken=function(e){var t=o[e];if(!t){for(var n=Date.CultureInfo.regexPatterns,a=e.split(/\s+/),r=[],s=0;s<a.length;s++)r.push(i.replace(i.rtoken(n[a[s]]),a[s]));t=o[e]=i.any.apply(null,r)}return t},n.ctoken2=function(e){return i.rtoken(Date.CultureInfo.regexPatterns[e])},n.h=i.cache(i.process(i.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),a.hour)),n.hh=i.cache(i.process(i.rtoken(/^(0[0-9]|1[0-2])/),a.hour)),n.H=i.cache(i.process(i.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),a.hour)),n.HH=i.cache(i.process(i.rtoken(/^([0-1][0-9]|2[0-3])/),a.hour)),n.m=i.cache(i.process(i.rtoken(/^([0-5][0-9]|[0-9])/),a.minute)),n.mm=i.cache(i.process(i.rtoken(/^[0-5][0-9]/),a.minute)),n.s=i.cache(i.process(i.rtoken(/^([0-5][0-9]|[0-9])/),a.second)),n.ss=i.cache(i.process(i.rtoken(/^[0-5][0-9]/),a.second)),n.hms=i.cache(i.sequence([n.H,n.mm,n.ss],n.timePartDelimiter)),n.t=i.cache(i.process(n.ctoken2("shortMeridian"),a.meridian)),n.tt=i.cache(i.process(n.ctoken2("longMeridian"),a.meridian)),n.z=i.cache(i.process(i.rtoken(/^(\+|\-)?\s*\d\d\d\d?/),a.timezone)),n.zz=i.cache(i.process(i.rtoken(/^(\+|\-)\s*\d\d\d\d/),a.timezone)),n.zzz=i.cache(i.process(n.ctoken2("timezone"),a.timezone)),n.timeSuffix=i.each(i.ignore(n.whiteSpace),i.set([n.tt,n.zzz])),n.time=i.each(i.optional(i.ignore(i.stoken("T"))),n.hms,n.timeSuffix),n.d=i.cache(i.process(i.each(i.rtoken(/^([0-2]\d|3[0-1]|\d)/),i.optional(n.ctoken2("ordinalSuffix"))),a.day)),n.dd=i.cache(i.process(i.each(i.rtoken(/^([0-2]\d|3[0-1])/),i.optional(n.ctoken2("ordinalSuffix"))),a.day)),n.ddd=n.dddd=i.cache(i.process(n.ctoken("sun mon tue wed thu fri sat"),function(e){return function(){this.weekday=e}})),n.M=i.cache(i.process(i.rtoken(/^(1[0-2]|0\d|\d)/),a.month)),n.MM=i.cache(i.process(i.rtoken(/^(1[0-2]|0\d)/),a.month)),n.MMM=n.MMMM=i.cache(i.process(n.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),a.month)),n.y=i.cache(i.process(i.rtoken(/^(\d\d?)/),a.year)),n.yy=i.cache(i.process(i.rtoken(/^(\d\d)/),a.year)),n.yyy=i.cache(i.process(i.rtoken(/^(\d\d?\d?\d?)/),a.year)),n.yyyy=i.cache(i.process(i.rtoken(/^(\d\d\d\d)/),a.year)),t=function(){return i.each(i.any.apply(null,arguments),i.not(n.ctoken2("timeContext")))},n.day=t(n.d,n.dd),n.month=t(n.M,n.MMM),n.year=t(n.yyyy,n.yy),n.orientation=i.process(n.ctoken("past future"),function(e){return function(){this.orient=e}}),n.operator=i.process(n.ctoken("add subtract"),function(e){return function(){this.operator=e}}),n.rday=i.process(n.ctoken("yesterday tomorrow today now"),a.rday),n.unit=i.process(n.ctoken("minute hour day week month year"),function(e){return function(){this.unit=e}}),n.value=i.process(i.rtoken(/^\d\d?(st|nd|rd|th)?/),function(e){return function(){this.value=e.replace(/\D/g,"")}}),n.expression=i.set([n.rday,n.operator,n.value,n.unit,n.orientation,n.ddd,n.MMM]),t=function(){return i.set(arguments,n.datePartDelimiter)},n.mdy=t(n.ddd,n.month,n.day,n.year),n.ymd=t(n.ddd,n.year,n.month,n.day),n.dmy=t(n.ddd,n.day,n.month,n.year),n.date=function(e){return(n[Date.CultureInfo.dateElementOrder]||n.mdy).call(this,e)},n.format=i.process(i.many(i.any(i.process(i.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(e){if(n[e])return n[e];throw Date.Parsing.Exception(e)}),i.process(i.rtoken(/^[^dMyhHmstz]+/),function(e){return i.ignore(i.stoken(e))}))),function(e){return i.process(i.each.apply(null,e),a.finishExact)});var r={},s=function(e){return r[e]=r[e]||n.format(e)[0]};n.formats=function(e){if(e instanceof Array){for(var t=[],n=0;n<e.length;n++)t.push(s(e[n]));return i.any.apply(null,t)}return s(e)},n._formats=n.formats(["yyyy-MM-ddTHH:mm:ss","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","d"]),n._start=i.process(i.set([n.date,n.time,n.expression],n.generalDelimiter,n.whiteSpace),a.finish),n.start=function(e){try{var t=n._formats.call({},e);if(0===t[1].length)return t}catch(e){}return n._start.call({},e)}}(),Date._parse=Date.parse,Date.parse=function(e){var t=null;if(!e)return null;try{t=Date.Grammar.start.call({},e)}catch(e){return null}return 0===t[1].length?t[0]:null},Date.getParseFunction=function(e){var t=Date.Grammar.formats(e);return function(e){var i=null;try{i=t.call({},e)}catch(e){return null}return 0===i[1].length?i[0]:null}},Date.parseExact=function(e,t){return Date.getParseFunction(t)(e)},Date.prototype.isBefore=function(e){return this.compareTo(e)<0},Date.prototype.isAfter=function(e){return this.compareTo(e)>0}}),crmc.define("extensions",["dateExt"],function(){"function"!=typeof Object.create&&(Object.create=function(e){var t=function(){};return t.prototype=e,new t}),"function"!=typeof Object.copy&&(Object.copy=function(e,t){return t=t||{},Object.each(e,function(e,i){t[i]=e}),t}),"function"!=typeof Object.each&&(Object.each=function(e,t){for(var i in e)e.hasOwnProperty(i)&&t(e[i],i)}),"function"!=typeof Object.where&&(Object.where=function(e,t){var i=[];return Object.each(e,function(e,n){t(e,n)&&i.push(e)}),i}),"function"!=typeof Object.first&&(Object.first=function(e,t){for(var i in e)if(e.hasOwnProperty(i)&&t(e[i],i))return e[i]}),"function"!=typeof Array.orderBy&&(Array.orderBy=function(e,t){return e.sort(function(e,i){return t(e)<t(i)?-1:t(e)>t(i)?1:0})}),"function"!=typeof String.format&&(String.format=function(e){for(var t=e.match(/{\d+}/g),i=0;i<t.length;i++){var n=parseInt(t[i].replace(/[{}]/,""));e=e.replace(t[i],arguments[n+1])}return e}),String.prototype.toTitleCase=function(){var e=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;return this.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(t,i,n){return i>0&&i+t.length!==n.length&&t.search(e)>-1&&":"!==n.charAt(i-2)&&("-"!==n.charAt(i+t.length)||"-"===n.charAt(i-1))&&n.charAt(i-1).search(/[^\s-]/)<0?t.toLowerCase():t.substr(1).search(/[A-Z]|\../)>-1?t:t.charAt(0).toUpperCase()+t.substr(1)})},String.prototype.prettifyAPIName=function(){return this.replace("__r","").split(/(?=[A-Z])/).join(" ").replace(/\_/g," ").replace(/\ \ /g," ").toTitleCase()},String.prototype.distance=function(e){var t=this;if(0==t.length)return e.length;if(0==e.length)return t.length;var i,n=[];for(i=0;i<=e.length;i++)n[i]=[i];var a;for(a=0;a<=t.length;a++)n[0][a]=a;for(i=1;i<=e.length;i++)for(a=1;a<=t.length;a++)e.charAt(i-1)==t.charAt(a-1)?n[i][a]=n[i-1][a-1]:n[i][a]=Math.min(n[i-1][a-1]+1,Math.min(n[i][a-1]+1,n[i-1][a]+1));return n[e.length][t.length]}}),crmc.define("sfdc",["GridConstants","SFRest","extensions"],function(e,t){return{namespace:void 0,sessionId:void 0,describeCache:{},describeLayoutCache:{},describeLayoutRecordTypeCache:{},licensedPackageCache:void 0,initSforce:function(){sforce.connection.client="CRMCulture/ActionGrid/",sforce&&sforce.connection&&sforce.connection.serverUrl&&0!=sforce.connection.serverUrl.indexOf(UserContext.siteUrlPrefix)&&(sforce.connection.serverUrl=UserContext.siteUrlPrefix+sforce.connection.serverUrl),this.sessionId&&(sforce.connection.sessionId=this.sessionId)},parseAsObject:function(){for(var e=location.search.slice(1).split("&"),t={},i=0;i<e.length;i++){var n=e[i].split("=");2===n.length&&(t[unescape(n[0])]=unescape(n[1]))}return t},isSandbox:function(){var e,t=window.location.hostname.split(".");return e=5==t.length?t[1]:3==t.length?t[0]:t[1],e&&e[0]&&"c"==e[0].toLowerCase()},executeRemoteAction:function(t,i,n,a){var o=this;t=o.getRemoteAction(e.VF_APEX_CONTROLLER,t),i.unshift(t),i.push(n),a&&i.push(a),Visualforce.remoting.Manager.invokeAction.apply(Visualforce.remoting.Manager,i)},promiseRemoteAction:function(e,t,i){var n=this;return new Promise(function(a,o){n.executeRemoteAction(e,t,function(e,t){t.status?a(e,t):o(t)},i)})},parseAsArray:function(e){var t=[],i=this.parseAsObject();if(void 0!==i[e])for(var n=i[e].split(","),a=0;a<n.length;a++)""!=n[a]&&t.push(n[a]);return t},parseDate:function(e,t){var i=e;return"number"==typeof e&&(i=new Date(e),i="date"!==t.toLowerCase()?this.convertToUserDateTime(i):new Date(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate())),i},formatPhone:function(e){var t="",n=e.trim(),a="",o=-1;if(0<n.length&&"+"!=n.charAt(0)){var r=0;for("1"==n.charAt(0)&&(n=n.substring(1,n.length)),i=0;i<n.length;i++){var s=n.charAt(i);if("0"<=s&&"9">=s&&(0==r?a+="(":3==r?a+=") ":6==r&&(a+="-"),a+=s,r++),!("0"<=s&&"9">=s)&&" "!=s&&"-"!=s&&"."!=s&&"("!=s&&")"!=s){o=i;break}}return 0<=o&&(a+=" "+n.substring(o,n.length)),10==r&&40>=a.length&&(t=a),t}},importScript:function(e,t){var i=document.createElement("script");t&&(i.onload=t),document.getElementsByTagName("HEAD").item(0).appendChild(i),i.src=e},popupWindow:function(e,t){var i=window.outerWidth-365,n=window.outerHeight-115,a=window.screenX+350,o=window.screenY+50;return window.open(e,t?t:"_blank","toolbar=yes,location=yes,menubar=yes,resizable=yes,scrollbars=yes,status=yes, height="+n+", width="+i+", left="+a+", top="+o)},navigateToVFPage:function(e,t,i,n,a){var o=[];Object.each(i,function(e,t){e&&t&&o.push(encodeURIComponent(t)+"="+encodeURIComponent(e))});var r=String.format("/apex/{0}__{1}?{2}",e,t,o.join("&"));if(n)this.popupWindow(r);else{var s=window.open(r,a?a:"_top","toolbar=yes,location=yes,menubar=yes,resizable=yes,scrollbars=yes,status=yes");s.focus()}},getRecordURL:function(e,t,i){var n="",a="";window.UserContext&&UserContext.siteUrlPrefix&&(n=UserContext.siteUrlPrefix),t&&(a="/e");var o=n+"/"+e+a,r=this.isInConsole(),s=this.isLightningExperienceOrSalesforce1();return r&&window.srcUp?"javascript:srcUp('"+encodeURIComponent(o+"?isdtp=vw'")+");":r&&sforce&&sforce.console&&sforce.console.openPrimaryTab?kendo.format("javascript:sforce.console.openPrimaryTab(null, '{0}');",o):s?kendo.format("javascript:SfdcApp.projectOneNavigator.fireContainerEvent('force:navigateToSObject', {recordId:'{0}'});",e):n+"/"+e+a+(void 0!=i?"?retURL="+encodeURIComponent(i):"")},isInConsole:function(){var e=location.search;return!("undefined"!=typeof sforce&&sforce.one)&&0!==e.length&&e.indexOf("agFS")==-1&&(e.indexOf("?isdtp=")>-1||e.indexOf("&isdtp=")>-1)||"undefined"!=typeof canvasClient&&canvasClient.isInConsole&&canvasClient.isInConsole()},getSfdcURL:function(e,t,i,n){var a,o="",r=window.location.hostname.split(".");if(5==r.length){a=r[1];var s=r[0].lastIndexOf("--");s>-1&&(o=r[0].substring(0,s+2))}else a=3==r.length?r[0]:r[1];var l=[];Object.each(i,function(e,t){e&&t&&l.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),e=e.replace("_","-");var d=o+e?o+e:"c";return String.format("{0}//{1}.{2}.visual.force.com/{5}/{3}?{4}",location.protocol,d,a,t,l.join("&"),n)},getStaticResourceURL:function(e,t,i){return this.getSfdcURL(e,t,i,"resource")},getVFPageURL:function(e,t,i){return this.getSfdcURL(e,t,i,"apex")},postToVFPage:function(e,t,i,n,a,o){var r=this.getVFPageURL(e,t,i),s=document.createElement("form");s.method="post",s.action=r,s.setAttribute("target",o?o:"_top"),Object.each(n,function(e,t){var i=document.createElement("input");i.type="hidden","object"==typeof e&&void 0!==e.name&&void 0!==e.value?(i.name=e.name,i.value=e.value):(i.name=t,i.value=e),s.appendChild(i)}),a&&s.setAttribute("target",t),document.body.appendChild(s),s.submit()},navigateToPage:function(e,t,i,n,a){var o=[];Object.each(t,function(e,t){o.push(encodeURIComponent(t)+"="+encodeURIComponent(e))});var r=String.format("/{0}{1}{2}",e,o.length>0?"?"+o.join("&"):"",a?a:"");if(i)this.popupWindow(r);else{var s=window.open(r,n?n:"_top");s.focus()}},getSObjectDescribe:function(e){return this.initSforce(),this.describeCache[e]||(this.describeCache[e]=sforce.connection.describeSObject(e)),this.describeCache[e]},getDescribeGlobal:function(e){this.initSforce();var t;if(this.describeGlobal)t=this.describeGlobal,"function"==typeof e&&e(t);else{var i=this;"function"==typeof e?sforce.connection.describeGlobal(function(t){i.describeGlobal=t,e(t)}):(t=sforce.connection.describeGlobal(),this.describeGlobal=t)}return t},getDescribeLayout:function(e){this.initSforce();var t;return this.describeLayoutCache[e]?t=this.describeLayoutCache[e]:(t=sforce.connection.describeLayout(e),this.describeLayoutCache[e]=t),t},getDescribeLayoutByRecordType:function(e,t,i){this.initSforce();var n=this;this.describeLayoutRecordTypeCache[t]?"function"==typeof i&&i(this.describeLayoutRecordTypeCache[t]):sforce.connection.describeLayout(e,null,[t],function(e){n.describeLayoutRecordTypeCache[t]=e,"function"==typeof i&&i(e)})},getPicklistsForRecordTypes:function(e){this.initSforce();var t={};return e.getBoolean?t.selectorRequired=e.getBoolean("recordTypeSelectorRequired"):e.recordTypeSelectorRequired&&e.recordTypeSelectorRequired.length>0&&(t.selectorRequired=e.recordTypeSelectorRequired[0]),e.recordTypeMappings&&(e.recordTypeMappings instanceof Array||(e.recordTypeMappings=[e.recordTypeMappings]),Object.each(e.recordTypeMappings,function(e){t[e.recordTypeId]={_name:e.name,_isAvailable:e.available,_isDefault:e.defaultRecordTypeMapping};var i=[].concat(e.picklistsForRecordType);Object.each(i,function(i){t[e.recordTypeId][i.picklistName]=i.picklistValues}),t[e.recordTypeId]._isDefault&&(t.defaultRecordTypeId=e.recordTypeId)})),t},getAvailableObjects:function(e,t){var i=["Note","Task","Profile","Event","CampaignMember","CaseContactRole","OrderItem","OpportunityLineItem","QuoteLineItem","OpportunityTeamMember","OpportunityContactRole","PricebookEntry","Pricebook2"],n=this.getDescribeGlobal(),a=n.getArray("sobjects"),o=[];return Object.each(a,function(n){if(i.indexOf(n.name)>-1||!n.getBoolean("deprecatedAndHidden")&&n.getBoolean("queryable")&&n.getBoolean("retrieveable")&&n.getBoolean("searchable")&&n.getBoolean("layoutable")){var a={};Object.each(n,function(e,t){a[t]=e}),e&&t(n.name)===!1||o.push(a)}}),o=Array.orderBy(o,function(e){return e.label.toLowerCase()})},getSavedViews:function(i,n,a){var o=[];try{var r=String.format("select Id, Name, {0}JSON__c, {0}Privacy__c, OwnerId, {0}Description__c, {0}IsDefault__c, {0}Context__c from {0}GridView__c where {0}ObjectName__c like '{1}' and isDeleted = false and ({0}Context__c {2} '{3}' or {0}Context__c = null) order by {0}Privacy__c, Name",this.getNamespace(!0),i,n?"=":"!=",e.viewContext.pageLayout);"function"==typeof a?t.query(r,a,function(e){console.log(JSON.stringify(e))}):o=this.query(r)}catch(e){}return o},getSObjectNameField:function(e){var t=Object.first(e.fields,function(e){return e.getBoolean("nameField")});return t?t.name:void 0},query:function(e){arguments.length>1&&(e=String.format.apply(String,arguments)),window.isDebug&&console.log(e);try{this.initSforce();var t=sforce.connection.queryAll(e);return t.getArray("records")}catch(e){throw console.log(e.faultstring),e}},queryAsync:function(e,t,i){var n=[];this.initSforce();var a=function(e){var o=!0;n=n.concat(e.getArray("records")),e.getBoolean("done")?(o=!1,t(n)):sforce.connection.queryMore(e.queryLocator,{onSuccess:a,onFailure:i})};sforce.connection.query(e,{onSuccess:a,onFailure:i})},batchQueryIn:function(e,t,i,n){var a=[],o="select {0} from {1} where {2} in ({3})";t instanceof Array&&(t=t.join());var r=85,s=Math.ceil(n.length/r);s<1&&(s=1);for(var l=0;l<s;l++){var d=n.slice(l*r,(l+1)*r),c=this.query(o,t,e,i,d.join());a=a.concat(c)}return a},errorHandlerObject:function(e,t,i){return{onSuccess:function(n){var a,o,r=n[0],s=!0;i?(Object.each(n,function(e){e.getBoolean("success")||(s=!1)}),n.length>1?(a=n,o=n):(a=r.errors||r.faultstring||r,o=r)):(s=r.getBoolean("success"),r.errors&&(r.errors=[].concat(r.errors),a=r.errors[0].message),o=r),s?e(o):"function"==typeof t&&t(a)},onFailure:function(e){"function"==typeof t&&t(i?e:e.message||e.faultstring||e)}}},update:function(e,t,i,n){this.initSforce(),sforce.connection.update([e],this.errorHandlerObject(t,i,n))},upsert:function(e,t,i,n){this.initSforce(),sforce.connection.upsert(e,[t],this.errorHandlerObject(i,n,!0))},insert:function(e,t,i,n){this.initSforce(),e instanceof Array||(e=[e]),sforce.connection.create(e,this.errorHandlerObject(t,i,n))},batchUpdate:function(e,t){this.initSforce(),e instanceof Array||(e=[e]);var i,n=200,a=[],o=e.length/200,r=0,s=function(e){a=a.concat(e),r++,r>=o&&"function"==typeof t&&t(a)};for(i=0;i<e.length;i+=n)sforce.connection.update(e.slice(i,i+n),{onSuccess:s,onFailure:s})},batchInsert:function(e,t){this.initSforce(),e instanceof Array||(e=[e]);var i,n=200,a=[],o=function(i){a=a.concat(i),a.length==e.length&&"function"==typeof t&&t(a)};for(i=0;i<e.length;i+=n)sforce.connection.create(e.slice(i,i+n),{onSuccess:o,onFailure:o})},batchDelete:function(e,t){this.initSforce(),e instanceof Array||(e=[e]);for(var i=200,n=[],a=function(i){i&&i.length&&$.merge(n,i),n.length==e.length&&"function"==typeof t&&t(n)},o=0;o<e.length;o+=i)sforce.connection.deleteIds(e.slice(o,o+i),{onSuccess:a,onFailure:a})},getUserInfo:function(e){if(!this.userInfo)if(window.isDebug)this.userInfo={organizationId:"00Do0000000KXVqEAO",userLocale:"en_US",userTimeZone:"America/Denver",currencySymbol:"$",userId:"",orgHasPersonAccounts:!1};else try{if(this.initSforce(),"function"==typeof e)var t=function(t){this.userInfo=t,e(t)};this.userInfo=sforce.connection.getUserInfo(t)}catch(e){console.log(e)}return this.userInfo},setCulture:function(e,t){var i=document.getElementsByTagName("HEAD").item(0),n=this;if(i){var a=document.createElement("script");a.type="text/javascript",i.appendChild(a),a.src=t,a.onerror=function(e){console.log(arguments)},a.onload=function(){kendo.culture(e);var t=kendo.culture();if(t&&t.numberFormat&&t.numberFormat.currency){var i=n.getUserInfo(),a=i.currencySymbol||"";t.numberFormat.currency.symbol=a}}}},getProfileTimezoneOffset:function(){var e=new Date,t=this.convertToUserDateTime(e),i=t.valueOf(),n=e.valueOf(),a=Math.round((n-i)/1e3/60);return a},getDateWithOffset:function(e,t){var i=e.valueOf();return new Date(i+60*t*1e3)},convertToUserDateTime:function(e){var t=this.getUserInfo();try{var i={timeZone:void 0!==t.userTimeZone?t.userTimeZone:"UTC"};"string"!=typeof e&&"number"!=typeof e||(e=new Date(e));var n=e.toLocaleString("en-US",i);n.indexOf(" at")>-1&&(n=n.replace(" at",""));var a=new Date(n);"Invalid Date"!=a&&(e=a)}catch(e){}return e},convertDateFilters:function(e,t){var i=this;e&&e.filters&&e.filters.length&&e.filters.map(function(e){if(e&&e.value&&e.value instanceof Date){var n=Object.first(t,function(t){return t.name==e.field});n&&n.type&&("DATE"!=n.type.toUpperCase()&&(e.value=i.getDateWithOffset(e.value,i.getProfileTimezoneOffset())),e.value=e.value.toISOString())}i.convertDateFilters(e,t)})},convertFKFilters:function(e,t){var i=this;e&&e.filters&&e.filters.length&&e.filters.map(function(e){if(e&&e.value&&("isnull"==e.operator||"isnotnull"==e.operator)){var n=Object.first(t,function(t){return t.name==e.field});n&&n.parentMeta&&"REFERENCE"==n.parentMeta.type&&(e.field=n.parentMeta.name)}i.convertDateFilters(e,t)})},getNamespace:function(t){return void 0===this.namespace&&(this.namespace=e.namespace),t&&this.namespace.length>0?this.namespace+"__":this.namespace},getRemoteAction:function(e,t){var i=this.getNamespace(!1),n=i?i+".":"";return n+e+"."+t},isSalesforceId:function(e){return/[a-zA-Z0-9]{15}|[a-zA-Z0-9]{18}/.test(e)},getIdFieldFromRelationshipName:function(e){var t=/__(p?)r$/,i=e+"Id";return e.match(t)&&(i=e.replace(t,"__$1c")),i},getDependentPicklistValues:function(e,t,i){for(var n,a,o=0,r=0;r<e.fields.length;r++){var s=e.fields[r];if(s.name==t?(n=s,o++):s.name==i&&(a=s,o++),2==o)break}var l={},d=new sforce.Base64Binary(""),c=function(e,t){var i=Math.floor(t/8),n=7-t%8;return(Math.pow(2,n)&e.charCodeAt(i))>>n==1},u=a.picklistValues;if("boolean"==n.type.toLowerCase()){l.getControllerLabel=function(e){return e?"enabled":"disabled"},l.enabled=[],l.disabled=[];for(var r=0;r<u.length;r++){var f=u[r];"QAAA"==f.validFor?l.enabled.push(f.label):"gAAA"==f.validFor&&l.disabled.push(f.label)}}else{l.getControllerLabel=function(e){for(var t=e,i=0;i<p.length;i++)if(p[i].value==e){t=p[i].label;break}return t};for(var p=n.picklistValues,r=0;r<p.length;r++)l[p[r].label]=[];for(var r=0;r<u.length;r++)for(var h=u[r],g=d.decode(h.validFor),m=0;m<p.length;m++)c(g,m)&&l[p[m].label].push(h.label)}return l},isLightningExperienceOrSalesforce1:function(){var e=this.parseAsObject();return"undefined"!=typeof sforce&&sforce&&!!sforce.one||e&&void 0!==e.sf1},getLicensedPackages:function(e,t){return void 0===crmc.licensedPackageCache?this.executeRemoteAction("getLicensedPackages",[e],function(e,i){crmc.licensedPackageCache=e,t(e,i)}):void t(crmc.licensedPackageCache,{status:!0})},getPicklistValueFactory:function(e){var t,i=this,n=e.fieldName,a=e.picklistValues,o=e.objectName,r=e.recordTypeInfos||[],s=e.fields||[],l="CampaignMember"==o&&"Status"==n,d=function(e,t,n){if(r.length>0&&!l){if(!(t.model.RecordTypeId||t.model.RecordType&&t.model.RecordType.Id)){var a;if(t.model.Id&&(a=i.query("SELECT RecordTypeId FROM {0} WHERE Id = '{1}'",o,t.model.Id)[0].RecordTypeId),!a){var s=Object.first(r,function(e){return e&&"true"===e.defaultRecordTypeMapping});a=a||(s&&s.recordTypeId?s.recordTypeId:a)}t.model.RecordTypeId=a,t.model.RecordType={Id:a}}var d=t.model.RecordTypeId||t.model.RecordType.Id,c=[];i.getDescribeLayoutByRecordType(o,d,function(a){var o=i.getPicklistsForRecordTypes(a),r=o[d][t.field];!r||r instanceof Array||(r=[r]),r&&r.length>0&&(Object.each(r,function(t){var i=Object.first(e,function(e){return t.label===(e.label||e.text)});t.getBoolean("active")&&i&&c.push({text:t.label,value:t.value})}),e=c),"function"==typeof n&&n(e)})}else"function"==typeof n&&n(e)},c=function(e){var t,n=[];if(e.hasOwnProperty("CampaignId"))t=e.CampaignId;else if(e.Id){var a=sforce.connection.retrieve("CampaignId","CampaignMember",[e.Id]);t=a[0].CampaignId}if(t){var o=i.query("SELECT Label FROM CampaignMemberStatus WHERE CampaignId = '"+t+"'");Object.each(o,function(e){n.push({text:e.Label,value:e.Label})})}return n},u=[],f={transport:{read:function(e){d(u,t,function(i){t.isMultiPicklist&&(i=i.map(function(e){return e.value})),e.success(i)})}}},p=Object.first(s,function(e){return e.name==n});return p&&p.dependentPicklist?function(e){u=[],t=e;var r=i.getDependentPicklistValues({fields:s},p.controllerName,n);l&&(a=c(e.model));var d;if(e.model.hasOwnProperty(p.controllerName))d=e.model[p.controllerName];else if(e.model.Id){var h=sforce.connection.retrieve(p.controllerName,o,[e.model.Id]);d=h[0][p.controllerName]}return d=r.getControllerLabel(d),Object.each(a,function(e){var t=e.label||e.text||e.value||e;r[d]&&r[d].indexOf(t)>-1&&u.push({text:t,value:e.value||e})}),f}:function(e){return u=[],t=e,l?u=c(e.model):Object.each(a,function(e){var t=e.label||e.text||e.value||e;u.push({text:t,value:e.value||e})}),f}}}}),crmc.define("ReadOnlyObjects",["SFRest"],function(e){var t={Id:"Id",AccountId:"AccountId",WhoId:"WhoId",WhatId:"WhatId",Subject:"Subject",IsTask:void 0,ActivityDate:"ActivityDate",OwnerId:"OwnerId",Status:"Status",Priority:"Priority",IsHighPriority:"IsHighPriority",ActivityType:"Type",IsClosed:"IsClosed",IsAllDayEvent:void 0,DurationInMinutes:void 0,Location:void 0,Description:"Description",CurrencyIsoCode:"CurrencyIsoCode",IsDeleted:"IsDeleted",CreatedDate:"CreatedDate",CreatedById:"CreatedById",LastModifiedDate:"LastModifiedDate",LastModifiedById:"LastModifiedById",SystemModstamp:"SystemModstamp",CallDurationInSeconds:"CallDurationInSeconds",CallType:"CallType",CallDisposition:"CallDisposition",CallObject:"CallObject",ReminderDateTime:"ReminderDateTime",IsReminderSet:"IsReminderSet",EndDateTime:void 0,StartDateTime:void 0},i={Id:"Id",AccountId:"AccountId",WhoId:"WhoId",WhatId:"WhatId",Subject:"Subject",IsTask:void 0,ActivityDate:"ActivityDate",OwnerId:"OwnerId",Status:void 0,Priority:void 0,IsHighPriority:void 0,ActivityType:"Type",IsClosed:void 0,IsAllDayEvent:"IsAllDayEvent",DurationInMinutes:"DurationInMinutes",Location:"Location",Description:"Description",CurrencyIsoCode:"CurrencyIsoCode",IsDeleted:"IsDeleted",CreatedDate:"CreatedDate",CreatedById:"CreatedById",LastModifiedDate:"LastModifiedDate",LastModifiedById:"LastModifiedById",SystemModstamp:"SystemModstamp",CallDurationInSeconds:void 0,CallType:void 0,CallDisposition:void 0,CallObject:void 0,ReminderDateTime:"ReminderDateTime",IsReminderSet:"IsReminderSet",EndDateTime:"EndDateTime",StartDateTime:"StartDateTime"},n=function(){return!0},a=function(e){},o={ActivityHistory:{Types:{Task:t,Event:i},IsEditable:n,TypeForRow:a},OpenActivity:{Types:{Task:t,Event:i},IsEditable:n,TypeForRow:a}};return o}),crmc.define("FormulaHelpers",[],function(){var e={getFormulaFieldName:function(e){return"formula_"+e.id.replace(/[\W]*/g,"")},isNumber:function(e){return!("Date"==e.type||"DateTime"==e.type||"Time"==e.type)},formatFormula:function(e,t){var i=this.evaluateFormula(e,t);if(e.format&&e.format.length>0){if(e.format)switch(e.format){case"d":case"g":case"hh:mm tt":if("Invalid Date"==i){var n=Object.first(e.dependentFields,function(e){return t[e]});return n?i:i=""}i=new Date(i);break;case"c":case"n":case"n0":i=+i.replace(/[^\d\.e\+\-]*/g,"")}i=kendo.format("{0:"+e.format+"}",i)}return i},parseFormula:function(e,t){var i=this.formatFormula(e,t);return e.format&&(i=this.isNumber(e)?kendo.parseFloat(i):kendo.parseDate(i)),i},evaluateFormula:function(e,t){var i="#= "+e.expression+"#",n="";if(e.expression&&e.expression.length>0)try{n=kendo.template(i)(t)}catch(t){var a=t.message;t instanceof ReferenceError&&(a='Message from Formula named "'+e.id+'": '+a+". This message is expected when Formula references a field with empty value."),console.log(a)}return n}};return e}),crmc.define("mixpanel",["sfdc"],function(e){var t="06d471d8bbba711cca0e208f3eb31429";!function(e,t){if(!t.__SV){var i,n,a,o;window.mixpanel=t,t._i=[],t.init=function(e,i,n){function r(e,t){var i=t.split(".");2==i.length&&(e=e[i[0]],t=i[1]),e[t]=function(){e.push([t].concat(Array.prototype.slice.call(arguments,0)))}}var s=t;for("undefined"!=typeof n?s=t[n]=[]:n="mixpanel",s.people=s.people||[],s.toString=function(e){var t="mixpanel";return"mixpanel"!==n&&(t+="."+n),e||(t+=" (stub)"),t},s.people.toString=function(){return s.toString(1)+".people (stub)"},a="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" "),o=0;o<a.length;o++)r(s,a[o]);t._i.push([e,i,n])},t.__SV=1.2,i=e.createElement("script"),i.type="text/javascript",i.async=!0,i.src="undefined"!=typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js",n=e.getElementsByTagName("script")[0],n.parentNode.insertBefore(i,n)}}(document,window.mixpanel||[]),mixpanel.init(t);var i,n={init:function(){if(void 0==i){var t=e.getUserInfo();e.getNamespace();i={orgId:t.organizationId,orgHasPersonAccounts:t.orgHasPersonAccounts,isLightning:e.isLightningExperienceOrSalesforce1(),isSandbox:e.isSandbox()},window.mixpanel.identify(t.organizationId+t.userId),window.mixpanel.register(i),window.mixpanel.people.set({userId:t.userId,userLocale:t.userLocale,userTimeZone:t.userTimeZone,orgId:t.organizationId,orgName:t.organizationName})}},track:function(e,t){try{this.init(),window.mixpanel.track(e,t)}catch(e){console.log(e)}},trackException:function(e){var t=e.stack;if("string"==typeof e&&(t=e),!t){var i=new Error;t=i.stack}this.track("Exception",{message:e&&e.toString(),stack:t})}};return n}),crmc.define("GridDataProvider",["KendoPopup","sfdc","GridConstants","ReadOnlyObjects","SFRest","FormulaHelpers","mixpanel","extensions"],function(t,i,n,a,o,r,s){var l={dataSource:void 0,pageInfo:{},delegate:{allowParentalEditing:function(){},getUpdateOperations:function(){},onDataSourceReady:function(e){},onReadFieldMetadata:function(e,t){},onRowSuccess:function(e){},onRowFailure:function(e){},onSync:function(e){}},init:function(e){e=e||{};var t=Object.create(this);return t.pageInfo=e.pageInfo,t.settings=e,t},create:function(e,t){e=e||{};var i=this.init(e);i.delegate=t||{};var n=function(e){i.fieldMeta=e,i.dataSource=i.createDataSource(),"function"==typeof i.delegate.onDataSourceReady&&i.delegate.onDataSourceReady(i.dataSource,i.fieldMeta)};e.pageInfo.columns&&e.pageInfo.columns.length>0?i.getFieldMetadata(e.pageInfo.objectName,e.pageInfo.columns,n):(i.dataSource=i.createDataSource(),"function"==typeof i.delegate.onDataSourceReady&&i.delegate.onDataSourceReady(i.dataSource,i.fieldMeta))},getFieldMetadata:function(e,n,a){i.executeRemoteAction("getFieldMetaForObjectColumns",[e,n],function(e,i){i.status?"function"==typeof a&&a(e):t.popup("Metadata Error",i.message)},{escape:!1})},saveRecord:function(e,t,n){var a=this,o=10;this.numSavesPending=this.numSavesPending||0,this.deferredSaves=this.deferredSaves||[],this.numSavesPending++;var r=function(i,o){a.numSavesPending--;var r=void 0!=n?a.dataSource.getByUid(n):a.dataSource.get(e.Id);i&&(r.id=i),o.status?(r.dirty=!1,delete r.dirtyFields,"function"==typeof a.delegate.onRowSuccess&&a.delegate.onRowSuccess(r.uid),t()):"function"==typeof a.delegate.onRowFailure&&a.delegate.onRowFailure(r.uid,o),a.deferredSaves&&a.deferredSaves.length>0&&a.deferredSaves.shift()()};this.numSavesPending<=o?i.executeRemoteAction("saveObject",[e],r):this.deferredSaves.push(function(){i.executeRemoteAction("saveObject",[e],r)})},parseRecord:function(e,t,n,a){e[n]=t[n];var o=void 0;if(a&&(o=a.type.toLowerCase()),null!=t[n]||"date"!=o&&"datetime"!=o&&"time"!=o||(e[n]=Date.UTC(1700,0,1)),void 0!==t[n]&&""!==t[n]||(e[n]=null),"subject_input"==n.toLowerCase()||n.indexOf(".")>0)delete e[n];else if(e[n]instanceof Date)if(a&&"date"!=a.type.toLowerCase()){var r=i.getDateWithOffset(t[n],i.getProfileTimezoneOffset());e[n]=r.valueOf()}else{var s=e[n];s=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())),e[n]=s.valueOf()}t[n]instanceof Array&&(t[n].length>0?e[n]=t[n].join(";"):e[n]=null)},validation:function(e){var t=this,i=[];Object.each(t.dataSource.options.schema.model.fields,function(t,n){t.validation&&t.validation.required&&!e.data[n]&&i.push("["+n+"]")});var n=i.length>0;if(n){var a="Field"+(i.length>1?"s":"")+" required: "+i.join(", ");e.error(e.data.UID,a),t.delegate.onRowFailure(e.data.UID,a)}return n},createDataSource:function(){var n=this,l=this.createSchema(this.fieldMeta),d=new kendo.data.DataSource({serverPaging:!window.isDebug,serverSorting:!window.isDebug,serverFiltering:!window.isDebug,pageSize:this.pageInfo.takeCount?this.pageInfo.takeCount:100,sort:this.pageInfo.sorts?this.pageInfo.sorts:[],filter:this.pageInfo.filter?this.pageInfo.filter:[],error:function(e){e.status&&"string"==typeof e.status.message&&(t.popup("Data Error",e.status.message),
e=e.status.message),s.trackException(e)},transport:{update:function(t){var r=n.validation(t);if(!r){var s={};s.Id=t.data.Id,Object.each(t.data.dirtyFields,function(e,i){var a=void 0;$.each(n.fieldMeta,function(e,t){if(t.name.toLowerCase()==i.toLowerCase())return a=t,!1}),n.parseRecord(s,t.data,i,a)});var l=void 0!=a[n.settings.pageInfo.objectName];if(l)o.getCachedDescribeById(s.Id,function(e){var i=a[n.settings.pageInfo.objectName].Types[e.name],o={};Object.each(i,function(e,t){s[t]&&(o[e]=s[t])}),n.saveRecord(o,function(){t.success()})},function(t){var i=n.dataSource.get(s.Id);"function"==typeof n.delegate.onRowFailure&&n.delegate.onRowFailure(i.uid,e)});else{var d=n.delegate.getUpdateOperations();if(d&&Object.keys(d).length>0){var c=0,u=0;Object.each(d,function(e,a){var o=[];Object.each(e,function(e,t){var i=new sforce.SObject(a);i.Id=t,Object.each(e,function(e,t){i[t]=e}),o.push(i)}),c++;var r=function(e){u++,u==c&&n.saveRecord(s,function(){t.success()})};i.batchUpdate(o,r)})}else n.saveRecord(s,function(){t.success()})}}},read:function(e){if(n.pageInfo.takeCount=e.data.take,n.pageInfo.skipCount=e.data.skip,n.pageInfo.sorts=e.data.sort,n.pageInfo.groups=e.data.group,n.pageInfo.filter=e.data.filter,i.convertDateFilters(n.pageInfo.filter,n.fieldMeta),i.convertFKFilters(n.pageInfo.filter,n.fieldMeta),void 0!==n.settings.baseFilter){if(void 0===n.pageInfo.filter&&(n.pageInfo.filter={logic:"and"}),n.pageInfo.filter||(n.pageInfo.filter={}),void 0===n.pageInfo.filter.filters&&(n.pageInfo.filter.filters=[]),n.pageInfo.filter.logic&&"and"!=n.pageInfo.filter.logic.toLowerCase()){var t=n.pageInfo.filter;n.pageInfo.filter={logic:"and",filters:[t]}}n.pageInfo.filter.filters.push(n.settings.baseFilter)}delete n.pageInfo.displayColumns,delete n.pageInfo.selectedRecordsPassed;var a=jQuery.extend(!0,{},n.pageInfo.childGridSettings);delete n.pageInfo.childGridSettings,n.settings.fkRelationship&&(n.pageInfo.fkId=n.settings.fkValue,n.pageInfo.fkRelationship=n.settings.fkRelationship);var o=function(t){var a=n.getModelPrototype();if(void 0!==t.results)for(var o=0;o<t.results.length;o++)if(t.results[o].__proto__=a,n.settings.formulaFields){var l=t.results[o];Object.each(n.fieldMeta,function(e){var t=e.type&&e.type.toLowerCase();"date"!=t&&"time"!=t&&"datetime"!=t||l[e.name]&&(l[e.name]=i.parseDate(l[e.name],t))}),Object.each(n.settings.formulaFields,function(e){var i=r.getFormulaFieldName(e);t.results[o][i]=r.parseFormula(e,l)})}try{e.success(t)}catch(e){console.log(e),s.trackException(e)}};if(n.pageInfo.filterId||n.pageInfo.fkRelationship)i.executeRemoteAction("getPage",[n.pageInfo],function(t,i){i.status?o(t):e.error(t,i)},{escape:!1,buffer:!1});else{var l=1e6;i.promiseRemoteAction("getResultSOQL",[n.pageInfo],{escape:!1,buffer:!1}).then(function(t){return Promise.all([i.promiseRemoteAction("runQuery",[t.resultSOQL,e.data.take,e.data.skip,t.suffix,n.pageInfo.fkRelationship||""],{escape:!1,buffer:!1}),i.promiseRemoteAction("countQuery",[t.countSOQL+" limit "+l+t.suffix],{buffer:!1})])}).then(function(e){e[0].totalResults=e[1],o(e[0])}).catch(function(t){e.error(null,t)})}n.pageInfo.childGridSettings=a},create:function(e){var t=n.validation(e);if(!t){var i=["uid","id","isdeleted","dirtyfields"];Object.each(n.settings.formulaFields,function(e){i.push(r.getFormulaFieldName(e).toLowerCase())});var a={sobjectType:n.pageInfo.objectName};Object.each(e.data,function(t,o){var r=Object.first(n.fieldMeta,function(e){return e.name==o});return"Task"==n.pageInfo.objectName&&"AccountId"==o?void(a.WhatId=e.data.AccountId):("RecordTypeId"==o&&"012000000000000AAA"==e.data.RecordTypeId&&(e.data.RecordTypeId=null),void(i.indexOf(o.toLowerCase())>-1||o.indexOf(".")>=0||r&&("child"==r.type.toLowerCase()||!r.isCreateable)||"subject_input"===o.toLowerCase()||(n.parseRecord(a,e.data,o,r),a[o]instanceof Object&&delete a[o])))}),n.saveRecord(a,function(t){try{e.success()}catch(e){console.log(e),s.trackException(e)}},e.data.UID)}}},sync:function(e){"function"==typeof n.delegate.onSync&&n.delegate.onSync(this,e)},schema:l});return d},getModelPrototype:function(){var e={};if(void 0!==this.pageInfo.columns)for(var t=0;t<this.pageInfo.columns.length;t++){var i=this.pageInfo.columns[t].split(".");2==i.length&&(e[i[0]]={})}return e},createSchema:function(e){var t=this,o={DAY_IN_MONTH:function(e){return e?e.getUTCDate():""},CALENDAR_MONTH:function(e){return kendo.toString(e,"MM MMMM")},CALENDAR_YEAR:function(e){return e?e.getUTCFullYear():""},CALENDAR_QUARTER:function(e){return e?Math.ceil((e.getUTCMonth()+1)/3):""}},s={data:"results",total:"totalResults",model:{id:"Id",fields:{}},parse:function(t){return void 0!==e&&$.each(t.results,function(t,n){$.each(e,function(e,t){var a,r=t.name.split(".");if(null==n[t.name]&&r.length>1){a=n;for(var s=0;s<r.length-1;s++)r[s]in a||(a[r[s]]={}),a=a[r[s]]}if("datepart"==t.type.toLowerCase()||"datetimepart"==t.type.toLowerCase())if(a){var l=a[r[s].split("__datepart__")[0]],d=o[r[s].split("__datepart__")[1]];a[r[s]]=d(i.parseDate(l,t.type.toLowerCase().split("part")[0]))}else{var l=n[t.name.split("__datepart__")[0]],d=o[t.name.split("__datepart__")[1]];n[t.name]=d(i.parseDate(l,t.type.toLowerCase().split("part")[0]))}switch(t.type.toLowerCase()){case"date":case"datetime":case"time":for(var c=n,s=0;s<r.length;s++)s==r.length-1?c[r[s]]=i.parseDate(c[r[s]],t.type):c=c[r[s]]}})}),t}},l=function(e){var i=void 0!=a[t.pageInfo.objectName],o=e.name&&1==e.name.split(".").length&&!e.isNillable&&!e.isReadonly&&n.ignoreRequiredFields.indexOf(e.name)<0||e.validation&&e.validation.required;e.type&&"boolean"==e.type.toLowerCase()?o=!1:"OwnerId"!=e.name||e.validation&&e.validation.required||(o=!1);var r=o,s=o||!(e.isReadonly||e.isHtmlFormatted)||e.isCreateable;i&&(s=!0);var l={editable:s,nullable:e.isNillable&&void 0==e.defaultValue,isROV:i,sfRequired:r,validation:{required:o},defaultValue:e.defaultValue};return l};if(this.settings.formulaFields&&Object.each(this.settings.formulaFields,function(e){var t=l({isReadonly:!0,isNillable:!1,isCreateable:!1}),i=r.getFormulaFieldName(e);s.model.fields[i]=t}),void 0!==e){var t=this;Object.each(this.pageInfo.columns,function(n){var a=Object.first(e,function(e){return e.name===n});if(void 0!==a){var o=l(a);switch(a.type.toLowerCase()){case"currency":case"integer":case"double":case"percent":o.type="number";break;case"boolean":o.type="boolean",delete o.validation;break;case"datetime":case"time":case"date":if(o.defaultValue)if("date"==a.type.toLowerCase()){var r=new Date(o.defaultValue);o.defaultValue=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate())}else o.defaultValue=i.parseDate(o.defaultValue,a.type);o.type="date",o.parse=function(e){return i.parseDate(e,a.type)};break;case"datepart":case"datetimepart":o.type="date",o.parse=function(e){return e};break;case"picklist":o.type="string";var d=Object.first(a.picklistValues,function(e){return e&&e.active&&e.defaultValue});d&&(o.nullable=!1,o.defaultValue=d.value);break;case"multipicklist":o.type="multipicklist";break;case"child":o.type="Object",o.editable=!1,delete o.validation;break;case"string":default:o.type="string"}if(t.settings.restoreColumns){var c=Object.first(t.settings.restoreColumns,function(e){return e.field==a.name});c&&(void 0!==c.defaultValue&&(o.defaultValue=c.defaultValue,o.nullable=!1),void 0!==c.defaultId&&(o.defaultId=c.defaultId),c.required&&(o.validation.required=!0),c.readOnly&&(o.editable=!1))}var u=a.name.split(".");if(u.length>=2){var f=2;t.delegate.allowParentalEditing()&&(f=3),(u.length>f+1&&!a.isNameField||u.length>f)&&(o.editable=!1);for(var d={},n=u.length;n>1;n--){var p={};2==n&&(p=s.model.fields[u[0]]&&s.model.fields[u[0]].defaultValue||{}),p[u[n-1]]=d,d=p}s.model.fields[u[0]]={type:"Object",defaultValue:d}}if(a.isNameField&&u.length>1){var h=u.slice(0,u.length-1).join("."),g=i.getIdFieldFromRelationshipName(h),m=Object.first(e,function(e){return e.name===g});if(m&&(o&&o.validation&&(m.validation=o.validation),a.parentMeta=m,2==u.length||t.delegate.allowParentalEditing()&&3==u.length)){var v=l(m);o.editable=v.editable,o.nullable=v.nullable,o.validation=v.validation;var b=v.defaultValue,y=void 0;if(m.name==t.settings.fkField?(b=t.settings.fkValue,y=t.settings.fkDisplayName):c&&c.defaultValue&&c.defaultId&&(y=c.defaultValue,b=c.defaultId),b&&i.isSalesforceId(b)){var k=u.length-1;if(!y)try{var w=sforce.connection.retrieve(u[k],m.relObjectName,[b]);y=w&&w.length>0&&w[0]?w[0][u[k]]:""}catch(e){}o.nullable=!1,o.defaultValue=y;var x=s.model.fields[g]||{};x.defaultValue=b,s.model.fields[g]=x;var I=s.model.fields[u[0]]&&s.model.fields[u[0]].defaultValue||{};I.Id=b,I[u[k]]=y,s.model.fields[u[0]]={type:"Object",defaultValue:I}}}if(a.name.indexOf("RecordType.Name")>-1)if(2==u.length){var S=Object.first(t.settings.metadata.recordTypeInfos,function(e){return e&&"true"===e.defaultRecordTypeMapping});o.nullable=!1;var C=s.model.fields[u[0]].defaultValue;S&&C&&!C.Id&&(C.Name=S.name,C.Id=S.recordTypeId,o.defaultValue=S.name,s.model.fields[g]={defaultValue:S.recordTypeId})}else o.nullable=!0,o.editable=!1}else u.length>1&&(o.isParentField=!0);s.model.fields[a.name]=o,"function"==typeof t.delegate.onReadFieldMetadata&&t.delegate.onReadFieldMetadata(a,e,o)}if(t.settings.fkField&&t.settings.fkValue&&"Id"!=t.settings.fkField){var v=s.model.fields[t.settings.fkField]||{};v.nullable=!1,v.defaultValue=t.settings.fkValue,s.model.fields[t.settings.fkField]=v}})}return s}};return l}),crmc.define("CustomSettings",["sfdc","SFRest","extensions"],function(e,t){var i={settings:void 0,userInfo:void 0,sfdcSettings:void 0,initAsync:function(i){if(void 0===this.userInfo&&(this.userInfo=e.getUserInfo()),void 0===this.settings){var n=e.getNamespace(!0),a=String.format("SELECT Id, Name, {2}JSON__c, {2}Owner__c , {2}Owner_Type__c, {2}Setting_Name__c, {2}Table_Name__c, {2}Setting_Type__c FROM {2}Grid_Setting__c WHERE isDeleted = false and (({2}Owner__c = '{0}' and {2}Owner_Type__c = 'user') or ({2}Owner__c = '{1}' and {2}Owner_Type__c = 'profile') or {2}Owner_Type__c = 'global') ORDER BY {2}Owner_Type__c ",this.userInfo.userId,this.userInfo.profileId,n),o=this,r=function(e){o.settings={},Object.each(e,function(e){var t,i=e[n+"Table_Name__c"],a=e[n+"Setting_Type__c"]?e[n+"Setting_Type__c"]:"action",r=e[n+"Setting_Name__c"],s=e[n+"Owner_Type__c"];e[n+"Owner__c"];if(o.settings[a]||(o.settings[a]={}),o.settings[a][i]&&o.settings[a][i][r])switch(o.settings[a][i][r].ownerType){case"global":"profile"==s&&(t=o.convertSetting(e));case"profile":"user"==s&&(t=o.convertSetting(e))}else o.settings[a][i]||(o.settings[a][i]={}),t=o.convertSetting(e);t&&void 0!==t.setting&&(o.settings[a][i][r]=t)}),"function"==typeof i&&i()};t.query(a,r,function(e){console.log(JSON.stringify(e))})}else"function"==typeof i&&i()},init:function(){if(void 0===this.userInfo&&(this.userInfo=e.getUserInfo()),void 0===this.settings){var t=e.getNamespace(!0);this.sfdcSettings=e.query("SELECT Id, Name, {2}JSON__c, {2}Owner__c , {2}Owner_Type__c, {2}Setting_Name__c, {2}Table_Name__c, {2}Setting_Type__c FROM {2}Grid_Setting__c WHERE isDeleted = false and (({2}Owner__c = '{0}' and {2}Owner_Type__c = 'user') or ({2}Owner__c = '{1}' and {2}Owner_Type__c = 'profile') or {2}Owner_Type__c = 'global') ORDER BY {2}Owner_Type__c ",this.userInfo.userId,this.userInfo.profileId,t),this.settings={};var i=this;Object.each(this.sfdcSettings,function(e){var n,a=e[t+"Table_Name__c"],o=e[t+"Setting_Type__c"]?e[t+"Setting_Type__c"]:"action",r=e[t+"Setting_Name__c"],s=e[t+"Owner_Type__c"];e[t+"Owner__c"];if(i.settings[o]||(i.settings[o]={}),i.settings[o][a]&&i.settings[o][a][r])switch(i.settings[o][a][r].ownerType){case"global":"profile"==s&&(n=i.convertSetting(e));case"profile":"user"==s&&(n=i.convertSetting(e))}else i.settings[o][a]||(i.settings[o][a]={}),n=i.convertSetting(e);n&&void 0!==n.setting&&(i.settings[o][a][r]=n)})}},convertSetting:function(t){var i=e.getNamespace(!0),n={id:t.Id,name:t.Name,owner:t[i+"Owner__c"],ownerType:t[i+"Owner_Type__c"],tableName:t[i+"Table_Name__c"],settingType:t[i+"Setting_Type__c"],settingName:t[i+"Setting_Name__c"]};if(t[i+"JSON__c"]&&"undefined"!==t[i+"JSON__c"])try{n.setting=JSON.parse(unescape(t[i+"JSON__c"]))}catch(e){console.log("Malformed setting!"),console.log(e)}return n},getSetting:function(e,t,i){var n;try{this.init(),i||(i="action"),this.settings[i]&&(this.settings[i][e]&&this.settings[i][e][t]?n=this.settings[i][e][t].setting:this.settings[i].global&&this.settings[i].global[t]&&(n=this.settings[i].global[t].setting)),void 0===n&&"action"===i&&this.settings.globalDefault&&this.settings.globalDefault.global.globalFeature?this.settings.globalDefault.global.globalFeature.setting||(n=!1):void 0===n&&"explorer"===i&&this.settings.globalDefault&&this.settings.globalDefault.global.globalObject&&(n=this.settings.globalDefault.global.globalObject.setting)}catch(e){console.log(e)}return n},getTableSettings:function(t,i,n,a){var o={};try{var r=e.getNamespace(!0);void 0===this.userInfo&&(this.userInfo=e.getUserInfo());var s="SELECT Id, Name, {1}JSON__c, {1}Owner__c ,{1}Owner_Type__c, {1}Setting_Name__c, {1}Table_Name__c, {1}Setting_Type__c FROM {1}Grid_Setting__c WHERE {1}Table_Name__c = '{0}' and isDeleted = false ";i&&(s+=" AND {1}Owner__c = '"+i+"'"),n&&(s+=" AND {1}Owner_Type__c = '"+n+"'"),a&&(s+=" AND {1}Setting_Type__c = '"+a+"'");var l=e.query(s,t,r),d=this;Object.each(l,function(e){o[e[r+"Setting_Name__c"]]=d.convertSetting(e)})}catch(e){console.log(e)}return o},setSetting:function(i,n,a){try{var o=e.getNamespace(!0);if(!i||!i.settingName)return;var r=new sforce.SObject(o+"Grid_Setting__c"),s=function(t){r.Id=t;var s=((new Date).getTime()+Math.floor(100*Math.random())+i.settingName+"_"+i.settingType).slice(0,38);r.Name=i.name?i.name:s,r[o+"Table_Name__c"]=i.tableName,r[o+"Setting_Name__c"]=i.settingName,r[o+"Setting_Type__c"]=i.settingType,r[o+"Owner_Label__c"]=i.ownerLabel,r[o+"Owner_Type__c"]=i.ownerType,r[o+"Owner__c"]=i.owner,r[o+"JSON__c"]=escape(JSON.stringify(i.setting)),r.type=o+"Grid_Setting__c";var l=function(e){"function"==typeof n&&n(e)},d=function(e){"function"==typeof a&&a(e)};e.upsert("Id",r,l,function(t){t instanceof Array&&(t=t[0]),"FIELD_INTEGRITY_EXCEPTION"==t.statusCode?(r.Name=s,e.upsert("Id",r,l,d)):d(t)})};if(i.id)s(i.id);else{var l=String.format("SELECT Id FROM {0}Grid_Setting__c WHERE isDeleted = false and {0}Owner__c = {1} and {0}Owner_Type__c = '{2}' and {0}Setting_Name__c = '{3}' and {0}Setting_Type__c = '{4}' and {0}Table_Name__c = {5} and {0}Owner_Label__c = {6}  ORDER BY {0}Owner_Type__c ",o,i.owner?"'"+i.owner+"'":"null",i.ownerType,i.settingName,i.settingType,i.tableName?"'"+i.tableName+"'":"null",i.ownerLabel?"'"+i.ownerLabel+"'":"null");t.query(l,function(e){var t;e.length>0&&(t=e[0].Id),s(t)},function(e){console.log(JSON.stringify(e))})}}catch(e){return{}}}};return i}),crmc.define("FieldChooserDataProvider",["CustomSettings","sfdc","GridConstants","SFRest","extensions"],function(e,t,i,n){return{create:function(a){var o=a.objectName,r=a.objectLabel,s=a.overrideSecurity,l=a.hideRootNodes,d=a.expandFK,c=Object.create(this),u=new kendo.data.TreeListDataSource({transport:{read:function(c){if(c.data&&c.data.id||l===!0){var f=null;c.data.id&&(f=c.data.id);var p=u.get(f),h=!0,g=!1,m=o;if(p){if(p.relObjectName)m=p.relObjectName,g=!0;else{if("toolbarnode"==p.type){var v=[],b=a.delegate&&a.delegate.toolbar;return Object.each(b.getAvailableGroups(),function(e){var t=e.name,i={parentId:f,parentModel:p,hasChildren:!1,nodeName:t,help:"Show or Hide the Toolbar group",type:"toolbargroupnode"};v.push(i)}),void c.success(v)}if("readingpanenode"==p.type){var y=[{parentId:f,parentModel:p,displayName:" ",nodeName:"Chatter Tab",type:"chatternode",hasChildren:!1,tabName:"quickView",help:"Display Chatter tab in Reading Pane"},{parentId:f,parentModel:p,displayName:" ",nodeName:"Reading Pane Tab",type:"rptabnode",hasChildren:!1,tabName:"readingPane",help:"Display Long Text fields from selected records in Reading Pane"}];return s||e.getSetting(m,"detailGrid")===!1||y.push({parentId:f,parentModel:p,displayName:" ",nodeName:"Detail Grid Tab",type:"detailgridnode",hasChildren:!0,tabName:"detailGrid",help:"Display Detail Grid in Reading Pane"}),s||e.getSetting(m,"chart")===!1||y.push({parentId:f,parentModel:p,displayName:" ",nodeName:"Quick Graph Tab",type:"chartnode",hasChildren:!0,tabName:"chart",help:"Display Quick Graph in Reading Pane"}),void n.getSObjectDescribe("ApexPage",function(){y.push({parentId:f,parentModel:p,displayName:"Visualforce Pages",nodeName:"Visualforce Pages",type:"pagesnode",hasChildren:!0,showCheckbox:!1,help:"Display a custom Visualforce Page in Reading Pane related to the selected data"}),c.success(y)},function(){c.success(y)})}if("pagesnode"==p.type)return void n.query(kendo.format("select Name, MasterLabel, NamespacePrefix, Description from ApexPage where ControllerType = '1' and ControllerKey = '{0}' order by MasterLabel",o),function(e){var t=[];Object.each(e,function(e){t.push({nodeName:e.MasterLabel,name:e.NamespacePrefix&&e.NamespacePrefix.length>0?e.NamespacePrefix+"__"+e.Name:"c__"+e.Name,help:kendo.format(" <div style='word-break: break-all;'>Name: {0}<br>Label: {1}<br>Description: {2}</div>",e.Name,e.MasterLabel,e.Description?e.Description:"Empty"),parentId:f,parentModel:p,type:"pagenode"})}),c.success(t)});void 0!==p.type&&("objectnode"==p.type?h=!0:"childrelnode"==p.type?h=!1:"childgridnode"==p.type&&(h=!1))}if("DATE"==p.type||"DATETIME"==p.type){var k=[],w="";if(p.isChild)for(var x=p.parentModel;x.parentModel;)w=x.relationshipName+"."+w,x=x.parentModel;return Object.each(i.dateParts,function(e,t){var i=(p.isChild?".":"")+w+p.name+"__datepart__"+t,n=p.displayName+"__datepart__"+e;k.push({displayName:n,isCreateable:!0,isFilterable:!0,isGroupable:!0,isHtmlFormatted:!1,isNameField:!1,isNillable:!0,isReadonly:!1,isSortable:!1,name:i,parentId:p.id,parentModel:p,type:p.type+"PART"})}),void c.success(k)}}t.executeRemoteAction("getFieldMetaForObject",[m,h],function(t,i){if(i.status){var n=[];Object.each(t,function(t){return t.parentId=f,t.parentModel=p,p&&"chartnode"==p.type&&["integer","double","currency"].indexOf(t.type.toLowerCase())<0?void n.push(t):(l&&!d||("reference"==t.type.toLowerCase()||"child"==t.type.toLowerCase()&&"childgridnode"==p.type||"date"==t.type.toLowerCase()||"datetime"==t.type.toLowerCase())&&(t.hasChildren=!0),g&&(t.isChild=!0),void(h?s||e.getSetting(m,t.name,"field")!==!1||n.push(t):e.getSetting("global",t.relObjectName,"explorer")===!1&&n.push(t)))}),Object.each(n,function(e){t.remove(e)}),c.success(t),u.trigger("expandNode")}else c.error(t)},{escape:!1})}else c.success([{parentId:null,displayName:" ",nodeName:r+" Fields",type:"objectnode",hasChildren:!0,showCheckbox:!1,help:"Add columns from the Primary or Parent Objects"},{parentId:null,displayName:"  ",nodeName:"Related List",type:"childgridnode",hasChildren:!0,showCheckbox:!1,help:"Add an ActionGrid of related data as a tab"},{parentId:null,displayName:"  ",nodeName:"Related Column",type:"childrelnode",hasChildren:!0,showCheckbox:!1,help:"Add related data as a column of comma separated values"},{parentId:null,displayName:"  ",nodeName:"Reading Pane",type:"readingpanenode",hasChildren:!0,showCheckbox:!1,help:"Control what appears in the Reading Pane area of ActionGrid"},{parentId:null,displayName:"  ",nodeName:"Toolbar",type:"toolbarnode",hasChildren:!0,showCheckbox:!1,help:"Display or hide Toolbar groups"}])}},sort:{field:"displayName",dir:"asc"},schema:{model:{id:"uid",fields:{displayName:{type:"string"},visible:{type:"Boolean",defaultValue:!1,nullable:!1},type:{type:"string"}}}}});return c.dataSource=u,c}}}),crmc.define("FieldChooser",["FieldChooserDataProvider","CustomSettings"],function(e,t){var i={fieldDataProvider:void 0,fieldTreeView:void 0,delegate:{getColumns:function(e){}},init:function(i){var n=this;this.settings=i||{};var a=function(e){var a=e.inlineHelpText?"<span style='font-weight:bold'>Help Text: </span>"+e.inlineHelpText:e.help;e.name&&(e.type&&e.type.toTitleCase&&(a="<span style='font-weight:bold'>Type: </span>"+e.type.toLowerCase().toTitleCase()+(a?"<br />"+a:"")),a="<span style='font-weight:bold'>API Name: </span>"+e.name+(a?"<br />"+a:""));var o=e.displayName;e.type&&("child"===e.type.toLowerCase()&&(a="<span style='font-weight:bold'>Name: </span>"+e.relationshipName+"<br /><span style='font-weight:bold'>Label: </span>"+e.childFKFieldLabel),e.type.indexOf("node")>-1&&(o=e.nodeName,a=e.help),"datetimepart"!=e.type.toLowerCase()&&"datepart"!=e.type.toLowerCase()||(o=e.displayName.split("__datepart__")[1]));var r=e.type;"CHILD"==e.type&&(r=e.relationshipName);var s="$(this).parents('tr').first().find('input').click();";return"toolbargroupnode"==e.type&&"Views"==e.nodeName&&t.getSetting(i.objectName,"saveView")!==!1&&(o+=kendo.format(' (<a href="#" onclick="$(\'{0}\').data(\'kendoTreeList\').parent.delegate.saveNamedView();">Save View</a>) <span class="k-icon k-i-info"></span>',i.elementId),a="Hide/Show View Toolbar Group. Ctrl-Shift-S to save a view with the view group hidden.",s=""),"toolbargroupnode"==e.type&&"Edit"==e.nodeName&&t.getSetting(i.objectName,"editButton")!==!1&&n.delegate.settings.metadata&&n.delegate.settings.metadata.updateable&&"true"==n.delegate.settings.metadata.updateable&&(o+=kendo.format(' (<a href="#" onclick="$(\'{0}\').data(\'kendoTreeList\').parent.delegate.toggleEditMode();">{1}</a>) <span class="k-icon k-i-info"></span>',i.elementId,n.delegate.settings.editable?"Disable Edit":"Enable Edit"),a="Enable/Disable Edit Mode. Ctrl-E",s=""),kendo.format('<label title="{0}" onclick="{3}" data-node-name="{2}">{1}</label>',a.replace(/"/g,"&quot;"),o,r,s)};n.delegate&&"function"==typeof n.delegate.template&&(a=n.delegate.template);var o=[{expandable:!0,field:"displayName",title:"Field",template:a,headerTemplate:String.format('<input id="{0}filter" type="search" class="k-textbox" style="width:100%" placeholder="Search Fields"/>',i.elementId.replace("#",""))},{field:"type",title:"Type",width:"64px",filterable:!1,template:function(e){var t="";if(e.type&&e.type.indexOf("node")<0)switch(e.type.toLowerCase()){case"currency":t="$";break;case"integer":case"double":case"percent":t="<span class='k-icon k-i-123'></span>";break;case"boolean":t="<span class='k-icon k-i-tick'></span>";break;case"date":case"datetime":case"datepart":case"datetimepart":t="<span class='k-icon k-i-calendar'></span>";break;case"time":t="<span class='k-icon k-i-clock'></span>";break;case"multipicklist":case"combobox":case"picklist":t="<div class='k-button-group'><span class='k-icon k-insertOrderedList'></span></div>";break;case"email":t='<span class="k-icon k-i-email"></span>';break;case"url":t='<span class="k-icon k-i-link"></span>';break;case"phone":t='<span class="k-icon k-i-call"></span>';break;case"string":case"textarea":t="<span class='k-icon k-i-abc'></span>";break;case"child":break;case"reference":case"id":t='<span class="k-icon k-i-keys"></span>';break;case"base64":t='<span class="k-icon k-i-attach"></span>';break;default:t=e.type}return t}}];n.fieldDataProvider=e.create(i),n.delegate=i.delegate;var r=i.elementId;this.delegate&&"function"==typeof this.delegate.getColumns&&(o=this.delegate.getColumns(o));var s=!0;if(this.fieldTreeView=$(r).kendoTreeList({columns:o,sortable:!0,expand:function(e){if(n.clearSearch()){var t=e.model.uid,i=$(String.format("{0} tbody>tr[data-uid={1}]",n.settings.elementId,t));n.fieldTreeView.element.find(".k-grid-content").animate({scrollTop:i.get(0).offsetTop},200)}},dataBound:function(e){if(s){s=!1;var t=$(r+"filter");t&&(t.on("click",function(e){e.stopPropagation()}),t.on("keyup search input paste",function(e){var i=!1;Object.each(n.fieldDataProvider.dataSource.rootNodes(),function(e){i|=e.expanded}),i||n.expandPrimaryFields(),n.fieldDataProvider.dataSource.filter({field:"displayName",operator:"contains",value:t.val()})}),t.parent().attr({draggable:"false"}))}n.delegate&&"function"==typeof n.delegate.dataBound?n.delegate.dataBound.call(this,e):i.delegate&&i.delegate.settings&&i.delegate.settings.pageInfo.columns&&i.delegate.settings.pageInfo.columns.length>0&&$.each(i.delegate.settings.pageInfo.columns,function(t,n){var a=0==n.lastIndexOf(".",0),o=n.split("."),r=o.length-1;if(a){var s=o[1],l=e.sender.element.find(' [data-field-name=".'+s+'"]').first();l&&(l.prop("checked",!0),l.prop("indeterminate",!0)),r-=2}var d=!a&&o.length>=2||a&&o.length>=4;if(d)for(var c=0;c<r;c++){o.splice(-1,1);var u=o.join(".")+".Name",f=e.sender.element.find(' [data-field-name="'+u+'"]').first();i.delegate.settings.pageInfo.columns.indexOf(u)==-1&&f.prop("indeterminate",!0)}})}}).data("kendoTreeList"),i.enableAutoUpdate){var l=$('<label style="margin-left: 15px;">Auto Update</label>'),d=$('<input type="checkbox" checked/>');d.on("click",function(){n.delegate&&"function"==typeof n.delegate.autoUpdateChecked&&n.delegate.autoUpdateChecked(d.prop("checked"))});var c=$('<div class="k-pager-wrap" style="padding:5px; height:32px;">');c.append(d),c.append(l),$(r).append(c)}this.fieldTreeView.parent=this,$(r).kendoTooltip({showAfter:1e3,filter:"label",width:200,position:"top"}).data("kendoTooltip")},clearSearch:function(){var e=$(this.settings.elementId+"filter"),t=!1;return e&&e.val()&&(e.val(""),e.trigger("search"),t=!0),t},expandRelatedListNode:function(){this.fieldTreeView.collapse($(String.format("{0} tbody>tr:eq(0)",this.settings.elementId)));var e=$(String.format("{0} tbody>tr label[data-node-name=childgridnode]",this.settings.elementId)).parent().parent();return this.fieldTreeView.expand(e),e},collapseRootNodes:function(){try{var e=$(String.format("{0} tbody>tr[aria-expanded=true]",this.settings.elementId)),t=this;Object.each(e,function(e){t.fieldTreeView.collapse(e)})}catch(e){}},showChildRelationshipHelp:function(){var e=this.expandRelatedListNode();this.fieldTreeView.element.find(".k-grid-content").animate({scrollTop:e.get(0).offsetTop},200,function(){setTimeout(function(){var t=$("<div>").kendoTooltip({width:225,position:"left",autoHide:!1,content:"<div>Add a tab of related records by choosing fields from a child object.</div>"}).data("kendoTooltip");t.show(e)},100)})},expandPrimaryFields:function(){try{this.fieldTreeView.expand($(String.format("{0} tbody>tr:eq(0)",this.settings.elementId)))}catch(e){}},expandChildFields:function(e){var t=this,i=function(){var n=$(String.format("{0} tbody>tr label[data-node-name={1}]",t.settings.elementId,e)).parent().parent(),a=n&&n.length>0;if(a&&n.is(":visible"))void 0!=n.attr("aria-expanded")?t.fieldTreeView.element.find(".k-grid-content").animate({scrollTop:n.get(0).offsetTop},200):t.fieldDataProvider.dataSource.one("expandNode",function(){t.fieldTreeView.element.find(".k-grid-content").animate({scrollTop:n.get(0).offsetTop},200)}),t.fieldTreeView.expand(n);else{t.expandRelatedListNode();a?i():t.fieldDataProvider.dataSource.one("expandNode",i)}};i()},refresh:function(){this.fieldTreeView.setDataSource(this.fieldDataProvider.dataSource)},_handleRefresh:function(){this.delegate.isReadingPaneShowing()?this.delegate.initReadingPane():this.delegate.refresh()},onItemChecked:function(e){if(this.delegate&&"function"==typeof this.delegate.onItemChecked)return this.delegate.onItemChecked(e)},onRPTabFieldChecked:function(e,t){this.delegate&&"function"==typeof this.delegate.onRPTabFieldChecked&&(this.delegate.onRPTabFieldChecked(e,t,!this.delegate.onRPTabFieldChecked(e,t)),this.refresh(),this._handleRefresh())},onRPTabChecked:function(e){this.delegate&&"function"==typeof this.delegate.isReadingPaneTabEnabled&&(this.delegate.isReadingPaneTabEnabled(e,!this.delegate.isReadingPaneTabEnabled(e)),this._handleRefresh())},onToolbarItemChecked:function(e){this.delegate&&"function"==typeof this.delegate.onToolbarItemChecked&&this.delegate.onToolbarItemChecked(e)},onVFPageChecked:function(e){this.delegate&&"function"==typeof this.delegate.onVFPageChecked&&(this.delegate.onVFPageChecked(e),this._handleRefresh())},onChildGridNodeChecked:function(e,t){this.delegate&&"function"==typeof this.delegate.onChildGridNodeChecked&&this.delegate.onChildGridNodeChecked(e,t)}};return i}),crmc.define("tooling",["KendoPopup","RestService"],function(e,t){var i=Object.create(t);return i.endpoint="/services/data/v37.0/tooling/",i.cacheKey="toolingCache",i.query=function(e,t,i){var n=[],a=this,o=function(e){var r=!0;n=n.concat(e.records),e.done?(r=!1,t(n)):a.getRequest(e.nextRecordsUrl,o,i,!0)};this.getRequest(this.endpoint+"query/?q="+encodeURIComponent(e),o,i,!0)},i.queryFirstId=function(e,t,i){this.query(e,function(e){t(e[0].Id)},i)},i.getCustomObjectId=function(e,t,i){var n=kendo.format("select DurableId from EntityDefinition where QualifiedAPIName='{0}'",e),a=function(e){var i=e&&e.length>0&&e[0].DurableId;t(i)};this.query(n,a,i)},i.getCustomFieldId=function(e,t,i,n){var a=function(e){var t=e.length>0?e[0].DurableId:"";t.indexOf(".")>-1&&(t=t.split(".")[1]),i(t)};this.query(kendo.format("select DurableId from FieldDefinition where EntityDefinition.QualifiedAPIName = '{0}' and QualifiedAPIName = '{1}'",e,t),a,n)},i.getFieldDefinition=function(e,t,i,n){this.query(kendo.format("select Metadata from FieldDefinition where EntityDefinition.QualifiedAPIName = '{0}' and QualifiedAPIName = '{1}'",e,t),i,n)},i.getVisualForcePages=function(e,t){var i="SELECT ApiVersion,ControllerKey,ControllerType,CreatedById,CreatedDate,Description,Id,IsAvailableInTouch,IsConfirmationTokenRequired,LastModifiedById,LastModifiedDate,Markup,MasterLabel,Name,NamespacePrefix,SystemModstamp FROM ApexPage WHERE NamespacePrefix = ''";this.query(i,e,t)},i.getCustomTab=function(e,t,i){this.query("SELECT Id, Metadata, FullName, Type, MasterLabel, DeveloperName, Description, MotifName, Url, EncodingKey, ContentId, HasSidebar, ManageableState, NamespacePrefix, CreatedDate, CreatedById, LastModifiedDate, LastModifiedById FROM CustomTab WHERE Id = '"+e+"'",t,i)},i.getCustomTabByName=function(e,t,i){this.query("SELECT Id, Metadata, FullName, Type, MasterLabel, DeveloperName, Description, MotifName, Url, EncodingKey, ContentId, HasSidebar, ManageableState, NamespacePrefix, CreatedDate, CreatedById, LastModifiedDate, LastModifiedById FROM CustomTab WHERE DeveloperName = '"+e+"'",t,i)},i.createCustomTab=function(e,t,i){this.postRequest(this.endpoint+"sobjects/CustomTab/",e,t,i)},i.addCustomTabToSet=function(e,t,i){this.postRequest(this.endpoint+"sobjects/PermissionSetTabSetting/",e,t,i)},i}),crmc.define("ExpressionTree",[],function(){function e(){this.value=null,this.left=null,this.right=null,this.toString=function(){return this.value}}function t(e){function t(t){var i,n=0;for(i=0;i<e.length;i++){var a=e.substring(0,i).lastIndexOf(t);if(n<1&&a>0&&i==a+t.length)break;")"==e[i]?n--:"("==e[i]&&n++}return i==e.length&&(i=-1),i-t.length}var i=-1,a={};return Object.each(n,function(e){i<0&&(i=t(e),a={index:i,length:e.length})}),a}function i(n){for(n=n.replace(/\s+/g,"");0==n.indexOf("(");){var a,o=1;for(a=1;a<n.length&&0!=o;a++)")"==n[a]?o--:"("==n[a]&&o++;if(a!=n.length||0!=o)break;n=n.substring(1,n.length-1)}var r=t(n),s=new e;return r.index>0?(s.value=n.substring(r.index,r.length+r.index),s.left=i(n.substring(0,r.index)),s.right=i(n.substring(r.index+r.length))):s.value=n,s}var n=[];return{parseBooleanExpression:function(e){return n=["AND","OR"],i(e)}}}),crmc.define("ForeignKeyControl",["GridDataProvider","sfdc","tooling","SFRest","ExpressionTree","mixpanel"],function(e,t,i,n,a,o){var r=[{field:"IsActive",operator:"eq",value:"true"}],s={},l={isPolymorphic:!1,isFiltered:!1,enableSpyGlass:!0,makeControl:function(e,t,i,n){this.controlFactory({referenceTo:t},i)(e,void 0,void 0,void 0,void 0,n)},createSpyglass:function(e){var n=this.isPolymorphic,a=this.isFiltered,o=e.keyPrefix,r=e.parentObject,s=this.fieldMeta,l=e.model,d=e.inputName,c=e.field,u=this.input,f=e.objectName,p=e.objectPicker,h=this.pageInfo,g=this.setFunction,m=$("<div>");m.kendoButton({spriteCssClass:"k-icon k-i-search",click:function(){var e=function(){var e=n?p.data("kendoDropDownList").value():f,h=t.getSObjectDescribe(e),g="";
window.UserContext&&UserContext.siteUrlPrefix&&(g=UserContext.siteUrlPrefix);var m=g+"/_ui/common/data/LookupPage?lkfm=editPage&lknm={0}&lktp={1}&lkent={3}&lkfield={5}&dplp=%5B{2}%5D&lksrch={4}",v=s&&s.name.indexOf("__c")>-1,b=l&&l.Id?'"'+l.Id+'"':"null",y=u.data("kendoComboBox").text();a&&v?i.getCustomFieldId(r,s.name,function(e){openLookup(kendo.format(m,s.name,h.keyPrefix,b,o,y,e),670,"assigned_mod","&lksrch="+escapeUTF(c),"maxw")},function(){openLookup(kendo.format(m,s.name,h.keyPrefix,b,o,y),670,"assigned_mod","&lksrch="+escapeUTF(c),"maxw")}):openLookup(kendo.format(m,d,h.keyPrefix,b,o,y),670,"assigned_mod","&lksrch="+escapeUTF(d),"maxw"),void 0==window.Sfdc&&t.importScript(kendo.format("/jslibrary/{0}/ui-sfdc-javascript-impl/SfdcCore.js",(new Date).valueOf()))};"function"==typeof openLookup?e():t.importScript("/js/functions.js",function(){e()})}}),m.appendTo(u.parent());var v=$('<span style="position:absolute; z-index:-1;"/>');v.appendTo(u.parent());var b=$('<input type="text" onchange="void(0);" style="width:0px;" />');b.attr("name",d),b.appendTo(v);var y=$('<input type="hidden"/>');y.attr("name",d+"_lkid"),y.appendTo(v);var k=$('<input type="hidden"/>');k.attr("name",d+"_lkold"),k.appendTo(v),v.delegate("input","change",function(){var e={};e[h.columns[0]]=b.val(),e[h.columns[1]]=y.val(),$.isFunction(g)&&g(e,h.columns);var t=u.data("kendoComboBox");t.input.val(b.val())})},createPolymorphicMenu:function(i){var a=this.input,o=this.fieldMeta,s=i.objectName,l=this.pageInfo,d=this.template,c=l.filter,u=$('<input style="width:40px;"/>');return u.prependTo(a.parent()),u.kendoDropDownList({dataSource:{transport:{read:function(e){n.getGlobalDescribes(function(t){var i=Object.where(t.sobjects,function(e){return o.referenceTo.indexOf(e.name)>-1});i=Array.orderBy(i,function(e){return e.label&&e.label.toLowerCase()}),e.success(i)})}}},dataTextField:"label",dataValueField:"name",value:s,valueTemplate:'<span class="k-icon k-i-custom"></span>',open:function(e){$(e.sender.list).width(150)},cascade:function(i){var n=this.value(),o=a.data("kendoComboBox");if(o&&n&&n.length>0){var s=t.getSObjectDescribe(n),u=t.getSObjectNameField(s);"User"==n?l.filter=r:l.filter=c,l.objectName=n,l.sorts=[{field:u,dir:"asc"}],l.columns=[u,"Id"];var f=e.init({pageInfo:l}).createDataSource();o.setDataSource(f),o.setOptions({dataTextField:u,valueTemplate:d||'<span title="#: data.'+l.columns[0]+' #">#: data.'+l.columns[0]+" #</span>",template:d||'<span title="#: data.'+l.columns[0]+' #">#: data.'+l.columns[0]+" #</span>"}),o.text(""),o.value(void 0)}}}),u},kendoOperatorForLookupOperation:function(e){var t;switch(e){case"equals":t="eq";break;case"notEqual":t="neq";break;case"lessThan":t="lt";break;case"greaterThan":t="gt";break;case"lessOrEqual":t="lte";break;case"greaterOrEqual":t="gte";break;case"contains":t="contains";break;case"notContain":t="doesnotcontain";break;case"startsWith":t="startswith";break;default:case"includes":case"excludes":case"within":}return t},filterValueForLookup:function(e,i,a,r){var s,l,d=e.split(".");if(d.length>1)switch(d[0]){case"$User":var c=t.getUserInfo();c&&c.userId&&(s=kendo.format("select {0} from User where Id = '{1}'",d[1],c.userId));break;case"$Source":i&&i[d[1]]?l=i[d[1]]:i&&i.Id&&(s=kendo.format("select {0} from {1} where Id = '{2}'",d[1],a,i.Id));break;default:var u="Unsupported filtered lookup valueField: "+e;console.log(u),o.trackException(u)}s?n.query(s,function(e){e&&e.length>0&&r(e[0][d[1]])},function(t){console.log(kendo.format("Failure retrieving lookup filter value {0}: {1} ",e,t)),o.trackException(t)}):r(l)},preevaluateFilter:function(e){var t=!1,i=this;if(e.filters&&e.filters.length>0)Object.each(e.filters,function(n){t="or"==e.logic.toLowerCase()?t||i.preevaluateFilter(n):t&&i.preevaluateFilter(n)});else switch(e.operator){case"neq":t=e.value!=e.field;break;case"lt":t=e.field<e.value;break;case"gt":t=e.field>e.value;break;case"lte":t=e.field<=e.value;break;case"gte":t=e.field>=e.value;break;case"contains":t=e.field.indexOf(e.value)<-1;break;case"notContain":t=e.field.indexOf(e.value)>-1;break;case"startsWith":t=0==e.field.indexOf(e.value);break;case"eq":default:t=e.value==e.field}return t},evaluateBooleanFilterLogic:function(e,t){Object.each(t,function(e,t){"isnotnull"==e.operator||"isnull"==e.operator||void 0!==e.value&&null!==e.value||void 0===e.field||(e.operator="neq"==e.operator?"isnotnull":"isnull")});var i={filters:t,logic:"and"};if(e){var n=parseInt(e.value)-1,a=e.value.toLowerCase();if("and"==a||"or"==a){var o=[];e.left&&o.push(l.evaluateBooleanFilterLogic(e.left,t)),e.right&&o.push(l.evaluateBooleanFilterLogic(e.right,t));var r=Object.where(o,function(e){return e.preEvaluate});if(r&&r.length>0)for(var s=0;s<r.length;s++){var d=r[s],c=this.preevaluateFilter(d);!c&&"and"==a||c&&"or"==a?o=[]:o.splice(o.indexOf(d),1)}i={filters:o,logic:a}}else t[n]&&(i=t[n])}return i},adjustFilterByType:function(e,i,n){var a=t.getSObjectDescribe(e),o=Object.first(a.fields,function(e){return e.name==i});if(o)if("picklist"==o.type)switch(n.operator){case"eq":case"contains":case"startswith":n.operator="includes";break;case"neq":case"doesnotcontain":n.operator="excludes"}else if("RecordTypeId"==o.name&&n.value){var r=n.value.split(","),s={filters:[],logic:"or"};Object.each(r,function(i,a){var o=t.query(kendo.format("select Id from RecordType where Name = '{0}' and SobjectType = '{1}'",i.trim(),e));1==o.length&&s.filters.push({field:n.field,operator:n.operator,value:o[0].Id}),r.length==parseInt(a)+1&&(delete n.value,delete n.field,delete n.operator,n.logic=s.logic,n.filters=s.filters)})}},createLookupFilter:function(e,n,r,d){var c=[],u=[],f=void 0,p=this,h=function(){var i=c.pop();if(i){var n={},a=i.field,o=i.value||i.valueField,s=a&&(a.indexOf("$User")>-1||a.indexOf("$Source")>-1),g=o&&(o.indexOf("$User")>-1||o.indexOf("$Source")>-1);if(i.valueField&&s){a=i.valueField,o=i.field;var m=s;s=g,g=m}var v=a.split(".");n.field=v.length>1?a.substr(a.indexOf(".")+1):a;var b=e,y=v.length>1?v[v.length-1]:a;if(b.indexOf("$User")>-1)b="User";else if(v.length>1&&"$Source"!=v[v.length-2]){var k=v[v.length-2],w=t.getIdFieldFromRelationshipName(k);if(v.length>2){var x=v[v.length-3],I=t.getSObjectDescribe(x),S=Object.first(I.fields,function(e){return e.name==w});b=S.referenceTo}else b=v[v.length-2]}n.operator=l.kendoOperatorForLookupOperation(i.operation),g?l.filterValueForLookup(o,r,e,function(t){n.value=t,p.adjustFilterByType(b,y,n),s?l.filterValueForLookup(i.field,r,e,function(e){p.adjustFilterByType(b,y,n),n.field=e,u.push(n),h()}):(u.push(n),h())}):s?l.filterValueForLookup(i.field,r,e,function(e){n.value=o,n.field=e,p.adjustFilterByType(b,y,n),n.preEvaluate=!0,u.push(n),h()}):(n.value=o,p.adjustFilterByType(b,y,n),u.push(n),h())}else u=l.evaluateBooleanFilterLogic(f,u),"function"==typeof d&&d(u)};s[e]&&s[e][n]?(c=s[e][n].filters.slice(0),f=s[e][n].booleanFilter,h()):i.getFieldDefinition(e,n,function(t){var i=t&&t.length>0&&t[0].Metadata&&t[0].Metadata.lookupFilter?t[0].Metadata.lookupFilter:{};i&&i.filterItems&&(c=i.filterItems),i&&i.booleanFilter&&(f=a.parseBooleanExpression(i.booleanFilter)),s[e]||(s[e]={}),s[e][n]={filters:c.slice(0),booleanFilter:f},h()},function(e){console.log(e),"function"==typeof d&&d(),o.trackException(e)})},createDataSourceFilter:function(e,i){var n=e.fkField,a=e.fkValue,o=this.fieldMeta,s=this.pageInfo,l=e.parentObject,d=e.model,c=!1;if(o)switch(o.referenceTo){case"RecordType":s.filter=[{field:"IsActive",operator:"eq",value:"true"},{field:"SobjectType",operator:"eq",value:l}];break;case"User":s.filter=r;break;case"PricebookEntry":this.enableSpyGlass=!1;var u=void 0,f=["Pricebook2Id"];if(a){n=n.toLowerCase();var p=t.getUserInfo();switch("true"==p.organizationMultiCurrency&&f.push("CurrencyIsoCode"),l){case"opportunitylineitem":"opportunityid"===n&&(u="select {1} from Opportunity where Id = '{0}'");break;case"orderitem":"orderid"===n&&(u="select {1} from order where id = '{0}'");break;case"quotelineitem":"quoteid"===n&&(u="select {1} from quote where id = '{0}'")}}if(u){var h=t.query(u,a,f);h.length>0&&(s.filter=[],h[0].Pricebook2Id&&(s.filter=[{field:"Pricebook2Id",operator:"eq",value:h[0].Pricebook2Id}]),h[0].CurrencyIsoCode&&s.filter.push({field:"CurrencyIsoCode",operator:"eq",value:h[0].CurrencyIsoCode}))}s.filter instanceof Array||(s.filter=[]),s.filter.push({field:"IsActive",operator:"eq",value:"true"}),s.columns=["Name","Id","Pricebook2.Name","UnitPrice"],this.template='<span title="#: data.Name # (#: data.Pricebook2.Name #)">#: data.Name # (#: data.Pricebook2.Name #)</span>';break;default:this.isFiltered&&(c=!0,this.createLookupFilter(l,o.name,d,function(e){s.filter=e,i()}))}c||i()},createDataSource:function(t){var i=this.pageInfo,n=this.fieldMeta,a=(this.template,this.setFunction,this.enableSpyGlass,i.filter),o=i.sorts;return a?a instanceof Array||(a=[a]):a=[],o?o instanceof Array||(o=[o]):o=[],i.sorts=o,i.filter=a,i.takeCount=25,i.objectName||(i.objectName=n.relObjectName),i.columns||(i.columns=["Name","Id"]),e.init({pageInfo:i}).createDataSource()},setSelect:function(e){var t=this.pageInfo,i=this.setFunction;if(void 0!==e){var n=e[t.columns[0]];$.isFunction(i)&&i(e,t.columns,n)}else{var a={};a[t.columns[0]]="",a[t.columns[1]]=null,$.isFunction(i)&&i(a,t.columns)}},createComboBox:function(e){var t=this.input,i=e.displayText,n=e.dataSource,a=e.autoBind,o=this.isPolymorphic,r=this.enableSpyGlass,s=this.pageInfo,l=(this.pageInfo.filter,this.template),d=this,c=t.kendoComboBox({dataTextField:s.columns[0],dataValueField:s.columns[1],dataSource:n,text:i?i:"",filter:"contains",autoBind:void 0===a||a,valueTemplate:l||'<span title="#: data.'+s.columns[0]+' #">#: data.'+s.columns[0]+" #</span>",template:l||'<span title="#: data.'+s.columns[0]+' #">#: data.'+s.columns[0]+" #</span>",change:function(e){var t=this.dataItem(this.select());(t||0==this.value().length)&&d.setSelect(t)}}).data("kendoComboBox");c.input.blur(function(e){var t=c.dataItems();if(1===t.length){var i=t[0];c.select(0),c.input.val(i[s.columns[0]]),d.setSelect(i)}else null!=c.dataItem()&&d.setSelect(c.dataItem())}),c.input.on("paste",function(){c.input.trigger("keydown")}),i&&c.one("dataBound",function(){c.input.select()}),t.on("resize",function(e,i){var n=t.parent().css("width"),a=n.indexOf("%")>-1?-3:parseInt(n),s=75,l=i||a;r&&(l-=30),o&&(l-=40),a<=0?l=kendo.format("calc(100% - {0}px)",Math.abs(l)):l<s&&(l=s),$(c.wrapper).width(l)}),t.trigger("resize")},create:function(e){var t=Object.create(l);e.parentObject&&""!=e.parentObject||(t.enableSpyGlass=!1),t.fieldMeta=e.fieldMeta,t.input=e.input,t.isFiltered=t.fieldMeta&&t.fieldMeta.filteredLookupInfo,t.isPolymorphic=t.fieldMeta&&t.fieldMeta.referenceTo instanceof Array,t.pageInfo=e.pageInfo,t.template=e.template,t.setFunction=e.setFunction;var i,n=t.fieldMeta?t.fieldMeta.name:e.field;return t.createDataSourceFilter({fkField:e.fkField,fkValue:e.fkValue,parentObject:e.parentObject,model:e.model},function(){var a=t.createDataSource();t.isPolymorphic&&(i=t.createPolymorphicMenu({objectName:e.pageInfo.objectName})),t.enableSpyGlass&&t.createSpyglass({objectName:e.pageInfo.objectName,keyPrefix:e.keyPrefix,parentObject:e.parentObject,model:e.model,inputName:n,field:e.field,objectPicker:i}),t.createComboBox({displayText:e.displayText,dataSource:a,autoBind:e.autoBind})}),t},controlFactory:function(e,t,i,n,a){try{e&&e.filteredLookupInfo&&l.createLookupFilter(i,e.name)}catch(e){}return function(o,r,s,d,c,u,f){var p=l.create({input:o,field:r,model:s,displayText:d,keyPrefix:c,setFunction:u,autoBind:f,fieldMeta:e,pageInfo:t.pageInfo,parentObject:i,fkField:n,fkValue:a});return p}},editor:function(e,t,i,n){var a=this;return function(o,r){var s=$("<input/>");s.attr("name",r.field),s.appendTo(o),a.makeControl(s,e,t,function(e,t){var a=i.split(".");r.model[i]=e[a[a.length-1]];for(var o,s=r.model,l=0;l<a.length-1;l++)o=s,s=s[a[l]];Object.each(t,function(t){s[t]=e[t]}),n?(r.model[n]=e.Id,void 0!==r.model.dirty&&(r.model.dirtyFields||(r.model.dirtyFields={}),r.model.dirtyFields[n]=e.Id)):o[a[a.length-2]+"Id"]=e.Id})}}};return l}),crmc.define("JSOperators",["extensions"],function(){var e="…",t="🌀",i={Date:{"Add X Days":"(new Date(…)).addDays(…)","Add X Hours":"(new Date(…)).addHours(…)","Add X Minutes":"(new Date(…)).addMinutes(…)","Add X Months":"(new Date(…)).addMonths(…)","Add X Weeks":"(new Date(…)).addWeeks(…)","Add X Years":"(new Date(…)).addYears(…)","Day of Month (1-31)":"….getDate()","Day of Week (0-6)":"….getDay()","Hour of Day (0-23)":"….getHours()","Is After":"….isAfter(…)","Is Before":"….isBefore(…)","Is Between":"….between(…,…)","Is In Next X":'….inNext(…numberOf…,"…DaysWeeksMonthsOrYears…")',"Is In Previous X":'….inLast(…numberOf…,"…DaysWeeksMonthsOrYears…")',"Is Weekday":"….isWeekday()","Minutes (0-59)":"….getMinutes()","Month (0-11)":"….getMonth()",Now:"(new Date())",Today:"(Date.today())",Value:"(new Date(…year…,…month…,…day…,…hour…,…minutes…))",Year:"….getFullYear()","Is Blank":"… == null","Is Not Blank":"… != null","Is Equal To":"… === …","Is Not Equal To":"… !== …"},Format:{"As Currency":'kendo.format("{0:c}", …)',"As Date":'kendo.format("{0:d}", …)',"As DateTime":'kendo.format("{0:g}", …)',"As Decimal":'kendo.format("{0:n}", …)',"As Number":'kendo.format("{0:n0}", …)',"As Time":'kendo.format("{0:hh:mm tt}", …)'},Advanced:{"Function (Required)":"function(){\n  // Snarky Comments\n  return …;\n}()",Variable:"var …x… = …y…;",If:"if (…test…) {\n  …then…\n}\nelse {\n  …else…\n}","For Each":"Object.each(…list…, function(item){\n  // Use item\n});","Regular Expression":"/…regex…/.test(…string…)"},Logic:{And:"… && …","Group Selected":"(…)",If:"(…if…) ? (…then…) : (…else…)","Is Blank":"… == null","Is Not Blank":"… != null","Is Less Than":"… < …","Is Greater Than":"… > …","Is Equal To":"… === …","Is Not Equal To":"… !== …",Not:"!(…)",Or:"… || …"},Number:{"Absolute Value":"Math.abs(…)","+ Add":"… + …","Round Up":"Math.ceil(…)","/ Divide":"… / …","Round Down":"Math.floor(…)",Max:"Math.max(…1…,…2…,…)",Min:"Math.min(…1…,…2…,…)","* Multiply":"… * …","xʸ Exponent":"Math.pow(…base…,…exp…)","Random (0-1)":"Math.random()",Round:"Math.round(…)","- Subtract":"… - …","√ Sqaure Root":"Math.sqrt(…)","Is Blank":"… == null","Is Not Blank":"… != null","Is Less Than":"… < …","Is Greater Than":"… > …","Is Equal To":"… === …","Is Not Equal To":"… !== …"},Text:{Append:"… + …",Contains:"(….indexOf(…) > 0)","Index Of":"….indexOf(…substring…)",Replace:"….replace(…find…,…replace…)",Substring:"….substr(…startIndex…,…length…)",Value:'"…"',"Is Blank":"… == null","Is Not Blank":"… != null","Is Equal To":"… === …","Is Not Equal To":"… !== …"}},n={},a=function(e,t){var i=[];return Object.each(e,function(e,o){var r="crmcOperator"+Math.random().toString(16),s={text:o,cssClass:r,value:e,parent:t,encoded:!1};n[r]=s;var l="object"==typeof e?a(e):[];l&&l.length>0&&(s.items=l),i.push(s)}),i=Array.orderBy(i,function(e){return e.text})},o=kendo.format("\\u{0}\\u{1}",t.charCodeAt(0).toString(16),t.charCodeAt(1).toString(16)),r=new RegExp(kendo.format("[{0}{1}](\\w+[{0}{1}])?",o,e)),s={dataSource:a(i),itemDictionary:n,initMenu:function(e,t,n){var o=[];n.map(function(e){var t={};switch(t[e.displayName]=e.name,t=a(t)[0],t.text=kendo.format('<input type="checkbox" disabled data-bind="checked: dependentFields" title="Used by Formula" value="{0}" /> {1}',t.value,t.text),t.isField=!0,e.type.toLowerCase()){case"currency":case"integer":case"double":case"percent":t.items=a(i.Number,t);break;case"boolean":break;case"date":case"datetime":case"time":case"datepart":case"datetimepart":t.items=a(i.Date,t);break;case"picklist":case"multipicklist":case"child":case"string":default:t.items=a(i.Text,t)}o.push(t)}),n=o;var s=$('<ul style="position:fixed; z-index:10001;">'),l=this;s.on("mousedown",function(e){e.preventDefault()});var d=function(e,i,n){var a=t.get(0),o=a.selectionStart||0,l=a.selectionEnd||o,d=t.val();n&&n.value&&(e=e.replace(r,n.value)),l>o&&e&&e.search&&e.search(r)>-1&&(e=e.replace(r,d.substr(o,l-o))),d=d.substr(0,o)+e+d.substr(l,d.length),i.set("expression",d);var c=d.match(r);c&&c.length>0?(a.selectionStart=d.indexOf(c[0]),a.selectionEnd=a.selectionStart+c[0].length):(a.selectionStart=o,a.selectionEnd=l+e.length),s.data("kendoMenu").close()},c=function(e){var i,n=t.get(0),a=n.selectionStart||0,o=n.selectionEnd||a,s=t.val();if(a==o)for(var l=new RegExp(r.source,"g");null!==(i=l.exec(s));){var d=i[0]&&i[0].length;if(a>=i.index&&a<=d+i.index){n.selectionStart=i.index,n.selectionEnd=d+i.index;break}}};t.on("click",c),e.append(s),e.append('<div style="height:30px;"></div>'),s.kendoMenu({dataSource:[{text:"Fields",items:n},{text:"Functions",items:this.dataSource}],openOnClick:!0,open:function(e){var t=$(e.item).find("input[type=checkbox]");t.each(function(e,t){var i=$(t).prop("checked");i?($(t).removeProp("disabled"),$(t).css("pointer-events","")):($(t).prop("disabled","true"),$(t).css("pointer-events","none"))}),t.off("click"),t.on("click",function(e){var t=$(this).prop("checked");t||($(this).prop("disabled","true"),e.stopPropagation())})},select:function(e){e.item.classList||(e.item.classList=e.item.className.split(" "));var i=Object.first(e.item.classList,function(e){return e&&e.indexOf&&0==e.indexOf("crmcOperator")}),n={};if($(t)[0].kendoBindingTarget&&$(t)[0].kendoBindingTarget.source&&(n=$(t)[0].kendoBindingTarget.source),void 0!==l.itemDictionary[i]){var a=l.itemDictionary[i];if(a&&a.value&&a.value.search){d(a.value,n,a.parent);var o=a.parent?$(e.item).parents("li:first"):$(e.item),r=(a.parent?a.parent.value:a.value,o.find("input"));if(r&&r.length>0){var s=$(r).prop("checked");s||(r.prop("checked","true"),r.removeProp("disabled"),r.trigger("change"))}}}}})}};return s}),crmc.define("ColumnFactory",["CustomSettings","sfdc","tooling","GridConstants","ForeignKeyControl","SFRest","ReadOnlyObjects","FormulaHelpers"],function(e,t,i,n,a,o,r,s){var l={pageLayoutURLTemplate:function(e,i,n,a){return function(e){var a=e;if(n&&n.length>0)for(var o=0;o<n.length-1;o++)a&&a[n[o]]&&(a=a[n[o]]);var r="";if(e[i]){var s=e[i];""!=s&&void 0!==s||(s="(empty)");var l=e[i]?e[i]:"",d=(Math.floor(1e5*Math.random()+1)+"_",t.getRecordURL(a.Id)),c=0==d.indexOf("javascript:");r=kendo.format('<a href="{2}" data-id="{0}" class="agHoverHelp" {3}>{1}</a>',a.Id,kendo.htmlEncode(l),d,c?"":'target="_blank"')}return r}},createFormulaColumn:function(e){var t={};return t.title=e.id,t.width=100,t.attributes={class:"readOnly"},t.sortable=!1,t.filterable=!1,t.field=s.getFormulaFieldName(e),t.headerAttributes={class:"k-with-icon"},t.formula=e,t.aggregates=[],s.isNumber(e)&&t.aggregates.push("sum"),t.groupFooterTemplate=function(e){var i=e[t.field]||e,n="";if(i&&i.sum&&"number"==typeof i.sum){var a=t.formula&&t.formula.format;n=void 0!==a?kendo.format('<div class="number">{0:'+a+"}</div>",i.sum):i.sum}return n},t.footerTemplate=t.groupFooterTemplate,t.headerTemplate=kendo.format('<a class="k-grid-filter" href="#"><span class="k-icon k-i-funnel-clear" title="{1}"/></a><a class="k-link" href="#" title="{1}"><span class="k-icon k-i-sum" style="vertical-align:top;" />{0}</a>',t.title,"This column is not filterable or sortable because it is a formula field"),t.template=function(i){var n=i[t.field]||"";return t.formula&&t.formula.format&&(n=s.formatFormula(t.formula,i),s.isNumber(e)&&(n="<div class='number'>"+n+"</div>")),n},t},getParentalMeta:function(e,i){var n=e.name.split(".");if(n.length>1)for(var a=[],o=1;o<n.length;o++){var r=n.slice(0,o).join("."),s=t.getIdFieldFromRelationshipName(r),l=$.grep(i,function(e){return e.name==s});l.length>0&&a.push(l[0])}return a},getHeaderTitle:function(e,t){var i,a=e.name.split(".");if(a.length>1){var o=l.getParentalMeta(e,t).map(function(e){return e.displayName});i=e.isNameField===!0?o.join(" "):kendo.format("{0} ({1})",o.join(" "),e.displayName)}else i=e.displayName;return"datetimepart"!=e.type.toLowerCase()&&"datepart"!=e.type.toLowerCase()||(i+=" ("+n.dateParts[e.name.split("__datepart__")[1]]+")"),i},initFactory:function(e){var i={config:e,createTemplate:function(e){var i=Object.first(this.config.fieldMeta,function(t){return t.name==e});if(i){var n=this.config.settings;if(i.type=i.type.toLowerCase(),"RecordType.Name"==e)return function(t){return t[e]?'<span title="'+t[e]+'">'+t[e]+"</span>":""};if(i.isNameField){var a=e.split(".");return l.pageLayoutURLTemplate(n.objectName,e,a,n.enableHover)}if("email"==i.type)return function(t){var i=t[e];return i?kendo.format('<a href="mailto:{0}">{0}</a>',i):""};if("phone"==i.type)return function(t){var i=t[e]||"";if(void 0===i&&(i=""),window.sendCTIMessage)if(""==i);else if(window.clickToDialEnabled){var a=t.Name||(t.FirstName&&t.LastName?t.FirstName+" "+t.LastName:t.FirstName);i="<a href='javascript:void(0);' onclick=\"disableClicked(this, 'Click to dial disabled');sendCTIMessage('/CLICK_TO_DIAL?DN='+encodeURIComponent('"+i+"')+'&amp;ID="+t.id+"&amp;ENTITY_NAME="+n.pageInfo.objectName+"&amp;OBJECT_NAME='+encodeURIComponent('"+a+"')+'&amp;DISPLAY_NAME='+encodeURIComponent('"+n.pageInfo.objectName+"'));return false;\">"+i+'<img src="/img/btn_dial_inline.gif" alt="Click to dial" width="16" height="10" title="Click to dial" style="display: inline;"></a>'}else i="<span>"+i+'<img src="/img/btn_nodial_inline.gif" alt="Click to dial disabled" width="16" height="10" title="Click to dial disabled"></span>';return i};if("url"==i.type)return function(t){var i=t[e];return i&&i.indexOf("://")<0&&(i="http://"+i),i?kendo.format('<a href="{0}" target="_blank">{1}</a>',i,t[e]):""};if("string"==i.type)return function(t){return t[e]?t[e]:""};if("encryptedstring"==i.type){var o=Object.first(n.metadata.fields,function(t){return t.name==e});return function(t){var i="";if(t[e]){var n="",a=4;switch(o.maskType){case"ssn":n="XXX-XX-";break;case"creditCard":n="XXXX-XXXX-XXXX-";break;case"nino":n="XX XX XX XX X",a=0;break;case"sin":n="XXX-XXX-",a=3;break;case"all":default:a=0;case"lastFour":for(;n.length<t[e].length-a;)n+="X"}"X"!=o.mask&&(n=n.replace(/[X]/g,o.mask));var r=t[e].length-a;i=n+t[e].substr(r>=0?r:0,a)}return i}}if("textarea"==i.type)return function(t){return t[e]?'<div class="longtext">'+t[e]+"</div>":""};if(["combobox","picklist"].indexOf(i.type)>-1)return function(t){return t[e]?'<span title="'+t[e]+'">'+t[e]+"</span>":""};if("multipicklist"==i.type)return function(t){return t&&t[e]?t[e].join?t[e].join(";"):t[e]:""};if(["datepart","datetimepart"].indexOf(i.type)>-1)return function(t){var i="";return void 0!=t[e]&&(i=t[e]),i};if("date"==i.type){var r=function(e,n){return e=t.parseDate(e,i.type),n=n||"{0:d}",kendo.format(n,e)};return function(t){var i="";if(void 0!==t[e]&&t[e]instanceof Date){var n=t[e];i=r(n)}return i}}return["time","datetime"].indexOf(i.type)>-1?function(t){var i="";return void 0!==t[e]&&t[e]instanceof Date&&(i=kendo.format("{0:g}",t[e])),i}:["currency","double","percent"].indexOf(i.type)>-1?function(t){var n="{0:n"+i.precision+"}";"currency"==i.type?n="{0:c"+i.precision+"}":"percent"==i.type&&(n="{0:n"+i.precision+"}%");var a="";return"number"==typeof t[e]&&(a=kendo.format(n,t[e])),a}:"boolean"==i.type?function(t){return kendo.format('<input type="checkbox" style="pointer-events:none;" disabled {0}/>',t[e]===!0?"checked":"")}:"base64"==i.type?function(e){var i='<a target="_blank" href="'+t.getRecordURL(e.Id)+'" />View</a>';return"Attachment"==n.metadata.name?i='<a target="_blank" href="/servlet/servlet.FileDownload?file='+e.Id+'" />View</a>':"StaticResource"==n.metadata.name&&(i='<a target="_blank" href="/resource/'+e.Name+'" />View</a>',e.NamespacePrefix&&(i='<a target="_blank" href="/resource/'+e.NamespacePrefix+"__"+e.Name+'" />View</a>')),i}:e.indexOf(".")>-1?function(t){var n="";return t[e]&&(n=t[e],i.format&&(n=kendo.format(i.format,n))),n}:void 0}},createEditor:function(e,i){i||(i={validation:{required:!1}});var n=this,o=Object.first(this.config.fieldMeta,function(t){return t.name==e});if(o){if(e.indexOf(".")>-1){var r=e.split("."),s=t.getIdFieldFromRelationshipName(r[0]);o.idMeta=Object.first(this.config.fieldMeta,function(e){return e.name===s})}var l=this.config.settings,d=this.config.getRecordTypes,c=this.config.picklistValuesFactory;if(o.type=o.type.toLowerCase(),"RecordType.Name"==e)o.picklistValues=[],o.editor=function(e,t){var n=$("<input/>"),a="RecordTypeId";n.attr("name",a),n.appendTo(e),i.validation.required&&(n.attr("required","required"),$('<span class="k-invalid-msg" data-for="'+a+'"></span>').appendTo(e));var r=n.kendoComboBox({dataSource:{transport:{read:function(e){o.picklistValues.length>0?e.success(o.picklistValues):d(function(t){Object.each(t,function(e,t){e._isAvailable&&"Master"!=e._name&&o.picklistValues.push({text:e._name,value:t})}),e.success(o.picklistValues)})}}},valueTemplate:'<span title="#: data.text #">#: data.text #</span>',template:'<span title="#: data.text #">#: data.text #</span>',dataTextField:"text",dataValueField:"value",change:function(e){var i=t.model;i.RecordType={Id:this.value(),Name:this.text()},i.RecordTypeId=this.value(),i["RecordType.Name"]=this.text()}}).data("kendoComboBox");return r};else if(e.indexOf(".")>-1&&o.isNameField){var r=e.split("."),u={pageInfo:{objectName:o.parentMeta.relObjectName},remoteActions:l.remoteActions},f=r.length-1;u.pageInfo.sorts=[{field:r[f],dir:"asc"}],u.pageInfo.columns=[r[f],"Id"];var p=Object.first(l.metadata.fields,function(e){return e.name==o.parentMeta.name}),h=a.controlFactory(p,u,l.pageInfo.objectName.toLowerCase(),l.fkField,l.fkValue,!0);o.editor=function(t,n){n.model[r[0]][r[f]+"_input"]=n.model[e];var a=$('<input type="hidden" />');return a.appendTo(t),a.attr("name",n.field),i.validation.required&&(a.attr("required","required"),$('<span class="k-invalid-msg" data-for="'+n.field+'"></span>').appendTo(t)),h(a,n.field,n.model,n.model[n.field],l.metadata.keyPrefix,function(t,i,a){var r=e.split("."),s=t[r[r.length-1]]||a;n.model[e]=s;for(var l,d=n.model,c=0;c<r.length-1;c++)l=d,d=d[r[c]];Object.each(i,function(e){d[e]=t[e]}),d[r[r.length-1]+"_input"]=s,o.parentMeta.name?n.model[o.parentMeta.name]!=t.Id&&(n.model[o.parentMeta.name]=t.Id,void 0!==n.model.dirty&&n.model.set(n.field,t.Id)):l[r[r.length-2]+"Id"]=t.Id,"PricebookEntry"==o.parentMeta.relObjectName&&(n.model.UnitPrice=t.UnitPrice,n.model.Quantity=1)}),a.data("kendoComboBox")}}else if(["currency","double","percent","integer"].indexOf(o.type)>-1)o.editor=function(e,t){var n="n"+o.precision;"currency"==o.type&&(n="c"+o.precision);var a=$("<input/>");return a.attr("name",t.field),a.appendTo(e),i.validation.required&&(a.attr("required","required"),$('<span class="k-invalid-msg" data-for="'+t.field+'"></span>').appendTo(e)),a.kendoNumericTextBox({decimals:o.precision,format:o.formatStr}),a.data("kendoNumericTextBox")};else if(["phone"].indexOf(o.type)>-1)o.editor=function(e,n){var a=$("<input class='k-input k-textbox'/>");a.attr("name",n.field);var o=t.getUserInfo(),r=["en_us","fr_ca","en_ca"];return o&&r.indexOf(o.userLocale.toLowerCase())>-1&&a.on("change",function(){a.one("blur",function(){var e=this.value,i=t.formatPhone(e);i&&n.model.set(n.field,i)})}),i.validation.required&&a.attr("required","required"),a.appendTo(e),a.data("kendoMaskedTextBox")};else if("textarea"==o.type)o.editor=function(e,t){t.model[t.field]=$("<div/>").html(t.model[t.field]).text();var n=$('<textarea data-bind="value: '+t.field+'" class="k-input k-textbox"></textarea>');return n.attr("name",t.field),n.on("keydown",function(e){switch(e.keyCode){case kendo.keys.TAB:(void 0!=t.model[t.field]||n.val())&&t.model.set(t.field,n.val());break;case kendo.keys.UP:case kendo.keys.DOWN:case kendo.keys.ENTER:e.stopPropagation()}}),i.validation.required&&n.attr("required","required"),n.appendTo(e),n};else if("encryptedstring"==o.type)o.editor=function(t,a){var o=$('<input type="text" class="k-input k-textbox" />');o.attr("dirty","false"),o.attr("name",a.field);var r=n.createTemplate(e);return o.val(r(a.model)),o.on("keydown",function(e){"false"==o.attr("dirty")&&(o.attr("dirty","true"),o.val(""))}),o.on("input paste",function(e){a.model.set(a.field,o.val())}),i.validation.required&&o.attr("required","required"),o.appendTo(t),o};else if(["combobox","picklist"].indexOf(o.type)>-1){if(void 0!==o.picklistValues){var g="kendoDropDownList";"combobox"==o.type&&(g="kendoComboBox");var m=o.picklistValues.filter(function(e){return e.active}).map(function(e){return{text:e.label,value:e.value}})}var v=c(e,m);o.editor=function(e,t){var n=$("<input/>");n.attr("name",t.field),n.appendTo(e),i.validation.required&&(n.attr("required","required"),$('<span class="k-invalid-msg" data-for="'+t.field+'"></span>').appendTo(e));n[g]({valuePrimitive:!0,optionLabel:" ",dataSource:v(t),valueTemplate:'<span title="#: data.text #">#: data.text #</span>',template:'<span title="#: data.text #">#: data.text #</span>',dataTextField:"text",dataValueField:"value"}).data(g);return n.data("kendoDropDownList")}}else if("multipicklist"==o.type){var m=[];void 0!==o.picklistValues&&Object.each(o.picklistValues,function(e){e.active&&m.push(e.value)});var v=c(e,m);o.editor=function(e,t){var n=i.validation.required,a=$("<input />");a.attr("name",t.field),a.appendTo(e),n&&(a.attr("required","required"),$('<span class="k-invalid-msg" data-for="'+t.field+'"></span>').appendTo(e)),t.isMultiPicklist=!0;var r=a.kendoMultiSelect({optionLabel:o.isNillable?" ":void 0,dataSource:v(t),autoClose:!1,close:function(i){if(n&&i.sender.value().length>0){var o=t.model[t.field];t.model[t.field]=i.sender.value().join(";"),o!=t.model[t.field]&&e.addClass("k-dirty-cell"),a.removeAttr("required")}},change:function(e){t.model.dirtyFields||(t.model.dirtyFields={}),t.model.dirtyFields[t.field]=this.value()}}).data("kendoMultiSelect");return n&&r.open(),origValue=r.value,r.value=function(e){return"string"==typeof e&&(e=e.split(";")),origValue.call(this,e)},a.data("kendoMultiSelect")}}else["date","datetime","datetimepart"].indexOf(o.type)>-1?o.editor=function(e,t){var n="kendoDatePicker";"datetime"==o.type?n="kendoDateTimePicker":"time"==o.type&&(n="kendoTimePicker");var a=$('<input name="'+t.field+'" data-text-field="'+t.field+'" data-value-field="'+t.field+'" data-bind="value:'+t.field+'"/>');a.appendTo(e)[n]();return i.validation.required&&(a.attr("required","required"),$('<span class="k-invalid-msg" data-for="'+t.field+'"></span>').appendTo(e)),a.data(n)}:"boolean"==o.type&&(o.editor=function(e,t){var i=$('<input type="checkbox" data-text-field="'+t.field+'" data-value-field="'+t.field+'" data-bind="checked:'+t.field+'"/>');return i.appendTo(e),i});return o.idMeta&&o.idMeta.isReadonly&&o.idMeta.isCreateable?function(t,a){var r=""==a.model.id;if(r){if("function"==typeof o.editor)return o.editor(t,a);var s=$("<input/>");s.attr("name",a.field),i.validation.required&&s.attr("required","required"),s.appendTo(t),s.kendoMaskedTextBox()}else{$(t).addClass("readOnly");var l=n.createTemplate(e);"function"==typeof l?$(t).html(l(a.model)):$(t).text(a.model[a.field])}}:void 0!=o.editor?o.editor:o.editor=function(e,t){var n=$("<input/>");n.attr("name",t.field),n.addClass("k-textbox"),i.validation.required&&n.attr("required","required"),n.appendTo(e)}}}};return i},createNonFilterableHeaderTemplate:function(e){return kendo.format('<a class="k-grid-filter" href="#"><span class="k-icon k-i-funnel-clear" title="This column is not filterable due to Salesforce limitations"/></a><a class="k-link" href="#">{0}</a>',e)},createColumn:function(i,n,a){var o={};o.schema=a;var r=this.getElementId("col"+i.name).replace("#","");o.headerAttributes={id:r,scope:"col"},o.attributes={headers:r};var s=this;o.width=200,a.editable&&e.getSetting(this.settings.pageInfo.objectName,i.name,"fieldInlineEdit")===!1&&(a.editable=!1),this.settings.editable&&(o.attributes=void 0===o.attributes?{}:o.attributes,o.attributes.class="",a.editable?a.validation&&a.validation.required&&(o.attributes.class+=" requiredField",void 0===o.headerAttributes&&(o.headerAttributes={class:""}),o.headerAttributes.class+=" requiredField"):o.attributes.class+=" readOnly"),o.field=i.name,o.name=i.name,o.title=l.getHeaderTitle(i,n),
o.sortable=i.isSortable,o.template=this.factory.createTemplate(o.field),o.aggregates=["count"];var d,c;if(o.field.indexOf(".")>-1){c=o.field.split(".");var u=t.getIdFieldFromRelationshipName(c[0]);d=Object.first(n,function(e){return e.name===u})}if("RecordType.Name"==o.field){o.exportFormat=!1,o.exportTemplate=function(){return function(e){return e[i.name]?e[i.name]:""}};o.editor=s.factory.createEditor(o.field,o.schema)}else if(o.field.indexOf(".")>-1&&i.isNameField){o.exportFormat=!1;var s=this;if(void 0!==d){o.template=l.pageLayoutURLTemplate(this.settings.pageInfo.objectName,o.field,c,this.settings.enableHover);({isNameField:i.isNameField,idMeta:d});o.editor=s.factory.createEditor(o.field,o.schema)}}else i.isNameField&&(o.exportFormat=!1);var f=function(e,t){return function(i){var n=0,a=i[o.field]||i,r='<div class="number warningFooter">{0}</div>';return void 0!==a&&void 0!==a[e]&&"number"==typeof a[e]&&(n=void 0!==t?kendo.format("{0:"+t+"}",a[e]):a[e]),s.gridDataSource.totalPages()>1&&(r='<div class="number warningFooter"><span class="k-icon k-i-info" style="margin-right:2px;" data-title="{1}"></span>{0}</div>'),String.format(r,n,o.field)}},p=function(e,n){return e=t.parseDate(e,i.type),n=n||"{0:d}",kendo.format(n,e)};o.groupHeaderTemplate=function(e){var t="",n=i.type.toLowerCase();void 0!==e.value&&null!==e.value&&(t="date"==n?p(e.value):"datetime"==n?p(e.value,"{0:g}"):e.value);var a="";return s.gridDataSource.view()[0].field==e.field&&(a=kendo.format('<input type="checkbox" style="vertical-align: bottom;" class="check-group_{0}" name="group|{1}|{2}" />',s.settings.id,e.field,void 0===e.value||null===e.value?"":e.value)),kendo.format("{0} <span>{1}: {2}{3}</span>",a,o.title,t,e.count?" ("+e.count+")":"")};var h=function(e){var t=$(e).closest(".k-filter-menu");if(t&&t.length){var n,a=" ",o=$(e).prev();switch(i.type.toLowerCase()){case"date":case"datepart":n=e.kendoDatePicker().data("kendoDatePicker"),a=new Date;break;case"datetime":case"datetimepart":n=e.kendoDateTimePicker().data("kendoDateTimePicker"),a=new Date;break;default:t.find("input[type=text]:not([class*=reldate])").addClass("k-textbox")}t.on("click","button[type=submit]",function(){var t=o.val();"isnull"!=t&&"isnotnull"!=t||($(e).val(a),n&&(n.value(a),n.trigger("change")),$(e).trigger("change"))})}};switch(i.type.toLowerCase()){case"date":case"datetime":case"datepart":case"datetimepart":case"time":case"currency":case"integer":case"double":case"percent":case"combobox":case"picklist":o.filterable={ui:function(e){h(e)},extra:!0};break;default:o.filterable={ui:function(e){h(e)}}}var g=this.settings.metadata.getBoolean("queryable");i.isFilterable?$.inArray(i.type.toLowerCase(),["string","picklist","url","email"])!=-1&&i.isGroupable&&g||$.inArray(i.type.toLowerCase(),["multipicklist"])!=-1?o.filterable={ui:function(e){var t=$(e).closest(".k-filter-menu");$.inArray(i.type.toLowerCase(),["date","datetime","datepart","datetimepart"])!=-1&&e.kendoDateTimePicker();var n=t.find(".tabstrip");if(h(e),!n.length){t.prepend($('<div class="tabstrip"><ul><li class="k-state-active">Smart Filter</li><li>Basic Filter</li></ul><div><div class="filter-div" /></div></div>')),n=t.find(".tabstrip");var a=t.find(".filter-div"),r=n.next();n.append(r),a.kendoMultiSelectGridFilter({field:o.field,fieldMeta:i,objectName:s.settings.pageInfo.objectName,gridDataSource:s.gridDataSource,gridId:s.settings.id+"_grid",baseFilter:s.settings.baseFilter,getPageAction:s.settings.remoteActions.getPageAction,getColumnAction:s.settings.remoteActions.getColumnAction}),t.find("[type=reset]").on("click",function(){a.data("kendoMultiSelectGridFilter").clearFilter()}),n.kendoTabStrip(),r.find("div,select,input").css("margin",".19em")}},extra:!0}:("child"==i.type.toLowerCase()&&i.isGroupable||$.inArray(i.type.toLowerCase(),["date","datetime","datepart","datetimepart"])!=-1)&&(o.filterable={ui:function(e){e.removeAttr("data-bind");var t=$(e).closest(".k-filter-menu");t.html('<div class="filter-div"></div>');var n=t.find(".filter-div");n.kendoMultiSelectGridFilter({field:o.field,fieldMeta:i,objectName:s.settings.pageInfo.objectName,gridDataSource:s.gridDataSource,gridId:s.settings.id+"_grid",baseFilter:s.settings.baseFilter,getPageAction:s.settings.remoteActions.getPageAction,getColumnAction:s.settings.remoteActions.getColumnAction})},extra:!1}):(o.filterable=!1,o.headerAttributes=o.headerAttributes||{},o.headerAttributes.class="k-with-icon",o.headerTemplate=s.columnFactory.createNonFilterableHeaderTemplate(o.title)),$.inArray(i.type.toLowerCase(),["percent","double","integer","currency"])!=-1&&(o.attributes||(o.attributes={}),o.attributes.class?o.attributes.class+=" number":o.attributes.class="number"),o.headerAttributes=o.headerAttributes||{};var m=i.parentMeta?Object.create(i.parentMeta):Object.create(i),v=m.name.split(".");v.length>1&&(m.name=v[v.length-1]),o.headerAttributes["ag-data-tooltip"]=escape(kendo.format(" <div style='word-break: break-all; max-width: 300px'> Label: {2}<br/>API Name: {1}<br/>{0}Type: {3}<br/>Help: {4}</div>",v.length>1?kendo.format("Relationship: …{0}<br/>",v[v.length-2]):"",m.name,m.displayName,m.type.toLowerCase().toTitleCase(),m.inlineHelpText?m.inlineHelpText:"Empty"));var b=this.settings.pageInfo.objectName,y=o.field;o.field.indexOf(".")>0&&(b=d.relObjectName,y=c[c.length-1]);var k={type:i.type.toLowerCase()};switch(i.type.toLowerCase()){case"id":return;case"email":case"url":o.exportFormat=!1;break;case"phone":o.exportFormat=!1;break;case"string":case"encryptedstring":o.encoded=!i.isHtmlFormatted;break;case"combobox":case"picklist":if(void 0!==i.picklistValues){var w="values__c",x="kendoDropDownList";"combobox"==i.type.toLowerCase()&&(w="crmc_values",x="kendoComboBox",this.settings.editable),o[w]=[],Object.each(i.picklistValues,function(e){e.active&&o[w].push({text:e.label,value:e.value})})}o.exportFormat=!1,o.exportTemplate=function(){return function(e){return e[i.name]?e[i.name]:""}};break;case"child":o.exportFormat=!1,o.exportTemplate=function(e,n){return function(a){var o=[],r="";return a[i.name]?($.each(a[i.name],function(n,a){if(10==n)return void(r=" ...");var l=[],d=i.childFieldName.split(",");$.each(d,function(n,o){var r,c,u=o.split(".");if(u.length>1){var f=a[u[0]];if(void 0==f)return!0;var p=f[u[1]];r=u.length>0&&f.Id?f.Id:a.Id,c=p;var h=s.settings.pageInfo.objectName;if("Contact"==h&&"Lead"==u[0]||"Lead"==h&&"Contact"==u[0]){if(d.length>1||l.length>0)return!0}else if("Campaign"==h&&"Lead"==u[0]&&a.Contact&&a.Contact.Id)return!0}else r=a.Id,c=a[i.childFieldName];void 0!=c&&""!=c||(c="(empty)"),l.push(kendo.format(e,r,c,t.getRecordURL(r)))}),o.push(l.join("/"))}),'<div class="longtext">'+o.join(n)+r+"</div>"):""}},e.getSetting(s.settings.pageInfo.objectName,"lookupHoverDetail")===!1||t.isLightningExperienceOrSalesforce1()?o.template=o.exportTemplate('<a href="{2}" target="_blank">{1}</a>',", "):o.template=o.exportTemplate('<a href="{2}" target="_blank" class="agHoverHelp" data-id="{0}">{1}</a>',", "),o.groupable=!1;break;case"multipicklist":void 0!==i.picklistValues&&(o.crmc_values=[],Object.each(i.picklistValues,function(e){e.active&&o.crmc_values.push(e.value)}));break;case"datepart":case"datetimepart":o.width=100,o.headerAttributes.title=o.title;break;case"date":o.width=100;break;case"datetime":case"time":"time"===i.type.toLowerCase()&&(o.filterable={ui:"timepicker"}),o.width=150;break;case"currency":var I=i.precision||2,S="c"+I;o.width=100,o.format="{0:"+S+"}",e.getSetting(b,y,"fieldSum")!==!0&&(o.aggregates.push("sum"),o.footerTemplate=f("sum",S),o.groupFooterTemplate=f("sum",S));break;case"integer":o.width=75,o.format="{0:n0}",e.getSetting(b,y,"fieldSum")!==!0&&(o.aggregates.push("sum"),o.footerTemplate=f("sum","n"),o.groupFooterTemplate=f("sum","n"));break;case"double":var I=i.precision||0,S="n"+I;o.width=75,o.format="{0:"+S+"}",e.getSetting(b,y,"fieldSum")!==!0&&(o.aggregates.push("sum"),o.footerTemplate=f("sum",S),o.groupFooterTemplate=f("sum",S));break;case"percent":k.precision=i.precision||0,k.formatStr="n"+I,o.width=75;break;case"boolean":o.width=75,o.exportFormat=!1}if(o.editor=s.factory.createEditor(o.field,o.schema),a.isROV&&l.decorateEditor(o,l.readOnlyObjectEditor.bind(o,s.settings.pageInfo.objectName)),o.name.indexOf(".")>-1&&!i.isNameField){var C=o.editor,D=i.idMeta.name,N=this.factory.config.decorateDirtyParents;o.editor=function(e,t){var n=i.idMeta.relObjectName;e.kendoTooltip({autoHide:!1,showOn:"click",position:"top",relative:!0,content:t.model[i.idMeta.relationshipName].Id?"<div>Editing field on <a target='_blank' href='/"+t.model[D]+"'>"+n+"</a> parent object.</div>":"<div>Cannot edit on blank "+n+"!</div>",show:function(){this.popup.element.addClass("parentalWarning")}}).data("kendoTooltip").show(),t.model[i.idMeta.relationshipName].Id&&(C(e,t),e.find("input,textarea").on("blur",function(e){N&&N(o.name,t.model[i.idMeta.relationshipName].Id,n)}))}}if(this.settings.conditionalRules&&this.settings.conditionalRules[o.field]){var T=this.settings.conditionalRules[o.field];l.decorateColumnConditionalFormatting(o,T)}return o},decorateColumnConditionalFormatting:function(e,t){var i=e.template;e.template=function(n){var a=i?i(n):n[e.field];e.format&&a&&(a=kendo.format(e.format,a));var o=[],r=0;if(Object.each(t,function(t,i){if(t.expression&&t.expression.length>0){var a="#= "+t.expression+"#",s=function(e){var t="false";try{t=kendo.template(a)(e)}catch(e){console.log(e)}return"true"===t};s(n)&&o.push("crmc_"+e.field.replace(/[^A-Z0-9a-z]*/g,"")+r),r++}}),o.length>0){var s='<span class="{1}">{0}</span>';a=void 0===a||null===a?"":a,a=kendo.format(s,a,o.join(" "))}return a||""}},decorateEditor:function(e,t){var i=[]||e.decorators;e.editor&&i.push(e.editor),i.push(t.bind(e)),e.editor=function(e,t){Object.each(i,function(i){i(e,t)})}},readOnlyObjectEditor:function(e,i,n){var a=""==n.model.id,s=this,l=n.field;if(l.indexOf(".")>-1){var d=l.split(".");l=t.getIdFieldFromRelationshipName(d[0])}if(a)$(i).addClass("readOnly"),"function"==typeof s.template?$(i).html(s.template(n.model)):$(i).text(n.model[n.field]);else{var c=function(t){var a=r[e].Types[t.name][l],o=void 0==a;if(void 0!=a){var d=Object.first(t.fields,function(e){return e.name.toLowerCase()==a.toLowerCase()});d.updateable||(o=!0)}o&&($(i).addClass("readOnly"),"function"==typeof s.template?$(i).html(s.template(n.model)):$(i).text(n.model[n.field]))},u=function(e){alert.popup("Error",e)};o.getCachedDescribeById(n.model.id,c,u)}}};return l}),crmc.define("Formula",["KendoPopup","sfdc","JSOperators","ColumnFactory"],function(e,t,i,n){var a,o,r,s,l,d,c,u=kendo.ui,f=u.Widget,p=function(e,t,i){var n=$('<div style="margin:4px;">'),a=$(kendo.format('<label style="display:inline-block; clear:left; width:7em;">{0}: </label>',e));n.append(a);var o=$("<span>");return i&&o.append($("<span style='display:inline-block; vertical-align:middle; background-color: #c00; width:3px; height:21px;'></span>")),o.append(t),n.append(o),n},h="Untitled Formula",g=f.extend({options:{name:"FormulaWindow"},init:function(e,t){$(e).kendoFormulaWidget({grid:t.grid,allowNew:!0}),$(e).kendoWindow({title:"Saved Formulas",width:"550px",minWidth:"400px",minHeight:"260px",resizable:!0,resize:function(){var t=$(e).height()-290;t<114&&(t=114),o.css("height",t);var i=$(e).height()-46;i<218&&(i=218),s.css("height",i)},modal:!0}).data("kendoWindow").center().open();var i=s.data("kendoListView");i.select(i.element.children().eq(0))}}),m=f.extend({init:function(e,t){var c=this;r=t,f.fn.init.call(c,e);var u=$('<div style="width:150px; float:left;">');if(t.allowNew){var h=$("<button>New</button>");u.append(h),h.on("click",function(){c.newRule()}),h.kendoButton(),u.append($("<span> </span>"));var g=$("<button>Delete</button>");u.append(g),g.on("click",function(){c.deleteRule()}),g.kendoButton()}s=$('<div style="width:150px; float:left; height:264px; margin-top:3px;" data-bind="source: items">'),s.kendoListView({template:"<div style='padding:0.5em;'>#:id#</div>",editTemplate:"<div style='padding:0.5em;'>*#:id#</div>",selectable:!0,change:function(){var t=c.selectedRule();t&&(c.setSelected(t),$(e).trigger("select",{formula:t}))}}),$(u).append(s),$(e).append(u),l=$('<div style="width:calc(100% - 170px); float:right;">'),$(e).append(l),a=$('<input type="search" data-bind="value: id" style="width:calc(100% - 110px);" required="required" />'),$(l).append(p("Formula Label",a,!0));var m=$("<span/>"),v=$('<input type="text" data-bind="value:format"/>'),b=$("<span/>");d=$('<input type="hidden" size="10" data-bind="value:format"/>'),d.on("change",function(){var e=new Date,t=v.data("kendoDropDownList"),i=t&&t.value(),n=c.selectedRule();n.format=d.val(),n.type=t.text(),"g"!=i&&"d"!=i&&"hh:mm tt"!=i&&(e=e.valueOf()),i?b.text(kendo.format("{0:"+d.val()+"}",e)):b.html("")}),m.append(v),m.append(d),$(l).append(p("Format As",m)),$(l).append(p("Preview",b)),v.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:[{text:"No Formatting",value:""},{text:"Currency",value:"c"},{text:"Date",value:"d"},{text:"DateTime",value:"g"},{text:"Decimal",value:"n"},{text:"Number",value:"n0"},{text:"Time",value:"hh:mm tt"}],change:function(){var e=this.value(),t=e;e?d.val(t):d.val(""),d.trigger("change")}});var y=$.extend([],t.grid.fieldMeta);y=Object.where(y,function(e){return"function"!=typeof e&&(e.displayName=n.getHeaderTitle(e,y),"reference"!==e.type.toLowerCase())}),y=Array.orderBy(y,function(e){return e.displayName}),l.append('<label style="display:inline-block; clear:left; margin:5px;">JavaScript:</label>');var k=$("<div/>");o=$('<textarea style="vertical-align:top; width:calc(100% - 5px); height: 120px;font-family:monospace; font-size:14px;" data-bind="value:expression">'),k.append(o),i.initMenu(l,o,y),$(l).append(k);var w=$('<div style="float:right; margin:3px;">'),x=t.tooltip?$('<button class="k-primary" style="margin:3px;">Select</button>'):$('<button style="margin:3px;">Apply</button>');w.append(x),x.on("click",function(){c.selectedRule();c.apply(),t&&t.tooltip&&t.tooltip.hide&&t.tooltip.hide()}),x.kendoButton(),$(l).append(w),this.refresh()},selectedRule:function(){var e=s.data("kendoListView"),t=e.dataItem(e.select());return t},deleteRule:function(){var e=s.data("kendoListView");if(this.selectedRule()){var t=e.select();e.remove(t),this.apply(),0==c.data().length?l.hide():e.select(e.element.children().eq(0))}},newRule:function(){var e=s.data("kendoListView");e.add(),e.select(e.element.children().first()),l.show()},refresh:function(){var e=s.data("kendoListView"),t=[];Object.each(r.grid.settings.formulaFields,function(e){var i=new kendo.data.ObservableObject(e);t.push(i)}),c=new kendo.data.DataSource({data:t,schema:{model:{id:"id",fields:{id:{nullable:!1,type:"string",validation:{required:!0},defaultValue:function(){var e=h,t=Object.where(c.data(),function(e){return e.id&&e.id.indexOf(h)>-1});return t&&t.length>0&&(e+=t.length),e}},expression:{type:"string"},format:{type:"string"},dependentFields:{type:"array",defaultValue:[]}}}}});var i=new kendo.observable({items:c}),n=e.select(),a=e.select().prevAll().length;kendo.bind(s,i),n.length>0?(e.select(e.element.children().eq(a)),l.show()):l.hide()},apply:function(){var t=c.data().slice(0);if(t.length>0){if(!a.val()||0==a.val().length)return void e.popup("Name Required","Rule Name is required");if(!o.val()||0==o.val().length)return void e.popup("Expression Required","A Formula Expression is required")}r.grid.settings.formulaFields={},Object.each(t,function(e){e.id&&e.expression&&(r.grid.settings.formulaFields[e.id]=e)}),r.grid.preserveSelectedRows(r.grid.settings.editable),this.refresh()},setSelected:function(e){kendo.bind(l,e),d.trigger("change"),l.show()},options:{name:"FormulaWidget"}});u.plugin(g),u.plugin(m)}),crmc.define("KendoEntry",["ForeignKeyControl","KendoPopup","sfdc","GridConstants","FormulaHelpers","extensions","Formula"],function(e,t,i,n,a){var o={isNumerical:function(e){var t=!1;if(e)switch(e.toLowerCase()){case"percent":case"integer":case"double":case"currency":t=!0}return t},buildEntryFields:function(e,t,i){var n=[],a=t.name;return Object.each(e,function(e){var o=Object.first(t.fields,function(t){return t.name===e});if(o&&o.getBoolean("createable")){var r={name:o.name,label:o.label,type:o.type,values:o.picklistValues,referenceTo:o.referenceTo,value:i[e]};"Task"==a&&"OwnerId"==e?r.validate=function(e){var t=Object.first(e,function(e){return"assignToRecordOwner__crmc"==e.name});return this.value||t.value?null:'Please select an "Assigned To ID" or check "Assign To Record Owner"'}:o.referenceTo instanceof Array&&o.referenceTo.length>1?"OwnerId"==e?r.referenceTo="User":r.referenceTo=o.referenceTo[0]:"false"==e.nillable&&(r.required=!0,r.validate=function(e){return null==this.value||""===this.value?this.label+" is a required field!":null}),n.push(r)}}),n}},r={fieldSetEntry:function(e,n,a,s,l){s=s||{};var d;try{d=i.getSObjectDescribe(n)}catch(e){}var c=function(t){var i=o.buildEntryFields(t,d,s);r.entry(e,i,{objectName:n},null,l)};a instanceof Array?c(a):i.executeRemoteAction("getFieldSetDescribe",[n,a],function(e,i){i.status&&d?c(e):t.popup(String.format("'{0}' FieldSet not found for Object '{1}'",a,n),i.message)})},entry:function(r,s,l,d,c){var u=n.UNIQUE_ID++,f='<table style="width:100%">',p=i.getUserInfo(),h=kendo.format("{0}_{1}_{2}_{3}",p.organizationId,l.objectName,r.replace(" ",""),"displayResults"),g=function(){var e={};return Object.each(s,function(t){var n={name:t.name,label:t.label,validate:t.validate,maxLength:t.maxLength,required:t.required,isFormula:t.isFormula,formula:t.formula},a=$("#"+t.name+"_"+u);if(n.rawValue=a.val(),"boolean"==t.type)n.value=a[0].checked;else if("date"==t.type){var r=a.data("kendoDatePicker").value();n.value=null,r&&(r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())),n.value=r.toISOString(),n.rawValue=r)}else if("datetime"==t.type){var r=a.data("kendoDateTimePicker").value();if(r){var s=i.getDateWithOffset(new Date(r),i.getProfileTimezoneOffset());n.value=s.toISOString(),n.rawValue=s}else n.value=""}else if(o.isNumerical(t.type)){var d=a.data("kendoNumericTextBox"),c=d.value();n.value=c}else"html"==t.type||("reference"==t.type?n.value=$("#"+t.name+"_hidden_"+u).val():"multipicklist"==t.type?n.value=a.data("kendoMultiSelect").value().join(";"):"custom"==t.type?n.value=t.getValue():n.value=a[0].value);l&&l.includeCheckboxes&&(n.isChecked=$("#"+t.name+"_checkbox_"+u)[0].checked),e[n.name]=n}),e},m=function(){if(l&&l.hasDependency){var e={};Object.each(g(),function(t,i){e[i]=t.value}),Object.each(s,function(t){if(t.dependentPicklist){var i=t.dependentPicklist({field:t.name,model:e},t.values),n=$("#"+t.name+"_"+u);n.data("kendoDropDownList")?n.data("kendoDropDownList").setDataSource(i):n.data("kendoMultiSelect")&&n.data("kendoMultiSelect").setDataSource(i)}})}};Object.each(s,function(e){var t=' style="width:1px; white-space:nowrap;"';"textarea"==e.type&&(t=" style='vertical-align: top; padding-top: 5px'");var i='<span class="k-icon k-i-info helpIcon_'+u+'"margin-right:2px;" title="'+e.help+'" />';f+="<tr><th"+t+">"+(e.label?"<label for='"+e.name+"_"+u+"' >"+e.label+":</label>"+(e.help?i:""):"")+"</th>",l&&l.includeCheckboxes&&(f+=String.format("<td style='text-align:left; width:15px'><input type='checkbox' id='{0}'/></td>",e.name+"_checkbox_"+u)),f+="<td style='text-align:left;'>";var n=" visibility: hidden;";e.required&&"boolean"!=e.type&&(n=""),f+="<div style='background-color: #c00; position: relative; width: 3px;  top: 1px;  height: 21px; float: left;"+n+"'></div>";var a=e.name+"_"+u;if("textarea"==e.type){var o=e.height?e.height:"inherit";f+=String.format("<textarea id='{0}' name='{0}' style='width:97%; height:{2};' rows='4' class='k-textbox'>{1}</textarea></td>",a,e.value?e.value:"",o)}else if("html"==e.type)f+=e.html;else if("javascript"==e.type){var o=e.height?e.height:"inherit";f+=String.format("<div id='{0}' style='display:none; height:{1};' />",e.name+"__editor_"+u,o),f+=String.format("<textarea id='{0}' name='{0}' style='width:97%; height:{1}; font-size:13px; font-family:monospace' rows='4' class='k-textbox'></textarea></td>",a,o)}else if("custom"==e.type)f+=String.format("<div id='{0}' />",a),e.id=e.name+"_"+u;else{e.value;e.value&&e.value.replace&&(e.value=e.value.replace('"',"&#34;"));var r=255;e.maxLength&&(r=e.maxLength);var s="";e.attributes&&(s=e.attributes),f+=String.format("<input style='width:97%;' id='{0}' value=\"{1}\" maxlength=\"{2}\" {3} /></td>",a,e.value?e.value:"",r,s),"reference"==e.type&&(f+=String.format('<input type="hidden" id="{0}" />',e.name+"_hidden_"+u))}l&&l.allowFormulas&&l.grid&&(f+=kendo.format('<td><div class="k-button k-button-icon ag-formula" id="{0}" title="Use Formula"><span class="k-sprite k-icon k-i-sum"/></div></td>',a+"_formula")),f+="</tr>"}),f+="</table>",displayResultsValue=localStorage.getItem(h);var v="<div id='KendoPopupBox"+u+"' style='display:none; text-align:center;'><p>#= val #</p>",b=l.displayResults?kendo.format("Display Results <input id='{0}' type='checkbox' {1}/> &nbsp; &nbsp;","checkboxResults"+u,displayResultsValue?"":"checked='checked'"):"";b+="<span id='OKWindow"+u+"' class='k-button'>OK</span>&nbsp; &nbsp;<span id='closeWindow"+u+"' class='k-button'>Cancel</span>",l&&l.buttons&&(b="",Object.each(l.buttons,function(e){b+=kendo.format("<span id='{0}' class='k-button'>{1}</span>&nbsp; &nbsp;",e.name+u,e.label)})),v+=b+"</div>",v=kendo.template(v);var y={val:f},k=v(y);$("body").append(k),Object.each(s,function(t){var n=$("#"+t.name+"_"+u);if(l&&l.autoSizeFields&&n.css({"max-width":"230px",width:"calc(100% - 3px)"}),"date"==t.type||"datetime"==t.type){var a="kendoDatePicker";l&&l.autoSizeFields&&n.css({"max-width":"",width:""}),"datetime"==t.type&&(a="kendoDateTimePicker"),n.after("<div id='"+t.name+"_"+u+"_clr' style='width:15px; cursor: pointer; height: 19px;' class='k-icon k-i-close' >&nbsp;</div>");var r=new Date(n.attr("value"));isNaN(r)&&(r=new Date),n[a]({value:r,change:function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u)}});var s=$("#"+t.name+"_"+u+"_clr");s.bind("click",function(){n.data(a).value("")}),n.parents(".k-widget").first().css({"max-width":"165px",width:"calc(100% - 20px)"})}else if("combobox"==t.type)$("#"+t.name+"_"+u).kendoComboBox({dataTextField:"label",dataValueField:"value",dataSource:t.values,filter:"contains",suggest:!0,change:function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u)}});else if("picklist"==t.type){var d,c=l&&l.hasDependency&&t.dependentPicklist;d=t.value?t.value:Object.first(t.values,function(e){return"true"==e.defaultValue});var f=$("#"+t.name+"_"+u),p=f.kendoDropDownList({optionLabel:" ",dataTextField:c?"text":"label",dataValueField:"value",dataSource:t.values,value:d?d.value:"",change:function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u),m()}}),h=p.data("kendoDropDownList").popup.element,g=h.css("visibility","hidden").show().outerWidth(),v=p.closest("div"),b=v.show().find("tr").find("th").width();v.hide(),h.hide().css("visibility","visible"),b+g>l.width&&(p.closest(".k-widget").width(g),l.width=null)}else if("multipicklist"==t.type){var d,c=l&&l.hasDependency&&t.dependentPicklist;d=t.value?t.value:Object.first(t.values,function(e){return"true"==e.defaultValue}),$("#"+t.name+"_"+u).width("97%"),$("#"+t.name+"_"+u).kendoMultiSelect({dataTextField:c?"text":"label",dataValueField:"value",dataSource:t.values,value:d?d.value:"",change:function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u),m()}})}else if("boolean"==t.type){var y="#"+t.name+"_"+u;$(y)[0].type="checkbox",t.value&&$(y).prop("checked",!0),$(y).width("auto").css({"margin-top":"4px","margin-left":"0px"}),l&&l.includeCheckboxes&&$(y).on("change",function(e){$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u)})}else if("reference"==t.type){var k={pageInfo:{objectName:t.referenceTo}};if(t.filter&&(k.pageInfo.filter=t.filter),t.sorts)k.pageInfo.sorts=t.sorts;else{var w=i.getSObjectNameField(i.getSObjectDescribe(t.referenceTo));w&&(k.pageInfo.sorts=[{field:w,dir:"asc"}],k.pageInfo.columns=[w,"Id"])}var x=function(e){$("#"+t.name+"_hidden_"+u).val(e.Id),l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u),m()};n.on("change",x);var I=l&&l.objectName?l.objectName:void 0,S=l&&l.keyPrefix?l.keyPrefix:void 0;if(!t.fullMeta&&I){var C=i.getSObjectDescribe(I);C&&(t.fullMeta=Object.first(C.fields,function(e){return e.name==t.name}),S=C.keyPrefix)}e.create({input:n,field:t.name,model:void 0,displayText:void 0,keyPrefix:S,setFunction:x,autoBind:!1,fieldMeta:t.fullMeta,pageInfo:k.pageInfo,parentObject:I,fkField:l&&l.fkField?l.fkField:void 0,fkValue:l&&l.fkValue?l.fkValue:void 0})}else if("textarea"==t.type||"html"==t.type)$("#"+t.name+"_"+u).bind("propertychange keyup input paste",function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u)});else if("javascript"==t.type){$("#"+t.name+"_"+u).val(t.value);var D=function(){var e=$("#"+t.name+"_"+u),i=ace.edit(t.name+"__editor_"+u);i.setTheme("ace/theme/chrome"),i.session.setMode("ace/mode/javascript"),i.session.setTabSize(2),i.session.setUseSoftTabs(!0),i.session.on("change",function(){e.val(i.getValue())}),i.setValue(t.value,-1),setTimeout(function(){$("#"+t.name+"__editor_"+u).css({display:"block"}),e.css("display","none")},500)};try{if("undefined"!=typeof ace&&ace.edit)D();else{i.importScript("https://cdn.jsdelivr.net/ace/1.2.1/min/ace.js",function(){D()})}}catch(e){console.log(e)}}else if(o.isNumerical(t.type)){var N=t.precision;void 0==N&&(N=2),$("#"+t.name+"_"+u).kendoNumericTextBox({format:"n"+N,decimals:N,min:t.min,max:t.max}).bind("propertychange keyup input paste change",function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u)})}else"custom"==t.type?t.init.call(t,$("#"+t.name+"_"+u),u):$("#"+t.name+"_"+u).kendoMaskedTextBox().bind("propertychange keyup input paste",function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u)});"reference"!=t.type&&"function"==typeof t.change&&$("#"+t.name+"_"+u).on("change",function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),t.change(e,u)})}),$(".helpIcon_"+u).kendoTooltip({showAfter:1e3}).data("kendoTooltip"),$(".helpIcon_"+u).on("click",function(){$(this).data("kendoTooltip").show($(this))}),m();var w=$("#closeWindow"+u),x=$("#OKWindow"+u),I=$("#KendoPopupBox"+u);if(w.bind("click",function(){I.data("kendoWindow").close().destroy()}),l&&l.buttons&&Object.each(l.buttons,function(e){$("#"+e.name+u).bind("click",function(){I.data("kendoWindow").close(),"function"==typeof e.click&&e.click(g())})}),x.bind("click",function(){var e=g(),i=[];if(l.displayResults){var n=$("#checkboxResults"+u).prop("checked");n?localStorage.removeItem(h):localStorage.setItem(h,!1)}return Object.each(e,function(t){if("function"==typeof t.validate){var n=t.validate(e);n&&i.push(n)}}),i.length>0?void t.popup("Validation Errors!","Please correct all validation errors \n<br /><ul><li>"+i.join("\n</li><li>")+"</li></ul>"):(I.data("kendoWindow").close().destroy(),void c(e))}),!I.data("kendoWindow")){I.kendoWindow({width:void 0!=l?l.width:null,height:void 0!=l?l.height:null,draggable:!0,modal:!0,resizable:!(!l||!l.resizable),actions:["Close"],title:r,maxHeight:$(window).height()-100,minHeight:l?l.minHeight:void 0,maxWidth:$(window).width()-100,minWidth:l&&l.minWidth?l.minWidth:"400px",activate:function(){if(!l||!l.includeCheckboxes){var e=Object.first(s,function(e){return"html"!=e.type});e&&$(String.format("#{0}_{1}",e.name,u)).focus()}},close:function(e){l&&l.grid&&l.grid.setKeyboardFocus()}})}$(".k-button.ag-formula").click(function(){var e=this,t="k-primary",i="ag-formula",n=$(e).attr("id"),a="#"+n.replace("_formula",""),o=$(a),r=$(a.replace("_"+u,"_checkbox_"+u)),l=Object.first(s,function(e){return e.name==a.replace("#","").replace("_"+u,"")}),d=Object.first(o.data(),function(e,t){return t.indexOf("kendo")>-1});d&&d.input&&(o=d.input),o.data("field",l);var c=$(e).hasClass(t);if(c)$(e).removeClass(t),$(o).removeClass(i),$(o).removeAttr("readonly"),$(o).val(""),$(r).removeProp("checked"),l&&(l.isFormula=!1);else{if($(e).addClass(t),$(o).addClass(i),"none"!=o.css("display"))$(o).focus();else{var f=o.parent();f.data("input",o),$(I).data("kendoTooltip").show(f)}$(o).attr("readonly","true"),$(r).prop("checked","true"),l&&(l.isFormula=!0)}}),$(I).kendoTooltip({filter:"input.ag-formula, textarea.ag-formula",content:function(e){e.sender.popup.element.removeClass("k-widget");var i="entryformula",n=$("#ag-"+i);0!=n.length&&(kendo.destroy(n),n.empty(),n.remove()),n=$(kendo.format('<div id="{0}">',"ag-"+i)),n.kendoFormulaWidget({grid:l.grid,tooltip:e.sender}),n.on("select",function(i,n){var o=n&&n.formula;if(o&&o.id){var r=$(e.target);r.data("input")&&(r=r.data("input")),r.val(o.id);var s=r.data("field"),l=!1;if(s)switch(s.formula=o,s.type.toLowerCase()){case"currency":case"integer":case"double":case"percent":o.format&&a.isNumber(o)||(l=!0);break;case"date":case"datetime":case"time":o.format&&!a.isNumber(o)||(l=!0);break;default:o.format&&(l=!0)}if(l){e.sender.hide();var d=o.type;d&&"No Formatting"!=d||(d="unformatted"),t.popup("Data Type Warning",kendo.format("Warning you've selected a {0} Formula but you are attempting to update a {1} field.<br/> Proceeding could have unexpected results. Continue at your own risk!",d,s.type.toTitleCase()),"Cancel",function(){r.val(""),s.formula=void 0},"Continue")}}});var o=$("<div>"),r=$('<div style="padding:5px;"><h3>Select an existing Formula to use for Mass Update. <a href="https://support.getconga.com/Conga_ActionGrid/Getting_Started_with_ActionGrid/ActionGrid_Basics/11Add_Formula_Fields" target="_blank">Help Me Create a Formula.</a></h3></div>');return o.append(r),o.append(n),$(o).css({"max-height":"320px",width:"500px","min-height":"260px",height:"auto"})},showOn:"focus",autoHide:!1,position:"bottom"}),l&&l.saveShortcut&&I.on("keyup",function(e){if(e.keyCode=="S".charCodeAt(0)&&e.ctrlKey)return e.preventDefault(),x.trigger("click"),!1}),I.data("kendoWindow").center().open()},requiredValidation:function(e){return null==this.value||""===this.value?this.label+" is a required field!":this.maxLength&&this.value.length>this.maxLength?this.label+" must be less than "+this.maxLength+" characters!":null}};return r}),crmc.define("marketing",["KendoPopup","sfdc"],function(e,t){var i="App Not Installed!",n='This feature is not installed. This is a free application from the Salesforce AppExchange. Please install this application by <a href="{0}" target="new">clicking here.</a><p/><a href="{0}" target="new"><img src="{1}" style="display:block; margin-left:auto; margin-right:auto;"/></a>',a='This feature is not installed. This is a paid application from the Salesforce AppExchange but you can install a free trial.  Please install this application by <a href="{0}" target="new">clicking here</a>.<p/><a href="{0}" target="new"><img src="{1}" style="display:block; margin-left:auto; margin-right:auto;"/></a>',o=kendo.format("/resource/{0}GridResources/styles/images/",t.getNamespace(!0)),r={awduplicate2:{title:i,label:"Duplicate Check for Salesforce 2.0",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N300000058vzKEAQ",imageURL:o+"DuplicateCheck_Logo_320x100.png",content:n},dupcheck:{title:i,label:"Duplicate Check for Salesforce 3.0",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N300000058vzKEAQ",imageURL:o+"DuplicateCheck_Logo_320x100.png",content:n},emma:{title:i,label:"Emma Email Marketing for Salesforce",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N30000005uzUnEAI",
imageURL:o+"Emma_Logo_320x100.png",content:n},geopointe:{title:i,label:"Geopointe, unlock the where in your data",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N300000016ZHeEAM",imageURL:o+"geopointe_logo_320x100.png",content:a},taf_listbrowse:{title:i,label:"List Browse, natural data browsing",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N3000000B3fiZEAR",imageURL:o+"listbrowse_320x100.png",content:n},sma:{title:i,label:"MapAnything: Maps, Mapping and GeoAnalytics Made Easy!",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N3000000586bhEAA",imageURL:o+"mapanything_320x100.png",content:a},crmc_pp:{title:"Upgrade Required!",label:"Please upgrade to the newest version of ActionGrid",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N3000000B5ilaEAB",imageURL:o+"ActnGrd_vidbumper_275x176.jpg",content:'The feature you\'re trying to use is not available in this version of ActionGrid. Please upgrade by <a href="{0}" target="new">clicking here.</a><p/><a href="{0}" target="new"><img src="{1}" style="display:block; margin-left:auto; margin-right:auto;"/></a>'}};return{missingApp:function(t){var i=r[t],n=kendo.format(i.content,i.appURL,i.imageURL),a=kendo.format('<div style="max-width: 400px;">{0}</div>',n);e.popup(i.title,a)}}}),crmc.define("ActionItem",["CustomSettings"],function(e){var t={itemID:"actionName",featureSecurity:e,getAppNamespace:function(){},getLabel:function(e){return"Hello World!"},createSubmenuItems:function(e){return[]},click:function(e){console.log("Hello World!")},toJSON:function(){return'crmc.addCustomAction({\n  itemID: "actionName",\n  isAvailable: function(context) {\n    // This function is called before the action item is displayed and returns a boolean if the item should be displayed\n    // By default determine availability based on Feature Security for this action\n    return this.featureSecurity.getSetting(context.objectDescribe.name, this.itemID) !== false;\n  },\n  isHeaderAvailable: function(context) {\n    // This function determines if this item can be displayed from the column header menu\n    return false;\n  },\n  isToolbarAvailable: function(context) {\n    // This function determines if this item can be displayed in the Toolbar as a button\n    return false;\n  },\n  getLabel: function(context) {\n    // This function returns the display label of the action item and is called before the item is shown\n    return "Hello World!";\n  },\n  createSubmenuItems: function(context) {\n    // If this function returns additional action item objects, they will appear as submenu items\n    return [];\n  },\n  click: function(context) {\n    // This function is what is executed when the action item is clicked\n    // Context object has this format:\n    /* {\n        objectDescribe: metadata for current object\n        selectedRows: rows selected in AG\n        loadedRows: all rows loaded in AG\n        isHeader: true if header column initiated action\n        selectedColumn: if header Action, info about the column which was clicked\n        kendoGrid: kendoGrid object\n    } */\n    alert("Hello World!");\n  }\n});'}};return t}),crmc.define("FileSaver",[],function(){var e=window;if("undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator))return function(e,t){return navigator.msSaveBlob(e,t)};if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,i=function(){return e.URL||e.webkitURL||e},n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),a="download"in n,o=function(i){var n=t.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(n)},r=e.webkitRequestFileSystem,s=e.requestFileSystem||r||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},d="application/octet-stream",c=0,u=10,f=function(t){var n=function(){"string"==typeof t?i().revokeObjectURL(t):t.remove()};e.chrome?n():setTimeout(n,u)},p=function(e,t,i){t=[].concat(t);for(var n=t.length;n--;){var a=e["on"+t[n]];if("function"==typeof a)try{a.call(e,i||e)}catch(e){l(e)}}},h=function(t,l){var u,h,g,m=this,v=t.type,b=!1,y=function(){p(m,"writestart progress write writeend".split(" "))},k=function(){if(!b&&u||(u=i().createObjectURL(t)),h)h.location.href=u;else{var n=e.open(u,"_blank");void 0==n&&"undefined"!=typeof safari&&(e.location.href=u)}m.readyState=m.DONE,y(),f(u)},w=function(e){return function(){if(m.readyState!==m.DONE)return e.apply(this,arguments)}},x={create:!0,exclusive:!1};return m.readyState=m.INIT,l||(l="download"),a?(u=i().createObjectURL(t),n.href=u,n.download=l,o(n),m.readyState=m.DONE,y(),void f(u)):(e.chrome&&v&&v!==d&&(g=t.slice||t.webkitSlice,t=g.call(t,0,t.size,d),b=!0),r&&"download"!==l&&(l+=".download"),(v===d||r)&&(h=e),s?(c+=t.size,void s(e.TEMPORARY,c,w(function(e){e.root.getDirectory("saved",x,w(function(e){var i=function(){e.getFile(l,x,w(function(e){e.createWriter(w(function(i){i.onwriteend=function(t){h.location.href=e.toURL(),m.readyState=m.DONE,p(m,"writeend",t),f(e)},i.onerror=function(){var e=i.error;e.code!==e.ABORT_ERR&&k()},"writestart progress write abort".split(" ").forEach(function(e){i["on"+e]=m["on"+e]}),i.write(t),m.abort=function(){i.abort(),m.readyState=m.DONE},m.readyState=m.WRITING}),k)}),k)};e.getFile(l,{create:!1},w(function(e){e.remove(),i()}),w(function(e){e.code===e.NOT_FOUND_ERR?i():k()}))}),k)}),k)):void k())},g=h.prototype,m=function(e,t){return new h(e,t)};return g.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,m}}),crmc.define("ExportMenuItem",["CustomSettings","KendoPopup","FileSaver"],function(e,t,i){var n=function(e,n,a){var o,r,s,l,d,c,u,f,p,h=(this.gridDataSource.pageSize(),"");"csv"===e?(o=r=s=l='"',d=",",c="",u="\n",f="\n",p=""):"xls"===e&&(h="<table>",o="<th filter=all>",r="</th>",s="<td>",l="</td>",d="",c="<tr>",u="<br style='mso-data-placement:same-cell;' />",f="</tr>\n",p="</table>");n=n||"download."+e;var g=this.getSelectedItems();if(g.length<1)return void t.popup("No Rows Selected!","Please select rows to Export!",void 0,void 0,void 0,{grid:this});var m=[];h+=c,a&&(h+=o+"Id"+r+d);for(var v=0;v<this.kendoGrid.columns.length;v++){var b=this.kendoGrid.columns[v].field,y=this.kendoGrid.columns[v].title||b,k={fieldName:this.kendoGrid.columns[v].field,template:this.kendoGrid.columns[v].template,format:this.kendoGrid.columns[v].format,exportFormat:this.kendoGrid.columns[v].exportFormat,exportTemplate:this.kendoGrid.columns[v].exportTemplate};if(b){if(y=y.replace(/"/g,'""'),h+=o+y+r,b.indexOf(".")>=0){var w=b.split("."),x=Object.first(this.fieldMeta,function(e){return e.name==b});k.isNameField=x.isNameField,2==w.length&&x.isNameField&&a&&(h+=d,y=w[0]+"Id",h+=o+y+r)}v<this.kendoGrid.columns.length-1&&(h+=d)}m.push(k)}h+=f;for(var I=0;I<g.length;I++){h+=c,a&&(h+=s+g[I].id+l+d);for(var v=0;v<this.kendoGrid.columns.length;v++){var k=m[v],w=void 0;if(k.fieldName){var S="";if(k.fieldName.indexOf(".")>=0){w=k.fieldName.split(".");for(var S=g[I]||"",C=0;C<w.length;C++){var D=w[C];S=S[D]||""}}else S=g[I][k.fieldName]||"";if(S&&k.template&&k.exportFormat!==!1?S=$.isFunction(k.template)?k.template(g[I]):kendo.template(k.template)(g[I]):S&&k.format&&k.exportFormat!==!1?S=kendo.format(k.format,g[I][k.fieldName]):k.exportTemplate&&(S=k.exportTemplate("{1}",u)(g[I])),S=S.toString().replace(/"/g,'""'),h+=s+S+l,k.isNameField&&a){try{S=g[I][w[0]].Id,S=S.toString().replace(/"/g,'""')}catch(e){S=""}h+=d+s+S+l}v<this.kendoGrid.columns.length-1&&(h+=d)}}h+=f}h+=p;var N=new Blob(["\ufeff",h],{type:"text/"+e+";charset=utf-8"});i(N,n)},a={isAvailable:function(t){return window.isDebug||e.getSetting(t.objectDescribe.name,"exportToExcel")!==!1},getLabel:function(e){return"Export To..."},createSubmenuItems:function(e){var i=[{getLabel:function(e){return"CSV"},click:function(e){n.apply(e.actionGrid,["csv"])}},{getLabel:function(e){return"CSV (with Record IDs)"},click:function(e){n.apply(e.actionGrid,["csv",void 0,!0])}},{getLabel:function(e){return"Excel"},doExport:function(e,i){var n={filterable:!0,fileName:"ActionGrid.xlsx",allPages:i},a=document.getElementsByTagName("HEAD").item(0),o=document.createElement("script");o.type="text/javascript",a.appendChild(o),o.src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.4.0/jszip.js",o.onerror=function(){t.popup("Export Failed","Export failed, contact support@getactiongrid.com",void 0,void 0,void 0,{grid:e.actionGrid})},o.onload=function(){if(e.kendoGrid.options.excel=n,!i&&e.selectedRows.length>0){var t=e.kendoGrid.dataSource.filter(),a=null,o={field:"Id",operator:"includes",value:"'"+e.selectedRows.map(function(e){return e.Id}).join("','")+"'"};t?(a=$.extend(!0,{},t),t.filters.push(o)):t={filters:[o]},e.kendoGrid.dataSource.filter(t),e.kendoGrid.saveAsExcel(),e.kendoGrid.dataSource.filter(a)}else e.kendoGrid.saveAsExcel()}},click:function(e){if(!e.actionGrid.checkForDirtyRows()){var i=this;e.actionGrid.gridDataSource&&e.actionGrid.gridDataSource.totalPages()>1&&(0==e.selectedRows.length||e.selectedRows.length==e.actionGrid.gridDataSource.pageSize())?t.popupWithButtons("Excel Export","Would you like to export all results matching the current filter </br>or only the first page of results?",[{label:"All Results",click:function(){i.doExport(e,!0)}},{label:"First Page",click:function(){i.doExport(e,!1)}},{label:"Cancel"}],e.actionGrid):i.doExport(e,!1)}}},{getLabel:function(e){return"Excel (with Record IDs)"},click:function(e){n.apply(e.actionGrid,["xls",void 0,!0])}}];return i},click:function(e){}};return a}),crmc.define("ViewMenuItem",["KendoPopup","CustomSettings"],function(e,t){var i={isAvailable:function(e){return t.getSetting(e.objectDescribe.name,"viewInNewWindow")!==!1},getLabel:function(e){return"New Window"},createSubmenuItems:function(e){},click:function(t){isTab=!1;var i=t.selectedRows;i.length>10?e.popup("Too Many Records!","Only 10 records can be opened at a time!"):i.length>0?Object.each(i,function(e){if(isTab)window.open("/"+e.Id,"page_"+e.Id),window.focus();else{var t=window.innerWidth-400,i=window.innerHeight-50,n=window.screenX+400,a=window.screenY+50;window.open("/"+e.Id,"_blank","toolbar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes,height="+i+", width="+t+", left="+n+", top="+a)}}):e.popup("Please select records","Select at least one record to view.")}},n={submenus:[i],getLabel:function(e){return"View Records..."},isAvailable:function(e){var t=!1;return Object.each(this.submenus,function(i){i.isAvailable(e)&&(t=!0)}),t},createSubmenuItems:function(e){return this.submenus}};return n}),crmc.define("BatchAddCampaignMemberMenuItem",["sfdc","marketing","KendoPopup","CustomSettings","GridConstants"],function(e,t,i,n,a){var o={appName:"CRMC_BatchAddCM",maxRows:500,getAppNamespace:function(){return this.appName},getLabel:function(e){return"Campaign Member"},isAvailable:function(e){return("Contact"===e.objectDescribe.name||"Lead"===e.objectDescribe.name)&&n.getSetting(e.objectDescribe.name,"campaignMemberLoader")!==!1},click:function(t){var n=document.getElementsByTagName("HEAD").item(0),r=document.createElement("script");r.type="text/javascript",n.appendChild(r);var s=this,l={ts:(new Date).getTime()};r.src=e.getStaticResourceURL(s.getAppNamespace(),"CRMC_BatchAddCM__BatchAddCampaignMembers",l);var d=function(){if(t.selectedRows.length>o.maxRows)i.popup("Batch Add Limit!","Currently, we don't allow more than "+o.maxRows+" contacts per batch!");else if(t.selectedRows.length>0){var n=[];Object.each(t.selectedRows,function(e){n.push({name:"ids",value:e.Id})});var r={passIds:"true",retURL:"/apex/"+a.namespace+"__"+a.VF_PAGE_NAME+"?object=CampaignMember"};"Lead"===t.objectDescribe.name?e.postToVFPage(s.getAppNamespace(),"BatchAddLeads",r,n,!1,"_BLANK"):e.postToVFPage(s.getAppNamespace(),"ContactButton_BatchAddToCampaignVF",r,n,!1,"_BLANK")}else i.popup("Please select records","Select at least one record to add to a campaign.")};r.onerror=function(){d()},r.onload=function(){d()}},init:function(e,t,i,n){}};return o}),crmc.define("Notification",["sfdc"],function(e){var t={singleNotification:void 0,showProgress:function(t,i){if(this.singleNotification){var n=this.singleNotification.getNotifications();n.each(function(){$(this).parent().remove()})}else this.singleNotification=$("<div>").kendoNotification({position:{pinned:!0,bottom:30,right:30},height:80,width:300,autoHideAfter:0,stacking:"down",templates:[{type:"info",template:'<div class="k-loading-image" style="position:static; width:48px; height:48px; float: left; margin: 15px;"></div><h3 style="font-size:1em; padding: 15px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>'},{type:"error",template:kendo.format('<div style="background-image:url(\'/resource/{0}kendoui/styles/Silver/error-icon.png\'); background-position:50% 50%; background-repeat:no-repeat; position:static; width:48px; height:48px; float:left; margin:15px;"></div><h3 style="font-size:1em; padding: 22px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>',e.getNamespace(!0))},{type:"success",template:kendo.format('<div style="background-image:url(\'/resource/{0}kendoui/styles/Silver/success-icon.png\'); background-position:50% 50%; background-repeat:no-repeat; position:static; width:48px; height:48px; float:left; margin:15px;"></div><h3 style="font-size:1em; padding: 22px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>',e.getNamespace(!0))}]}).data("kendoNotification");this.singleNotification.show(t,i)},showMessage:function(t,i){var n=$("<div>").kendoNotification({position:{pinned:!0,bottom:30,right:30},height:80,width:300,autoHideAfter:4e3,stacking:"down",templates:[{type:"info",template:kendo.format('<div class="k-loading-image" style="background-image:url(\'/resource/{0}kendoui/styles/Silver/success-icon.png\'); background-position:50% 50%; background-repeat:no-repeat; position:static; width:48px; height:48px; float:left; margin:15px;"></div><h3 style="font-size:1em; padding: 22px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>',e.getNamespace(!0))},{type:"error",template:kendo.format('<div style="background-image:url(\'/resource/{0}kendoui/styles/Silver/error-icon.png\'); background-position:50% 50%; background-repeat:no-repeat; position:static; width:48px; height:48px; float:left; margin:15px;"></div><h3 style="font-size:1em; padding: 22px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>',e.getNamespace(!0))},{type:"success",template:kendo.format('<div style="background-image:url(\'/resource/{0}kendoui/styles/Silver/success-icon.png\'); background-position:50% 50%; background-repeat:no-repeat; position:static; width:48px; height:48px; float:left; margin:15px;"></div><h3 style="font-size:1em; padding: 22px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>',e.getNamespace(!0))}]}).data("kendoNotification");n.show(t,i)},showOverlay:function(t,i,n){var a=$("<div>").kendoNotification({position:{pinned:!0,bottom:30,right:window.innerWidth/2-150},height:230,width:720,hideOnClick:n,autoHideAfter:n?0:5e3,stacking:"down",templates:[{type:"keyboard",template:kendo.format('<h3 id="ag-overlay-message" style="font-size:1em; padding: 22px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>',e.getNamespace(!0))}]}).data("kendoNotification");a.show(t,i);var o=$("#ag-overlay-message").parent();o.css("background-color","rgba(255, 255, 255, 0.9)"),o.append('<a id="ag-overlay-message-exit" style=" position: absolute; top: 0; right: 0; padding-right: 5px; padding-top: 5px; " role="button" href="#" class="k-window-action k-link"><span role="presentation" class="k-icon k-i-close">Close</span></a>')}};return t}),crmc.define("FollowMenuItem",["sfdc","KendoPopup","CustomSettings","Notification"],function(e,t,i,n){return{getLabel:function(e){return"Follow Records"},isAvailable:function(e){return i.getSetting(e.objectDescribe.name,"followRecords")!==!1},click:function(t){if(t.selectedRows.length>0){var i=[];Object.each(t.selectedRows,function(t){var n=new sforce.SObject("EntitySubscription");n.ParentId=t.Id,n.SubscriberId=e.getUserInfo().userId,i.push(n)});var a=function(e){var t=0,i=0;e instanceof Array||(e=[e]),Object.each(e,function(e){"true"==e.success?t++:"DUPLICATE_VALUE"==e.statusCode&&i++});var a="";t>0&&(a="Successfully following "+t+" record"+(1==t?"":"s")+"!"),i>0&&(a.length>0&&(a+="\n"),a+=i+" record"+(1==i?" is":"s are")+" already being followed!"),n.showMessage({title:"Follow Results",message:a},"success")};e.insert(i,a,a,!0)}else n.showMessage({title:"Please select records",message:"Select at least one record to follow."},"error")}}}),crmc.define("actions/BatchAdd_PriceBook_LineItems",["KendoEntry","KendoPopup","sfdc","CustomSettings"],function(e,t,i,n){function a(e){switch(e.objectDescribe.name.toLowerCase()){case"opportunity":return!0;case"order":return!0;case"quote":return!0;default:return!1}}var o="There was an error: ",r="Added {0} {1}, would you like to ActionGrid the results?",s="Batch Add Results",l="Yes",d="No";return{isAvailable:function(e){return!!(e.selectedRows&&e.selectedRows.length>0&&a(e))&&n.getSetting(e.objectDescribe.name,"batchAddProductLineItem")!==!1},getLabel:function(e){return e.objectDescribe.name+" Products"},createSubmenuItems:function(e){return[]},click:function(n){function a(e,t){e instanceof Array||(e=[e]);var i,n=200,a=[],o=function(i){a=a.concat(i),a.length==e.length&&"function"==typeof t&&t(a)};for(i=0;i<e.length;i+=n)sforce.connection.update(e.slice(i,i+n),{onSuccess:o,onFailure:o})}function c(e,t,i){for(var n=function(e){b()},o=[],r=0;r<e.length;r++){var s=new sforce.SObject(i);s.id=e[r],s.Pricebook2Id=t,o.push(s)}a(o,n)}function u(e,a,c){var u=i.query("SELECT Id, UnitPrice FROM PricebookEntry WHERE Id = '"+e+"'");n.selectedRows.map(function(t){var i=new sforce.SObject(v.current.createObject);v.current.parent(i,t.Id),i.PricebookEntryId=e,i.Quantity=a,i.UnitPrice=u[0].UnitPrice,i.Description=c,p.push(i)}),sforce.connection.create(p,{onSuccess:function(e){function i(){t.popupWithButtons("Errors",f.join(""),[{label:"Ok"}],{width:900}),n.actionGrid.refresh()}function a(e,t){for(var i=0;i<e.length;i++)if(e[i]==t)return!0;return!1}for(var o=[],c=0,u=0,f=["<ul>"],p=0;p<e.length;p++)if(e[p].success&&"true"==e[p].success)c++,o.push(e[p].id);else if(u++,void 0!=e[p].errors&&void 0!=e[p].errors.message){var h="<li>"+e[p].errors.message+"</li>";a(f,h)||f.push(h)}else if(void 0!=e[p].errors&&e[p].errors instanceof Array)for(var g=e[p].errors,m=0;m<g.length;m++){var h="<li>"+g[m].message+"</li>";a(f,h)||f.push(h)}else f.push("<li>"+e[p]+"</li>");if(f.push("</ul>"),o.length>0){var b=kendo.format(r,c),y=[{label:l,click:function(){window.open(kendo.format("/apex/CRMC_PP__crmc_grid?object={0}&Ids={1}",v.current.createObject,o.join())),u>0?i():n.actionGrid.refresh()}},{label:d,click:function(){u>0?i():n.actionGrid.refresh()}}];t.popupWithButtons(s,b,y)}else i()},onFailure:function(){alert(o+error.toString())}})}var f=[];Object.each(n.selectedRows,function(e){f.push("'"+e.Id+"'")});var p=[],h=i.getUserInfo(),g="true"==h.organizationMultiCurrency,m=function(e){return null==this.value||""===this.value?this.label+" is a required field!":this.maxLength&&this.value.length>this.maxLength?this.label+" must be less than "+this.maxLength+" characters!":null},v={set:function(){for(var e=0;e<this.objects.length;e++)if(n.objectDescribe.name===this.objects[e].context)return this.current=this.objects[e],!0;return!1},current:void 0,objects:[{context:"Opportunity",createObject:"OpportunityLineItem",parent:function(e,t){e.OpportunityId=t},filterId:void 0,VerifyPriceBooks:function(e){for(var n=void 0,a=!1,o=0;o<e.length;o++)null!=e[o].Pricebook2Id&&(void 0===n&&null!=e[o].Pricebook2Id&&(n=e[o].Pricebook2Id),n!=e[o].Pricebook2Id&&(a=!0));a?t.popup("WARNING","Select rows with a Price Book must contain the same Price Book"):void 0!=n?(this.filterId=n,b()):(this.filterId=i.query("SELECT Id FROM Pricebook2 WHERE IsStandard = true")[0].Id,b())}},{context:"Order",pluralName:"Orders",createObject:"OrderItem",parent:function(e,t){e.OrderId=t},filterId:void 0,VerifyPriceBooks:function(e){v.VerifyParentPricebook(e)}},{context:"Quote",pluralName:"Quotes",createObject:"QuoteLineItem",parent:function(e,t){e.QuoteId=t},filterId:void 0,VerifyPriceBooks:function(e){v.VerifyParentPricebook(e)}}],VerifyParentPricebook:function(n){for(var a=void 0,o=[],r=[],s=[{label:"Yes",click:function(){c(o,v.current.filterId,v.current.context)}},{label:"No Thanks"}],l=[{label:"Use Standard",click:function(){v.current.filterId=i.query("SELECT Id FROM Pricebook2 WHERE IsStandard = true")[0].Id,c(o,v.current.filterId,v.current.context)}},{label:"Choose Pricebook",click:function(){e.entry("Select Pricebook",[{referenceTo:"Pricebook2",name:"Pricebook2",label:"Pricebook",type:"reference",required:!0,validate:m}],{width:375,objectName:"Pricebook2"},null,function(e){v.current.filterId=e.Pricebook2.value,c(o,v.current.filterId,v.current.context)})}},{label:"No Thanks"}],d="Copy the Pricebook from your other selected records and batch update the "+v.current.pluralName+" missing a pricebook?",u="Batch update selected records with a Pricebook?",f="Selected rows with a Price Book must contain the same Price Book",p=!1,h=0;h<n.length;h++)if(null!=n[h].Pricebook2Id){if(r.push(n[h].Id),void 0===a&&null!=n[h].Pricebook2Id&&(a=n[h].Pricebook2Id),a!=n[h].Pricebook2Id){p=!0;break}}else o.push(n[h].Id);p?t.popup("WARNING",f):void 0!=a&&0===o.length?(v.current.filterId=a,b()):void 0!=a&&o.length>0?(v.current.filterId=a,t.popupWithButtons("Error: "+v.current.context+" records must contain a Pricebook",d,s,{width:350})):t.popupWithButtons("Error: "+v.current.context+" records must contain a Pricebook",u,l,{width:350})}},b=function(){var t=[{field:"Pricebook2Id",operator:"eq",value:v.current.filterId},g?{field:"CurrencyIsoCode",operator:"eq",value:v.current.currencyCode}:{}];e.entry("Batch Add Products",[{prefix:"01u",referenceTo:"PricebookEntry",name:"PricebookEntry",label:"Product",type:"reference",filter:t,required:!0,validate:m},{name:"Quantity",label:"Quantity",type:"double",value:1,min:1,precision:0,required:!0,validate:m},{name:"Description",label:"Description",type:"textarea",required:!1}],{width:375},null,function(e){var t=e.PricebookEntry.value,i=e.Quantity.value,n=e.Description.value;u(t,i,n)})};v.set();var y=g?"select Id, Pricebook2Id, CurrencyIsoCode from "+v.current.context+" where Id in ({0})":"select Id, Pricebook2Id from "+v.current.context+" where Id in ({0})",k=i.query(y,f.join());if(k.length>0){var w=k[0].Pricebook2Id,x=k[0].CurrencyIsoCode,I=(Object.first(k,function(e){return e.Pricebook2Id!=w}),!1);g&&(I=Object.first(k,function(e){return e.CurrencyIsoCode!=x}),v.current.currencyCode=x),I?t.popup("Error","Cannot Batch Add to Opportunities with mixed currencies."):v.current.VerifyPriceBooks(k)}}}}),crmc.define("BatchAddCampaignMemberInline",["KendoEntry","KendoPopup","sfdc","CustomSettings"],function(e,t,i,n){return{context:void 0,isValidObject:function(e){switch(e.objectDescribe.name.toLowerCase()){case"lead":return!0;case"contact":return!0;default:return!1}},isAvailable:function(e){var t=!1;return e.selectedRows&&e.selectedRows.length>0&&this.isValidObject(e)&&0!=n.getSetting(e.objectDescribe.name,"batchAddcampaignMember")&&(t=!0),t},getLabel:function(e){return"Campaign Member"+(e.selectedRows.length>1?"s":"")},createSubmenuItems:function(e){return[]},campaignMemberForm:function(){var e=this;$("#kendoCampaignMembers").data("kendoWindow")&&($("#kendoCampaignMembers").data("kendoWindow").destroy(),$("#kendoCampaignMembers").empty());var t="<div id='kendoCampaignMembers' style='display:none; display: inline-block; padding: 0px; padding-bottom:0.6em; text-align:center;'><div style='max-width: 485px; overflow-y:auto; padding:0.6em;'><div id='kendoCMGrid' /></div><span id='cmCreateButton' class='k-button'>Create Campaign Members</span> &nbsp; &nbsp;<span id='cmCloseButton' class='k-button'>Cancel</span></div>",n=t,a={},o=[],r=function(){var e=$("input.cmChk:checked");Object.each(e,function(e){var t=e.id;if(t){t=t.split("_")[1];var i=o.filter(function(e){return e.Id==t});1==i.length&&(a[t]=i[0],a[t].selectedStatus=$("#cmSel_"+t).val().split("=")[0])}})},s=function(){return r(),a};$("body").append(n),$("#kendoCampaignMembers").kendoWindow({draggable:!0,modal:!0,actions:["Close"],title:"Batch Add Campaign Members",height:347,width:500,resizable:!1,close:function(t){e.context.actionGrid.setKeyboardFocus()}}),$("#cmCloseButton").bind("click",function(){$("#kendoCampaignMembers").data("kendoWindow").close().destroy()}),$("#cmCreateButton").bind("click",function(){e.buildRecords(s()),$("#kendoCampaignMembers").data("kendoWindow").close().destroy()});var l=[{title:"",template:'<input class="cmChk" id="cmChk_#= Id #" type="checkbox" #=data.isChecked?"checked":""# >',width:"35px"},{field:"Name",title:"",template:"#= Name #",headerTemplate:'<input id="cmTxtCampaignSearch" type="search" class="k-textbox" placeholder="Search Campaign"/>',attributes:{style:"text-align: left;"}},{field:"Status",title:"Member Status",template:'<select class="cmSel" style="width: 110px" id="cmSel_#= Id #"> # for (var i = 0; i < statuses.length; i++) { # <option value=#= statuses[i].Id #=data.selectedStatus == statuses[i].Id?"selected":""# #>#= statuses[i].Label #</option> # } #</select>',width:"125px"}],d=new kendo.data.DataSource({transport:{read:function(e){r();var t=$("#cmTxtCampaignSearch").val();o=i.query("SELECT Id, Name, Type, StartDate FROM Campaign WHERE IsActive = true "+(t.length>2?" and Name like '%"+t.replace(/'/g,"''")+"%'":"")+"ORDER BY Name LIMIT 100");var n=i.query("SELECT CampaignId, Id, Label FROM CampaignMemberStatus WHERE CampaignId in ('{0}') ORDER BY CampaignId DESC",o.map(function(e){return e.Id}).join("','")),s={};Object.each(n,function(e){s[e.CampaignId]||(s[e.CampaignId]=[]),s[e.CampaignId].push(e)}),Object.each(o,function(e){e.statuses=s[e.Id],e.isChecked=void 0!=a[e.Id],e.selectedStatus=e.isChecked?a[e.Id].selectedStatus:void 0}),e.success(o)}}});$("#kendoCMGrid").data("kendoGrid")&&($("#kendoCMGrid").data("kendoGrid").destroy(),$("#kendoCMGrid").empty()),$("#kendoCMGrid").kendoGrid({dataSource:d,sortable:!0,height:300,columns:l,resizable:!0}),$("#cmTxtCampaignSearch").bind("propertychange keyup input paste",function(){($("#cmTxtCampaignSearch").val().length>2||0==$("#cmTxtCampaignSearch").val().length)&&(clearTimeout($(this).data("timeout")),$(this).data("timeout",setTimeout(function(){$("#kendoCMGrid").data("kendoGrid").dataSource.read()},500)))}),$("#kendoCampaignMembers").data("kendoWindow").center().open(),$(document).on("click","#kendoCMGrid > div.k-grid-content > table > tbody > tr > td:nth-child(2)",function(){var e=$(this.parentElement.children).find('input[type="checkbox"]');e.prop("checked",!e.prop("checked"))}),$("#cmTxtCampaignSearch").on("click",function(e){e.stopPropagation()})},buildRecords:function(e){for(var t=this.context.selectedRows,i=[],n=function(e,t){for(var i=0;i<t.length;i++)if(t[i].Id==e)return t[i].Label},a=0;a<t.length;a++){var o=this;Object.each(e,function(e){var r=new sforce.SObject("CampaignMember");r.CampaignId=e.Id,r[o.context.objectDescribe.name+"Id"]=t[a].Id,r.Status=n(e.selectedStatus,e.statuses),i.push(r)})}this.create(i)},create:function(e){var n=function(e){for(var i=[],n=["<ul> Success: "],a=0,o=0,r=["<ul> Errors:","</br>"],s=0;s<e.length;s++){var l=e[s];if("true"==l.success)a++,i.push(l.id);else if(l.errors){var d=l.errors;d.statusCode&&"DUPLICATE_VALUE"==d.statusCode?o++:void 0!=d&&void 0!=d.message&&r.push(d.message+"</br>")}else r.push("<li>"+l+"</li>")}n[0]=n[0]+a,n.push("</ul>"),n.push("<ul> Duplicates: "+o+"</ul>"),r.length>2?(n=n.concat(r),n.push("</ul>")):n.push(r[0]+" 0</ul>"),console.log(n);var c=[{label:"View Records",click:function(){window.open(kendo.format("/apex/CRMC_PP__crmc_grid?object={0}&Ids={1}","CampaignMember",i.join()))}},{label:"Close"}];t.popupWithButtons("Results",n.join(""),c)};i.batchInsert(e,n)},click:function(e){this.context=e,this.campaignMemberForm()}}}),crmc.define("actions/BatchAdd_UserPackageLicense",["KendoEntry","KendoPopup","sfdc","CustomSettings"],function(e,t,i,n){return{isAvailable:function(e){return!!(e.selectedRows&&e.selectedRows.length>0&&"User"==e.objectDescribe.name)&&n.getSetting(e.objectDescribe.name,"batchAddUserPackageLicense")!==!1},getLabel:function(e){return"AG License"},createSubmenuItems:function(e){return[]},click:function(e){var n=[];e.selectedRows.map(function(e){n.push(e.Id)});var a=i.query("SELECT Id, AllowedLicenses,UsedLicenses,NamespacePrefix,Status FROM PackageLicense WHERE NamespacePrefix = 'CRMC_PP'");if(a&&a[0]){a=a[0];var o=parseInt(a.AllowedLicenses),r=parseInt(a.UsedLicenses);if(o>r){var s=i.query(kendo.format("SELECT Id, UserId FROM UserPackageLicense WHERE PackageLicenseId = '{0}' AND UserId IN('"+n.join("','")+"')",a.Id)),l=o-r,d=n.length-s.length;if(d>0&&d<=l){for(var c=[],u=function(e){for(var t=0;t<s.length;t++)if(s[t].UserId==e)return!0;return!1},f=0;f<n.length;f++)if(!u(n[f])){var p=new sforce.SObject("UserPackageLicense");p.UserId=n[f],p.PackageLicenseId=a.Id,c.push(p)}var h=function(e){for(var i=[],n=["<ul> Success: "],a=0,o=["<ul> Errors:","</br>"],r=0;r<e.length;r++){var l=e[r];"true"==l.success?(a++,i.push(l.id)):l.errors&&void 0!==l.errors.message?o.push(l.errors.message+"</br>"):o.push("<li>"+l+"</li>")}n[0]=n[0]+a,n.push("</ul>"),n.push("<ul> Already Converted: "+s.length+"</ul>"),o.length>2?(n=n.concat(o),n.push("</ul>")):n.push(o[0]+" 0</ul>"),console.log(n);var d=[{label:"View Records",click:function(){window.open(kendo.format("/apex/CRMC_PP__crmc_grid?object={0}&Ids={1}","UserPackageLicense",i.join()))}},{label:"Close"}];t.popupWithButtons("Results",n.join(""),d)};i.batchInsert(c,h)}else{var g="";g=0===d?"All Selected users have a license.":"Selected users without a license exceeds the availability of unssigned licenses.",t.popupWithButtons("Available: "+a.AllowedLicenses+", Selected w/out License: "+d,g,[{label:"Ok"}],{width:400})}}else t.popupWithButtons("Warning: Out of Licenses","Please get more licenses or remove some users.",[{label:"Ok"}])}else t.popupWithButtons("Error Querying Data",a.toString(),[{label:"Ok"}])}}}),crmc.define("actions/BatchAdd_PermissionSetAssignment",["KendoEntry","KendoPopup","sfdc","CustomSettings"],function(e,t,i,n){return{isAvailable:function(e){return!!(e.selectedRows&&e.selectedRows.length>0&&"User"==e.objectDescribe.name)&&n.getSetting(e.objectDescribe.name,"batchAddPermissionSetAssignment")!==!1},getLabel:function(e){return"Permission Set"},createSubmenuItems:function(e){return[]},click:function(n){var a=[];n.selectedRows.map(function(e){a.push(e.Id)});var o=function(e){for(var n=[],o=0;o<a.length;o++){var r=new sforce.SObject("PermissionSetAssignment");r.AssigneeId=a[o],r.PermissionSetId=e,n.push(r)}var s=function(e){for(var i=[],n=["<ul> Success: "],a=0,o=0,r=["<ul> Errors:","</br>"],s=0;s<e.length;s++){var l=e[s];"true"==l.success?(a++,i.push(l.id)):l.errors&&l.errors.statusCode&&"DUPLICATE_VALUE"==l.errors.statusCode?o++:l.errors&&void 0!==l.errors.message?r.push(l.errors.message+"</br>"):r.push("<li>"+l+"</li>")}n[0]=n[0]+a,n.push("</ul>"),n.push("<ul> Already in Set: "+o+"</ul>"),r.length>2?(n=n.concat(r),n.push("</ul>")):n.push(r[0]+" 0</ul>");var d=[{label:"View Records",click:function(){window.open(kendo.format("/apex/CRMC_PP__crmc_grid?object={0}&Ids={1}","UserPackageLicense",i.join()))}},{label:"Close"}];t.popupWithButtons("Results",n.join(""),d)};i.batchInsert(n,s)};try{var r=i.query("SELECT Id,Label,Name,NamespacePrefix FROM PermissionSet")}catch(e){t.popup("Error","User does not have access to Permission Sets");
}if(r.length>0){var s=function(){for(var e,t=[],i=0;i<r.length;i++){var n=r[i],a="ActionGrid_Users"==n.Name&&"CRMC_PP"==n.NamespacePrefix;e=n.Name.length>20?n.Name.substring(0,14)+"...":n.Name;var o=n.Label+" ("+e+")";n.Name!="X"+n.Label&&t.push({active:"true",defaultValue:a,label:o,value:n.Id})}return t};e.entry("BatchAdd Permission Set",[{name:"PermissionSet",label:"Permission Set",type:"picklist",values:s(),required:!1}],{width:350},null,function(e){o(e.PermissionSet.value)})}else t.popupWithButtons("WARNING","There are no available PermissionSet objects",[{label:"Close"}])}}}),crmc.define("BatchAddNew",["sfdc","KendoPopup","KendoEntry","BatchAddCampaignMemberMenuItem","CustomSettings","GridConstants","FollowMenuItem","actions/BatchAdd_PriceBook_LineItems","BatchAddCampaignMemberInline","actions/BatchAdd_UserPackageLicense","actions/BatchAdd_PermissionSetAssignment","Notification"],function(e,t,i,n,a,o,r,s,l,d,c,u){var f={init:function(e){var t=this;Object.each(e,function(e,i){t[i]=e})},getLabel:function(e){return this.label},isAvailable:function(e){return e.objectDescribe.name!==this.name},getEntryFields:function(t,i){var n;try{n=e.getSObjectDescribe(this.name),this.meta=n}catch(e){}if(n){var a=[],o=[];return o=!t||t.length<1?this.entryFields:t,"Task"==this.name&&a.push({name:"assignToRecordOwner__crmc",label:"Assign To Record Owner",type:"boolean"}),Object.each(o,function(e){Object.each(n.fields,function(t){if(t.name==e){var i={name:t.name,label:t.label,type:t.type,values:t.picklistValues,referenceTo:t.referenceTo};"Task"==n.name&&"OwnerId"==t.name?(i.validate=function(e){var t=Object.first(e,function(e){return"assignToRecordOwner__crmc"==e.name});return this.value||t.value?null:'Please select an "Assigned To ID" or check "Assign To Record Owner"'},i.filter=[{field:"IsActive",operator:"eq",value:"true"},{field:"UserType",operator:"eq",value:"Standard"}]):"false"==t.nillable&&(i.required=!0,i.validate=function(e){return null==this.value||""===this.value?this.label+" is a required field!":null}),a.push(i)}})}),a}},click:function(n){var a=this;e.executeRemoteAction("getFieldSetDescribe",[this.name,this.fieldSet||""],function(r,s){if(s.status)if(n.selectedRows.length>0){var l="Batch ";a.label&&(l+=a.label);var d=a.getEntryFields(r,s);i.entry(l,d,{grid:n.actionGrid,objectName:a.name,displayResults:!0},n.actionGrid.settings,function(i){var r=[],s=[];if(Object.each(n.selectedRows,function(e){var t=new sforce.SObject(a.name);Object.each(a.mappedFields,function(i){t[i.name]=e[i.mappedName]}),Object.each(i,function(i){if("assignToRecordOwner__crmc"==i.name)i.value&&(e.OwnerId?t.OwnerId=e.OwnerId:s.push(e.Id));else{if("OwnerId"==i.name&&(t[i.name]||""==i.value))return;t[i.name]=i.value}}),r.push(t)}),s.length>0){var d=e.query("Select OwnerId, Id FROM "+n.actionGrid.settings.pageInfo.objectName+" WHERE Id in ('"+s.join("','")+"')");Object.each(d,function(e){Object.each(r,function(t){e.Id==(t.WhoId||t.WhatId)&&(t.OwnerId=e.OwnerId)})})}var c=function(i){for(var r,s=0,d=0,c=[],f=[],p=0;p<i.length;p++){var h=i[p];"true"==h.success?(s++,f.push(h.id)):(d++,void 0!=h.errors&&void 0!=h.errors.message&&(r||(r=e.getSObjectNameField(e.getSObjectDescribe(n.actionGrid.settings.pageInfo.objectName))),c.push('<a href="'+e.getRecordURL(n.selectedRows[p].Id)+'" target="_blank">'+n.selectedRows[p][r]+"</a> | "+h.errors.message)))}var g="Successfully created "+s+" record"+(1==s?"":"s")+"!",m=function(){var t={object:a.name,viewTitle:encodeURIComponent("Batch Add Results")},i=o.namespace;if(f.length>200){var n={Ids:f.join()};e.postToVFPage(i,o.VF_PAGE_NAME,t,n,!1,"_BLANK")}else t.Ids=f.join(),e.navigateToVFPage(i,o.VF_PAGE_NAME,t,!1,"_BLANK")},v=e.getUserInfo(),b=localStorage.getItem(kendo.format("{0}_{1}_{2}_{3}",v.organizationId,a.name,l.replace(" ",""),"displayResults"));if(0==d)u.showMessage({title:"Success",message:g},"success"),b||m();else{var y=[];0==s?(g="Batch Add Unsuccessful!",y.push({label:"Ok"})):y.push({label:"Yes",click:function(){m()}},{label:"No"}),d>0&&(g+="\n The following errors occurred: <br /><ul><li>"+c.join("\n</li><li>")+'</li></ul><br /> Contact <a href="mailto:support@getactiongrid.com">support@getactiongrid.com</a>'),f.length>0&&(g+="\n <br /> Would you like to ActionGrid the results?"),t.popupWithButtons("Batch Add Results",g,y)}};e.batchInsert(r,c)})}else t.popup("Please select records","Select at least one record to Batch Add to.");else t.popup("Error Retrieving FieldSet",s.message)})}},p=Object.create(f);p.init({label:"Task",name:"Task",entryFields:["OwnerId","Subject","ActivityDate","Status","Priority","Description"],fieldSet:"crmc_Batch_Add"}),p.isAvailable=function(e){var t=!1;if(a.getSetting(e.objectDescribe.name,"batchAddTask")!==!1){var i=(e.objectDescribe.name,"WhatId");Object.each(e.objectDescribe.childRelationships,function(n){"Task"==n.childSObject&&("WhatId"==n.field||"WhoId"==n.field&&"Account"!=e.objectDescribe.name)&&(t=!0,i=n.field)}),this.mappedFields=[{name:i,mappedName:"id"}]}return t};var h=Object.create(f);h.init({label:"Note",name:"Note",entryFields:["IsPrivate","Title","Body"],fieldSet:"crmc_Batch_Add",mappedFields:[{name:"ParentId",mappedName:"id"}]}),h.isAvailable=function(e){var t=!1,i=this,n=Object.first(e.objectDescribe.childRelationships,function(e){return e.childSObject==i.name});return n&&(t=a.getSetting(e.objectDescribe.name,"batchAddNote")!==!1),t};var g=Object.create(f);g.init({label:"Chatter",name:"FeedItem",entryFields:["Body"],fieldSet:"crmc_Batch_Add",mappedFields:[{name:"ParentId",mappedName:"id"}]}),g.isAvailable=function(e){var t=!1,i=this,n=Object.first(e.objectDescribe.childRelationships,function(e){return e.childSObject==i.name});return n&&(t=a.getSetting(e.objectDescribe.name,"batchAddChatter")!==!1),t};var m={submenus:[g,r,h,p,s,l,d,c],isAvailable:function(e){var t=!1;return Object.each(this.submenus,function(i){i.isAvailable(e)&&(t=!0)}),t},getLabel:function(e){return"Batch Add..."},createSubmenuItems:function(e){return this.submenus},click:function(){}};return m}),crmc.define("MassUpdateMenuItem",["sfdc","KendoPopup","marketing","CustomSettings"],function(e,t,i,n){return{appName:"CRMC_MassUpdate",pageName:"crmcMassUpdate",getAppNamespace:function(){return this.appName},getLabel:function(e){return"Mass Update - Secure"},isAvailable:function(e){return n.getSetting(e.objectDescribe.name,"massUpdate")!==!1},click:function(i){var n=document.getElementsByTagName("HEAD").item(0),a=document.createElement("script");a.type="text/javascript",n.appendChild(a);var o={ts:(new Date).getTime()};a.src=e.getStaticResourceURL(this.getAppNamespace(),"CRMC_MassUpdate__MassUpdate",o);var r=this,s=function(){if(i.selectedRows.length>0){var n=[];Object.each(i.selectedRows,function(e){n.push(e.Id)});var a={retURL:i.actionGrid.settings.pageURL},o={Ids:n.join()};e.postToVFPage(r.getAppNamespace(),r.pageName,a,o,!1)}else t.popup("Please select records","Select at least one record to update.")};a.onerror=function(e){console.log(e),s()},a.onload=function(){s()}},init:function(e,t){}}}),crmc.define("AWMergeMenuItem",["sfdc","KendoPopup","marketing","CustomSettings"],function(e,t,i,n){return{appName:["dupcheck","awduplicate2"],getAppNamespace:function(){return this.appName},getLabel:function(e){return"Merge"},isAvailable:function(e){return n.getSetting(e.objectDescribe.name,"merge")!==!1},click:function(i){if(i.selectedRows.length>1){var n=[];Object.each(i.selectedRows,function(e){n.push(e.Id)});var a={object:i.objectDescribe.name,ids:n.join(),retURL:i.actionGrid.settings.pageURL},o="awduplicate2"===this.appName,r=o?"awduplicatemerge":"dc3Merge";e.navigateToVFPage(this.appName,r,a,!0)}else t.popup("Please select records","Select at least two records merge.")},init:function(e,t){}}}),crmc.define("KendoPromptBox",["GridConstants"],function(e){return{promptBox:function(t,i,n,a,o,r){var s=e.UNIQUE_ID++,l=kendo.template("<div id='KendoPopupBox#=uniqueid#' style='display:none;'><p>#= val # : &nbsp;&nbsp; <input type='text' id='txtSaveValue#=uniqueid#' style='width: 200px;' value='#= defaultValue #'/></p><div style='float:right;'><span id='closeWindow#=uniqueid#' class='k-button'>Dismiss</span>&nbsp;#if (confirmText) {#<span id='confirmWindow#=uniqueid#' class='k-button'>#=confirmText#</span># } #</div></div>"),d={val:i,uniqueid:s,confirmText:n,defaultValue:r},c=l(d);$("body").append(c);var u=$("#closeWindow"+s),f=$("#KendoPopupBox"+s);if(u.bind("click",function(){f.data("kendoWindow").close()}),n){var p=$("#confirmWindow"+s);p.bind("click",function(){a($("#txtSaveValue"+s).val(),o),f.data("kendoWindow").close()})}f.data("kendoWindow")||f.kendoWindow({draggable:!0,modal:!0,resizable:!1,actions:["Close"],title:t}),f.data("kendoWindow").center().open()}}}),crmc.define("BatchAddToEmmaGroup",["sfdc","marketing","KendoPopup","KendoEntry","KendoPromptBox","CustomSettings"],function(e,t,i,n,a,o){var r={appName:"emma",getAppNamespace:function(){return this.appName},isAvailable:function(e){return("Contact"==e.objectDescribe.name||"Lead"==e.objectDescribe.name)&&o.getSetting(e.objectDescribe.name,"batchAddEmma")},getLabel:function(e){return"Emma Group"},createSubmenuItems:function(e){},click:function(t){if(t.selectedRows.length>0){var o="Add To Emma Group ";n.entry(o,[{name:"emmaGroup",label:"Select Emma Group (Leave blank for new)",referenceTo:"emma__Emma_Group__c",type:"reference"}],null,t.actionGrid.settings,function(n){var o=n.emmaGroup.value,r=function(t,i){if(void 0!==t&&""!=t){var n=new sforce.SObject("emma__Emma_Group__c");n.Name=t,e.insert(n,s,s)}},s=function(n){if(void 0!==n){if("true"!=n.success)return void i.popup("Error Creating Emma Group",n.errors.message);o=n.id}var a=[];Object.each(t.selectedRows,function(e){var i=new sforce.SObject("emma__Emma_Group_Member__c");"Contact"==t.objectDescribe.name?i.emma__Contact__c=e.Id:"Lead"==t.objectDescribe.name&&(i.emma__Lead__c=e.Id),i.emma__Emma_Group__c=o,a.push(i)});var r=function(e){var t=0,n=0,a=0,o=[];e instanceof Array||(e=[e]),Object.each(e,function(e){"true"==e.success?t++:void 0!=e.errors&&"DUPLICATE_VALUE"==e.errors.statusCode?a++:void 0!=e.errors&&void 0!=e.errors.message&&(n++,o.push(e.errors.message))});var r="Successfully added "+t+" Emma Group Member"+(1==t?"":"s")+"!";0==t&&(r="Add To Emma Group Unsuccessful!"),a>0&&(r+="\n <br />"+a+" duplicate"+(1==a?"":"s")+" were skipped."),n>0&&(r+="\n The following errors occurred: <br /><ul><li>"+o.join("\n</li><li>")+'</li></ul><br /> Contact <a href="mailto:support@getactiongrid.com">support@getactiongrid.com</a>'),i.popup("Add To Emma Group Results",r)};e.insert(a,r,r,!0)};void 0===o||""===o?a.promptBox("New Emma Group","Emma Group Name","Save",r,t.actionGrid,""):s()})}else i.popup("Please select records","Select at least one record to add to an Emma group.")}};return r}),crmc.define("Geopointe",["sfdc","marketing","KendoPopup","CustomSettings"],function(e,t,i,n){var a={appName:"geopointe",maxRows:750,getAppNamespace:function(){return this.appName},getLabel:function(e){return"Geopointe"},isAvailable:function(e){return n.getSetting(e.objectDescribe.name,"geopointe","action")!==!1},click:function(t){var n=document.getElementsByTagName("HEAD").item(0),o=document.createElement("script");o.type="text/javascript",n.appendChild(o);var r={ts:(new Date).getTime()};o.src=e.getStaticResourceURL(a.appName,a.appName+"__GeopointeJS_mq",r);var s=function(){if(t.selectedRows.length>a.maxRows)i.popup("Max Records Limit!","Currently, we don't allow more than "+a.maxRows+" records to be mapped!");else if(t.selectedRows.length>0){var n=[];Object.each(t.selectedRows,function(e){n.push(e.Id)}),e.postToVFPage(a.appName,"Map",void 0,{idArray:n},!0)}else i.popup("Please select records","Select at least one record to view in Geopointe")};o.onerror=function(){s()},o.onload=function(){s()}}};return a}),crmc.define("BatchDelete",["KendoPopup","CustomSettings","sfdc","Notification"],function(e,t,i,n){var a={isAvailable:function(e){return e.selectedRows.length>0&&"true"===e.objectDescribe.deletable&&1==t.getSetting(e.objectDescribe.name,"batchDelete")},getLabel:function(e){return"Delete Records"},createSubmenuItems:function(e){},click:function(t){var a=t.selectedRows,o=t.actionGrid.kendoGrid.dataItems();a.length>0&&void 0!=o[0].Id&&""==o[0].Id?e.popupWithButtons("Warning","Unsaved rows selected, Save before continuing.",[{label:"Ok"}],{width:260}):e.popupWithButtons("Confirm Deletion",kendo.format('<span style="font-size:150%;font-weight:bold;color:red;">ATTENTION!!!</span><p>You\'ve selected <b><u>{0} record{1}</u></b> for deletion.</p><p>The selected record{1} and <u><b>all related child records</b></u> will be deleted.</p><p>Depending on your organization\'s storage limits and length of time in<br/>the Recycle Bin, it is not always possible to recover deleted records.</p><p style="font-size:125%;font-weight:bold">Are you sure you want to proceed?</p>',a.length,a.length>1?"s":""),[{label:"Yes",click:function(){kendo.ui.progress($("#"+t.actionGrid.settings.id),!0);var o=[],r=$.map(a,function(e){return[e.Id]});i.batchDelete(r,function(i){for(var a=0,r=0,s=0;s<i.length;s++){var l=i[s];if(l&&"true"==l.success)r++;else{var d=l.getArray("errors");d.length>0&&o.push(d[0].message.replace(/\r\n/g,"<br/>").replace(/[\r\n]/g,"<br/>")),a++}}var c;a>0?(c="Succeeded: "+r+"<br/>Failed: "+a+"<br/> Due to:<br/><br/>"+o.join("<br/>"),e.popup("Deletion Results",c)):(c="Number of records deleted: "+r,n.showMessage({title:"Record"+(1===r?"":"s")+" Deleted",message:c},"success")),kendo.ui.progress($("#"+t.actionGrid.settings.id),!1),t.actionGrid.gridDataSource.read(),t.actionGrid.getElement("check-all").attr("checked",!1)})}},{label:"Cancel",click:function(){}}])}};return a}),crmc.define("ListBrowse",["sfdc","marketing","KendoPopup","CustomSettings"],function(e,t,i,n){var a={appName:"taf_listbrowse",maxRows:1e3,getAppNamespace:function(){return this.appName},getLabel:function(e){return"List Browse"},isAvailable:function(e){return n.getSetting(e.objectDescribe.name,"taf_listbrowse","action")!==!1},click:function(t){var n=$('<iframe style="display:none;"/>').appendTo($("body"));$(n).attr("src","/apex/taf_listbrowse__ListBrowse?"),n[0].onload=function(){if(t.selectedRows.length>a.maxRows)i.popup("Max Records Limit!","Currently, we don't allow more than "+a.maxRows+" records to be mapped!");else if(t.selectedRows.length>0){var o=[];Object.each(t.selectedRows,function(e){o.push(e.Id)}),e.postToVFPage(a.appName,"ListBrowse",void 0,{rids:o.join("$")},!0)}else i.popup("Please select records","Select at least one record to browse");$(n).remove()}}};return a}),crmc.define("MapAnything",["sfdc","marketing","KendoPopup","CustomSettings","KendoEntry"],function(e,t,i,n,a){var o={appName:"sma",maxRows:1e3,getAppNamespace:function(){return this.appName},getLabel:function(e){return"MapAnything"},isAvailable:function(e){return n.getSetting(e.objectDescribe.name,"sma","action")!==!1},click:function(n){var r=document.getElementsByTagName("HEAD").item(0),s=document.createElement("script");s.type="text/javascript",r.appendChild(s);var l=window.location.hostname.split(".");3==l.length?instance=l[0]:instance=l[1],s.src=String.format("https://{0}.{1}.visual.force.com/resource/{0}__MADemographicsJS?ts={2}",o.appName,instance,(new Date).getTime()),s.onerror=function(){t.missingApp(o.appName)},s.onload=function(){if(n.selectedRows.length>o.maxRows)i.popup("Max Records Limit!","Currently, we don't allow more than "+o.maxRows+" records to be mapped!");else{var t=[];Object.each(n.selectedRows,function(e){t.push(e.Id)});var r=function(a){var r=Object.copy(n.actionGrid.settings.pageInfo);if(!(r.filterId||r.sorts&&0!==r.sorts.length)){var s=e.getSObjectNameField(n.objectDescribe);s&&(r.sorts=[{field:s,dir:"asc"}])}r.filter&&r.filter.filters&&r.filter.filters.length&&r.filter.filters.map(function(t){if(t&&t.value&&t.value instanceof Date){var i=e.getDateWithOffset(t.value,e.getProfileTimezoneOffset());t.value=i.toISOString()}}),void 0!==n.actionGrid.settings.baseFilter&&(void 0===r.filter&&(r.filter={logic:"and"}),r.filter||(r.filter={}),void 0===r.filter.filters&&(r.filter.filters=[]),r.filter.filters.push(n.actionGrid.settings.baseFilter)),delete r.displayColumns,delete r.childGridSettings,t.length>0&&(r.selectedRecordIds=t);e.getNamespace(!1);e.executeRemoteAction("getResultSOQL",[r],function(t,r){if(r.status){var s,l=e.query("SELECT Name, sma__User__c,  Id FROM sma__MASavedQry__c WHERE Name = 'ActionGrid "+n.objectDescribe.name+"' AND sma__User__c = '"+e.getUserInfo().userId+"' AND IsDeleted = false");s=l.length<1?new sforce.SObject("sma__MASavedQry__c"):l[0],s.Name="ActionGrid "+n.objectDescribe.name,s.sma__User__c=e.getUserInfo().userId,s.sma__ActivityFilter__c='{"operator":"AND","task":"all","event":"all"}',s.sma__AdvancedOptions__c='{"selectType" : "MILES","enableProxLimit" : "false","enableLimit" : "false","address" : "","distance" : ""}',s.sma__BaseObject__c=a,s.sma__ColorAssignmentType__c="Static",s.sma__ProximityOptions__c='{ "hideMarkers" : "false", "selectType" : "circle", "radius" : "", "measurementType" : "MILES", "affectVisibility" : "true", "enabled" : "false" }',s.sma__OwnerFilterId__c="All",s.sma__IconColor__c="#00FF00:Marker",s.sma__Tooltip1__c=e.getSObjectNameField(n.objectDescribe)||"";var d=t.resultSOQL.split(" from ");s.sma__Query__c="FROM "+d[d.length-1].split(" order by ")[0],s.sma__Query__c.indexOf(" where ")<0&&(s.sma__Query__c+=" where Id != ''");var c=function(t){t.getBoolean("success")?e.navigateToVFPage(o.appName,"MapAnything",{layerid:t.id},!1,"_blank"):i.popup("Metadata Error",t.message)};e.upsert("Id",s,c,c)}else i.popup("Metadata Error",r.message)},{escape:!1,buffer:!1})},s=e.query("SELECT Id,Name FROM sma__MABaseObject__c WHERE Name = '"+n.objectDescribe.name+"'");if(1==s.length)r(s[0].Id);else{a.entry("MapAnything Base Object",[{name:"baseObject",label:"Select Base Object",referenceTo:"sma__MABaseObject__c",type:"reference",filter:[{field:"Name",operator:"eq",value:n.objectDescribe.name}]}],null,n.actionGrid.settings,function(e){var t=e.baseObject;r(t)})}}}}};return o}),crmc.define("CongaConductor",["sfdc","marketing","KendoPopup","KendoEntry","CustomSettings"],function(e,t,i,n,a){var o=function(t,n,o,r){return{appName:["APXTConga4","Conga_SE"],objectName:t,fieldName:n,label:o,type:r,getAppNamespace:function(){return this.appName},isAvailable:function(e){var t="congaConductor"==this.type&&e.selectedRows.length>1||"congaComposer"==this.type&&1==e.selectedRows.length;return t&&e.objectDescribe.name==this.objectName&&0!=a.getSetting(this.objectName,"conga__"+this.fieldName)},getLabel:function(e){return this.label},createSubmenuItems:function(e){},createButtonUrl:function(e,t){var i=window.location.hostname;return i="https://"+i+"/servlet/servlet.Integration?lid="+t,e&&(i+="&eid="+e),i+"&ic=1"},click:function(t){if(!(t.selectedRows.length>0))return void i.popup("Please select records","Select at least one record to send to Conga.");var n="";Object.each(t.selectedRows,function(e){n.length>0&&(n+=","),n+=e.Id});var a;if("congaComposer"==this.type){if(1==t.selectedRows.length)if(this.fieldName.indexOf("buttonId__")>-1)a=this.createButtonUrl(t.selectedRows[0].Id,this.fieldName.split("buttonId__")[1]);else if(a=t.selectedRows[0][this.fieldName],!a){var o=e.query("Select "+this.fieldName+", Id FROM "+this.objectName+" WHERE Id ='"+t.selectedRows[0].Id+"'");1==o.length&&(a=o[0][this.fieldName])}}else{if(this.fieldName.indexOf("buttonId__")>-1){a=this.createButtonUrl(void 0,this.fieldName.split("buttonId__")[1]);var r=document.createElement("form");return r.method="post",r.action=a,r.setAttribute("target","_blank"),Object.each(t.selectedRows,function(e){var t=document.createElement("input");t.type="hidden",t.name="ids",t.value=e.Id,r.appendChild(t)}),document.body.appendChild(r),void r.submit()}a="https://conductor.congamerge.com?MOID="+n+"&SessionId="+sforce.connection.sessionId+"&ServerUrl="+t.actionGrid.settings.Partner_Server_URL_290+"&UrlFieldName="+this.fieldName}a.toLowerCase().indexOf("https://")<0&&(a="https://composer.congamerge.com?SessionId="+sforce.connection.sessionId+"&ServerURL="+t.actionGrid.settings.Partner_Server_URL_290+"&"+a),window.open(a,"Conga","width=700,height=450,menubar=0")}}},r={subMenus:void 0,appName:["APXTConga4","Conga_SE"],getAppNamespace:function(){return this.appName},isAvailable:function(e){var t=!1;return this.createSubmenuItems(e),Object.each(this.subMenus,function(i){i.isAvailable(e)&&(t=!0)}),t},getLabel:function(e){return"Conga"},createSubmenuItems:function(t){if(!this.subMenus){this.subMenus=[];var i=this,n=e.getNamespace(!0),a=e.query("SELECT Id, Name, {0}JSON__c, {0}Setting_Name__c, {0}Table_Name__c, {0}Setting_Type__c FROM {0}Grid_Setting__c WHERE isDeleted = false AND ({0}Setting_Type__c = 'congaConductor' OR {0}Setting_Type__c = 'congaComposer')",n);Object.each(a,function(e){var t=e[n+"Table_Name__c"];try{t=JSON.parse(unescape(e[n+"JSON__c"]))}catch(e){}i.subMenus.push(o(e[n+"Table_Name__c"],e[n+"Setting_Name__c"],t,e[n+"Setting_Type__c"]))})}return this.subMenus},click:function(e){}};return r}),crmc.define("SummarizeAction",["CustomSettings","ColumnFactory","KendoPopup"],function(e,t,i){var n={getLabel:function(e){return this.metadata.title},click:function(e){var t=this.metadata.formula,n=function(n,a){if(e.actionGrid.gridDataSource&&e.selectedRows.length==e.actionGrid.gridDataSource.pageSize()){var o=t?"Warning":"Summarize Column",r=t?"Summarize column cannot summarize formula fields beyond the current page":"Would you like to summarize all results matching the current filter </br>or only the selected results?",s=[{label:"Selected Results",click:function(){e.actionGrid.summarizeColumn(n,a,t)}},{label:"Cancel"}];t||s.unshift({label:"All Results",click:function(){e.actionGrid.summarizeColumn(n)}}),i.popupWithButtons(o,r,s)}else t?e.actionGrid.summarizeColumn(n,a,!0):e.actionGrid.summarizeColumn(n,a)},a=[];Object.each(e.selectedRows,function(e){a.push(e.Id)}),n(t?this.metadata.field:this.metadata.name,a)}},a={itemID:"summarizeColumn",featureSecurity:e,isAvailable:function(e){var t=this.createSubmenuItems(e);return t&&t.length>0&&e.selectedRows&&e.selectedRows.length>1&&this.featureSecurity.getSetting(e.objectDescribe.name,this.itemID)!==!1},isHeaderAvailable:function(e){return e.selectedColumn&&e.selectedColumn.aggregates.length>1&&this.featureSecurity.getSetting(e.objectDescribe.name,this.itemID)!==!1},getLabel:function(e){return"Summarize Column"},createSubmenuItems:function(e){if(void 0==e.selectedColumn){var t=Object.where(e.actionGrid.columns,function(e){var t=function(e){switch(e){case"integer":case"currency":case"double":case"number":case"int":case"decimal":return!0;default:return!1}};return e.schema?t(e.schema.type.toLowerCase()):e.formula?t(e.formula.type.toLowerCase()):void 0}),i=[];return Object.each(t,function(e){var t=Object.create(n);t.metadata=e,i.push(t)}),i}},click:function(e){void 0!=e.selectedColumn&&e.selectedColumn&&e.selectedColumn.aggregates.length>0&&(e.selectedRows.length>0?summarize(e,e.selectedColumn.name,e.selectedRows.map(function(e){return e.Id})):e.actionGrid.summarizeColumn(e.selectedColumn.name))}};return a}),crmc.define("BatchClone",["KendoEntry","KendoPopup","sfdc","CustomSettings","ColumnFactory","ForeignKeyControl","Notification"],function(e,t,i,n,a,o,r){return{actions:[],context:void 0,isAvailable:function(e){return!!(e.selectedRows.length>0&&e.objectDescribe&&["true",!0].indexOf(e.objectDescribe.createable)>-1&&e.objectDescribe&&["true",!0].indexOf(e.objectDescribe.updateable)>-1)&&n.getSetting(e.objectDescribe.name,"batchClone")!==!1},getLabel:function(e){return"Clone"},createSubmenuItems:function(e){return this.actions},inLineEditMode:function(){return this.context.selectedRows.length>0&&void 0!=this.context.selectedRows[0].Id&&""==this.context.selectedRows[0].Id},saveGridMessage:function(){t.popupWithButtons("Warning","Unsaved rows selected, Save before continuing.",[{label:"Ok"}],{width:260})},getRowIds:function(e){var t=[];return e.map(function(e){t.push(e.Id)}),t},getFields:function(e){for(var t=this,i=[],n=[],o={name:"",label:"",type:void 0,required:!1,createable:!0,updateable:!0},r=t.context.objectDescribe.name,s=t.context.actionGrid,l=0;l<e.length;l++){var d=e[l];if("urn:address"!=d.soapType){var c=function(e){var t=Object.create(o);t.name=d.name;var r=Object.first(s.columns,function(e){return e.name==d.name});t.label=r&&r.title||a.getHeaderTitle(d,s.fieldMeta)||d.label,t.type=d.type,d.getBoolean("createable")||(t.createable=!1),d.getBoolean("updateable")||(t.updateable=!1),e?t.required=!0:t.required=!d.getBoolean("nillable"),t.reparentable=t.createable&&"reference"==t.type&&!t.updateable,t.createable&&!t.updateable&&"reference"==t.type?i.push(t):n.push(t)};if("OpportunityLineItem"==r||"OrderItem"==r||"QuoteLineItem"==r)switch(d.name){case"UnitPrice":c(!0);break;case"TotalPrice":break;default:c()}else c()}}t._reparentable=i.length>0;var u=function(e,t){var i=e.label.toLowerCase(),n=t.label.toLowerCase();return i<n?-1:i>n?1:0};return n=n.sort(u),i=i.sort(u),i.concat(n)},clone:function(e,n,a){function o(){return[{label:"Ok"}]}var s=this,l=parseInt(n),d=[],c={};if(Object.each(e,function(e){var t=!1;e.createable||(t=!0),t||d.push(e.name),"reference"==e.type&&e.Id&&(c[e.name]=e.Id)}),l*s.context.selectedRows.length<=200){s.context.kendoGrid._progress&&s.context.kendoGrid._progress(!0);for(var u=s.getRowIds(s.context.selectedRows),f=i.query(kendo.format("SELECT {0} FROM "+s.context.objectDescribe.name+" WHERE Id IN('"+u.join("','")+"')",d.join(", "))),p=[],h=0;h<f.length;h++){for(var g=new sforce.SObject(s.context.objectDescribe.name),m=0;m<d.length;m++)null!=f[h][d[m]]&&(g[d[m]]=c[d[m]]?c[d[m]]:f[h][d[m]]);for(var m=0;m<l;m++)p.push(g)}var v=function(e){try{return"<li> Status Code: "+e.statusCode+", Message: "+e.message+"</li>"}catch(e){alert("Error: "+e)}},b=function(e){function i(e){return s.context.kendoGrid._progress&&s.context.kendoGrid._progress(!1),[{label:"Send To Console",click:function(){$.each(e,function(e,t){t.errors&&console.log(t.errors)})}},{label:"Ok"}]}var n=[],o=["<style>div.overflow{overflow: auto; max-height: 600px;}</style><div><div class='overflow'><ul>"];if($.each(e,function(e,t){return t.errors?void o.push(v(t.errors)):void n.push(t.id)}),e.length==n.length){if(s.context.kendoGrid._progress&&s.context.kendoGrid._progress(!1),a)window.open(kendo.format("/apex/CRMC_PP__crmc_grid?object={0}&Ids={1}",s.context.objectDescribe.name,n.join()));else{var d=kendo.format("{0} Selected record"+(1===u.length?"":"s")+" cloned, "+l+" time"+(l>1?"s each":u.length>1?" each.":"."),u.length);r.showMessage({title:"Record"+(1===u.length?"":"s")+" Cloned",message:d},"success")}s.context.actionGrid.refresh()}else o.push("</ul></div></div>"),t.popupWithButtons("Batch Clone Errors",o.join(""),i(e),{width:700})};sforce.connection.create(p,{onSuccess:b,onFailure:b})}else{var y=["<ul>","<li> Total created records cannot exceed 200.</li>",,"<li> Example: 10 Rows cloned 5 times is 50 new records - Ok</li>","<li> Example: 10 Rows cloned 25 times is 250 new records - Limit exceeded</li>","</ul>"].join("");t.popupWithButtons("Limit Exceeded",y,o(),{width:480})}},ui:function(){var e=this,t=e.context.actionGrid.settings.id,n="clone_window",a=e.context.actionGrid.getElementId(n),r="clone_window_grid",s=t+"_"+r,l=s+"_fKControl",d=s+"_checkboxResults",c=s+"_cloneButtonApply",u=s+"_cloneButtonCancel",f=s+"_cloneChk",p=s+"_txtFieldSearch",h=s+"_cloneAmount",g=window.innerHeight<=580?window.innerHeight-60:538,m=function(e){return"#"+e};$(a).data("kendoWindow")&&($(a).data("kendoWindow").destroy(),$(a).empty());var v=localStorage[r];e._localStorage=v?JSON.parse(v):{displayResults:!0},$("body").append(kendo.format('<div id="{0}_{1}" style="display:none; text-align:center;">{2}{3}</div>',t,n,kendo.format('<div style="width:100%; padding:0.3em;"><div id="{0}"></div></div>',s),"<div style='padding-top:0.3em;'>"+kendo.format("Display Results <input id='{0}' type='checkbox' {1}/> &nbsp; &nbsp;",d,e._localStorage.displayResults?"checked='checked'":"")+kendo.format("<span id='{0}' class='k-button'> Create Clones </span> &nbsp; &nbsp;",c)+kendo.format("<span id='{0}' class='k-button'> Cancel </span><",u)+"/div>")),a=$(a).kendoWindow({title:"Clone Options",actions:["Close"],height:g,maxHeight:g,minHeight:g,width:615,visible:!1,animation:{open:{effects:"fade:in"}},close:function(t){e.context.actionGrid.setKeyboardFocus()}}),a.data("kendoWindow").center().open();var b=e.context.actionGrid.getElementId(r);$(b).data("kendoGrid")&&($(b).data("kendoGrid").destroy(),$(b).empty()),e._fields=e.getFields(e.context.objectDescribe.fields);var y={data:e._fields};e._reparentable&&(y.group={field:"reparentable",dir:"desc"}),e._dataSource=new kendo.data.DataSource(y),$(b).kendoGrid({selectable:!1,height:""+g-65+"px",columns:[{field:"reparentable",hidden:!0,groupHeaderTemplate:function(e){return e.value?"Non-Reparentable Fields (cannot be changed after cloning)":"Normal Fields"}},{template:function(e){return void 0==e.checked&&(e.checked=!0),kendo.format('<input class="cloneChk" id="cloneChk={0}" {1} type="checkbox" {2}>',e.name,e.required?'disabled="true"':"",e.checked?'checked="checked"':"")},headerTemplate:kendo.format('<input id="{0}" type="checkbox" checked="checked"/>',f),width:"33px"},{field:"label",template:function(e){var t="API Name: "+e.name+(e.required?" ,Required: true":"");return kendo.format('<div title="{0}">{1}</div>',t,e.label)},headerTemplate:kendo.format('<input id="{0}" type="search" class="k-textbox" placeholder="Search field"/>',p),attributes:{style:"text-align: left;"}},{template:function(e){return e.reparentable?kendo.format('<input class="{0}" type="text" style="width:99%;"/>',l):""},headerTemplate:kendo.format('Number of clones: <input id="{0}" style="width:6em;"/>',h),attributes:{style:"text-align: left;"}}],dataSource:e._dataSource}),$(b+">div.k-grid-content").css({"max-height":""+g-87+"px"});var k=function(){$(".k-grouping-row").prop("align","left")};e._dataSource.filter({logic:"and",filters:[{field:"createable",operator:"eq",value:!0}]}),k(),$(m(h)).kendoNumericTextBox({value:1,step:1,min:1,format:"n0"});var w=function(){$("."+l).each(function(){var t=e,n=$(this),a=n.parent().parent().attr("data-uid"),r=t._dataSource.getByUid(a),s=Object.first(e.context.actionGrid.settings.metadata.fields,function(e){return e.name==r.name}),l=i.getSObjectDescribe(s.referenceTo),d=i.getSObjectNameField(l),c={objectName:s.referenceTo,columns:[d]};o.create({input:n,field:r.name,model:void 0,displayText:"Use existing value",keyPrefix:l.keyPrefix,setFunction:function(e){r.Id=e.Id},autoBind:!1,fieldMeta:s,pageInfo:c,parentObject:s.referenceTo,fkField:void 0,fkValue:void 0})})};w();var x,I=function(t){Object.each(t,function(t){var i=t.id;if(i){i=i.split("=")[1];var n=Object.first(e._dataSource.data(),function(e){return e.name==i});n&&(n.checked=t.checked)}})},S=$(m(p));S.on("keyup search input paste",function(t){clearTimeout(x),x=setTimeout(function(){I($("input.cloneChk")),e._dataSource.filter({logic:"and",filters:[{field:"createable",operator:"eq",value:!0},{field:"label",operator:"contains",value:S.val()}]}),w(),k()},300)}),$(m(f)).bind("click",function(){var e=$("input.cloneChk").filter(function(){return!$(this).attr("disabled")});e.prop("checked",this.checked)}),$(m(c)).bind("click",function(){var t=$("input.cloneChk:checked"),i=$(m(h)).data("kendoNumericTextBox").value();e._localStorage.displayResults=$(m(d)).is(":checked"),localStorage[r]=JSON.stringify(e._localStorage);var n=[];Object.each(t,function(t){var i=t.id;if(i){i=i.split("=")[1];var a=Object.first(e._dataSource.data(),function(e){return e.name==i});a&&n.push(a)}}),e.clone(n,i,e._localStorage.displayResults),$(a).data("kendoWindow").close().destroy()}),$(m(u)).bind("click",function(){$(a).data("kendoWindow").close().destroy()})},click:function(e){this.context=e,this.ui()}}}),crmc.define("BatchEmail",["KendoEntry","KendoPopup","sfdc","CustomSettings","Notification"],function(e,t,i,n,a){
var o=function(){var e=i.getUserInfo(),t="true"==e.orgHasPersonAccounts;return t},r=function(e){for(var t=[],i=(e.objectDescribe.name.toLowerCase(),0);i<e.objectDescribe.fields.length;i++)field=e.objectDescribe.fields[i],field&&field.type&&"email"==field.type.toLowerCase()&&t.push({label:field.label,value:field.name});for(var n=e.actionGrid.fieldMeta,i=n.length-1;i>=0;i--){var a=n[i];"email"==a.type&&a.idMeta&&t.push({label:Object.first(e.actionGrid.columns,function(e){return e.name==a.name}).title,value:a.name,parent:!0})}return t},s=function(e,t,n){var a,o,r=Array.isArray(t)?t:[t],s=[],l=[],d=[],f=[];if(e.selectedRows.map(function(e){l.push(e.Id)}),Object.each(r,function(t){var i=Object.first(e.actionGrid.fieldMeta,function(e){return e.name&&e.name==t});i?f.push(t):d.push(t)}),"CampaignMember"==n&&(d.push("CampaignId"),o=function(){Object.each(s,function(e){"CampaignMember"==e.ObjectName&&(e.Id=e.CampaignId)})}),f.length>0&&Object.each(e.selectedRows,function(t){var i={},n=function(n){t[n]&&(i.Id=t.Id,i[n]=t[n],i.Type=c(e),i.ObjectName=e.objectDescribe.name)};Object.each(f,function(i){var a=i.split(".");if(1==a.length)n(i);else{var o=(a.pop(a.length),t);Object.each(a,function(e){o=o[e]});var r=Object.first(e.actionGrid.fieldMeta,function(e){return e.name&&e.name==i});if(r&&r.idMeta&&r.idMeta.relObjectName&&t[i]&&u(r.idMeta.relObjectName)){var l={Id:o.Id,Type:c(r.idMeta.relObjectName),ObjectName:r.idMeta.relObjectName};l[i]=t[i],s.push(l)}else n(i)}}),s.push(i)}),d.length>0){var p=f.length>0;a=i.query("SELECT Id, "+d.join(", ")+" FROM "+n+" WHERE Id IN('"+l.join("','")+"')"),p?Object.each(a,function(e){var t=Object.first(s,function(t){return t.Id==e.Id});t&&Object.each(d,function(i){t[i]=e[i]})}):s=a,"function"==typeof o&&o()}return{results:s,fields:r}},l=function(e,n,a,o,r){for(var s=[],l=function(i){var a=["<style>div.overflow{overflow: auto; max-height: 600px;}</style><div><div class='overflow'><ul>"];$.each(i,function(e,t){if(t.errors){var i="<li> Status Code: "+t.errors.statusCode+", Message: "+t.errors.message+"</li>";a.indexOf(i)===-1&&a.push(i)}else n.push(t.id)}),a.length>1?(a.push("</ul></div></div>"),t.popupWithButtons("Error creating activities",a.join(""),[{label:"Ok",click:function(){r&&r()}}],{grid:e.actionGrid,width:700})):r&&r()},d=i.getUserInfo().userId,c=0;c<n.length;c++){var u=new sforce.SObject("Task");"whoid"==o.toLowerCase()?u.WhoId=n[c]:u.WhatId=n[c],u.OwnerId=d,u.Subject=a.subject,u.TaskSubtype="Email",u.Status="Completed",u.Description=a.description?a.description:"To: "+a.toAddresses.join("; ")+"\nCC: \nBCC: \nAttachment: \nSubject: "+a.subject+"\nBody: "+a.htmlBody,s.push(u)}i.batchInsert(s,l)},d=function(e){if(null!=e&&void 0!=e)if("true"===e[0].success)a.showMessage({title:"Success",message:"Email batch has been successfully processed!"},"success");else{var i="Batch Failed...",n=["<ul>","<li> Emails were not sent.","<ul>","<li> Message: "+e[0].errors.message+"</li>","<li> Status Code: "+e[0].errors.statusCode+"</li>","<li> Target Object: "+e[0].errors.targetObjectId+"</li>","<li> Please check the console for more information.</li>","</ul>","</li>","</ul>","<ul>","<li> API Daily Outbound Single and Batch email limits.","<ul>","<li> 1,000 for all orgs </li>","<li> 10 for developer editions </li>","<li> Target Object: "+e[0].errors.targetObjectId+"</li>","</ul>","</li>","</ul>","<ul>","<li> API External Address Limit per Mass Email.","<ul>","<li> Personal: N/A </li>","<li> Contact Manager: N/A </li>","<li> Group: N/A </li>","<li> Professional: 250 </li>","<li> Enterprise: 500 </li>","<li> Unlimited: 1,000 </li>","<li> Performance: 1,000 </li>","<li> <a href='https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_gov_limits.htm#email_limits_section' target='_blank' >Salesforce documentation</a> </li>","</ul>","</li>","</ul>"].join("");t.popupWithButtons(i,n,[{label:"OK"}],{width:400})}else t.popup("Batch Error",e),console.log(e)},c=function(e){var t="string"==typeof e?e:e.objectDescribe.name;switch(t.toLowerCase()){case"contact":case"lead":case"user":return"WhoId";default:return"WhatId"}},u=function(e){var t;if(t="string"==typeof e?i.getSObjectDescribe(e):e.objectDescribe,"Task"!=t.name)for(var n=0;n<t.childRelationships.length;n++)if("Task"==t.childRelationships[n].childSObject)return!0;return!1},f={isAvailable:function(e){var t=e.objectDescribe.name.toLowerCase();if(t.contains("__c"))return u(e);switch(t){case"contact":case"lead":case"case":case"account":case"campaign":case"contract":case"opportunity":case"order":case"product":case"quote":case"solution":return!0;default:return!1}},getLabel:function(e){return"From Template"},createSubmenuItems:function(e){return[]},click:function(e){function n(){var t,n=[];if(t=e.actionGrid.settings.fkValue&&window.top!=window?"/"+e.actionGrid.settings.fkValue:window.location.href,e.selectedRows.map(function(e){n.push(e.Id)}),"WhoId"===c(e))for(var a=0;a<n.length;a++)window.open("/_ui/core/email/author/EmailAuthor?p2_lkid="+n[a]+"&retURL="+t);else{var o;try{o=i.query("SELECT Id, ContactId FROM "+e.objectDescribe.name+" WHERE Id IN('"+n.join("','")+"')")}catch(e){}if(void 0!=o)for(var a=0;a<o.length;a++)window.open("/_ui/core/email/author/EmailAuthor?p2_lkid="+o[a].ContactId+"&p3_lkid="+o[a].Id+"&retURL="+t);else for(var a=0;a<n.length;a++)window.open("/_ui/core/email/author/EmailAuthor?p2_lkid=&p3_lkid="+n[a]+"&retURL="+t)}}if(e.selectedRows.length>5){var a=[{label:"Yes",click:function(){n()}},{label:"No"}];t.popupWithButtons("WARNING","5 records are recommended because each item will show in a new tab. Do you want to continue?",a)}else n()}},p={isAvailable:function(e){return!0},getLabel:function(e){return"Compose (Default Client)"},createSubmenuItems:function(e){return[]},pushToEmailClient:function(e,t){for(var i=[],n=[],a=0;a<e.length;a++){var o=e[a][t];o&&(n.push(e[a].Id),i.indexOf(o)==-1&&i.push(o))}return url=["mailto:"+i.join(";")],i.length>0&&(window.location.href=url.join("")),{emails:i,sentIds:n}},ui:function(i,n){var a,o=this,d=r(i);if(d.length>0){var u=function(n){var a=s(i,n,i.objectDescribe.name),r=o.pushToEmailClient(a.results,n);r.emails.length>0?e.entry("Log Activity History",[{name:"subject",label:"Subject",type:"text",required:!0},{name:"description",label:"Description",type:"textarea",value:"To: "+r.emails.join("; ")+"\n"}],{},null,function(e){var t=e.subject.value,n=e.description.value,a=c(o.context);if(t||n){var s={subject:t?t:"",toAddresses:r.emails,description:n?n:""};l(i,r.sentIds,s,a)}}):t.popupWithButtons("Empty Email Addresses Data Set","Please add email data to the selected rows.",[{label:"Ok"}],{grid:o.context.actionGrid,width:250})};d.length>1?e.entry("Select Email Address",[{name:"Field",label:"Email Field",type:"picklist",values:d}],{width:350},null,function(e){for(var t=e.Field.value,i=0;i<d.length;i++){var n=d[i];if(n.value==t&&n.lookup){t=n.lookup.name+"."+n.lookup.field;break}if(n.value==t&&n.parent){a=!0,t=n.value;break}}u(t)}):u(d[0].value)}else t.popupWithButtons("No email fields available","Create and/or add email field to the grid",[{label:"Ok"}],{grid:o.context.actionGrid,width:240})},click:function(e){var t=this;t.context=e,t.ui(e,t.selectedRowIds)}},h={context:void 0,selectedRowIds:[],_localStorage:{},isAvailable:function(e){return!0},getLabel:function(e){return"Compose"},createSubmenuItems:function(e){return[]},singleEmailMessage:function(e,t,i,n,a,o,r){var s=new sforce.SingleEmailMessage;return o&&(r?s.targetObjectId=o:s.whatId=o),s.replyTo=e,s.toAddresses=t,s.subject=i,a?s.htmlBody=n:s.plainTextBody=n,s},sendEmail:function(e){this.context.kendoGrid._progress&&this.context.kendoGrid._progress(!0);for(var t=[],i=Math.ceil(e.length/10),n=0;n<i;n++){var a=e.splice(e.length-10,10),o=sforce.connection.sendEmail(a);t=t.concat(o)}return this.context.kendoGrid._progress&&this.context.kendoGrid._progress(!1),t},createEmailMessages:function(e,t,i){for(var n=e,a=[],o=[],r=[],s=0;s<t.results.length;s++){var l=t.results[s];i||(o=[]);for(var d=!1,c=0;c<t.fields.length;c++){var u=t.fields[c],f=l[u];f&&(o.indexOf(f)===-1&&o.push(f),d=!0)}i||a.push(this.singleEmailMessage(n.replyTo,o,n.subject,n.body,!0,l.Id,"WhoId"===l.Type)),d&&r.push(l.Id)}return i&&a.push(this.singleEmailMessage(n.replyTo,o,n.subject,n.body,!0)),{singleEmailMessages:a,activityHistoryIds:r}},ui:function(){var e=this,t=e.context.actionGrid.settings.id,n="compose_email_window",a=e.context.actionGrid.getElementId(n),o=n+"_replyToText",c=n+"_subjectText",u=n+"_emailComboBox",f=n+"_kendoEditor",p=t+"_"+f,h=n+"_chkIndividualEmails",g=n+"_chkIndividualEmailsHelpIcon",m=n+"_multiSelectHelpIcon",v=n+"_buttonApply",b=n+"_buttonCancel",y=function(e){return"#"+e},k=!1,w=!1,x=!1,I=window.innerHeight<=643?window.innerHeight-60:615,S=function(){var e=$(y(v)).data("kendoButton");k&&w&&x?e.enable(!0):e.enable(!1)};$(a).data("kendoWindow")&&($(a).data("kendoWindow").destroy(),$(a).empty());var C=localStorage[n];e._localStorage=C?JSON.parse(C):{individualEmails:!0},$("body").append(kendo.format('<div id="{0}_{1}" style="display:none; text-align:center;">{2}</div>',t,n,"<div class='k-content' style='padding-top:0.3em; padding-left: 0.25em; text-align:left; overflow:hidden;'>"+kendo.format('<div style="padding:0.1em;"> <input style="width:300px" class="ag-email-textbox" placeholder="ReplyTo" autocomplete="off" maxlength="255" id="{0}" value="{1}" /></div>',o,i.getUserInfo().userEmail)+kendo.format('<div style="padding:0.1em;"> <input style="width:300px" class="ag-email-textbox" placeholder="Subject" autocomplete="off" maxlength="255" id="{0}" /></div>',c)+"</div>"+kendo.format('<div style="width:100%; height:{0}px; max-height:{0}px; padding:0.3em; overflow:hidden">',I-110)+"<div><div>"+kendo.format('<textarea id="{0}" rows="10" cols="30" style="height:{1}px"/>',p,I-110)+"</div></div></div><div style='padding-top:0.3em; overflow:hidden'>"+kendo.format("Send as individual emails <span class='k-icon k-i-info {2}'></span> <input id='{0}' type='checkbox' {1}/> &nbsp; &nbsp;",h,e._localStorage.individualEmails?"checked='checked'":"",g)+kendo.format("<span id='{0}' class='k-button'> Send </span> &nbsp; &nbsp;",v)+kendo.format("<span id='{0}' class='k-button'> Cancel </span>",b)+"</div>"));"<div class='k-content' style='padding-top:0.3em;'>"+kendo.format('<div style="padding:0.1em;"> <input id="{0}" placeholder="Select email..." style="width: 300px" /></div>',u)+"</div>";a=$(a).kendoWindow({title:"New Email",height:I,maxHeight:I,minHeight:I,width:845,minWidth:780,visible:!1,modal:!0,animation:{open:{effects:"fade:in"}}}),$(y(p)).kendoEditor({resizable:!1,content:!0,toolbar:!0,tools:[{name:"Address",template:kendo.format('<input id="{0}" style="width: 200px" disabled="true" /> <span class="k-icon k-i-note {1}"></span>',u,m)},"formatting","bold","italic","underline","justifyLeft","justifyCenter","justifyRight","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink","insertImage","createTable","addColumnLeft","addColumnRight","addRowAbove","addRowBelow","deleteRow","deleteColumn"],keyup:function(e){w=this.value().length>0,S()},change:function(){w=this.value().length>0,S()}}),$("."+g).off("click"),$("."+g).on("click",function(){var e=$("<div>").kendoTooltip({filter:"label",width:225,position:"right",autoHide:!1,content:"<b>Checked</b>: Every selected row will get a seperate email. <br><b>Unchecked</b>: One email with all addresses, from every selected row, on the same email."}).data("kendoTooltip");e.show($(this))});var D=r(e.context),N=$(y(u));D&&D.length>0?($("."+m).hide(),N.attr("disabled",!1),N.kendoMultiSelect({dataTextField:"label",dataValueField:"value",placeholder:"Required - Select email…",dataSource:D,enable:!0,change:function(e){this.value();x=this.value().length>0,S()}})):(N.val("Email fields not available…"),N.addClass("k-textbox"),$("."+m).off("click"),$("."+m).on("click",function(){var e=$("<div>").kendoTooltip({filter:"label",width:225,position:"right",autoHide:!1,content:"<b>Email Address Fields</b><br>Options include standard Salesforce and custom email address fields for this object.<br> Parental email fields also get populated when on the grid."}).data("kendoTooltip");e.show($(this))})),$(y(v)).kendoButton({enable:!1,click:function(t){e._localStorage.individualEmails=$(y(h)).is(":checked"),localStorage[n]=JSON.stringify(e._localStorage);var i={replyTo:$(y(o)).val(),subject:$(y(c)).val(),emailFields:$(y(u)).data("kendoMultiSelect").value(),body:$(y(p)).data("kendoEditor").value()},r=s(e.context,i.emailFields,e.context.objectDescribe.name),f=e.createEmailMessages(i,r,!e._localStorage.individualEmails),g=e.sendEmail(f.singleEmailMessages);if(!e._localStorage.individualEmails&&g&&g[0]&&g[0].success&&"true"==g[0].success){var m=function(){d(g),$(a).data("kendoWindow").close().destroy()};l(e.context,f.activityHistoryIds,f.singleEmailMessages[0],objectType,m)}else d(g),$(a).data("kendoWindow").close().destroy()}}),$(y(b)).kendoButton({click:function(t){e._localStorage.individualEmails=$(y(h)).is(":checked"),localStorage[n]=JSON.stringify(e._localStorage),$(a).data("kendoWindow").close().destroy()}}),$(y(c)).bind("change",function(){k=$(this).val().length>0,S()}),a.data("kendoWindow").center().open()},click:function(e){var t=this;t.context=e,t.ui()}},g={isAvailable:function(e){switch(e.objectDescribe.name.toLowerCase()){case"contact":case"lead":return!0;case"account":return o();default:return!1}},getLabel:function(e){return"Batch"},createSubmenuItems:function(e){return[]},massEmailMessage:function(e,t,i,n){var a=new sforce.MassEmailMessage;return a.targetObjectIds=e,a.replyTo=i,a.templateId=t,""!=n&&void 0!=n&&(a.description=n),sendMailRes=sforce.connection.sendEmail([a])},click:function(t){var n=this;if(t.selectedRows.length>0){var a=[];t.selectedRows.map(function(e){a.push(e.Id)}),e.entry("Batch Send Email",[{referenceTo:"EmailTemplate",name:"Id",label:"Template",type:"reference",required:!0},{name:"ReplyTo",label:"Reply To",type:"text",value:i.getUserInfo().userEmail,required:!0},{name:"Name",label:"Mass Email Name",type:"text",value:"",required:!1}],{width:350,objectName:"EmailTemplate"},null,function(e){var r=e.Id.value,s=e.ReplyTo.value,l=e.Name.value;if("Account"===t.objectDescribe.name&&o()){for(var c=i.query("SELECT Id, PersonContactId FROM Account WHERE Id IN('"+a.join("','")+"')"),u=[],f=0;f<c.length;f++)u.push(c[f].PersonContactId);d(n.massEmailMessage(u,r,s,l))}else d(n.massEmailMessage(a,r,s,l))})}}},m={orgHasPersonAccounts:o,objectType:c,hasActivities:u,getEmailFields:r,queryEmailData:s,createActivityHistory:l,onFinish:d,emailToForm:f,singleEmail:h,batchEmail:g,actions:[f,g,h,p],isAvailable:function(e){if(e.selectedRows.length>0&&n.getSetting(e.objectDescribe.name,"batchEmail")!==!1){var t=!1;return Object.each(this.actions,function(i){i.isAvailable(e)&&(t=!0)}),t}return!1},getLabel:function(e){return"Send Email..."},createSubmenuItems:function(e){return this.actions},click:function(e){}};return m}),crmc.define("DrawLoop",["sfdc","marketing","KendoPopup","CustomSettings"],function(e,t,i,n){var a={appName:"Loop",maxRows:1e3,getAppNamespace:function(){return this.appName},getLabel:function(e){return"DrawLoop"},isAvailable:function(e){return n.getSetting(e.objectDescribe.name,"Loop","action")!==!1},click:function(t){var n=$('<iframe style="display:none;"/>').appendTo($("body"));$(n).attr("src","/apex/Loop__loop?"),n[0].onload=function(){if(t.selectedRows.length>a.maxRows)i.popup("Max Records Limit!","Currently, we don't allow more than "+a.maxRows+" records to be mapped!");else if(t.selectedRows.length>0){var o=[];Object.each(t.selectedRows,function(e){o.push(e.Id)});var r="masslooplus?";r+="&recordIds="+o.join(","),e.navigateToVFPage(a.appName,r,void 0,!0)}else i.popup("Please select records","Select at least one record to send to DrawLoop");$(n).remove()}}};return a}),crmc.define("FindReplace",["KendoEntry","KendoPopup","sfdc","CustomSettings","GridConstants"],function(e,t,i,n,a){return{isBatchEditItem:!0,getLabel:function(e){return"Find/Replace"},isAvailable:function(e){var t=e.objectDescribe&&["true",!0].indexOf(e.objectDescribe.updateable)>-1,i=n.getSetting(e.objectDescribe.name,"findReplace")!==!1,a=e.selectedRows.length>0;return i&&a&&t},click:function(n){function o(e){return[{label:"Send To Console",click:function(){$.each(e,function(e,t){t.errors&&console.log(t.errors)})}},{label:"Ok"}]}function r(){for(var e=[],t=0;t<u.length;t++)s(u[t].type)&&u[t].name.indexOf(".")===-1&&e.push({active:"true",defaultValue:"false",label:u[t].displayName,value:u[t].name});return e}function s(e){switch(e.toUpperCase()){case"STRING":return!0;case"TEXTAREA":return!0;case"PHONE":return!0;case"EMAIL":return!0;default:return!1}}function l(e,t){e instanceof Array||(e=[e]);var i,n=200,a=[],o=e.length/200,r=0,s=function(e){a=a.concat(e),r++,r>=o&&"function"==typeof t&&t(a)};for(i=0;i<e.length;i+=n)sforce.connection.update(e.slice(i,i+n),{onSuccess:s,onFailure:s})}function d(e){for(var i=[],a=0;a<f.length;a++){var o=new sforce.SObject(n.objectDescribe.name),r=f[a][e.apiValue];if(void 0===r&&""===e.oldValue)o.Id=f[a].Id,o[e.apiValue]=e.newValue,i.push(o);else if(void 0!=r&&""!=e.oldValue){var s=r.replace(e.oldValue,e.newValue);s||(s=null),s!=f[a][e.apiValue]&&(o.Id=f[a].Id,o[e.apiValue]=s,i.push(o))}}i.length>0?i.length>200?l(i,m):sforce.connection.update(i,{onSuccess:m,onFailure:g}):(n.kendoGrid._progress&&n.kendoGrid._progress(!1),t.popupWithButtons("Warning","No records to update",h,{grid:n.actionGrid,width:150}))}function c(e){function t(t){setTimeout(function(){var i=function(){for(var t=0;t<n.kendoGrid.columns.length;t++)if(n.kendoGrid.columns[t].field===e.apiValue)return t},a=f[t][e.apiValue],o=(n.kendoGrid.columns[t],$(kendo.format("{2} tr[data-uid={0}] td:not(.k-group-cell,.k-hierarchy-cell):eq({1})",f[t].uid,i(),n.actionGrid.getElementId("grid"))));if(void 0===a&&""===e.oldValue)n.kendoGrid.editCell(o),f[t].set(e.apiValue,e.newValue);else if(void 0!=a&&""!=e.oldValue){var r=a.replace(e.oldValue,e.newValue);r!=a&&(n.kendoGrid.editCell(o),f[t].set(e.apiValue,r))}t==n.selectedRows.length-1&&(n.kendoGrid.editCell(o),n.kendoGrid._progress&&n.kendoGrid._progress(!1))},100)}n.kendoGrid._progress&&n.kendoGrid._progress(!0);for(var i=0;i<f.length;i++)t(i)}var u=n.actionGrid.fieldMeta,f=n.selectedRows,p=[],h=[{label:"Ok"}],g=function(e){try{return"<li> Status Code: "+e.statusCode+", Message: "+e.message+"</li>"}catch(e){alert("Error: "+e)}},m=function(e){var r=["<style>div.overflow{overflow: auto; max-height: 600px;}</style><div><div class='overflow'><ul>"];if($.each(e,function(e,t){return t.errors?void r.push(g(t.errors)):void p.push(t.id)}),e.length==p.length){n.kendoGrid._progress&&n.kendoGrid._progress(!1);var s=kendo.format("{0} Record"+(1===p.length?"":"s")+" updated, would you like to ActionGrid the result"+(1===p.length?"":"s")+"?",p.length),l="Update Results",d=[{label:"Yes",click:function(){if(n.selectedRows.length>200){var e={retURL:n.actionGrid.settings.pageURL,object:n.objectDescribe.name},t={Ids:p.join()};i.postToVFPage(a.namespace,"crmc_grid",e,t,!0)}else window.open(kendo.format("/apex/CRMC_PP__crmc_grid?object={0}&Ids={1}",n.objectDescribe.name,p.join()))}},{label:"No"}];t.popupWithButtons(l,s,d,{grid:n.actionGrid}),n.actionGrid.refresh()}else n.kendoGrid._progress&&n.kendoGrid._progress(!1),r.push("</ul></div></div>"),t.popupWithButtons("Batch Update Errors",r.join(""),o(e),{grid:n.actionGrid,width:700})},v=function(e){var t="";if(e.Columns.value||(t+="Select a column."),!e.OldValue.value&&!e.NewValue.value){var i="Old Value or New Value must be filled out.";t+=t.length>0?"<li>"+i+"</li>":i}return t},b=r();b.length>0?e.entry("Replace With...",[{name:"Columns",label:"Column",type:"picklist",values:b,required:!0,validate:v},{name:"OldValue",label:"Old Value",type:"text",required:!0},{name:"NewValue",label:"New Value",type:"text",required:!0}],{grid:n.actionGrid,width:350},null,function(e){var i={apiValue:e.Columns.value,oldValue:e.OldValue.value,newValue:e.NewValue.value};if(""==i.oldValue&&""==i.newValue)t.popupWithButtons("Warning","No values were specified",h,{grid:n.actionGrid,width:150});else{var a=[{label:"EditMode",click:function(){n.actionGrid.settings.editable=!0,n.actionGrid.enterEditMode()}},{label:"Continue",click:function(){d(i)}},{label:"Cancel"}],o=["<ul>","<li> EditMode: Enables edit mode in the current ActionGrid to preview the changes.</li>","<li> Continue: Makes the changes, saves, reloads the current ActionGrid.</li>","<li> Cancel: Cancels the current operation.</li>","</ul>"].join("");n.actionGrid.settings.hasOwnProperty("editable")&&n.actionGrid.settings.editable?c(i):t.popupWithButtons("Continue or preview in edit mode?",o,a,{grid:n.actionGrid,width:450})}}):t.popupWithButtons("No Supported Fields","There are no supported fields in the view.",h,{grid:n.actionGrid,width:250})}}}),crmc.define("AutoFillMenuItem",["KendoPopup","CustomSettings"],function(e,t){var i={getLabel:function(e){return"Fill Down"},isAvailable:function(e){var i=!1;return e.actionGrid.settings.editable&&e.selectedRows.length>1&&e.actionGrid.gridDataSource.hasChanges()&&(i=e.actionGrid.settings.enableAutoFill&&t.getSetting(e.actionGrid.settings.pageInfo.objectName,"autoFill")!==!1),i},click:function(e){var t=e.actionGrid;t.fillDown()}};return i}),crmc.define("MassUpdateInline",["sfdc","KendoPopup","KendoEntry","CustomSettings","marketing","GridConstants","Notification","FormulaHelpers"],function(e,t,i,n,a,o,r,s){var l={label:"Mass Update",getLabel:function(e){return this.label},getPageInfo:function(t){var i=Object.copy(t.actionGrid.settings.pageInfo);if(!(i.filterId||i.sorts&&0!==i.sorts.length)){var n=e.getSObjectNameField(t.objectDescribe);n&&(i.sorts=[{field:n,dir:"asc"}])}return i.filter&&i.filter.filters&&i.filter.filters.length&&i.filter.filters.map(function(t){if(t&&t.value&&t.value instanceof Date){var i=e.getDateWithOffset(t.value,e.getProfileTimezoneOffset());t.value=i.toISOString()}}),void 0!==t.actionGrid.settings.baseFilter&&(void 0===i.filter&&(i.filter={logic:"and"}),i.filter||(i.filter={}),void 0===i.filter.filters&&(i.filter.filters=[]),i.filter.filters.push(t.actionGrid.settings.baseFilter)),delete i.displayColumns,delete i.childGridSettings,i},batchUpdateApex:function(i,n,a){var o=this,r=(e.getNamespace(!1),i.selectedRows[0].Id.substr(0,3)),s=e.query("SELECT Id,ParentJobId,Status,LastProcessed FROM AsyncApexJob WHERE LastProcessed LIKE '"+r+"%'AND Status = 'Processing'"),l=function(){e.executeRemoteAction("batchUpdate",[o.getPageInfo(i),n,a],function(e,i){i.status&&(t.popup("Mass Update Started","A Mass Update has been started.  You will receive an email when it is complete."),console.log(e))})};s.length>0?t.popup("Scheduled Apex Already Running!","An existing Scheduled Apex job is running on that object, you may have locked records.  Are you sure you want to continue?","OK",l):l()},warnRecordTypes:function(i,n,a){var o=i.selectedRows;if(n){var r=o.every(function(e){return!!(e.RecordTypeId==n||e.RecordType&&e.RecordType.Id==n)||(t.popup("Mixed Record Types","Selection contains more than one Record Type. It is possible to Mass Update fields to an invalid value for a Record Type if you continue.","Continue",a,"Cancel"),!1)});r&&a()}else{for(var s=0,l=750,d=o.map(function(e){return e.Id}),c=[];s<d.length;){var u=e.query("SELECT COUNT(Id) cnt, RecordTypeId FROM {0} WHERE Id in ('{1}') GROUP BY RecordTypeId",i.actionGrid.settings.pageInfo.objectName,d.slice(s,s+l).join("','"));if(Object.each(u,function(e){c.indexOf(e.RecordTypeId)<0&&c.push(e.RecordTypeId)}),c.length>1)break;s+=l}c.length>1?t.popup("Mixed Record Types","Selection contains more than one Record Type. It is possible to Mass Update fields to an invalid value for a Record Type if you continue.","Continue",a,"Cancel"):a()}},promptMassUpdate:function(e,t,a,o){var r=!1,s=[];Object.each(e.actionGrid.fieldMeta,function(i){var o=e.actionGrid.settings.pageInfo.columns.indexOf(i.name),l=Object.first(e.actionGrid.settings.hiddenColumns,function(e){return e==i.name}),d=i.name.indexOf(".")>-1,c=i.name;i.parentMeta&&(i=i.parentMeta,d=!1);var u=i.type.toLowerCase();if(!l&&!d&&o>-1&&"base64"!=u&&!i.isReadonly&&n.getSetting(e.objectDescribe.name,c,"fieldMassUpdate")!==!1){var f=Object.first(e.actionGrid.settings.metadata.fields,function(e){return e.name==i.name});if(f){var p={name:i.name,label:i.displayName,type:u,values:[].concat(i.picklistValues),referenceTo:i.relObjectName,colIndex:o};(f.dependentPicklist||t&&"picklist"==u||"CampaignMember"==e.objectDescribe.name&&"Status"==i.name)&&(p.dependentPicklist=function(n){return t&&!n.model.hasOwnProperty("RecordType")&&a.RecordType&&(n.model.recordType={Id:a.RecordTypeId||a.RecordType.Id}),n.model.Id=a.Id,e.actionGrid.getPicklistValues(i.name,i.picklistValues)(n)}),"double"==u?p.precision=i.precision:"reference"==u&&(p.fullMeta=f,r=!0),s.push(p)}}}),s=s.sort(function(e,t){return e.colIndex-t.colIndex});var l=!o;l=l&&n.getSetting(e.objectDescribe.name,"formulaMassUpdate")!==!1,l=l&&n.getSetting(e.objectDescribe.name,"formulaFields")!==!1;var d={includeCheckboxes:!0,hasDependency:!0,resizable:!1,autoSizeFields:!0,width:"25%",grid:e.actionGrid,allowFormulas:l};r&&(d.id=a.Id,d.keyPrefix=e.actionGrid.settings.metadata.keyPrefix,d.objectName=e.objectDescribe.name,d.fkField=e.actionGrid.settings.fkField,d.fkValue=e.actionGrid.settings.fkValue);i.entry("Mass Update",s,d,e.actionGrid.settings,this.entryFunctionFactory(e,o))},entryFunctionFactory:function(t,i){var n=this,a=t.selectedRows;return function(o){var l=Object.first(o,function(e){return e.isChecked});if(l)if(i){var d=[],c={sobjectType:t.objectDescribe.name};Object.each(o,function(e){e.isChecked&&(void 0!==e.value&&""!==e.value||(e.value=null),e.rawValue&&e.rawValue instanceof Date&&(e.value=e.rawValue.valueOf()),c[e.name]=e.value,d.push(e.name))}),n.batchUpdateApex(t,d,c)}else{var u=[];Object.each(a,function(e){var i=new sforce.SObject(t.objectDescribe.name);i.Id=e.Id,Object.each(o,function(t){if(t.isChecked&&(void 0!==t.value&&""!==t.value||(t.value=null),i[t.name]=t.value,t.isFormula)){var n=t.formula;n&&(i[t.name]=s.parseFormula(n,e))}}),u.push(i)}),e.batchUpdate(u,n.finishFunctionFactory(t))}else r.showMessage({title:"Mass Update",message:"No records updated"})}},finishFunctionFactory:function(i){var n=i.selectedRows;return function(a){for(var o,s=0,l=0,d=[],c=[],u=0;u<a.length;u++){var f=a[u];"true"==f.success?(s++,c.push(f.id)):(l++,void 0!=f.errors&&void 0!=f.errors.message?(o||(o=e.getSObjectNameField(i.objectDescribe)),d.push('<a href="'+e.getRecordURL(n[u].Id)+'" target="_blank">'+n[u][o]+"</a> | "+f.errors.message)):f.faultstring&&d.push(f.faultstring))}var p="Successfully updated "+s+" record"+(1==s?"":"s")+"!",h=[{label:"Ok"}];0==s&&(p="Mass Update Unsuccessful!"),l>0?(p+='\n The following errors occurred: <br /><div style="overflow:auto;max-height:300px;"><ul><li>'+d.join("\n</li><li>")+'</li></ul></div><br /> Contact <a href="mailto:support@getactiongrid.com">support@getactiongrid.com </a>',t.popupWithButtons("Mass Update Results",p,h)):r.showMessage({title:"Mass Update",message:"Successfully updated records."},"success"),i.actionGrid.refresh()}},isAvailable:function(e){return!!(e.selectedRows.length>0&&e.objectDescribe&&["true",!0].indexOf(e.objectDescribe.updateable)>-1)&&n.getSetting(e.objectDescribe.name,"massUpdateInline")!==!1},click:function(i){var r=this,s=i.selectedRows,l=s[0],d=n.getSetting(i.objectDescribe.name,"massUpdateBatch")===!0,c=function(e){var t=i.objectDescribe.recordTypeInfos&&i.objectDescribe.recordTypeInfos.length>0,n=function(){r.promptMassUpdate(i,t,l,e)};if(t){var a;(l.RecordTypeId||l.RecordType&&l.RecordType.Id)&&(a=l.RecordTypeId||l.RecordType.Id),r.warnRecordTypes(i,a,n)}else n()};if(s.length>0)if(d&&i.actionGrid.gridDataSource&&i.actionGrid.gridDataSource.totalPages()>1&&s.length==i.actionGrid.gridDataSource.pageSize()){useApex=!0;var u=i.actionGrid.gridDataSource.total();u=(u>=1e4?"more than 10,000":u)+" results!",t.popupWithButtons("Mass Update","Would you like to mass update all pages matching the current filter or only the first page? </br> <span style='color: #d30000'>WARNING:</span> All pages will update "+u,[{label:"All Pages",click:function(){var t=e.getNamespace(!1);t&&t.length>0&&(t+=".");var i=Visualforce.remoting.Manager.getController(t+o.VF_APEX_CONTROLLER);i&&i.batchUpdate?c(!0):a.missingApp("crmc_pp")}},{label:"This Page Only",click:function(){c(!1)}},{label:"Cancel"}])}else c(!1);else t.popup("Please select records","Select at least one record to Mass Update.")}};return l}),crmc.define("BatchEdit",["CustomSettings","FindReplace","AutoFillMenuItem","MassUpdateInline","MassUpdateMenuItem"],function(e,t,i,n,a){return{submenus:[i,t,n],isAvailable:function(e){var t=!1;return Object.each(this.submenus,function(i){i.isAvailable(e)&&(t=!0)}),t},getLabel:function(e){return"Batch Edit..."},createSubmenuItems:function(e){return this.submenus},click:function(e){}}}),crmc.define("SortAction",[],function(){var e=function(e,t){return{isHeaderAvailable:function(e){var i=e.actionGrid.gridDataSource,n=e.selectedColumn&&e.selectedColumn.field,a=e.selectedColumn&&e.selectedColumn.sortable,o=i.sort(),r=Object.first(o,function(e){return e&&e.field==n&&e.dir==t});return n&&a&&!r},getLabel:function(t){return e},click:function(e){var i=e.actionGrid.gridDataSource,n=i.sort(),a=n||[],o=e.selectedColumn&&e.selectedColumn.field,r=Object.first(n,function(e){return e&&e.field==o});r?r.dir=t:a.push({field:o,dir:t}),i.sort(a)}}};return e}),crmc.define("FreezeColumnAction",[],function(){var e={getLabel:function(e){var t=e.selectedColumn&&e.selectedColumn.locked;return t?"Unfreeze Column":"Freeze Column"},isHeaderAvailable:function(e){return void 0!=e.selectedColumn},click:function(e){var t=e.selectedColumn&&e.selectedColumn.locked;t?(e.kendoGrid.unlockColumn(e.selectedColumn.field),2==e.actionGrid.getLockedColumns().length&&(e.actionGrid.settings.lockedColumns=!1,e.actionGrid.preserveSelectedRows(e.actionGrid.settings.editable))):e.actionGrid.settings.lockedColumns?e.kendoGrid.lockColumn(e.selectedColumn.field):(e.actionGrid.settings.lockedColumns=!0,e.actionGrid.preserveSelectedRows(e.actionGrid.settings.editable,!1,!1,function(t){t.kendoGrid.lockColumn(e.selectedColumn.field)}))}};return e}),crmc.define("ColumnMenu",["KendoEntry","CustomSettings","ColumnFactory"],function(e,t,i){var n={customOrder:!0,getLabel:function(e){return"Column Settings…"},isHeaderAvailable:function(e){return void 0!=e.selectedColumn&&t.getSetting(e.objectDescribe.name,"columnSettings")!==!1},click:function(i){var n,a={},o=i.selectedColumn,r=Object.first(i.actionGrid.settings.metadata.fields,function(e){if(e.name==o.name)return!0;if("reference"==e.type){var t=o.name.split(".");return t[0]==e.relationshipName&&(a[t[0]]={},a[t[0]].Name="",a.id="",!0)}}),s=[{name:"readOnly",label:"Read Only",type:"boolean",value:i.selectedColumn.readOnly}],l={name:"required",label:"Required",type:"boolean",value:i.selectedColumn.required};o.schema.sfRequired&&(l.value=void 0,l.type="html",l.html='<input type="checkbox" disabled checked> <label>Column is required by Salesforce. <label>'),"boolean"!=o.schema.type.toLowerCase()&&s.push(l),i.selectedColumn.schema.editable&&(o.name.indexOf(".")<0||!o.schema.isParentField)&&(["text","string","email","url"].indexOf(r.type)==-1?s.unshift({name:"defaultValue",label:"Default Value",type:"custom",init:function(e){var t=o.editor(e,{field:o.name,model:a}),s=$("#"+this.id),l=i.selectedColumn.defaultValue;switch(r.type){case"reference":s.children(".k-combobox").css("width",s.children(".k-dropdown").length>0?"75%":"88%"),l&&t.value(l);break;case"picklist":case"combobox":case"currency":case"int":case"double":case"percent":case"date":case"datetime":case"datetimepart":case"time":s.children().css("width","97%"),l&&t.value(l);break;case"boolean":l&&t.prop("checked",l);break;case"multipicklist":s.children().css("width","97%"),
l&&t.value(l.split(";"));break;default:s.children().css("width","97%"),l&&s.children().val(l)}this.getValue=function(){switch(r.type){case"reference":n=t.dataItem();case"picklist":case"combobox":case"currency":case"int":case"double":case"percent":case"date":case"datetime":case"datetimepart":case"time":return t.value();case"boolean":return t.prop("checked");case"multipicklist":return t.value().join(";");default:var e=$("#"+this.id).children();return e.val()}}}}):s.unshift({name:"defaultValue",label:"Default Value",type:"text",value:i.selectedColumn.defaultValue}));var d=t.getSetting(i.objectDescribe.name,"renameColumn")!==!1;d&&s.unshift({name:"label",label:"Label",type:"text",value:i.selectedColumn.title}),e.entry("Column Settings",s,{},i.actionGrid.settings,function(e){var t=e.defaultValue?e.defaultValue.value:"";"reference"==r.type?n?(i.selectedColumn.defaultValue=n.Name?n.Name:n.text,i.selectedColumn.defaultId=n.Id?n.Id:n.value):(i.selectedColumn.defaultValue=void 0,i.selectedColumn.defaultId=void 0):i.selectedColumn.defaultValue=t,d&&(i.selectedColumn.title=e.label.value),i.selectedColumn.readOnly=e.readOnly.value,i.selectedColumn.required=e.required&&e.required.value,i.actionGrid.refresh()})}};return n}),crmc.define("ActionGridDelegate",["sfdc","marketing","ActionItem","ExportMenuItem","ViewMenuItem","BatchAddNew","BatchAddCampaignMemberMenuItem","MassUpdateMenuItem","AWMergeMenuItem","BatchAddToEmmaGroup","Geopointe","BatchDelete","ListBrowse","MapAnything","CongaConductor","SummarizeAction","BatchClone","BatchEmail","DrawLoop","BatchEdit","SortAction","FreezeColumnAction","ColumnMenu","tooling","mixpanel","extensions"],function(e,t,i,n,a,o,r,s,l,d,c,u,f,p,h,g,m,v,b,y,k,w,x,I,S){var C=[s,l,d,f,h,c,p,b],D=[s,b],N={},T=[],_={getLabel:function(e){return"<hr/>"},isAvailable:function(e){return F(e)}},O={getLabel:function(e){return"Not Installed"},isAvailable:function(e){return F(e)},createSubmenuItems:function(e){return Array.orderBy(T,function(t){return t.getLabel(e)})}},R={submenus:[],getLabel:function(e){return"Map Records..."},isAvailable:function(e){var t=!1;return Object.each(this.submenus,function(i){i.isAvailable(e)&&(t=!0)}),t},createSubmenuItems:function(e){return this.submenus}},j=function(e,t){var i=document.createElement("script");t&&(i.onload=t),document.getElementsByTagName("HEAD").item(0).appendChild(i),i.src=e},E=[o,y,n,a,u,g,m,v,k("Add Ascending Sort","asc"),k("Add Descending Sort","desc"),w,x];crmc="undefined"==typeof crmc?{}:crmc,crmc.addCustomAction=function(e){Object.each(i,function(t,n){e[n]||(e[n]=i[n])}),e.isBatchAddItem?o.submenus.push(e):e.isBatchEditItem?y.submenus.push(e):E.push(e),e.isCustom=!0,$(document).trigger("addCustomAction",e)},crmc.addReadingPane=function(e){$(document).trigger("customRPLoad",[e.itemID,e])};var F=function(e){var t=!1;return Object.each(T,function(i){i.isAvailable(e)&&(t=!0)}),t},P=function(){var e=[];return Object.each(C,function(t){if(t.getAppNamespace&&"function"==typeof t.getAppNamespace){var i=t.getAppNamespace();i&&i.length>0&&("string"==typeof i?e.push(i):Object.each(i,function(t){e.push(t)}))}}),e},A=function(){var i=[],n={};Object.each(C,function(e){if(e.getAppNamespace&&"function"==typeof e.getAppNamespace){var t=e.getAppNamespace();t&&t.length>0&&("string"==typeof t?(i.push(t),n[t]=e):Object.each(t,function(t){i.push(t),n[t]=e}))}}),i.length>0&&e.getLicensedPackages(i,function(e,l){if(l.status){var u=this.customItems||[];C=[],Object.each(i,function(i){var a=Object.first(e,function(e){return e===i}),o=n[i],r=Object.first(T,function(e){return Object.getPrototypeOf(e)==o}),s=T.indexOf(r),l=C.indexOf(o),d=D.indexOf(o)<0;a?(o.appName=i,C.push(o),s>-1&&T.splice(s,1)):l==-1&&s==-1&&d&&(o=Object.create(o),o.click=function(){t.missingApp(i)},T.push(o))}),Object.each(C,function(e){e===r?o.submenus.indexOf(r)==-1&&o.submenus.push(r):e===d?o.submenus.indexOf(d)==-1&&o.submenus.push(d):e===f?a.submenus.indexOf(f)==-1&&a.submenus.push(f):e===c?(R.submenus.indexOf(c)==-1&&R.submenus.push(c),E.indexOf(R)==-1&&E.push(R)):e===p?(R.submenus.indexOf(p)==-1&&R.submenus.push(p),E.indexOf(R)==-1&&E.push(R)):e===s?y.submenus.indexOf(s)==-1&&y.submenus.push(e):E.indexOf(e)===-1&&E.push(e)}),!this.customItems&&e&&e.length>0&&(e.map(function(e){e.indexOf("CustomAction:")>-1&&u.push(e.split("CustomAction:")[1])}),this.customItems=u),Object.each(u,function(e){N[e]||(j(String.format("/resource/{0}/{1}",Date.now(),e)),N[e]=e)})}else T=C,C=[]})},L=function(e,t,n){Object.each(i,function(t,n){e[n]||(e[n]=i[n])});var a=[];return Object.each(e.createSubmenuItems(t),function(e){e.isAvailable&&!e.isAvailable(t)||a.push(L(e,t))}),{customOrder:n,label:e.getLabel(t),click:function(i){e.click(t)},isCustom:e.isCustom,items:a.length>0?a:void 0}},M={appNameSpaces:P(),getActionItems:function(e){var t=Object.where(E,function(t){var i=!1;try{i=e.isHeader?t.isHeaderAvailable&&t.isHeaderAvailable(e):e.isToolbar?t.isToolbarAvailable&&t.isToolbarAvailable(e):t.isAvailable&&t.isAvailable(e)}catch(e){console.log("Unhandled exception in Action item isAvailable function, offending item follows: "+e),console.log(t),S.trackException(e)}return i}),i=[];return Object.each(t,function(t){try{i.push(L(t,e,t.customOrder))}catch(e){console.log("Unhandled exception in Action item, offending item follows: "+e),console.log(t),S.trackException(e)}}),e.isHeader||e.isToolbar||!F(e)||(i.push(L(_,e,!0)),i.push(L(O,e,!0))),i},selectionChanged:function(){},rowDoubleClick:function(){},createColumn:function(){},createInNewWindow:function(){var t,i=this,n=i.settings.metadata.keyPrefix+"/e";if(i.settings.newButtonURL&&i.settings.newButtonURL.length>0)n=i.settings.newButtonURL;else if(i.settings.metadata&&i.settings.metadata.recordTypeInfos&&i.settings.metadata.recordTypeInfos.length>0){var a=Object.where(i.settings.metadata.recordTypeInfos,function(e){return"true"===e.available});if(a.length>1&&(t=t||{},t.ent=i.settings.pageInfo.objectName,t.save_new_url=n,n="setup/ui/recordtypeselect.jsp","true"===i.settings.metadata.custom))return void I.getCustomObjectId(i.settings.pageInfo.objectName,function(i){t.ent=i,e.navigateToPage(n,t,!0)},function(e){console.log("Error retrieving custom object id for object "+i.settings.pageInfo.objectName),console.log(JSON.stringify(e))})}e.navigateToPage(n,t,!0)},dataReady:function(t){if(!this.firstTime&&(A(t),this.firstTime=!0,"undefined"!=typeof CRMC_PP&&"undefined"!=typeof CRMC_PP.DrillUpController||"undefined"!=typeof DrillUpController)){var i={remoteActions:{getDrillUpItemsForObject:e.getRemoteAction("DrillUpController","getDrillUpItemsForObject"),getDrillDownItemsForObject:e.getRemoteAction("DrillUpController","getDrillDownItemsForObject")}};crmc.require(["DrillUpMenuItem"],function(e){e.init([t.actionGrid],i)})}}};return M}),crmc.define("MultiSelectGridFilter",["GridConstants","sfdc","mixpanel"],function(e,t,i){var n=kendo.ui,a=n.Widget,o=a.extend({init:function(n,o){var r=this;a.fn.init.call(r,n,o);var s,l,d,c,u,f,p,h,g,m=[],v=[],b=null,y=!1,k=0,w=!1,x=!1,I=r.options.fieldMeta.type.toLowerCase(),S="child"==I,C="multipicklist"==I,D=$.inArray(I,["datepart","datetimepart"])>-1,N=!1,T=50,_=r.options.fieldMeta.parentMeta&&r.options.fieldMeta.parentMeta.relObjectName&&"user"==r.options.fieldMeta.parentMeta.relObjectName.toLowerCase();D&&(I=I.split("part")[0]);var O=r.options.field;if(S){var R=r.options.fieldMeta.childFieldName.split(",");O=R[0]}var j=1==S?r.options.fieldMeta.name+"!"+O:O,E=1==S?r.options.fieldMeta.relObjectName:r.options.objectName,F=[O],P=O.split("."),A=P[P.length-1],L=$.map(F,function(e){return{field:e}}),M=function(){r.element.parent().css("top",0),0==C&&We.value("in"),""==We.value()&&(1==C?We.element.val("or"):We.element.val("in"));var e=null,i=null,n=q(r.options.fieldMeta.name);n.length>0&&$.each(n,function(t,n){"notexists"==n.operator||"exists"==n.operator?e=n.operator:"dynamic"==n.operator&&(i=n.value)});var a=function(e,i,n){var a=n.length>0,o="kendoDatePicker",s=Ge;"datetime"==e&&(o="kendoDateTimePicker",s=_e);var l=r.element.find("input."+e+".logic-list").data("kendoDropDownList"),d=r.element.find("input."+e+".value.first").data(o),c=r.element.find("input."+e+".value.second").data(o),u=r.element.find("input."+e+".operator-list.first").data("kendoDropDownList"),f=r.element.find("input."+e+".operator-list.second").data("kendoDropDownList"),p=r.element.find("input.rel"+e+".N.first:not(.k-formatted-value)").data("kendoNumericTextBox"),h=r.element.find("input.rel"+e+".N.first.k-formatted-value"),g=r.element.find("input.rel"+e+".N.second:not(.k-formatted-value)").data("kendoNumericTextBox"),m=r.element.find("input.rel"+e+".N.second.k-formatted-value"),v=r.element.find("input.rel"+e+".value.first:not(.k-input)").data("kendoComboBox"),y=r.element.find("input.rel"+e+".value.second:not(.k-input)").data("kendoComboBox"),k=r.element.find(".rel"+e+".toggle.first .k-sprite.k-icon"),w=r.element.find(".rel"+e+".toggle.second .k-sprite.k-icon");v.dataSource.filter({}),y.dataSource.filter({}),i!=e&&i!=e||!a?(d.value(null),c.value(null),l.value("and"),v.value(null),y.value(null),p.value(null),g.value(null),y.value(null),u.value(s[0].value),f.value(s[0].value),r.element.find(".rel"+e+"-div").hide(),d.wrapper.show(),c.wrapper.show(),r.element.find(".rel"+e+"-div").hide(),p.wrapper.hide(),h.hide(),g.wrapper.hide(),m.hide(),k.removeClass("k-i-calendar"),k.addClass("k-i-custom"),w.removeClass("k-i-calendar"),w.addClass("k-i-custom")):(null==b?l.value("and"):l.value(b),$.each(n,function(i,a){try{if("string"==typeof a.value){var o=kendo.parseDate(a.value,"yyyy-MM-ddTHH:mm:ss.fffZ");"date"!=e&&(o=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes())),o=t.convertToUserDateTime(o)),o||0!=i?o||1!=i||y.value(a.value):v.value(a.value)}0==i?(d.value(o),u.value(a.operator),1==n.length&&(c.value(null),l.value("and"),f.value(s[0].value))):(c.value(o),f.value(a.operator))}catch(e){var r=a.value.split(":");0==i?(v.value(r[0]),u.value(a.operator),2==r.length&&p.value(r[1]),1==n.length&&(y.value(null),g.value(null),l.value("and"),f.value(s[0].value))):(y.value(r[0]),f.value(a.operator),2==r.length&&g.value(r[1]))}}),null!=v.value()&&""!=v.value()?(r.element.find(".rel"+e+"-div.first").show(),null!=p.value()&&""!=p.value()?(p.wrapper.show(),h.show()):(p.wrapper.hide(),h.hide()),k.addClass("k-i-calendar"),k.removeClass("k-i-custom"),d.wrapper.hide()):(r.element.find(".rel"+e+"-div.first").hide(),p.wrapper.hide(),h.hide(),d.wrapper.show(),k.removeClass("k-i-calendar"),k.addClass("k-i-custom")),null!=y.value()&&""!=y.value()?(r.element.find(".rel"+e+"-div.second").show(),null!=g.value()&&""!=g.value()?(g.wrapper.show(),m.show()):(g.wrapper.hide(),m.hide()),w.addClass("k-i-calendar"),w.removeClass("k-i-custom"),c.wrapper.hide()):(r.element.find(".rel"+e+"-div.second").hide(),g.wrapper.hide(),m.hide(),c.wrapper.show(),w.removeClass("k-i-calendar"),w.addClass("k-i-custom")))};if(l.prop("disabled",!1),1!=S||$.inArray(h.dataItem().type.toLowerCase(),["integer","currency","double","percent","boolean","time","date","datetime"])==-1&&0!=h.dataItem().isGroupable||"multipicklist"==h.dataItem().type.toLowerCase())if($.inArray(I,["date","datetime"])!=-1)a(I,I,n),l.prop("disabled",!1);else{if(S&&_){var n=q(r.options.fieldMeta.name+"!"+h.value());$.each(n,function(e,t){if("dynamic"==t.operator)return i=t.value,!1})}"me"==i?f.prop("checked",!0):f.prop("checked",!1),m=[],d.val(""),x=!1,c.next().html("<b>(Select All)</b>"),c.prop("checked",!0),c.prop("indeterminate",!1),u.parent().hide(),u.prop("checked",!1),s.dataSource._filter=null,l.prop("disabled",!0),s.dataSource.read()}else{var n=q(r.options.fieldMeta.name+"!"+h.value()),o=n.length>0,p=h.dataItem().type.toLowerCase();"boolean"==p&&o?(K.value(n[0].value),Y.value(n[0].operator)):(K.value(null),Y.value("eq")),$.inArray(p,["integer","currency","double","percent"])!=-1&&o?(null==b?X.value("and"):X.value(b),$.each(n,function(e,t){0==e?(J.value(t.value),ie.value(t.operator)):(Z.value(t.value),ne.value(t.operator))}),1==n.length&&(X.value("and"),Z.value(null),ne.value(ee[0].value))):(J.value(null),Z.value(null),X.value("and"),ie.value(ee[0].value),ne.value(ee[0].value)),"string"==p&&o?(null==b?oe.value("and"):oe.value(b),$.each(n,function(e,t){0==e?(re.val(t.value),de.value(t.operator)):(se.val(t.value),ce.value(t.operator))}),1==n.length&&(se.val(""),oe.value("and"),ce.value(le[0].value))):(re.val(""),se.val(""),oe.value("and"),de.value(le[0].value),ce.value(le[0].value)),"time"==p&&o?(null==b?fe.value("and"):fe.value(b),$.each(n,function(e,t){0==e?(pe.value(t.value),me.value(t.operator)):(he.value(t.value),ve.value(t.operator))}),1==n.length&&(he.value(null),fe.value("and"),ve.value(ge[0].value))):(pe.value(null),he.value(null),fe.value("and"),me.value(ge[0].value),ve.value(ge[0].value)),a("date",p,n),a("datetime",p,n)}ze(),N=!1},G=function(e,t,i,n){var a,o=r.options.gridDataSource.filter();return a=e===!0?o:o?jQuery.extend(!0,{},o):o,b=null,V(a,t,i,n),B(a,!0),a&&"undefined"!=a.filters&&0==a.filters.length&&(a=null),a},V=function(e,t,i,n){if("undefined"!=typeof e&&null!=e)if("undefined"!=typeof e.filters)b=e.logic,V(e.filters,t,i,n);else for(var a=e.length-1;a>=0;a--)if("undefined"!=typeof e[a].field)if(e[a].field==t){var o=t.split("!");e[a].field=o[o.length-1];var s=e.splice(a,1)[0];null!=n&&n instanceof Array&&n.unshift(s)}else 1==i&&1==S&&(t.indexOf("!")==-1&&e[a].field.indexOf(t+"!")!=-1||t.indexOf("!")!=-1&&e[a].field==r.options.fieldMeta.name)&&e.splice(a,1);else"undefined"!=typeof e[a].filters&&(b=e[a].logic,V(e[a].filters,t,i,n))},B=function(e,t){if(e)if(t){if("undefined"!=typeof e.filters&&e.filters.length>0)for(var i=e.filters.length-1;i>=0;i--)"undefined"!=typeof e.filters[i].filters&&(0==e.filters[i].filters.length?e.filters.splice(i,1):B(e.filters[i].filters,!1))}else for(var i=e.length-1;i>=0;i--)"undefined"!=typeof e[i].filters&&(0==e[i].filters.length?e.splice(i,1):B(e[i].filters,!1))},q=function(e){var t=r.options.gridDataSource.filter(),i=jQuery.extend(!0,{},t),n=[];return V(i,e,!1,n),n},U=r.element;if(1==S){g=new kendo.data.DataSource({transport:{read:function(e){t.executeRemoteAction("getFieldMetaForObject",[E,!0],function(t,i){i.status?(t=Array.orderBy(t,function(e){return e.displayName}),t=$.grep(t,function(e){return 1==e.isFilterable}),t.unshift({name:"",displayName:"(None)",type:""}),e.success(t)):e.error(t)})}}});var H=$("<div class='exist filter'></div>");H.append("<input type='radio' name='radExist' value='exists' checked='checked'/>Exists"),H.append("<input type='radio' name='radExist' value='notexists'/>Does not exist"),r.element.append(H);var W=$("<ul role='listbox' unselectable='on' class='k-reset' style='width:277px'/>");r.element.append(W),U=$("<div class='field filter'></div>"),r.element.append(U),U.append("<label>Select field:</label><br/>"),U.append("<input class='field-list' style='width: 99%' value='"+O+"' />");var z=$("<div class='bool filter filter-div' style='display:none'></div>");z.append("<label>Show items with value that:</label>"),z.append("<input class='bool operator-list' />"),z.append("<input class='bool value-list' />"),U.append(z);var K=r.element.find(".bool.value-list").kendoDropDownList({dataSource:[{value:null,text:"-Select value-"},{value:"false",text:"No"},{value:"true",text:"Yes"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),Y=r.element.find(".bool.operator-list").kendoDropDownList({dataSource:[{value:"eq",text:"Is equal to"},{value:"neq",text:"Is not equal to"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),Q=$("<div class='num filter filter-div' style='display:none'></div>");Q.append("<label>Show items with value that:</label>"),Q.append("<input class='num operator-list first' />"),Q.append("<input class='num value first' type='text' />"),Q.append("<input class='num logic-list' />"),Q.append("<input class='num operator-list second' />"),Q.append("<input class='num value second' type='text' />"),U.append(Q);var X=r.element.find(".num.logic-list").kendoDropDownList({dataSource:[{value:"and",text:"And"},{value:"or",text:"Or"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),J=r.element.find(".num.value.first").kendoNumericTextBox({}).data("kendoNumericTextBox"),Z=r.element.find(".num.value.second").kendoNumericTextBox({}).data("kendoNumericTextBox"),ee=[];for(var te in e.operators.number)ee.push({value:te,text:e.operators.number[te]});var ie=r.element.find(".num.operator-list.first").kendoDropDownList({dataSource:ee,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),ne=r.element.find(".num.operator-list.second").kendoDropDownList({dataSource:ee,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),ae=$("<div class='string filter filter-div' style='display:none'></div>");ae.append("<label>Show items with value that:</label>"),ae.append("<input class='string operator-list first' />"),ae.append("<input class='string value first k-textbox' type='text' />"),ae.append("<input class='string logic-list' />"),ae.append("<input class='string operator-list second' />"),ae.append("<input class='string value second k-textbox' type='text' />"),U.append(ae);var oe=r.element.find(".string.logic-list").kendoDropDownList({dataSource:[{value:"and",text:"And"},{value:"or",text:"Or"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),re=r.element.find(".string.value.first"),se=r.element.find(".string.value.second"),le=[];for(var te in e.operators.string)le.push({value:te,text:e.operators.string[te]});var de=r.element.find(".string.operator-list.first").kendoDropDownList({dataSource:le,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),ce=r.element.find(".string.operator-list.second").kendoDropDownList({dataSource:le,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),ue=$("<div class='time filter filter-div' style='display:none'></div>");ue.append("<label>Show items with value that:</label>"),ue.append("<input class='time operator-list first' />"),ue.append("<input class='time value first' type='text' />"),ue.append("<input class='time logic-list' />"),ue.append("<input class='time operator-list second' />"),ue.append("<input class='time value second' type='text' />"),U.append(ue);var fe=r.element.find(".time.logic-list").kendoDropDownList({dataSource:[{value:"and",text:"And"},{value:"or",text:"Or"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),pe=r.element.find(".time.value.first").kendoTimePicker({}).data("kendoTimePicker"),he=r.element.find(".time.value.second").kendoTimePicker({}).data("kendoTimePicker"),ge=[];for(var te in e.operators.date)ge.push({value:te,text:e.operators.date[te]});var me=r.element.find(".time.operator-list.first").kendoDropDownList({dataSource:ge,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),ve=r.element.find(".time.operator-list.second").kendoDropDownList({dataSource:ge,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),be=function(){var e=W.find("li:eq(1)");if(1==e.length){var t=e.attr("data-field-name");$.each(h.dataSource.data(),function(e,i){if(i.name==t)return h.select(e),!1})}else{var i=q(r.options.fieldMeta.name);if(i.length>0)h.select(0),W.find("li:first").addClass("k-primary");else{var n=r.options.fieldMeta.childFieldName.split(",");$.each(h.dataSource.data(),function(e,t){if(t.name==n[0])return h.select(e),!1})}}},ye=function(e){O=h.value(),j=r.options.fieldMeta.name+"!"+O,F=[O],P=O.split("."),L=$.map(F,function(e){return{field:e}}),A=P[P.length-1];var t=e.sender.dataItem().type.toLowerCase();if(C="multipicklist"==t,_=null!=e.sender.dataItem().relObjectName&&"user"==e.sender.dataItem().relObjectName.toLowerCase(),Ze(!1,t),""==t)r.element.find(".filter-div").hide();else if("boolean"==t)z.show(),z.siblings(".filter-div").hide();else if($.inArray(t,["integer","percent","currency","double"])!=-1)Q.show(),Q.siblings(".filter-div").hide();else if("time"==t)ue.show(),ue.siblings(".filter-div").hide();else if("datetime"==t)we.show(),we.siblings(".filter-div").hide();else if("date"==t)je.show(),je.siblings(".filter-div").hide();else if(0!=e.sender.dataItem().isGroupable||C){Ze(!0),qe.show(),qe.siblings(".filter-div").hide(),1==C?We.setDataSource(Ue):We.setDataSource(He),r.element.find(".smart.logic-div").show();var i=s.options;i.columns=[{width:30,template:function(e){var t=e[A];return void 0==t&&(t=""),'<input type="checkbox" value="'+t+'"/>'}},{field:A,template:function(e){return void 0==e[A]?"(empty)":e[A]}}],s.destroy(),s=r.element.find(".list-view").empty().kendoGrid(i).data("kendoGrid"),s.setDataSource(Je(e.sender.dataItem().picklistValues)),1==_?r.element.find(".dynamic.filter").parent().show():r.element.find(".dynamic.filter").parent().hide(),r.element.find(".list-view .k-grid-header").css("display","none"),r.element.find(".k-grid-content").css({"min-height":T+"px","overflow-y":"auto"})}else ae.show(),ae.siblings(".filter-div").hide();M()};h=r.element.find(".field-list").kendoDropDownList({dataTextField:"displayName",dataValueField:"name",dataSource:g,template:function(e){var t=e.displayName,i=q(r.options.fieldMeta.name+"!"+e.name);if(i.length>0){t+=" <span class='k-icon k-i-funnel' style='background-position-x: -32px !important'></span>";var n=$(kendo.format("<li class='k-button' unselectabale='on' data-field-name='{0}' style='margin-right:2px;width:initial' title='{1}'/>",e.name,e.displayName)),a=e.displayName.substring(0,18);e.displayName.length>18&&(a+="..."),n.append(kendo.format("<span unselectable='on'>{0}</span>",a)),n.append("<span unselectable='on' class='k-icon k-delete'>delete</span>"),W.append(n)}return t},valueTemplate:function(e){var t=e.displayName,i=q(r.options.fieldMeta.name+"!"+e.name),n=W.find("li[data-field-name='"+e.name+"']");return W.find("li").removeClass("k-primary"),i.length>0&&(t+=" <span class='k-icon k-i-funnel' style='background-position-x: -32px !important'></span>"),n.length>0&&n.addClass("k-primary"),t},dataBound:function(e){be(),ye(e)},cascade:function(e){ye(e)}}).data("kendoDropDownList"),W.delegate("li span","click",function(e){$(this).parent().siblings().removeClass("k-primary"),$(this).parent().addClass("k-primary");var t=this,i=$(this).parent().attr("data-field-name");$.each(h.dataSource.data(),function(e,n){if(n.name==i)return h.select(e),$(t).hasClass("k-delete")&&tt(!1),!1})})}var ke=function(e,t){var i=r.element.find("input.rel"+t+".value."+e+":not(.k-input)").data("kendoComboBox"),n="date"==t?"kendoDatePicker":"kendoDateTimePicker",a=r.element.find("input."+t+".value."+e).data(n);i.value(""),i.close(),a.value(null),r.element.find(".rel"+t+"-div."+e).toggle(),r.element.find(".rel"+t+".N."+e).hide(),a.wrapper.toggle(),r.element.find(".rel"+t+".toggle."+e+" .k-sprite.k-icon").toggleClass("k-i-custom"),r.element.find(".rel"+t+".toggle."+e+" .k-sprite.k-icon").toggleClass("k-i-calendar"),r.element.find(".rel"+t+"-div."+e).is(":visible")?r.element.find(".rel"+t+".toggle."+e).attr("title","Switch to static date"):r.element.find(".rel"+t+".toggle."+e).attr("title","Switch to relative date")},we=$("<div class='datetime filter filter-div' style='display:none'></div>");we.append("<label>Show items with value that:</label>"),we.append("<input class='datetime operator-list first'/>"),we.append("<em class='reldatetime toggle first' title='Switch to relative date'><span class='k-sprite'>Toggle Relative Date</span></em>"),we.append("<input class='datetime value first' type='text' />"),we.append("<div class='reldatetime-div first'><input class='reldatetime value first' type='text'/><input class='reldatetime N first' type='text' style='display:none'/></div>"),we.append("<input class='datetime logic-list' />"),we.append("<input class='datetime operator-list second' />"),we.append("<em class='reldatetime toggle second' title='Switch to relative date'><span class='k-sprite'>Toggle Relative Date</span></em>"),we.append("<input class='datetime value second' type='text' />"),we.append("<div class='reldatetime-div second'><input class='reldatetime value second' type='text'/><input class='reldatetime N second' type='text' style='display:none'/></div>"),U.append(we);var xe=r.element.find(".datetime.logic-list").kendoDropDownList({dataSource:[{value:"and",text:"And"},{value:"or",text:"Or"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList");r.element.find("input.datetime.value").kendoDateTimePicker();var Ie=r.element.find("input.datetime.value.first").data("kendoDateTimePicker"),Se=r.element.find("input.datetime.value.second").data("kendoDateTimePicker");r.element.find(".reldatetime.N").kendoNumericTextBox({min:1,step:1,format:"0.",change:function(){null!=this.value()&&""!=this.value()||this.value(1)}});var Ce=r.element.find("input.reldatetime.N.first:not(.k-formatted-value)").data("kendoNumericTextBox"),De=r.element.find("input.reldatetime.N.second:not(.k-formatted-value)").data("kendoNumericTextBox");r.element.find("input.reldatetime.value").kendoComboBox({dataSource:e.relativeDates,dataTextField:"displayName",dataValueField:"dateLiteral",template:function(e){return kendo.format(e.displayName,"n")},filter:"contains",change:function(e){if(this.value()&&this.selectedIndex==-1)this.value(""),this.text("");else{var t=this.wrapper.hasClass("first")?"first":"second",i=r.element.find("input.reldatetime.N."+t+":not(.k-formatted-value)").data("kendoNumericTextBox"),n=r.element.find("input.reldatetime.N."+t+".k-formatted-value");this.dataItem().requiresN?(i.wrapper.show(),i.value(1),n.show()):(i.wrapper.hide(),i.value(null),n.hide())}}});var Ne=r.element.find("input.reldatetime.value.first:not(.k-input)").data("kendoComboBox"),Te=r.element.find("input.reldatetime.value.second:not(.k-input)").data("kendoComboBox");r.element.find("em.reldatetime.toggle").kendoButton({spriteCssClass:"k-icon k-i-custom"}).data("kendoButton"),r.element.find(".reldatetime-div").css("display","inline"),r.element.find(".reldatetime-div").hide(),r.element.find(".reldatetime.toggle").css({width:"24px","margin-right":"2px","margin-top":"1px",height:"24px"}),r.element.find(".datetime.value").closest(".k-widget").css({display:"inline-block",width:"158px"}),r.element.find(".reldatetime.value").closest(".k-widget").css({width:"140px","margin-right":"2px",display:"inline-block"}),r.element.find(".reldatetime.N").closest(".k-widget").css({width:"48px",display:"inline-block"}),r.element.find(".datetime.value").on("input",function(e){var t=$(this).val().match(/^[a-zA-Z]+$/);if(null!=t){var i=$(this).val(),n=$(this).hasClass("first")?"first":"second",a=r.element.find("input.reldatetime.value."+n+":not(.k-input)").data("kendoComboBox");ke(n,"datetime"),a.value(i),a.search(i),a.focus()}}),r.element.find(".reldatetime.value").closest(".k-widget").on("input",function(e){var t=$(this).hasClass("first")?"first":"second",i=r.element.find("input.reldatetime.value."+t+":not(.k-input)").data("kendoComboBox");if(""==i.text()){ke(t,"datetime");var n=r.element.find("input.datetime.value.k-input."+t);n.focus()}}),r.element.find(".reldatetime.toggle").on("click",function(){var e=$(this).hasClass("first")?"first":"second";ke(e,"datetime")});var _e=[];for(var te in e.operators.date)_e.push({value:te,text:e.operators.date[te]});var Oe=r.element.find(".datetime.operator-list.first").kendoDropDownList({dataSource:_e,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),Re=r.element.find(".datetime.operator-list.second").kendoDropDownList({dataSource:_e,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),je=$("<div class='date filter filter-div' style='display:none; width: 217px'></div>");je.append("<label>Show items with value that:</label>"),je.append("<input class='date operator-list first' />"),je.append("<em class='reldate toggle first' title='Switch to relative date'><span class='k-sprite'>Toggle Relative Date</span></em>"),je.append("<input class='date value first' type='text' />"),je.append("<div class='reldate-div first'><input class='reldate value first' type='text'/><input class='reldate N first' type='text' style='display:none'/></div>"),je.append("<input class='date logic-list' />"),je.append("<input class='date operator-list second' />"),je.append("<em class='reldate toggle second' title='Switch to relative date'><span class='k-sprite'>Toggle Relative Date</span></em>"),je.append("<input class='date value second' type='text' />"),je.append("<div class='reldate-div second'><input class='reldate value second' type='text'/><input class='reldate N second' type='text' style='display:none'/></div>"),U.append(je);var Ee=r.element.find(".date.logic-list").kendoDropDownList({dataSource:[{value:"and",text:"And"},{value:"or",text:"Or"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList");r.element.find("input.date.value").kendoDatePicker();var Fe=r.element.find("input.date.value.first").data("kendoDatePicker"),Pe=r.element.find("input.date.value.second").data("kendoDatePicker");r.element.find(".reldate.N").kendoNumericTextBox({min:1,step:1,format:"0."});var Ae=r.element.find("input.reldate.N.first:not(.k-formatted-value)").data("kendoNumericTextBox"),Le=r.element.find("input.reldate.N.second:not(.k-formatted-value)").data("kendoNumericTextBox");r.element.find("input.reldate.value").kendoComboBox({dataSource:e.relativeDates,dataTextField:"displayName",dataValueField:"dateLiteral",template:function(e){return kendo.format(e.displayName,"n")},filter:"contains",change:function(e){if(this.value()&&this.selectedIndex==-1)this.value(""),this.text("");else{var t=this.wrapper.hasClass("first")?"first":"second",i=r.element.find("input.reldate.N."+t+":not(.k-formatted-value)").data("kendoNumericTextBox"),n=r.element.find("input.reldate.N."+t+".k-formatted-value");this.dataItem().requiresN?(i.wrapper.show(),i.value(1),n.show()):(i.wrapper.hide(),i.value(null),n.hide())}}});var Me=r.element.find("input.reldate.value.first:not(.k-input)").data("kendoComboBox"),$e=r.element.find("input.reldate.value.second:not(.k-input)").data("kendoComboBox");r.element.find("em.reldate.toggle").kendoButton({spriteCssClass:"k-icon k-i-custom"}).data("kendoButton"),r.element.find(".reldate-div").css("display","inline"),r.element.find(".reldate-div").hide(),r.element.find(".reldate.toggle").css({width:"24px","margin-right":"2px","margin-top":"1px",height:"24px"}),r.element.find(".date.value").closest(".k-widget").css({display:"inline-block",width:"120px"}),r.element.find(".reldate.value").closest(".k-widget").css({width:"140px","margin-right":"2px",display:"inline-block"}),r.element.find(".reldate.N").closest(".k-widget").css({width:"48px",display:"inline-block"}),r.element.find(".date.value").on("input",function(e){var t=$(this).val().match(/^[a-zA-Z]+$/);if(null!=t){var i=$(this).val(),n=$(this).hasClass("first")?"first":"second",a=r.element.find("input.reldate.value."+n+":not(.k-input)").data("kendoComboBox");ke(n,"date"),a.value(i),a.search(i),a.focus()}}),r.element.find(".reldate.value").closest(".k-widget").on("input",function(e){var t=$(this).hasClass("first")?"first":"second",i=r.element.find("input.reldate.value."+t+":not(.k-input)").data("kendoComboBox");if(""==i.text()){ke(t,"date");var n=r.element.find("input.date.value.k-input."+t);n.focus()}}),r.element.find(".reldate.toggle").on("click",function(){var e=$(this).hasClass("first")?"first":"second";ke(e,"date")});var Ge=[];for(var te in e.operators.date)Ge.push({value:te,text:e.operators.date[te]});var Ve=r.element.find(".date.operator-list.first").kendoDropDownList({dataSource:Ge,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),Be=r.element.find(".date.operator-list.second").kendoDropDownList({dataSource:Ge,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList");r.element.find(".logic-list").css("margin",".5em 0 .5em"),r.element.find(".filter").css("margin-top",".5em"),r.element.find(".filter-div, .operator-list, .logic-list, .value-list, .value:not(.date, .datetime, .reldate, .reldatetime)").css("width","100%"),
r.element.find(".k-widget.date.value, .k-widget.datetime.value").css("width","calc(100% - 26px)"),r.element.find(".k-widget.reldate.value, .k-widget.reldatetime.value").css("width","calc(100% - 76px)"),0==S&&r.element.find(".datetime.filter-div, .date.filter-div").css("width","217px");var qe=$('<div class="smart filter filter-div" style="display:none;" ><div>');qe.append("<input class='smart operator-list' style='height:23px;margin-right:4px;display:none'/>"),d=$("<input type='search' class='k-textbox' style='margin-top:.5em;width:100%' placeholder='Search'/>"),qe.append(d),qe.append('<div style="margin-bottom:4px;margin-top:.5em;display:none"><input type="checkbox" class="dynamic my filter" style="margin-left:10px;margin-right:12px;vertical-align:middle;position:relative;bottom:1px"/>&nbsp;<b>My</b></div>'),qe.append('<div style="margin-bottom:4px;margin-top:4px"><input type="checkbox" class="select-all-checkbox" checked="checked" style="margin-left:10px;margin-right:12px;vertical-align:middle;position:relative;bottom:1px"/>&nbsp;<b>(Select All)</b></div>'),qe.append('<div style="margin-bottom:4px;margin-top:4px;display:none"><input type="checkbox" class="add-selection-to-filter" style="margin-left:10px;margin-right:12px;vertical-align:middle;position:relative;bottom:1px"/>&nbsp;<b>Add current selection to filter</b></div>'),qe.append('<div class="list-view" style="width:275px;"></div>'),qe.append('<div class="smart logic-div" style="display:none;margin-top:.5em">Show items that: <input class="smart logic-list" style="width:auto"/></div>'),U.append(qe);var Ue=[{text:"Include any selected values",value:"or"},{text:"Include all selected values",value:"and"},{text:"Include only selected values",value:"eq"}],He=[{text:"Include selected values",value:"in"},{text:"Exclude selected values",value:"not in"}],We=r.element.find(".smart.logic-list").kendoDropDownList({dataSource:1==C?Ue:He,dataTextField:"text",dataValueField:"value",change:function(e){N=!0}}).data("kendoDropDownList");1==_&&r.element.find(".dynamic.filter").parent().show(),r.element.append('<div style="width:150px;margin:.5em 0 .5em"><button class="k-button k-primary filter-button" style="width:40%">Filter</button> <button class="k-button clear-button" style="width:50%">Clear'+(1==S?" All":"")+"</button></div>"),c=r.element.find(".select-all-checkbox"),u=r.element.find(".add-selection-to-filter"),f=r.element.find(".my.dynamic.filter"),f.on("click",function(e){var t=f.prop("checked");t&&c.prop("checked",!1)}),p=r.element.find(".myteam.dynamic.filter"),l=r.element.find(".filter-button"),r.element.find(".dynamic.filter").bind("click",function(e){Qe()});var ze=function(){var e=215;if(S){e=300;var t=W.height();t>0&&(e+=t-15)}C&&(e+=45),_&&(e+=18),u.is(":visible")&&(e+=18);var i=(r.element.parent(),$("#"+r.options.gridId+" .k-grid-content")),n=$("#"+r.options.gridId+" .k-grid-footer"),a=$("#"+r.options.gridId+" .k-grid-pager"),o=(i?i.height():0)+(n?n.height():0)+(a?a.height():0),s=o-e;s<T&&(s=T),r.element.find(".k-grid-content").css("max-height",s)},Ke=[{value:"contains",text:"Contains"},{value:"doesnotcontain",text:"Does not contain"},{value:"startswith",text:"Starts with"},{value:"endswith",text:"Ends with"},{value:"eq",text:"Is equal to"},{value:"neq",text:"Is not equal to"}],Ye=r.element.find(".smart.operator-list").kendoDropDownList({dataSource:Ke,dataTextField:"text",dataValueField:"value",change:function(){""!=d.val()&&d.trigger("input")}}).data("kendoDropDownList");r.element.find(".k-dropdown.smart.operator-list").css("display","none");var Qe=function(){""==d.val()&&f.is(":visible")&&!f.is(":checked")&&(0==s.dataSource.total()||0==c.prop("checked")&&0==c.prop("indeterminate"))?l.prop("disabled",!0):l.prop("disabled",!1)},Xe=function(){var e=k;$.each(m,function(t,i){i.checked?e++:e--}),e==s.dataSource.total()?(c.prop("checked",!0),c.prop("indeterminate",!1),r.element.find(".list-view input").prop("checked",!0)):0==e?(c.prop("checked",!1),c.prop("indeterminate",!1),r.element.find(".list-view input").prop("checked",!1)):(c.prop("checked",!1),c.prop("indeterminate",!0))},Je=function(e){var n;if(1==C){var a=[],o={};o[A]=null,a.push(o),$.each(e,function(e,t){if(1==t.active){var i={};i[A]=t.label,a.push(i)}}),n=new kendo.data.DataSource({data:a,pageSize:10,page:1,change:function(){if(v=[],G(!1,j,!0,v),0==v.length)k=a.length;else{k=0;var e=[];"neq"!=v[0].operator&&"excludes"!=v[0].operator||$.each(s.dataSource.data(),function(t,i){var n=i[A];null==n&&(n=""),e.push(n)}),$.each(v,function(t,i){var n=[];n="eq"==i.operator||"neq"==i.operator?i.value.split(";"):JSON.parse(i.value),$.each(n,function(t,n){$.each(s.dataSource.data(),function(t,a){var o=a[A];if(null==o&&(o=""),("eq"==i.operator||"includes"==i.operator)&&o==n)return e.indexOf(o)==-1&&e.push(o),!1;if(("neq"==i.operator||"excludes"==i.operator)&&o==n){var r=e.indexOf(o);return r!=-1&&e.splice(r,1),!1}})})}),k=e.length}}})}else n=new kendo.data.DataSource({transport:{read:function(e){v=[];var n=G(!1,j,!0,v);1==S?n=null:r.options.baseFilter&&(n?n.filters?n.filters.push(r.options.baseFilter):n.filters=[r.options.baseFilter]:n=jQuery.extend(!0,{},r.options.baseFilter)),e.data.filter&&(v=[],n?n.filters?n.filters.push(e.data.filter):n.filters=[e.data.filter]:n=e.data.filter);var a=0;s&&s.dataSource&&(a=s.dataSource.total()),e.data.sort=[{field:O,dir:"asc"}];var o={takeCount:e.data.take,skipCount:e.data.skip,sorts:e.data.sort,groups:L,filter:n,objectName:E,columns:F};return O&&""!=O?void t.executeRemoteAction("getPage",[o],function(r,s){if(s.status)if(y=r.totalResults!=a,v.length>0){var l={logic:"and",filters:[]};0==S&&null!=n&&(l={logic:"and",filters:[n]});var d={logic:"and",filters:[]},c={logic:"or",filters:[]},u={logic:"or",filters:[]},f=!0;if($.each(v,function(e,t){if("dynamic"==t.operator)return!0;f=!1;var i={field:O,operator:t.operator,value:t.value};"neq"==t.operator||"doesnotcontain"==t.operator?d.filters.push(i):"eq"==t.operator?c.filters.push(i):u.filters.push(i)}),1==f)return k=0,e.success(r),!0;u.filters.length>0&&d.filters.push(u),d.filters.length>0&&c.filters.push(d),c.filters.length>0&&l.filters.push(c),o.filter=l,t.executeRemoteAction("getPage",[o],function(t,i){i.status?(k=t.totalResults,e.success(r)):e.error(t,i)})}else k=r.totalResults,e.success(r);else console.log("error",r),e.error(r,s),i.trackException(s)},{escape:!1}):void e.success({results:[]})}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,schema:{data:"results",total:"totalResults",parse:function(e){return $.each(e.results,function(e,t){O in t||(t[O]=t[A])}),e}},error:function(e){console.log("error",e),i.trackException(e)}});return n},Ze=function(e,t){var i=r.element.closest(".k-animation-container"),n=275,a=$("#"+r.options.gridId+' th[data-field="'+(1==S?r.options.fieldMeta.relationshipName:O)+'"] .k-grid-filter').get(0),o=a.getBoundingClientRect().left,s=20;o+s+n>$(window).width()?i.css("left",$(window).width()-n-s):i.css("left",o+1)},et=function(){var e=null,t=q(r.options.fieldMeta.name);if(t.length>0&&$.each(t,function(t,i){"notexists"!=i.operator&&"exists"!=i.operator||(e=i.operator)}),null!=e){var i="exists"==e?"Exists":"Does not exist",n=$(kendo.format("<li class='k-button' unselectabale='on' data-field-name='' style='margin-right:2px;width:initial' title='{1}'/>",i));n.append(kendo.format("<span unselectable='on'>{0}</span>",i)),W.append(n)}else e="exists";H.find("input[name=radExist][value='"+e+"']").prop("checked",!0)};$("#"+r.options.gridId+' th[data-field="'+(1==S?r.options.fieldMeta.relationshipName:O)+'"] .k-grid-filter').bind("click",function(e){e.preventDefault(),1==S&&(W.empty(),et()),1==S&&U.is(":visible")&&h.refresh(),M()}),r.element.delegate(".list-view input","click",function(){var e=m.length,t=this;m=$.grep(m,function(e){return e.value!=t.value}),m.length==e&&m.push({value:this.value,checked:$(this).is(":checked")}),Xe(),Qe()}),s=r.element.find(".list-view").kendoGrid({dataSource:Je(r.options.fieldMeta.picklistValues),autoBind:!1,pageable:{info:!0,numeric:!1,previousNext:!0},columns:[{width:30,template:function(e){var t=e[A];return void 0==t&&(t=""),'<input type="checkbox" value="'+t.replace(/"/g,"&quot;")+'"/>'}},{field:A,template:function(e){return void 0==e[A]?"(empty)":e[A]}}],dataBound:function(e){if(""!=d.val()&&1==c.prop("checked")&&c.prop("indeterminate",!1))r.element.find(".list-view input").prop("checked",!0);else if(0==x&&v.length>0){if(1==C){var t=0,i="neq"==v[0].operator||"excludes"==v[0].operator;if(r.element.find(".list-view input").prop("checked",i),$.each(v,function(e,n){var a=[];"eq"==n.operator||"neq"==n.operator?a=n.value.split(";"):(a=JSON.parse(n.value),t++),r.element.find(".list-view input").filter(function(){return a.indexOf(this.value)!=-1}).prop("checked",!i)}),0==N){var n=v[0].operator;t>1?We.value("and"):"eq"==n||"neq"==n?We.value("eq"):We.value("or")}}else{r.element.find(".list-view input").prop("checked",!1),$.each(v,function(e,t){r.element.find(".list-view input").filter(function(){var e=this.value.toLowerCase(),i=t.value.toLowerCase();return"contains"==t.operator?e.indexOf(i)!=-1:"startswith"==t.operator?0===e.lastIndexOf(i,0):"endswith"==t.operator?e.indexOf(i,e.length-i.length)===e.length-i.length:void 0}).prop("checked",!0)}),$.each(v,function(e,t){r.element.find(".list-view input").filter(function(){var e=this.value.toLowerCase(),i=t.value.toLowerCase();if("eq"==t.operator)return e==i}).prop("checked",!0)});var a=Object.first(v,function(e){return"neq"==e.operator||"doesnotcontain"==e.operator});a&&0==r.element.find(".list-view input:checked").length&&r.element.find(".list-view input").prop("checked",!0),$.each(v,function(e,t){r.element.find(".list-view input").filter(function(){var e=this.value.toLowerCase(),i=t.value.toLowerCase();if("doesnotcontain"==t.operator)return e.indexOf(i)!=-1}).prop("checked",!1)}),$.each(v,function(e,t){r.element.find(".list-view input").filter(function(){var e=this.value.toLowerCase(),i=t.value.toLowerCase();if("neq"==t.operator)return e==i}).prop("checked",!1)})}Xe()}else{var o=c.prop("checked");1==c.prop("indeterminate")&&m.length>0&&(o=!m[0].checked),r.element.find(".list-view input").prop("checked",o)}$.each(m,function(e,t){r.element.find('.list-view input[value="'+t.value+'"]').prop("checked",t.checked)}),Qe()}}).data("kendoGrid"),r.element.find(".list-view .k-grid-header").css("display","none"),r.element.find(".k-grid-content").css({"min-height":T+"px","overflow-y":"auto"}),0==S?(M(),l.prop("disabled",!1),"date"==I?je.show():"datetime"==I?we.show():(l.prop("disabled",!0),qe.show(),r.element.find(".smart.logic-div").show(),ze())):et(),d.bind("propertychange keyup input paste",function(e){window.event&&"propertychange"==event.type&&"value"!=event.propertyName||(clearTimeout($(this).data("timeout")),$(this).data("timeout",setTimeout(function(){m=[],w=!1,c.prop("checked",!0),c.prop("indeterminate",!1),u.prop("checked",!1);var e=d.val();e?(c.next().html("<b>(Select All Search Results)</b>"),u.parent().show(),""==Ye.value()&&Ye.element.val("contains"),s.dataSource.filter({field:O,operator:Ye.value(),value:e})):(c.next().html("<b>(Select All)</b>"),u.parent().hide(),s.dataSource.filter({})),ze()},500)))}),c.bind("click",function(){var e=$(this).is(":checked");r.element.find(".list-view input").each(function(){this.checked=e}),Qe(),m=[],k=1==e?s.dataSource.total():0,0==e&&""!=d.val()&&(w=!0),x=!0});var tt=function(e){var t={},i=!1,n=[];1==e&&1==S?(W.find("li").each(function(){n.push(r.options.fieldMeta.name+"!"+$(this).attr("data-field-name"))}),n.push(r.options.fieldMeta.name)):(n.push(j),1==S&&1==W.find("li[data-field-name='"+j.split("!")[1]+"']").length&&1==W.find("li").length&&n.push(r.options.fieldMeta.name)),$.each(n,function(e,n){v=[],t=G(!0,n,!1,v),v.length>0&&(t||(t={}),i=!0)}),i&&r.options.gridDataSource.filter(t),r.element.closest(".k-animation-container").hide()};this.clearFilter=tt,r.element.find(".clear-button").click(function(e){e.preventDefault(),tt(S)});var it=function(e,t,i,n,a,o,r,s,l){var d=!1,c=function(e){return"isnull"===e||"isnotnull"===e},u="and"==l?n:a;return o(i)&&!c(t)||(u.push({field:e,operator:t,value:i}),d=!0),o(s)&&!c(r)||(u.push({field:e,operator:r,value:s}),d=!0),d};r.element.find(".filter-button").click(function(e){e.preventDefault(),v=[],G(!1,j,!0,v);var t={logic:"and",filters:[]},i={logic:"or",filters:[]},n={logic:"or",filters:[]},a=!1,o=function(e){var t=e;return t&&t.indexOf(":")>-1&&(t=t.split(":")[0]),t};if(z&&z.is(":visible"))a=it(j,Y.value(),K.value(),t.filters,i.filters,function(e){return null==e||0==e.length});else if(Q&&Q.is(":visible"))a=it(j,ie.value(),J.value(),t.filters,i.filters,function(e){return null==e},ne.value(),Z.value(),X.value());else if(ae&&ae.is(":visible"))a=it(j,de.value(),re.val(),t.filters,i.filters,function(e){return 0==e.length},ce.value(),se.val(),oe.value());else if(ue&&ue.is(":visible"))a=it(j,me.value(),pe.value(),t.filters,i.filters,function(e){return null==e},ve.value(),he.value(),fe.value());else if(we&&we.is(":visible")){var l=Ie.value();Ne.wrapper.is(":visible")&&(l=o(Ne.value()),Ce.wrapper.is(":visible")&&(l+=":"+Ce.value()));var p=Se.value();Te.wrapper.is(":visible")&&(p=o(Te.value()),De.wrapper.is(":visible")&&(p+=":"+De.value())),a=it(j,Oe.value(),l,t.filters,i.filters,function(e){return null==e||0==e.length},Re.value(),p,xe.value())}else if(je&&je.is(":visible")){var l=Fe.value();Me.wrapper.is(":visible")&&(l=o(Me.value()),Ae.wrapper.is(":visible")&&(l+=":"+Ae.value()));var p=Pe.value();$e.wrapper.is(":visible")&&(p=o($e.value()),Le.wrapper.is(":visible")&&(p+=":"+Le.value())),l instanceof Date&&(l=new Date(Date.UTC(l.getFullYear(),l.getMonth(),l.getDate()))),p instanceof Date&&(p=new Date(Date.UTC(p.getFullYear(),p.getMonth(),p.getDate()))),a=it(j,Ve.value(),l,t.filters,i.filters,function(e){return null==e||0==e.length},Be.value(),p,Ee.value())}else if(qe.is(":visible")){var h=d.val(),g=u.is(":visible")&&u.is(":checked");if(1==c.prop("checked")&&0==c.prop("indeterminate")&&0==g)if(""==h)a=!0;else if(1==C){var b=[];$.each(s.dataSource.data(),function(e,t){t[A]&&t[A].toLowerCase().indexOf(h.toLowerCase())!=-1&&b.push(t[A])}),b.length<s.dataSource.data().length&&("eq"==We.value()?t.filters.push({field:j,operator:"eq",value:b.join(";")}):"or"==We.value()?t.filters.push({field:j,operator:"includes",value:JSON.stringify(b)}):"and"==We.value()&&$.each(b,function(e,i){t.filters.push({field:j,operator:"includes",value:JSON.stringify([i])})}),a=!0)}else{var y="contains",k=n;"not in"==We.value()&&(y="doesnotcontain",k=t),k.filters.push({field:j,operator:y,value:h}),c.prop("indeterminate",!0),a=!0}else if(0==c.prop("checked")&&0==c.prop("indeterminate")&&0==g)if(""==h)a=!1;else if(1==C){var b=[];$.each(s.dataSource.data(),function(e,t){t[A]&&t[A].toLowerCase().indexOf(h.toLowerCase())!=-1&&b.push(t[A])}),"eq"==We.value()?t.filters.push({field:j,operator:"neq",value:b.join(";")}):"or"==We.value()?t.filters.push({field:j,operator:"excludes",value:JSON.stringify(b)}):"and"==We.value()&&$.each(b,function(e,t){i.filters.push({field:j,operator:"excludes",value:JSON.stringify([t])})}),a=!0}else a=!1;else{""==h&&!x||0!=g||(v=[]);var b=[];if((1==C&&v.length>0&&("neq"==v[0].operator||"excludes"==v[0].operator)||1==c.prop("indeterminate")&&m.length>0&&0==m[0].checked)&&$.each(s.dataSource.data(),function(e,t){var i=t[A];null==i&&(i=""),b.push(i)}),$.each(v,function(e,a){if("exists"==a.operator||"notexists"==a.operator)return!0;if(1==C){var o=[];return o="eq"==a.operator||"neq"==a.operator?a.value.split(";"):JSON.parse(a.value),$.each(o,function(e,t){$.each(s.dataSource.data(),function(e,i){var n=i[A];if(null==n&&(n=""),("eq"==a.operator||"includes"==a.operator)&&n==t)return b.indexOf(n)==-1&&b.push(n),!1;if(("neq"==a.operator||"excludes"==a.operator)&&n==t){var o=b.indexOf(n);return o!=-1&&b.splice(o,1),!1}})}),!0}if("eq"==a.operator||"neq"==a.operator){var r=!1,l="neq"==a.operator;if($.each(m,function(e,t){if(t.value==a.value&&t.checked==l)return r=!0,!1}),1==r)return m=$.grep(m,function(e){return!(e.value==a.value&&e.checked==l)}),!0;if(1==g){var d=a.value.toLowerCase().indexOf(h.toLowerCase())!=-1;if("neq"==a.operator&&"in"==We.value()&&d)return!0;if("eq"==a.operator&&"not in"==We.value()&&d)return!0}}else if("dynamic"==a.operator)return!0;var c=a.operator;"not in"==We.value()&&0==g&&("contains"==a.operator?c="doesnotcontain":"doesnotcontain"==a.operator?c="contains":"eq"==a.operator?c="neq":"neq"==a.operator&&(c="eq"));var u={field:j,operator:c,value:a.value};"neq"==c||"doesnotcontain"==a.operator?t.filters.push(u):"eq"==a.operator?i.filters.push(u):n.filters.push(u)}),1==C)""!=h&&$.each(s.dataSource.data(),function(e,t){var i=t[A];if(null==i&&(i=""),0==c.prop("checked")&&0==c.prop("indeterminate")||1==c.prop("indeterminate")&&m.length>0&&m[0].checked){if(i.toLowerCase().indexOf(h.toLowerCase())!=-1){var n=b.indexOf(i);n!=-1&&b.splice(n,1)}}else i.toLowerCase().indexOf(h.toLowerCase())!=-1&&b.indexOf(i)==-1&&b.push(i)}),$.each(m,function(e,t){if(1==t.checked)$.inArray(b,t.value)==-1&&b.push(t.value);else{var i=b.indexOf(t.value);i!=-1&&b.splice(i,1)}}),"eq"==We.value()?t.filters.push({field:j,operator:"eq",value:b.join(";")}):"or"==We.value()?t.filters.push({field:j,operator:"includes",value:JSON.stringify(b)}):"and"==We.value()&&$.each(b,function(e,i){t.filters.push({field:j,operator:"includes",value:JSON.stringify([i])})});else{if(""!=h&&0==w){var y="contains",k=n;"not in"==We.value()&&(y="doesnotcontain",k=t),k.filters.push({field:j,operator:y,value:h})}$.each(m,function(e,n){1==n.checked&&"in"==We.value()||0==n.checked&&"not in"==We.value()?i.filters.push({field:j,operator:"eq",value:n.value}):t.filters.push({field:j,operator:"neq",value:n.value})})}a=!0}}if(H&&H.is(":visible")&&(t.filters.push({field:r.options.fieldMeta.name,operator:H.find("input[name=radExist]:checked").val(),value:""}),a=!0),!f.is(":visible")||!f.is(":checked")||c.is(":checked")&&""==h||(i.filters.push({field:j,operator:"dynamic",value:"me"}),a=!0),a){G(!0,j,!0,v);var I=r.options.gridDataSource.filter();I||(I={logic:"and",filters:[]}),I.filters||(I.filters=[]),n.filters.length>0&&t.filters.push(n),t.filters.length>0&&i.filters.push(t),i.filters.length>0&&I.filters.push(i),r.options.gridDataSource.filter(I)}r.element.closest(".k-animation-container").hide()})},options:{name:"MultiSelectGridFilter"}});n.plugin(o)}),crmc.define("FilterLogic",["sfdc","ExpressionTree","ForeignKeyControl","GridConstants","KendoPopup","ColumnFactory"],function(e,t,i,n,a,o){var r={hasFilter:function(e){var t=jQuery.extend(!0,{},e.gridDataSource.filter());this.removeEmptyFilterArrays(t,!0);var i=[this.getFilterTreeViewData(t,null,[],null,void 0,e)];return i&&i[0]||e.settings.pageInfo.filterId||e.settings.pageInfo.selectedRecordIds&&e.settings.pageInfo.selectedRecordIds.length>0},removeEmptyFilterArrays:function(e,t){var i=this;if(e)if(t){if("undefined"!=typeof e.filters&&e.filters.length>0)for(var n=e.filters.length-1;n>=0;n--)"undefined"!=typeof e.filters[n].filters&&(0==e.filters[n].filters.length?e.filters.splice(n,1):i.removeEmptyFilterArrays(e.filters[n].filters,!1))}else for(var n=e.length-1;n>=0;n--)"undefined"!=typeof e[n].filters&&(0==e[n].filters.length?e.splice(n,1):i.removeEmptyFilterArrays(e[n].filters,!1))},getFilterTreeViewData:function(t,i,a,r,s,l){var d=this;if(void 0===s&&(s={i:1}),void 0!=t.field){var c=t.value,u=t.field,f=t.field.split("!"),p=t.operator,h=t.field,g=h.split("!");g.length>1&&(h=g[0]);var m=null;if($.each(l.fieldMeta,function(i,a){var r=a.type.toLowerCase();if(a.name==h){var s=Object.first(l.kendoGrid.columns,function(e){return e.name==a.name});if(u=s&&s.title||o.getHeaderTitle(a,l.fieldMeta)||a.displayName,"string"==r||"picklist"==r)c=null==t.value||""==t.value?"(empty)":'"'+c+'"';else if("date"==r||"datetime"==r){if("string"==typeof c){var d=c.split(":");if(d.length>=1)var f=Object.first(n.relativeDates,function(e){return e.dateLiteral==d[0]})}if(f){var p=f.formatText;c=p&&d.length>=1?kendo.format(p,d[1]):f.displayName}else{var g=new Date(c),m=!("Invalid Date"===g||isNaN(g));if(m){var v=e.convertToUserDateTime(c);c="date"==r?kendo.format("{0:d}",v):kendo.format("{0:g}",v)}else c=kendo.format("{0:g}",v)}}}}),"includes"!=t.operator.toLowerCase()){var v=!1;for(var b in n.operators){for(var y in n.operators[b])if(y==t.operator){p=n.operators[b][y],v=!0;break}if(v)break}}if(null!=m){if("exists"==t.operator||"notexists"==t.operator){if(null==r)return{text:kendo.format("<b>{0} record exists in {1}</b>","exists"==t.operator?"A":"No",m.childRelDisplayName),items:[],rootNode:!1,logic:"AND",childRelName:m.childRelName,isChildField:!1,nodeIndex:s.i++};return}return r==m.childRelName?($.each(m.childFieldMeta,function(e,t){if(t.name.toLowerCase()==g[1].toLowerCase())return u=t.displayName,!1}),{text:kendo.format("<b>{0}</b> {1} <b>{2}</b>",u,p,c),logic:i,rootNode:!1,items:void 0,childRelName:m.childRelName,isChildField:!0,nodeIndex:s.i++}):void 0}var k=kendo.format("<b>{0}</b> {1} <b>{2}</b>",u,1==f.length?p:" Exists where "+f[1]+" "+p.toLowerCase(),c);return"isnull"!=t.operator&&"isnotnull"!=t.operator||(k=kendo.format("<b>{0}</b> {1}",u,p)),{text:k,logic:i,rootNode:!1,items:void 0,nodeIndex:s.i++}}if(t instanceof Array&&t.length>0){var w=[],x=[];if($.each(t,function(e,t){var n=d.getFilterTreeViewData(t,t.logic?t.logic.toUpperCase():i,a,r,s,l);if(void 0!=n&&(r==n.childRelName&&1==n.isChildField||null==r)){var o=t&&t.operator?t.operator.toLowerCase():"";n.logic=i,"exists"!=o&&"notexists"!=o?w.push(n):x.push(n)}}),0==w.length&&(w=x),w.length>1){w[0].text="("+w[0].text;var I=w.splice(0,1)[0];w[0].logic=i;var S=[];void 0!=I.items&&$.merge(S,I.items),$.merge(S,w);for(var C=S[S.length-1];;){if(!(void 0!=C.items&&C.items.length>0))break;C=C.items[C.items.length-1]}return C.text+=")",{text:I.text,logic:i,items:S,rootNode:!1,childRelName:I.childRelName,isChildField:null!=r,nodeIndex:I.nodeIndex}}if(1==w.length)return{text:w[0].text,logic:i,items:w[0].items,rootNode:!1,childRelName:w[0].childRelName,isChildField:null!=r,nodeIndex:w[0].nodeIndex}}else if(void 0!=t.filters)return this.getFilterTreeViewData(t.filters,t.logic.toUpperCase(),a,r,s,l)},getBooleanFilterString:function(e,t){var i=this;void 0===t&&(t={i:1});var n=e.logic||"and",a=[];return e.field&&(a.push(t.i),t.i++),e.filters&&Object.each(e.filters,function(e){"object"==typeof e&&a.push(i.getBooleanFilterString(e,t))}),kendo.format(a.length>1?"({0})":"{0}",a.join(" "+n+" "))},flattenFilter:function(e){var t=[],i=this;return e.field&&t.push({field:e.field,operator:e.operator,value:e.value}),e.filters&&e.filters.length>0&&Object.each(e.filters,function(e){"object"==typeof e&&(t=t.concat(i.flattenFilter(e)))}),t},parseBooleanFilterString:function(e,n,a){if(e=e.toUpperCase()){var o=t.parseBooleanExpression(e),r=this.flattenFilter(n),s=i.evaluateBooleanFilterLogic(o,r);a.getElement("grid").one("beforeQuery",function(e,t){t.filter=s});var l=this;a.refresh(function(){l.showFilter(a)})}else a.clearFilters()},showWindow:function(e,t,i,n,o){var r=this,s="Filter Logic";a.popupWithButtons(s,(i?"<label style='width:15ex;'>Boolean Logic: </label>"+kendo.format("<input style='width:calc(100% - 15ex);' id='{0}_booleanLogic' type='text'/> <p/>",e.settings.id)+"<div style='height: calc(100% - 125px); border-style: groove; border-width: 1px 1px 1px 1px;' ><div style='overflow: auto; height: 100%'>"+kendo.format("{1}<div id='{0}_filterTreeView'/>",e.settings.id,n?n:"")+"</div></div>":n?n:"Grid has no filtered columns.")+"<p/><label style='width:15ex;'>Scope: </label>"+kendo.format("<input style='width:calc(100% - 7ex);' id='{0}_filterScope' type='text'/>",e.settings.id),[{label:"Clear Filters",click:function(){e.clearFilters()}},{label:"Close"},{label:"Apply Logic",click:function(){e.settings.pageInfo.scope=e.getElement("filterScope").val();var t="";i&&(t=e.getElement("booleanLogic").val()),r.parseBooleanFilterString(t,o,e)}}],{resizable:!0,height:t}),e.getElement("filterScope").kendoDropDownList({dataTextField:"label",dataValueField:"name",dataSource:e.settings.metadata.supportedScopes,value:e.settings.pageInfo.scope,change:function(e){}})},showFilter:function(e){var t="Filter Logic";if(e.settings.pageInfo.filterId)return void a.popup(t,"Grid is filtered by a List View.");var i;e.settings.pageInfo.selectedRecordIds&&e.settings.pageInfo.selectedRecordIds.length>0&&(i="Grid is filtered to "+e.settings.pageInfo.selectedRecordIds.length+" record"+(1==e.settings.pageInfo.selectedRecordIds.length?"":"s"));var n=jQuery.extend(!0,{},e.gridDataSource.filter());this.removeEmptyFilterArrays(n,!0);var o=[],r=[this.getFilterTreeViewData(n,null,o,null,void 0,e)];if(void 0==r[0]){var s=window.innerHeight<=300?window.innerHeight-50:125;return void this.showWindow(e,s,!1,i)}if(r[0].rootNode=!0,void 0!=r[0].items&&r[0].items.length>0){r[0].text=r[0].text.substring(1);for(var l=r[0].items[r[0].items.length-1];;){if(!(void 0!=l.items&&l.items.length>0))break;l=l.items[l.items.length-1]}l.text=l.text.slice(0,-1)}var d=this;setTimeout(function(){$.each(o,function(t,i){var a=[d.getFilterTreeViewData(n,null,o,i.childRelName,void 0,e)];if(void 0==a[0])return!0;a[0].rootNode=!0;for(var s=null,l=r[0],c=0;;){if(void 0!=l.childRelName&&l.childRelName==i.childRelName&&void 0!=l.isChildField&&0==l.isChildField){s=l;break}if(void 0==r[0].items||r[0].items.length<=c)break;l=r[0].items[c],c++}s.text=kendo.format("{0}({1} where",0===s.text.lastIndexOf("AND",0)?"AND ":"",s.text);for(var u=a[0];;){if(!(void 0!=u.items&&u.items.length>0))break;u=u.items[u.items.length-1]}u.text+=")";var f=a;$.merge(f,s.items),s.items=f}),0!=e.getElement("filterTreeView").length&&(e.getElement("filterTreeView").data("kendoTreeView").destroy(),e.getElement("filterTreeView").remove());var t=window.innerHeight<=300?window.innerHeight-50:195;d.showWindow(e,t,!0,i,n);var a=d.getBooleanFilterString(n);e.getElement("booleanLogic").val(a.substring(1,a.length-1));var s=e.getElement("filterTreeView").kendoTreeView({dataSource:r,template:"(#=item.nodeIndex#) #if(item.rootNode === false){# #=item.logic# #}# #=item.text# "}).data("kendoTreeView");s.expand(".k-item"),s.element.find("span.k-icon").hide()},500)}};return r}),crmc.define("FieldChooserTour",[],function(){var e=[{content:"Check here to add a column to the grid",position:function(e){return $(kendo.format("{0} tbody>tr input",e.getElementId("fieldTreeView"))).first()},direction:"left"},{content:"Start typing a part of a field name here to search for a specific field",position:function(e){return $(kendo.format("{0} thead>tr input",e.getElementId("fieldTreeView")))}},{content:"Click here to sort by data type",position:function(e){return $(kendo.format("{0} thead>tr th[data-title=Type]",e.getElementId("fieldTreeView")))},direction:"left"},{content:"Click here to expand the fields of this parent relationship and add a field",position:function(e){return $(kendo.format("{0} tbody>tr span.k-i-expand:eq(0)",e.getElementId("fieldTreeView")))},action:function(e){var t=$(kendo.format("{0} tbody>tr span.k-i-expand:eq(0)",e.getElementId("fieldTreeView")));if(t&&t.length){var i=t.position();e.getElement("fieldTreeView").find(".k-grid-content").animate({scrollTop:i.top},0)}},direction:"left"}];return e}),crmc.define("GuidedTour",["FieldChooserTour"],function(e){var t={toolbar:function(e){return $(e.getElementId("grid"))},fieldChooserButton:function(e){return $(e.getElementId("configButton"))},actionsButton:function(e){return $(e.getElementId("actionMenu"))},filterIcon:function(e){return $("span.k-filter").first().parent()},footer:function(e){return $("tr.k-footer-template").first()}},i=[],n=[{content:"Welcome to ActionGrid, a better way to interact with your Salesforce data! To get started take a quick tour...",position:function(e){return e.getElement("grid")},direction:"center"},{content:"The Field Chooser can be used to add columns to ActionGrid.",position:t.fieldChooserButton,action:function(e){e.showFieldChooser(!0)},tips:e},{content:"Double click on a row to navigate the record's page layout",position:function(e){return $(kendo.format("{0} table>tbody tr.k-master-row:eq(0)",e.getElementId("grid")))},action:function(e){e.kendoGrid.select(kendo.format("{0} table>tbody tr.k-master-row:eq(0)",e.getElementId("grid"))),e.fieldSplitter.collapse(".k-pane:last")}},{content:"Click here to sort by this column",position:function(e){return $(kendo.format("{0} table>thead th[data-role=columnsorter]:eq(0)",e.getElementId("grid")))},action:function(e){e.kendoGrid.clearSelection()}},{content:"Click here to filter on this column",position:t.filterIcon,direction:"right"},{content:"Drag column here to group results by distinct values",position:function(e){return $(kendo.format("{0} div.k-grouping-header",e.getElementId("grid")))}},{content:"Click here to enable Inline Edit Mode of the grid",position:function(e){return $(e.getElementId("editButton"))}},{content:"Click here to create new records (drop down to see option to add in place or in new window)",position:function(e){return $(e.getElementId("newButton")).next("a.k-split-button-arrow")},direction:"right",action:function(e){try{var t=$(e.getElementId("newButton")).next("a.k-split-button-arrow");t.length&&(t.trigger("mousedown"),t.trigger("mouseup"))}catch(e){}}},{content:"Click here to change the number of records loaded per page",position:function(e){return $(kendo.format("{0} div.k-grid-pager span.k-pager-sizes span.k-dropdown",e.getElementId("grid")))},direction:"top",action:function(e){try{var t=$(e.getElementId("newButton")).next("a.k-split-button-arrow");t.length&&(t.trigger("mousedown"),t.trigger("mouseup"))}catch(e){}}},{content:"Click here to view more pages of results",position:function(e){return $(kendo.format("{0} div.k-grid-pager span.k-i-arrow-e",e.getElementId("grid")))},direction:"top"},{content:"You can save the current state of the ActionGrid as a saved view",position:function(e){return $(e.getElementId("saveView"))}},{content:"Load saved views here, including views shared by other users",position:function(e){return $(kendo.format("{0} div.k-grid-toolbar span.k-dropdown",e.getElementId("grid")))}},{content:"Click here to reset the view to the system default or a saved default",position:function(e){return $(e.getElementId("resetAllViews"))},direction:"left",action:function(e){var t=$(e.getElementId("resetAllViews")).next("a.k-split-button-arrow");t&&(t.trigger("mousedown"),t.trigger("mouseup"))}},{content:"Click here to clear filtering but retain the view",position:function(e){return $(e.getElementId("clearFilters"))},direction:"left"},{content:"Click here to access the Actions Menu (Be sure to select records first!)",position:t.actionsButton,direction:"right",action:function(e){var t=$(e.getElementId("resetAllViews")).next("a.k-split-button-arrow");t&&(t.trigger("mousedown"),t.trigger("mouseup"))}}],a={start:function(e){i=e.tips||n.slice(0),this.options=e;var t=this;$(document.body).delegate("button.btnNext","click",function(){t.showNext()}),$(document.body).delegate("button.btnNo","click",function(){t.hide()}),this.showNext()},hide:function(){this.tooltip&&this.tooltip.hide()},showNext:function(){this.hide();var e=i.shift();if(e){var t='<div style="max-width:300px; padding-bottom:5px;">{0}</div>',n='<button class="btnNext" style="float:right;">Continue</button>',a=(!this.tooltip,kendo.format('<div style="margin-top:-7px;">{0}</div>',n));this.tooltip=$("<div>").kendoTooltip({position:e.direction||"bottom",autoHide:!1,showOn:"focus",content:function(){return kendo.format(t,e.content)+a},show:function(e){$(e.sender.content).find("button").kendoButton(),$(e.sender.popup.element).addClass("k-tooltip-help")}}).data("kendoTooltip");try{this.tooltip._initPopup(),this.tooltip.popup.options.modal=!0;var o=e.position(this.options.grid);if(!o||!o.length||!o.is(":visible"))throw"Unable to position tooltip";e.action&&"function"==typeof e.action&&e.action(this.options.grid),this.tooltip.show(o),e.tips&&e.tips.length>0&&(i=e.tips.concat(i));
}catch(e){this.showNext()}}}};return a}),crmc.define("Toolbar",["CustomSettings","sfdc","FilterLogic","GuidedTour","ReadOnlyObjects","SFRest","Notification","tooling","mixpanel"],function(e,t,i,n,a,o,r,s,l){var d={dragHandle:{type:"separator",attributes:{class:"dragHandle",style:"cursor: move;"},overflow:"never"},newButton:{type:"button",label:"New",icon:"plus",id:"newButton",overflow:"never",init:function(t){var i=!1,n=!1;t.settings.metadata.getBoolean("createable")&&(t.settings.metadata.urlNew&&t.settings.metadata.urlNew.length>0&&e.getSetting(t.settings.pageInfo.objectName,"newButton")!==!1&&(i=t.settings.enableNewButton),e.getSetting(t.settings.pageInfo.objectName,"inlineNew")!==!1&&t.settings.enableEdit&&e.getSetting(t.settings.pageInfo.objectName,"editButton")!==!1&&(n=t.settings.enableNewInline));var a=t.createNewInline;n||i&&(a=t.createInNewWindow),i&&n?(this.menuButtons=[{id:t.settings.id+"createNewWindow",text:"In New Window",icon:"restore",click:function(){t.createInNewWindow()}},{id:t.settings.id+"createInline",text:"Add Inline",icon:"insert-m",click:function(){t.createNewInline()}}],this.type="splitButton"):(delete this.menuButtons,this.type="button"),this.attributes={class:"k-button",title:"New "+t.settings.metadata.label},this.text=t.settings.metadata.label,this.enable=i||n,this.click=function(){a.apply(t)}}},editButton:{type:"button",text:"Edit",attributes:{title:"Toggle inline edit mode"},icon:"pencil",id:"editButton",overflow:"never",togglable:!0,hasSetting:function(t){return t.settings.enableEdit&&t.settings.metadata.getBoolean("updateable")&&e.getSetting(t.settings.pageInfo.objectName,"editButton")!==!1},init:function(e){this.toggle=function(){e.settings.editable=!e.settings.editable,e.settings.editable?e.enterEditMode():e.cancelEditMode()},void 0!=a[e.settings.pageInfo.objectName]&&(this.enable=!0)}},quickSaveView:{text:"Save View",attributes:{class:"k-button",title:"Save View"},featureSecurity:"saveView",icon:"tick",click:function(e){e.settings.isChildGrid?e.settings.parentGrid.quickSaveView():e.quickSaveView()}},saveButton:{type:"splitButton",text:"Save",icon:"tick",id:"saveButton",menuButtons:[],attributes:{class:"k-button",title:"Save all view and data changes"},hasSetting:function(t){return t.settings.editable?t.settings.enableEdit&&t.settings.metadata.getBoolean("updateable")&&e.getSetting(t.settings.pageInfo.objectName,"editButton")!==!1:!t.settings.isChildGrid&&e.getSetting(t.settings.pageInfo.objectName,"saveView")!==!1},init:function(t){var i=[];this.type="splitButton",t.settings.editable?(this.text="Save",this.attributes={class:"k-button",title:"Save"},this.click=function(){t.saveDataAndView()},this.menuButtons=[],i=[d.quickSaveView,d.saveViewButton,d.saveDataButton,d.revertDataButton]):(this.menuButtons=[],i=[d.saveViewButton],d.editButton.hasSetting(t)?(d.editButton.init(t),this.text=d.editButton.text,this.icon=d.editButton.icon,this.attributes=d.editButton.attributes,this.click=d.editButton.toggle,t.settings.isChildGrid?this.type="button":i.unshift(d.quickSaveView)):(this.text=d.quickSaveView.text,this.attributes=d.quickSaveView.attributes,this.click=d.quickSaveView.click));for(var n=0;n<i.length;n++)i[n].featureSecurity&&e.getSetting(t.settings.pageInfo.objectName,i[n].featureSecurity)===!1||i[n].hasSetting&&!i[n].hasSetting(t)||(this.menuButtons.push(i[n]),h.initToolbarItem(i[n],t))},postInit:function(e){e.gridDataSource.hasChanges()&&e.setSaveButtonDirty(!0)}},actionsMenu:{type:"button",text:"Actions",icon:"lightning",id:"actionMenu",overflow:"never",attributes:{class:"k-button",title:"Actions"},init:function(e){this.click=function(t){var i=e.getElement("actionMenu"),n=i.offset(),a=i.height();e.showContextMenu(n.left,n.top+a)}}},viewLabel:{init:function(e){this.template=kendo.format('<strong style="padding-left:0.69em; padding-right: 0.69em;" id="{0}_viewLabel">View:</strong>',e.settings.id)}},saveDataButton:{text:"Save Data",icon:"pencil",id:"saveData",featureSecurity:void 0,attributes:{title:"Save pending data changes"},init:function(e){this.click=function(){e.blurEditCell(),e.saveButtonClick()}}},revertDataButton:{text:"Revert Data",icon:"undo",id:"revertData",featureSecurity:"revertData",attributes:{title:"Revert unsaved changes"},init:function(e){this.click=function(){e.setSaveButtonDirty(!1),e.kendoGrid.cancelChanges()}}},saveViewButton:{text:"Save View As…",icon:"tick",id:"saveView",featureSecurity:"saveView",attributes:{title:"Save View As…"},hasSetting:function(e){return e.settings.enableViews},init:function(e){this.click=function(){e.saveNamedView()}}},newViewButton:{text:"New View",icon:"plus",attributes:{title:"Create a new view"},featureSecurity:"saveView",hasSetting:function(e){return e.settings.enableViews},init:function(e){this.click=function(){e.newView()}}},manageViewsButton:{text:"Manage Views",icon:"manage-views",id:"manageView",attributes:{title:"Manage all current views"},featureSecurity:"manageView",hasSetting:function(e){return e.settings.enableViews},init:function(e){this.click=function(){e.manageViewsClick()}}},viewDropDown:{init:function(e){this.template=kendo.format('<div class="k-button-group crmcViewDropDown"><select class="k-group-start" id="{0}_views" style="width: 200px;"/></div>',e.settings.id)},postInit:function(e){e.settings.enableViews&&e.loadViewDropDown()}},readingPaneButton:{overflow:"never",type:"splitButton",text:"Reading Pane",attributes:{title:"Reading Pane Options"},icon:"chooser",id:"readingPaneMenu",init:function(e){var t=this;this.click=function(i){e.checkForDirtyRows(!1,t.click)?t.postInit(e):(e.settings.readingPane.expanded=!e.settings.readingPane.expanded,e.modifySelectedView(),e.preserveSelectedRows(e.settings.editable,!1,!1,function(){if(e.isReadingPaneShowing()&&e.kendoGrid.select().length<1){var t=e.kendoGrid.table.find("tr[data-uid]").first();t.find("input[name='selectedBox"+e.settings.id+"']").prop("checked",!0),e.settings.lockedColumns&&(t=$("[data-uid="+t.data("uid")+"]")),t.addClass("k-state-selected"),e.selectionChanged()}}))};var i=function(i){var n=e.settings.readingPane.position!=i;!n&&e.isReadingPaneShowing()||(e.settings.readingPane.expanded=!0,e.settings.readingPane.position=i,e.settings.readingPane.showText=!0,e.modifySelectedView(),setTimeout(function(){t.postInit(e),e.initReadingPane(n)},1))};this.menuButtons[0].click=function(){i("top")},this.menuButtons[1].click=function(){i("right")},this.menuButtons[2].click=function(){i("bottom")},this.menuButtons[3].click=function(){i("left")}},postInit:function(t){t.isReadingPaneShowing()?t.getElement("readingPaneMenu").addClass("k-state-active"):t.getElement("readingPaneMenu").removeClass("k-state-active"),t.settings.enableReadingPane&&e.getSetting(t.settings.pageInfo.objectName,"readingPane")!==!1||t.getElement("readingPaneMenu_wrapper").css({display:"none"})},menuButtons:[{attributes:{title:"Top"},text:"Top",icon:"arrowhead-n"},{attributes:{title:"Right"},text:"Right",icon:"arrowhead-e"},{attributes:{title:"Bottom"},text:"Bottom",icon:"arrowhead-s"},{attributes:{title:"Left"},text:"Left",icon:"arrowhead-w"}]},resetToDefaultButton:{attributes:{title:"Reset to default view if it exists otherwise system default"},text:"Reset to Default",icon:"refresh",init:function(e){this.click=function(){e.resetView()}}},clearFiltersButton:{text:"Clear Filters",icon:"funnel-clear",id:"clearFilters",attributes:{title:"Reset only current filters"},init:function(e){this.click=function(){e.clearFilters()}}},clearFormattingButton:{text:"Clear Formatting",icon:"shape",attributes:{title:"Reset only current formatting"},init:function(e){this.click=function(){delete e.settings.conditionalRules,e.refresh()}}},resetButton:{type:"splitButton",text:"Reset View",attributes:{title:"Revert unsaved changes to view"},icon:"refresh",id:"resetAllViews",overflow:"never",init:function(t){this.click=function(){var e=t.getSelectedView();e?t.loadSavedView(e):t.resetView()};var i=[d.resetToDefaultButton,d.clearFiltersButton,d.clearFormattingButton,d.newViewButton];this.menuButtons=[];for(var n=0;n<i.length;n++)i[n].featureSecurity&&e.getSetting(t.settings.pageInfo.objectName,i[n].featureSecurity)===!1||(this.menuButtons.push(i[n]),h.initToolbarItem(i[n],t))}},fieldsButton:{type:"button",text:"Fields",overflow:"never",attributes:{title:"Add or remove columns"},icon:"matrix",id:"fieldButton",featureSecurity:"fieldChooser",hasSetting:function(e){return e.settings.enableFieldChooser},init:function(e){this.click=function(){var t=e;e.settings.isChildGrid&&(t=e.settings.parentGrid),t.fieldSplitter&&!t.fieldSplitter.options.panes[1].collapsed?t.showFieldChooser(!1):(t.showFieldChooser(!0),e.settings.isChildGrid?e.settings.fkRelationship?e.settings.parentGrid.fieldChooser.expandChildFields(e.settings.fkRelationship):e.settings.parentGrid.fieldChooser.showChildRelationshipHelp():e.fieldChooser.expandPrimaryFields())}}},configureButton:{type:"splitButton",label:"Configure",overflow:"never",icon:"custom k-i-chooser",attributes:{title:"ActionGrid configuration options"},id:"configButton",text:"Configure",init:function(t){this.click=function(){t.showConfigure()},this.menuButtons=[];for(var i=[d.fieldsButton,d.conditionalFormatButton,d.formulaButton,d.filterLogic,d.manageViewsButton,d.keyboardControlHelpButton,d.helpButton],n=0;n<i.length;n++)i[n].featureSecurity&&e.getSetting(t.settings.pageInfo.objectName,i[n].featureSecurity)===!1||i[n].hasSetting&&!i[n].hasSetting(t)||(this.menuButtons.push(i[n]),h.initToolbarItem(i[n],t));t.settings.isChildGrid&&(this.click=d.fieldsButton.click)},postInit:function(e){var t=e;e.settings.isChildGrid&&(t=e.settings.parentGrid),t.fieldSplitter&&(t.fieldSplitter.options.panes[1].collapsed?t.getElement("configButton").removeClass("k-state-selected"):t.getElement("configButton").addClass("k-state-selected"))}},filterLogic:{type:"button",text:"Filter Logic",attributes:{title:"Display details of the currently applied filter"},id:"showFilter",featureSecurity:"filterLogic",init:function(e){this.click=function(){i.showFilter(e)},this.icon=i.hasFilter(e)?"funnel-active":"funnel"}},formulaButton:{type:"button",text:"Formulas",attributes:{title:"Create a computed field"},icon:"sum",id:"formulas",featureSecurity:"formulaFields",init:function(e){this.click=function(){var t="ff",i=$(e.getElementId(t));kendo.destroy(i),$("body").append($(kendo.format('<div id="{0}">',e.settings.id+"_"+t))),$(e.getElementId(t)).kendoFormulaWindow({grid:e})}}},conditionalFormatButton:{type:"button",text:"Conditional Formatting",attributes:{title:"Apply conditional color formatting to cells or rows"},icon:"paint",id:"formatting",featureSecurity:"conditionalFormatting",hasSetting:function(e){return e.settings.enableFormatting},init:function(e){this.click=function(){var t=$(e.getElementId("cf"));0!=t.length?(t.data("kendoConditonalFormatting").destroy(),t.empty()):$("body").append($(kendo.format('<div id="{0}">',e.settings.id+"_cf"))),$(e.getElementId("cf")).kendoConditonalFormatting({grid:e})}}},searchText:{template:function(e){return'<input id="'+e.getElementId("grid")+'searchText" type="search" class="k-textbox" placeholder="Search"/>'},attributes:{title:"Search all searchable text fields"},init:function(e){this.template=function(){var t=$(kendo.format('<input id="{0}_searchText" style="width:130px;" type="search" class="k-textbox" placeholder="🔎 Search {1}"/>',e.settings.id,e.settings.metadata.labelPlural));e.settings.searchText&&t.val(e.settings.searchText);var i,n=function(){clearTimeout(i),i=setTimeout(function(){var i=t.val();if(!e.checkForDirtyRows(!1))if(i.length>1){var n=t.val();e.searchText(n),e.settings.searchText=n}else 1==i.length?(r.showMessage({title:"Search",message:"Length must be greater than 1 character"},"error"),t.focus()):0==i.length&&""!=e.settings.searchText&&(e.settings.searchText="",e.settings.pageInfo.selectedRecordIds=[],e.gridDataSource.read())},300)};return t.on("keypress search",function(){n()}),t.on("keydown",function(e){e&&e.key&&"backspace"==e.key.toLowerCase()&&n()}),t.on("focusin",function(){t.one("mouseup",function(){var e=0==t.parent().parent().siblings().length;e&&t.animate({width:"250px"},300)})}),t.on("focusout",function(){t.animate({width:"130px"},300)}),t}},postInit:function(e,t){$(t.element).off("keydown")}},keyboardControlHelpButton:{type:"button",text:"Keyboard Shortcuts",attributes:{title:"Keyboard shortcut help menu"},icon:"keyboard",id:"help",init:function(e){this.click=function(){e.showKeyboardHelp(!0)}}},helpButton:{type:"button",text:"Help",attributes:{title:"View ActionGrid Guided Tour"},icon:"help",id:"help",init:function(e){this.click=function(){n.start({grid:e})}}}},c={Search:{visible:!0,row:1,index:2}},u={Views:{visible:!0,row:0,index:1},Edit:{visible:!0,row:1,index:0},Configure:{visible:!0,row:1,index:2},"Reading Pane":{visible:!0,row:1,index:1},Search:{visible:!0,row:0,index:0},"Reset View":{visible:!0,row:0,index:2}},f={Views:[d.dragHandle,d.viewLabel,d.viewDropDown],Edit:[d.dragHandle,d.newButton,d.saveButton,d.actionsMenu],Configure:[d.dragHandle,d.configureButton],"Reading Pane":[d.dragHandle,d.readingPaneButton],Search:[d.dragHandle,d.searchText],"Reset View":[d.dragHandle,d.resetButton]},p={Views:"viewGroup",Edit:"editGroup",Configure:"configGroup","Reading Pane":"readingPaneGroup",Search:"searchGroup","Reset View":"resetViewGroup"},h={init:function(e,t,i,n){var a=Object.create(this);a.element=t,a.toolbarGroups=Object.copy(f),a.actionGrid=e,a.groups={},a.loadState(i,n);var o=function(t,o){if("function"==typeof o.isToolbarAvailable){var r=e.getActionContext(),s=o.getLabel&&o.getLabel(r),l=[d.dragHandle,{text:s,id:s,type:"button",init:function(e){this.click=function(){var t=e.getActionContext();o.click(t)},this.isAvailable=function(){var t=e.getActionContext();return o.isToolbarAvailable(t)}}}];f[s]=l,a.toolbarGroups[s]=l,i&&i[s]&&i[s].visible&&a.loadState(i,n)}};return $(window.document).off("addCustomAction."+e.getElementId("toolbar")),$(window.document).on("addCustomAction."+e.getElementId("toolbar"),o),e.getElement("toolbarHandle").on("click",function(t){var i="none"==e.getElement("toolbar").css("display");e.getElement("toolbar").css("display",i?"block":"none"),$(this).css("background-position",i?"2px 0px":"2px -30px"),e.settings.toolbarCollapsed=!i,e.redraw(),e.modifySelectedView()}),a},initToolbarItem:function(e,t){if(e.id&&(e.itemName||(e.itemName=e.id),e.id=t.settings.id+"_"+e.itemName),"function"==typeof e.init&&e.init(t),"function"==typeof e.click){var i=e.click;e.click=function(){var n={type:"Toolbar Button",objectName:t.settings.pageInfo.objectName};l.track(e.text||e.label,n),i(t)}}},saveState:function(){var e={},t=this;return Object.each(f,function(i,n){var a=t.groups[n]&&t.groups[n].element;if(i&&a){var o=t.row1Container.find(a).length>0?1:0,r=a.prevAll().length,s=t.row1Container.find(a).length>0||t.row0Container.find(a).length>0||!1;e[n]={visible:s,row:o,index:r}}else{var l=Object.create(u[n]||{});l.visible=!1,e[n]=l}}),e},getAvailableGroups:function(e){var t=[],i=this,n=this.actionGrid,a=e||this.saveState(),o=[];Object.each(a,function(e,t){e.name=t,o.push(e)});var r=0;return Object.each(f,function(){r++}),o.length!=r&&Object.each(f,function(e,t){var i=Object.first(o,function(e){return e.name==t});if(!i){var n=["Views","Configure","Edit"],a=Object.create(u[t]||{});a.name=t,a&&(n.indexOf(t)>-1&&(a.visible=!1),o.push(a))}}),o=Array.orderBy(o,function(e){return e.index}),Object.each(o,function(e){var a=[],o=f[e.name];if(Object.each(f[e.name],function(e){i.initToolbarItem(e,n),"function"==typeof e.isAvailable?e.isAvailable()&&a.push(e):a.push(e)}),o==f.Views){if(n.settings.enableViews===!1)return}else{if(o==f["Reading Pane"]&&n.settings.isChildGrid)return;if(o==f["Reset View"]&&!n.settings.enableViews)return;if(o==f.Edit){for(var r=[],s=0;s<f.Edit.length;s++)f.Edit[s].hasSetting&&!f.Edit[s].hasSetting(n)||r.push(f.Edit[s]);a=r}}a&&a.length>1&&t.push(e),i.toolbarGroups[e.name]=a}),t},loadState:function(i,n){var a=this.actionGrid,o=this.element,r=this;$(o).empty(),a.settings.isChildGrid&&Object.each(c,function(e,t){void 0!=u[t]&&(u[t]=e)});var s=i||u,l=document.doctype&&document.doctype.publicId&&document.doctype.publicId.toLowerCase().indexOf("transitional")>-1,d='<div id="{0}" style="padding-right:35px;">';l&&(d='<div id="{0}" style="padding:0.3em; padding-right:35px;">');var f=a.getElementId("toolbarRow0").replace("#",""),h=$(kendo.format(d,f));o.append(h);var g=a.getElementId("toolbarRow1").replace("#",""),m=$(kendo.format(d,g));o.append(m);var v=(a.settings.id,t.parseAsObject());if(!a.settings.isChildGrid&&!v.disableFS&&a.settings.enableFullscreen!==!1&&e.getSetting(a.settings.pageInfo.objectName,"fullScreenMode")!==!1){var b=$('<div style="position:absolute; right: 5px; top: 6px;">'),y=$('<button title="Toggle Fullscreen Mode">');y.kendoButton({icon:"restore",click:function(){a.toggleFullscreen()}}),b.append(y),o.append(b)}Object.each(r.getAvailableGroups(s),function(e){if(e&&e.visible){var t=r.toolbarGroups[e.name],i=a.getElementId(p[e.name]).replace("#",""),n=$(kendo.format('<div class="toolbarGroup" id="{0}">',i));e.row>0?m.append(n):h.append(n);var s=n.kendoToolBar({items:t,resizable:!1});r.groups[e.name]=s.data("kendoToolBar"),Object.each(t,function(t){"function"==typeof t.postInit&&t.postInit(a,r.groups[e.name])});n.data("kendoToolBar");o.trigger("resize")}});var k=function(e){return e.clone().css({opacity:"0.4",border:"1px dashed #a6a6a6"})},w=function(e){return e.clone().css({width:"250px",height:"100px","font-size":"11px",overflow:"hidden"}).height(e.height()).width(e.width()+5)},x=function(){var e={"min-height":"33px"};$("#"+f).css(e),$("#"+g).css(e)},I=function(e){var t={"min-height":"inherit"};$("#"+f).css(t),$("#"+g).css(t),a.redraw()},S=function(){a.modifySelectedView()};h.kendoSortable({filter:">div",cursor:"move",handler:".dragHandle",connectWith:"#"+g,placeholder:k,hint:w,start:x,end:I,change:S,ignore:".k-textbox"}),m.kendoSortable({filter:">div",cursor:"move",handler:".dragHandle",connectWith:"#"+f,placeholder:k,hint:w,start:x,end:I,change:S,ignore:".k-textbox"}),r.row0Container=h,r.row1Container=m,n?a.getElement("toolbar").css("display","none"):a.getElement("toolbar").css("display","block")},enable:function(e,t){Object.each(this.groups,function(i){$(i.element).find(e).length>0&&i.enable(e,t)})},toggleGroup:function(e){var t=this.saveState()||{};t&&t[e]?t[e].visible=!t[e].visible:u[e]?t[e]=u[e]:t[e]={visible:!0},this.actionGrid.modifySelectedView(),this.loadState(t),this.actionGrid.redraw()}};return h}),crmc.define("HoverHelp",[],function(){var e="/{0}/m?retURL=%2F{0}&isAjaxRequest=1",t={},i="HoverHelpProxyEvent",n={mouseenter:function(n){setTimeout(function(){if($(":hover").filter($(n.target)).length>0){var a=$(n.target).data("id");if(void 0!=a)var o=a.substring(0,3);void 0==t[o]&&($(n.target).data("content")?$(n.target).trigger(i):$.ajax({url:kendo.format(e,a),type:"GET",success:function(e){$(":hover").filter($(n.target)).length>0&&($(n.target).data("content",e),$(n.target).trigger(i))}}).fail(function(){t[o]=!0}))}},600)},init:function(e){$("#"+e.settings.id).off("mouseenter",this.mouseenter),$("#"+e.settings.id).on("mouseenter","a.agHoverHelp",this.mouseenter),$("#"+e.settings.id).kendoTooltip({filter:"a.agHoverHelp",content:function(e){e.sender.popup.element.removeClass("k-widget"),e.sender.popup.element.addClass("agHoverHelp");var t=$(e.target).data("content");return $(t).css({overflow:"auto","max-height":"320px",width:"370px","min-height":"100px",height:"auto"})},showAfter:0,showOn:i,position:"right"})}};return n}),crmc.define("LightningDelegate",["ActionGridDelegate","KendoEntry","sfdc"],function(e,t,i){var n=function(e,t){window.SfdcApp&&SfdcApp.projectOneNavigator&&"function"==typeof SfdcApp.projectOneNavigator.fireContainerEvent?SfdcApp.projectOneNavigator.fireContainerEvent(e,t):window.parent.postMessage({type:"event",eventName:e,eventArgs:t},"*")},a=Object.create(e);return a.createInNewWindow=function(){var e=this,a=e.settings.metadata&&e.settings.metadata.recordTypeInfos&&e.settings.metadata.recordTypeInfos.length>0;if(a){var o="RecordTypeId",r=Object.first(e.settings.metadata.fields,function(e){return e.name==o});t.entry("Select a Record Type",[{name:o,label:"Record Type",type:"reference",referenceTo:"RecordType",fullMeta:r}],{objectName:this.settings.pageInfo.objectName},void 0,function(t){var a=t[o].value;i.isSalesforceId(a)&&n("force:createRecord",{entityApiName:e.settings.pageInfo.objectName,recordTypeId:a})})}else n("force:createRecord",{entityApiName:this.settings.pageInfo.objectName})},a}),crmc.define("customPanes/detailGrid",["ColumnFactory","FieldChooser","GridDataProvider","CustomSettings","sfdc"],function(e,t,i,n,a){var o,r,s,l=0,d=3,c={},u={fieldNames:[],fieldSettings:{},itemID:"detailGrid",mainDiv:void 0,_update:function(){var e=u.mainDiv?u.mainDiv.find("[name=detailGridDiv]"):void 0;return e&&e.data("kendoGrid")&&e.data("kendoGrid").dataSource.read(),!0},isAvailable:function(e){return e.actionGrid.isReadingPaneTabEnabled("detailGrid")&&n.getSetting(e.objectDescribe.name,this.itemID)!==!1},getLabel:function(e){return"Detail Grid"},select:function(e,t){if(u.mainDiv=t,e){s=e.selectedRows;var i=t.find("[name=detailGridDiv]");i.data("kendoGrid")?i.data("kendoGrid").dataSource.read():this.loadView(e,t,e.actionGrid.saveView())}},saveView:function(e,t,i){u.mainDiv=t,i.readingPane&&(i.readingPane[this.itemID]||(i.readingPane[this.itemID]={}),i.readingPane[this.itemID].fieldNames=this.fieldNames,i.readingPane[this.itemID].fieldSettings=this.fieldSettings)},loadView:function(t,f,p){function h(){function i(e){var t,i=S.data("kendoGrid"),n=i.table.clone(),a=i.wrapper.width(),o=$("<div class='k-grid k-widget'></div>").width(a);return n.find("thead").remove(),n.find("tbody").empty(),n.wrap(o),n.append(e.clone().removeAttr("uid")),t=n.parent()}s=t.selectedRows;var n=new kendo.data.DataSource({schema:{model:{id:"field",fields:{label:{updateable:!1},field:{updateable:!1},value:{}}}},batch:!0,transport:{read:function(i){var n=[];if(s.length>0){var a=s[0],o=!1,u=0;n=g.fieldNames.map(function(i){var n=Object.first(r.config.fieldMeta,function(e){return e.name==i});if(!n)return void(a.fields[i]||(l<d?(t.actionGrid.addRemoveColumn(i,0,!0),o=!0):(console.log("detailgrid field "+i+" definitively not found, was it deleted?"),g.fieldNames.remove(i))));if("REFERENCE"!=n.type&&"CHILD"!=n.type){var i=n.name,s=t.objectDescribe.fields.filter(function(e){return e.name==n.name}),f=s.length>0?s[0]:new sforce.Xml;c[i]||("textarea"==n.type.toLowerCase()?c[i]=function(e,t){var n='style="max-width:'+e.width()+"px; width: "+e.width()+"px; ";g.fieldSettings[i]&&g.fieldSettings[i].height&&(n+="height:"+g.fieldSettings[i].height+"px"),n+='"';var a=$("<textarea "+n+' data-bind="value: '+t.field+'" class="k-input k-textbox"></textarea>'),o="textAreaHover";a.on("keydown",function(e){switch(e.keyCode){case kendo.keys.TAB:t.model.set(t.field,a.val());break;case kendo.keys.UP:case kendo.keys.DOWN:case kendo.keys.ENTER:e.stopPropagation()}}),a.on("dblclick",function(e){a.height()-e.offsetY<10&&a.width()-e.offsetX<10&&(g.fieldSettings[i]||(g.fieldSettings[i]={}),g.fieldSettings[i].height=void 0,a.css("height",""))}),a.on("mouseup",function(){g.fieldSettings[i]||(g.fieldSettings[i]={}),g.fieldSettings[i].height=a.outerHeight()}),a.on("mousemove",function(e){a.height()-e.offsetY<10&&a.width()-e.offsetX<10&&r.trigger(o)});var r=$('<div style="width:'+e.width()+'px" />');return a.appendTo(r),r.kendoTooltip({content:function(e){return $("<div>Double Click to shrink text area</div>")},showAfter:0,width:230,showOn:o}),r.appendTo(e),a}:c[i]=r.createEditor(i));var p;p="textarea"==n.type?function(e){var t="";return g.fieldSettings[i]&&g.fieldSettings[i].height&&(t='style="height:'+g.fieldSettings[i].height+'px"'),e[i]?"<div "+t+">"+e[i]+"</div>":""}:r.createTemplate(i);var h={field:i,label:e.getHeaderTitle(n,r.config.fieldMeta),value:a[i],editor:c[i],template:p,updateable:f.getBoolean("updateable"),type:n.type};if(h[i]=a[i],h.Order=u++,a.dirty&&(h.dirty=!0,h.dirtyFields={value:a[i]},h.dirtyFields[i]=a[i]),i.indexOf(".")>0){names=i.split(".");var m=names[0];try{var v=/__(p?)r$/,b=m+"Id";m.match(v)&&(b=m.replace(v,"__$1c"));var y=Object.first(t.objectDescribe.fields,function(e){return e.name===b});h.updateable=y.getBoolean("updateable");var k=a;for(h[m]=a[m];names.length>0;)m=names.splice(0,1)[0],h.value=k[m],k=k[m];h.idName=b,a.dirty&&(h.dirtyFields[b]=a[b],h.dirtyFields[m]=a[m])}catch(e){console.log("Error in parental Field"+e),h.updateable=!1}}return h}}).filter(function(e){return e}),o?(l++,t.actionGrid.preserveSelectedRows(t.actionGrid.settings.editable,!1,void 0,function(){g.loadView(t,f)})):l=0,i.success(n);try{Object.each(s[0].dirtyFields,function(e,t){var i=S.data("kendoGrid")._data.filter(function(e){return e.field==t||e.idName==t})[0];if(i){var n=$(kendo.format("#{2} tr[data-uid={0}] td:not(.k-group-cell,.k-hierarchy-cell):eq({1})",i.uid,1,f.attr("id")));n&&(n.hasClass("k-dirty-cell")||(n.addClass("k-dirty-cell"),n.prepend("<span class='k-dirty'></span>")))}})}catch(e){console.log(e)}return!0}return i.error(),!1}}}),o=S.kendoGrid({selectable:"multiple cell",allowCopy:!0,resizable:!0,columns:[{field:"label",title:"Label",template:'<span class="handler">#= label #</span>',editable:!1,editor:function(){}},{field:"value",title:"Value",template:function(e){return e.template?e.template(e):null!==e[e.field]?e[e.field]:e.value||""},editor:function(e,t){if(t.model.editor)return t.field=t.model.field,t.model.editor.apply(this,[e,t]);var i=$('<input class="k-input k-textbox" />');i.attr("name",t.model.field),i.appendTo(e)},attributes:{class:"#= editable? '': 'readOnly' #"}}],dataSource:n,editable:!0,dataBound:function(e){$(this.element).is(":visible")&&this.autoFitColumn(0)},save:function(e){var i=e.model.field;"textarea"==e.model.type&&(g.fieldSettings[i]||(g.fieldSettings[i]={}),g.fieldSettings[i].height=e.container.height());var n=e.values.value||e.values[i];e.container.addClass("k-dirty-cell"),e.preventDefault(),e.model[i]=n,s[0].dirtyFields||(s[0].dirtyFields={}),s[0].dirty=!0;var o=function(e){s[0].dirtyFields[e]=n,s[0][e]=n};if(i.indexOf(".")>-1){if(a.isSalesforceId(n)||null==n){var r=i.split(".");s[0][i]=e.model.value,o(a.getIdFieldFromRelationshipName(r[0]))}}else i.indexOf("_input")>-1&&!s[0].hasOwnProperty(i)?o(i.substring(0,i.lastIndexOf("_input"))):"_events"===i||o(i);t.actionGrid.setSaveButtonDirty(!0);for(var l=0,d=t.kendoGrid.columns.length;l<d;l++){var c=t.kendoGrid.columns[l];if(c.field===i){var u=$(kendo.format("{2} tr[data-uid={0}] td:not(.k-group-cell,.k-hierarchy-cell):eq({1})",s[0].uid,l,t.actionGrid.getElementId("grid")));if(u){var f=function(){u.hasClass("k-dirty-cell")||(u.addClass("k-dirty-cell"),u.prepend("<span class='k-dirty'></span>"))};if(i.indexOf(".")>-1){var p=e.container.find('[name="'+e.model.field+'"]');if(p.length>0){var h={};h[e.model.field]=p.data("kendoComboBox").text(),h[e.model.field.split(".")[0]]={Id:p.data("kendoComboBox").value()},u.html(e.model.template(h))}else u.html(e.container.html());setTimeout(f,200)}else t.kendoGrid.editCell(u),t.kendoGrid.closeCell(),f();break}}}},edit:function(e){e.model.updateable&&0!==this.select().index()||this.closeCell()}});o=o.data("kendoGrid"),void 0!==o&&o.table.kendoSortable({hint:i,cursor:"move",placeholder:function(e){return e.clone().addClass("k-state-hover").css("opacity",.65)},handler:".handler",ignore:"input, textarea",container:f.selector+" tbody",filter:">tbody >tr",change:function(e){var t=S.data("kendoGrid"),i=e.oldIndex,n=e.newIndex,a=t.dataSource.view(),o=t.dataSource.getByUid(e.item.data("uid"));if(o.Order=n,o.dirty=!0,i<n)for(var r=i+1;r<=n;r++)a[r].Order--,a[r].dirty=!0;else for(var r=i-1;r>=n;r--)a[r].Order++,a[r].dirty=!0;g.fieldNames=a.sort(function(e,t){return e.Order-t.Order}).map(function(e){return e.field})}})}u.mainDiv=f;var g=this;g.fieldNames=[],t.kendoGrid.dataSource.unbind("change",u._update),t.kendoGrid.dataSource.bind("change",u._update);var m=$(f),v=t.actionGrid,b=function(){t.actionGrid.forceKeyboardFocus()},y=function(e){var t=$(v.getElement("customRP_detailGrid")),i=t.find("[name=detailGridDiv]").data("kendoGrid"),n=$(t.find("tr.k-grid-edit-row"));if(n.length>0){var a;a=e?n.prevAll().first():n.nextAll().first(),0==a.length&&(a=e?n.nextAll().last():n.prevAll().last()),i.editCell(a.children().last())}};m.off("keydown.ag");var k=function(e){var t=$(document.activeElement);t.closest(".k-grid");switch(e.keyCode){case kendo.keys.TAB:setTimeout(function(){y(e.shiftKey)}),e.preventDefault();break;case"S".charCodeAt(0):e.shiftKey||(e.ctrlKey||e.metaKey)&&v.settings.editable&&(setTimeout(function(){v.saveButtonClick()}),e.preventDefault()),e.shiftKey&&(e.ctrlKey||e.metaKey)&&0!=n.getSetting(v.settings.pageInfo.objectName,"saveView")&&(setTimeout(function(){v.quickSaveView()}),e.preventDefault());break;case 191:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){v.showKeyboardHelp(!1)},1e3),e.preventDefault());break;case 219:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){b()}),e.preventDefault());break;case 221:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){b()}),e.preventDefault());break;case 220:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){v.showConfigure()}),e.preventDefault());break;case kendo.keys.UP:setTimeout(function(){y(!0)}),e.preventDefault();break;case kendo.keys.DOWN:setTimeout(function(){y(!1)}),e.preventDefault();break;case kendo.keys.ENTER:setTimeout(function(){y(e.shiftKey)}),e.preventDefault()}};m.on("keydown.ag",k.bind(m)),t.actionGrid.settings.readingPane[g.itemID]?(g.fieldNames=t.actionGrid.settings.readingPane[g.itemID].fieldNames,g.fieldSettings=t.actionGrid.settings.readingPane[g.itemID].fieldSettings||{}):t.actionGrid.settings.readingPane[g.itemID]={};var w=function(e){var i=e.draggable.currentTarget.data().field;if(i){var n=g.fieldNames?g.fieldNames.indexOf(i):-1;n>-1?(g.fieldNames.splice(n,1),delete g.fieldSettings[i]):(g.fieldNames||(g.fieldNames={}),g.fieldNames.push(i),g.fieldSettings[i]={}),t.selectedRows=t.actionGrid.getSelectedItems(),g.select(t,f)}},x=function(e){$(e.target).find("span").removeClass("k-denied"),$(e.target).find("span").addClass("k-i-pin")},I=function(e){$(e.target).find("span").addClass("k-denied"),$(e.target).find("span").removeClass("k-i-pin")};f.kendoDropTarget({group:t.actionGrid.getElement("grid").data().kendoReorderable.options.draggable.options.group,drop:w,dragenter:x,dragleave:I}),f.empty();var S=$('<div name="detailGridDiv" />');f.append(S);var C=$.extend(!0,{},t.actionGrid.settings);i.create(C,{allowParentalEditing:function(){return t.actionGrid.allowParentalEditing()},onReadFieldMetadata:function(i,n,a){r||(r=e.initFactory({settings:C,getRecordTypes:function(e){return t.actionGrid.getRecordTypes(e)},picklistValuesFactory:function(e,i){return t.actionGrid.getPicklistValues(e,i)}})),r.config.fieldMeta=n},onDataSourceReady:function(e,t){r.fieldMeta=t,o=e,h()}})}};return u}),crmc.define("customPanes/chart",["ColumnFactory","FieldChooser","sfdc","CustomSettings"],function(e,t,i,n){var a,o=[],r={templateFunction:function(e){return e},fieldNames:{},itemID:"chart",isAvailable:function(e){return e.actionGrid.isReadingPaneTabEnabled("chart")&&n.getSetting(e.objectDescribe.name,this.itemID)!==!1},getLabel:function(e){return"Quick Graph"},getDataset:function(e,t,i,n){return colors=[{fillColor:"rgba(220,120,120,0.5)",strokeColor:"rgba(220,120,120,1)",pointColor:"rgba(220,120,120,1)",pointStrokeColor:"#f77",pointHighlightFill:"#f77",pointHighlightStroke:"rgba(220,120,120,1)"},{fillColor:"rgba(120,220,120,0.5)",strokeColor:"rgba(120,220,120,1)",pointColor:"rgba(120,220,120,1)",pointStrokeColor:"#7f7",pointHighlightFill:"#7f7",pointHighlightStroke:"rgba(120,220,120,1)"},{fillColor:"rgba(120,120,220,0.5)",strokeColor:"rgba(120,120,220,1)",pointColor:"rgba(120,120,220,1)",pointStrokeColor:"#77f",pointHighlightFill:"#77f",pointHighlightStroke:"rgba(120,120,220,1)"}],e%=colors.length,
{type:n,label:t,backgroundColor:colors[e].fillColor,borderColor:colors[e].strokeColor,data:i}},drawChart:function(e,t){var i=this;o=e.selectedRows.length>0?e.selectedRows:e.kendoGrid.dataSource.view();var n="Name",r=e.objectDescribe.fields.filter(function(e){return e.getBoolean("nameField")});r.length>0&&(n=r[0].name,o.length>0&&!o[0].hasOwnProperty(n)&&o[0].aggregates&&o[0].items&&!o[0].items[0].hasOwnProperty(n)&&e.actionGrid.addRemoveColumn(n,0,!0));var s=o.map(function(e){return e.aggregates?"<a>"+e.value+"</a>":'<a href="/'+e.Id+'">'+e[n]+"</a>"}),l=[],d=0;i.templateFunctions=[function(e){return e}];var c=!1;if(Object.each(i.fieldNames,function(t){i.templateFunctions[d]=function(e){return e};var n=e.actionGrid.columns.filter(function(e){return e.field==t.fieldName})[0];n?i.templateFunctions[d]=function(e){var i={};return i[t.fieldName]=e,n.formula?kendo.format("{0:"+n.formula.format+"}",e):"function"==typeof n.template?n.template(i):void 0!=n.format?kendo.format(n.format,e):void 0}:console.log("no field found!");var a=o.map(function(e){return e.aggregates?e.aggregates[t.fieldName].sum||e.aggregates[t.fieldName].count:e[t.fieldName]}),r=Object.first(e.objectDescribe.fields,function(e){return e.name==t.fieldName});l.push(i.getDataset(d++,r?r.label:t.fieldName,a,t.type))}),c)return void console.log("reinit");var u={labels:s,datasets:l};if(t.html('<canvas id="'+this.itemID+'_can" style="width:100%;"></canvas>'),0==u.datasets.length)return void(document.getElementById(this.itemID+"_can").parentNode.innerHTML="Please select a column to graph from the Configure menu.");var f=document.getElementById(this.itemID+"_can").getContext("2d");a=new Chart(f,{type:"bar",data:u,options:{tooltips:{enabled:!0,mode:"label",callbacks:{label:function(e,t){var n=i.templateFunctions[e.datasetIndex](e.yLabel);return $("<p>").html(n).text()}}},maintainAspectRatio:!1,scales:{yAxes:[{ticks:{callback:function(e,t,n){var a=i.templateFunctions[0](e);return $("<p>").html(a).text()}}}],xAxes:[{ticks:{callback:function(e,t,i){return $("<p>").html(e).text()}}}]}}})},select:function(e,t){o=e&&e.selectedRows.length>0?e.selectedRows:e.kendoGrid.dataSource.view(),this.drawChart(e,t)},saveView:function(e,t,i){i.readingPane&&(i.readingPane[this.itemID]||(i.readingPane[this.itemID]={}),i.readingPane[this.itemID].fieldNames=this.fieldNames)},loadView:function(e,t){var n=this;n.fieldNames={},e.actionGrid.settings.readingPane[this.itemID]?n.fieldNames=e.actionGrid.settings.readingPane[this.itemID].fieldNames:e.actionGrid.settings.readingPane[this.itemID]={fieldNames:[]};var a=function(i){var a=i.draggable.currentTarget.data().field;if(a){if(n.fieldNames[a])delete n.fieldNames[a];else{var o=a;Object.each(e.actionGrid.columns,function(e){e.field==a&&(o=e.title||o)}),n.fieldNames[a]={fieldName:a,type:"bar",label:o}}n.drawChart(e,t)}},o=function(e){$(e.target).find("span").removeClass("k-denied"),$(e.target).find("span").addClass("k-i-pin")},r=function(e){$(e.target).find("span").addClass("k-denied"),$(e.target).find("span").removeClass("k-i-pin")};t.kendoDropTarget({group:e.actionGrid.getElement("grid").data().kendoReorderable.options.draggable.options.group,drop:a,dragenter:o,dragleave:r}),window.Chart?this.drawChart(e,t):i.importScript("https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.1/Chart.min.js",function(){n.drawChart(e,t)})}};return r}),crmc.define("ViewHelpers",["sfdc","GridConstants","KendoEntry","KendoPopup","Notification","ColumnFactory"],function(e,t,i,n,a,o){var r=["title","width","isResized","defaultValue","defaultId","readOnly","required","locked","headerTemplate","ordinal"],s={validateView:function(e,t,i,a){var o=e.filterId,r=e.selectedRecordIds&&e.selectedRecordIds.length>0;if(0!=t){var s=[{label:"Yes",click:function(){"function"==typeof i&&i()}},{label:"No",click:function(){"function"==typeof a&&a()}}];if(r){var l=["The current view is based off a set of Record IDs. Saving this view","will only ever display this set of Record IDs. We recommend that you",'"Clear Filters" via the Reset drop-down before you save the view if',"this is not desired. Would you like to continue?"].join("</br>");n.popupWithButtons("WARNING",l,s)}else if(o){var l=["The current view is based off a Salesforce List View. Saving","this view could produce undesirable results for others, including",'the inability to Sort or Filter. We recommend that you "Clear Filters"','via the "Reset" drop-down before you save the view. Would you like',"to continue?"].join("</br>");n.popupWithButtons("WARNING",l,s)}}return!o&&!r},saveMenu:function(o){var r=!1,l=o.settings.pageInfo,d=o.getSelectedView()||{},c=o.saveView(),u={"Reading Pane":o.isReadingPaneShowing(),editable:o.settings.editable,toolbarCollapsed:o.settings.toolbarCollapsed,contextName:o.getContextName(),objectName:l.objectName,hasStaticIds:l.selectedRecordIds&&l.selectedRecordIds.length>0},f=function(e,t){o.delegateEvent("saveView",e),r=!t.Editable.value!=!o.settings.editable||t.ReadingPane.value!=o.isReadingPaneShowing()||!t.Toolbar.value!=!!o.settings.toolbarCollapsed},p=function(e){a.showMessage({title:"View Updated",message:"Successfully updated view"},"success"),o.setSelectedView(e,!1,!0),o.loadViewDropDown(),r&&o.loadSavedView(e)},h=e.getNamespace(!0),g=d[h+"Privacy__c"],m=d.Name,v=d.OwnerId,b=e.getUserInfo(),y={},k=e.getSObjectDescribe(h+"GridView__c");g==t.viewPrivacy.publicReadOnly&&v&&b&&v!=b.userId&&(m+=" (Copy)",g=t.viewPrivacy.private),y.Name=m?m+(u.hasStaticIds?" (Fixed Records)":""):"",y[h+"Privacy__c"]=g||t.viewPrivacy.private,y[h+"Description__c"]=d[h+"Description__c"]||"",y[h+"IsDefault__c"]=!!d.getBoolean&&d.getBoolean([h+"IsDefault__c"]),privacyPicklistValues=[{active:"true",defaultValue:"true",label:"Private",value:"Private"},{active:"true",defaultValue:"false",label:"Public",value:"Public"},{active:"true",defaultValue:"false",label:"Public Read-Only",value:"Public Read-Only"}];var w=[{name:"Name",label:"View Name",type:"string",value:y.Name},{name:h+"Privacy__c",label:"Privacy",type:"picklist",dependentPicklist:function(t){return k.recordTypeInfos&&k.recordTypeInfos.length>0&&(t.model.Id=d.Id),e.getPicklistValueFactory({fieldName:h+"Privacy__c",picklistValues:privacyPicklistValues,objectName:h+"GridView__c",fields:[],recordTypeInfos:k.recordTypeInfos})(t)},values:privacyPicklistValues,value:y[h+"Privacy__c"]},{name:h+"IsDefault__c",label:"Default",type:"boolean",value:y[h+"IsDefault__c"]},{name:h+"Description__c",label:"Description",type:"textarea",value:y[h+"Description__c"]},{name:"Editable",label:"Inline Edit Mode",type:"boolean",value:u.editable},{name:"ReadingPane",label:"Show Reading Pane",type:"boolean",value:u["Reading Pane"]},{name:"Toolbar",label:"Show Toolbar",type:"boolean",value:!u.toolbarCollapsed}];i.entry("Save View / Save View As...",w,{hasDependency:!0,grid:o},null,function(e){var t=Object.first(e,function(e){return"Name"===e.name}),i=Object.first(e,function(e){return e.name===h+"Privacy__c"}),a=Object.first(e,function(e){return e.name===h+"Description__c"}),o=Object.first(e,function(e){return e.name===h+"IsDefault__c"}),r=Object.first(e,function(e){return"Editable"===e.name}),l=Object.first(e,function(e){return"ReadingPane"===e.name}),d=Object.first(e,function(e){return"Toolbar"===e.name});if(t&&t.value&&""!==t.value.trim()&&i){r&&r.value!=c.editable&&(c.editable=r.value),l&&c.readingPane&&l.value!=c.readingPane.expanded&&(c.readingPane.expanded=l.value,c.readingPane.showText=l.value),!d||d.value!=c.toolbarCollapsed&&void 0!=c.toolbarCollapsed||(c.toolbarCollapsed=!d.value),f&&f(c,e);var g={Name:t.value};g[h+"JSON__c"]=JSON.stringify(c),g[h+"ObjectName__c"]=u.objectName,g[h+"Privacy__c"]=i.value||y[h+"Privacy__c"],g[h+"IsDefault__c"]=o.value,g[h+"Description__c"]=a.value,g[h+"Context__c"]=u.contextName;var m=function(e){"function"==typeof p&&p(e)};s.saveAGView(g,m)}else n.popup("Error","Please enter a name for the view!")})},getSavedViews:function(i,n,a){var o=n==t.viewContext.pageLayout;return e.getSavedViews(i,o,a)},saveAGView:function(t,i,o){var r=e.getNamespace(!0),l=function(e){return r+e},d=new sforce.SObject(l("GridView__c"));if(t){d.Name=t.Name,d[l("JSON__c")]=t[l("JSON__c")],d[l("ObjectName__c")]=t[l("ObjectName__c")],d[l("Privacy__c")]=t[l("Privacy__c")],d[l("IsDefault__c")]="function"==typeof t.getBoolean?t.getBoolean(l("IsDefault__c")):t[l("IsDefault__c")]||!1,d[l("Description__c")]=t[l("Description__c")]||"",t[l("Context__c")]&&(d[l("Context__c")]=t[l("Context__c")]);var c=Object.first(s.getSavedViews(t[l("ObjectName__c")],t[l("Context__c")]),function(e){return e.Name==d.Name.trim()});c?(d.Id=c.Id,e.update(d,function(){"function"==typeof i?i(d):a.showMessage({title:"View Updated",message:"Successfully updated view"},"success")},function(e){"function"==typeof o?o(e):n.popup("Error","Unexpected error updating view: "+e)})):e.insert(d,function(){"function"==typeof i?i(d):a.showMessage({title:"View Saved",message:"Successfully saved view"},"success")},function(e){"function"==typeof o?o(e):n.popup("Error","Unexpected error saving view: "+e)})}},restoreColumn:function(e,t){if(void 0!==t){var i=Object.first(t,function(t){return t.field&&e.field&&t.field===e.field});void 0==i&&e.formula&&(i=Object.first(t,function(t){return t.title==e.title})),void 0!==i?Object.each(r,function(t){i[t]&&(e[t]=i[t]),"title"==t&&!e.filterable&&e.headerTemplate&&(e.headerTemplate=o.createNonFilterableHeaderTemplate(i.title))}):e.ordinal=t.length}},saveColumnMeta:function(e){var t={field:e.field};return Object.each(r,function(i){e[i]&&(t[i]=e[i])}),t}};return s}),crmc.define("browser",[],function(){var e={identify:function(){var e,t=navigator.userAgent,i=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(i[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE"):"Chrome"===i[1]&&(e=t.match(/\bOPR\/(\d+)/),null!=e)?"Opera "+e[1]:(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&i.splice(1,1,e[1]),window.isDebug&&console.log(i),i.join(","))},name:function(){return this.identify().split(",")[0]},version:function(){return parseInt(this.identify().split(",")[1])},isTouch:function(){throw Exception("Not Implemented")},CHROME:"Chrome",SAFARI:"Safari",IE:"IE",IE9:"MSIE",OPERA:"Opera",FIREFOX:"Firefox"};return e}),crmc.define("../Util/PromisePoly",[],function(){return function(e){function t(){}function i(e,t){return function(){e.apply(t,arguments)}}function n(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],d(e,this)}function a(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void n._immediateFn(function(){var i=1===e._state?t.onFulfilled:t.onRejected;if(null===i)return void(1===e._state?o:r)(t.promise,e._value);var n;try{n=i(e._value)}catch(e){return void r(t.promise,e)}o(t.promise,n)}))}function o(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var a=t.then;if(t instanceof n)return e._state=3,e._value=t,void s(e);if("function"==typeof a)return void d(i(a,t),e)}e._state=1,e._value=t,s(e)}catch(t){r(e,t)}}function r(e,t){e._state=2,e._value=t,s(e)}function s(e){2===e._state&&0===e._deferreds.length&&n._immediateFn(function(){e._handled||n._unhandledRejectionFn(e._value)});for(var t=0,i=e._deferreds.length;t<i;t++)a(e,e._deferreds[t]);e._deferreds=null}function l(e,t,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=i}function d(e,t){var i=!1;try{e(function(e){i||(i=!0,o(t,e))},function(e){i||(i=!0,r(t,e))})}catch(e){if(i)return;i=!0,r(t,e)}}var c=setTimeout;n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(e,i){var n=new this.constructor(t);return a(this,new l(e,i,n)),n},n.all=function(e){var t=Array.prototype.slice.call(e);return new n(function(e,i){function n(o,r){try{if(r&&("object"==typeof r||"function"==typeof r)){var s=r.then;if("function"==typeof s)return void s.call(r,function(e){n(o,e)},i)}t[o]=r,0===--a&&e(t)}catch(e){i(e)}}if(0===t.length)return e([]);for(var a=t.length,o=0;o<t.length;o++)n(o,t[o])})},n.resolve=function(e){return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(e){return new n(function(t,i){i(e)})},n.race=function(e){return new n(function(t,i){for(var n=0,a=e.length;n<a;n++)e[n].then(t,i)})},n._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){c(e,0)},n._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},n._setImmediateFn=function(e){n._immediateFn=e},n._setUnhandledRejectionFn=function(e){n._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=n:e.Promise||(e.Promise=n)}}),crmc.define("Patches",["browser","../Util/PromisePoly"],function(e,t){var i=e.name();if(i===e.CHROME||i===e.IE||i===e.IE9){var n=Array.prototype.sort,a=function(e){e||(e=function(e,t){return e.toString()<t.toString()?-1:e.toString()>t.toString()?1:0});var t=this.map(function(e,t){return{i:t,v:e}}),i=n.bind(t,function(t,i){var n=e(t.v,i.v);return 0==n?t.i-i.i:n});return i(),t.map(function(e){return e.v})};if(Array.prototype.sort=a,i===e.IE||i===e.IE9){t(window);try{kendo.ui.Popup.fn.options.position="top right",kendo.ui.Popup.fn.options.origin="bottom right"}catch(e){}}}}),crmc.define("ConditionalFormat",["KendoPopup","sfdc","JSOperators","ColumnFactory","FormulaHelpers"],function(e,t,i,n,a){var o=kendo.ui,r=o.Widget,s=function(e,t,i){var n=$('<div style="margin:4px; white-space:nowrap">'),a=$(kendo.format('<label style="display:inline-block; clear:left; width:7em;">{0}: </label>',e));n.append(a);var o=$("<span>");return i&&o.append($("<span style='display:inline-block; vertical-align:middle; background-color: #c00; width:3px; height:21px;'></span>")),o.append(t),n.append(o),n};Date.prototype.inLast=function(e,t){var i=!1,n=new Date(Date.now());n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate()));var a=new Date(Date.UTC(this.getFullYear(),this.getMonth(),this.getDate())),o=function(e,t){return t>0?e>0&&e<=t:e<=0&&e>=t};switch(t.toLowerCase()){case"days":var r=a.getTime(),s=n.getTime();i=o((s-r)/864e5,e);break;case"weeks":var r=a.getTime(),s=n.getTime();i=o((s-r)/6048e5,e);break;case"months":var r=a.getTime(),s=n.getTime();i=o((s-r)/2592e6,e);break;case"years":var r=a.getTime(),s=n.getTime();i=o((s-r)/31536e6,e)}return i},Date.prototype.inNext=function(e,t){return this.inLast(-e,t)},String.prototype.contains=function(e){return e=e?e.toLowerCase():e,this.toLowerCase().indexOf(e)>-1};var l,d,c,u,f,p,h,g,m,v,b,y,k,w,x,I="#000000",S="rgba(255, 255, 255, 0)",C="Untitled Rule",D=r.extend({init:function(e,t){var o=this;u=t,r.fn.init.call(o,e);var w=$('<div style="width:215px; float:left;">'),C=$("<button>New Rule</button>");w.append(C),C.on("click",function(){o.newRule()}),C.kendoButton();var D=$('<button style="margin-left:3px;">Delete Rule</button>');w.append(D),D.on("click",function(){o.deleteRule()}),D.kendoButton(),m=$('<div style="width:215px; float:left; height:341px; margin-top:3px;" data-bind="source: items">'),m.kendoListView({template:"<div style='padding:0.5em; cursor: move;'>#:id#</div>",editTemplate:"<div style='padding:0.5em; cursor: move;'>*#:id#</div>",selectable:!0,change:function(){var e=o.selectedRule();e&&o.setSelected(e)}}),m.kendoSortable({cursor:"move",placeholder:function(e){return e.clone().css("opacity",.1)},hint:function(e){return e.clone().removeClass("k-state-selected")},change:function(e){var t=m.data("kendoListView").options.dataSource,i=(e.oldIndex,e.newIndex),n=(t.data(),t.getByUid(e.item.data("uid")));t.remove(n),t.insert(i,n)}}),$(w).append(m),$(e).append(w),y=$('<div style="width:calc(100% - 220px); float:right; margin-left:5px;">'),$(e).append(y),l=$('<input type="search" data-bind="value: id" style="width:calc(100% - 134px);"  required="required" />'),$(y).append(s("Rule Name",l,!0)),d=$('<input type="text" data-bind="value:field" style="width:calc(100% - 94px); max-width:430px;" required="required">'),$(y).append(s("Field",d,!0)),p=$('<input data-bind="value:backColor">');var N=$('<input  data-bind="value:backColor"/>');$(y).append(s("Cell Color",p)),p.after(N);var T=N.kendoColorPicker({value:I,buttons:!1,opacity:!0}).data("kendoColorPicker");T.wrapper.children().hide();var _=$("<button />");T.wrapper.append(_),_.kendoButton({icon:"colorPicker",click:function(){"rgba(255, 255, 255, 0)"==T.value()&&T.value("rgba(255, 255, 255, 255)"),T.toggle()}}),p.kendoColorPicker({palette:"basic",value:S}),h=$('<input data-bind="value:foreColor">');var O=$('<input data-bind="value:foreColor"/>');$(y).append(s("Text Color",h)),h.after(O);var R=O.kendoColorPicker({value:I,opacity:!0,buttons:!1}).data("kendoColorPicker");R.wrapper.children().hide();var j=$("<button />");R.wrapper.append(j),j.kendoButton({icon:"colorPicker",click:function(){R.toggle()}}),h.kendoColorPicker({palette:"basic",value:I});var E=function(e){return function(t){var i=o.selectedRule();i&&(i[e]=t.checked)}};g=$('<span style="display:inline-block; border:none; background-color:#ffffff;">'),$(y).append(s("Font Style",g)),g.kendoToolBar({resizable:!1,items:[{type:"buttonGroup",buttons:[{spriteCssClass:"k-tool-icon k-bold",text:"Bold",togglable:!0,showText:"overflow",id:"btnBold",toggle:E("bold")},{spriteCssClass:"k-tool-icon k-italic",text:"Italic",togglable:!0,showText:"overflow",id:"btnItalic",toggle:E("italic")},{spriteCssClass:"k-tool-icon k-underline",text:"Underline",togglable:!0,showText:"overflow",id:"btnUnderline",toggle:E("underline")}]}]});var F=$.extend([],t.grid.fieldMeta);F=Object.where(F,function(e){return"function"!=typeof e&&(e.displayName=n.getHeaderTitle(e,F),"reference"!==e.type.toLowerCase())}),Object.each(t.grid.settings.formulaFields,function(e,t){F.push({name:a.getFormulaFieldName(e),type:e.type,displayName:t})}),F=Array.orderBy(F,function(e){return e.displayName}),f=$('<input type="checkbox" data-bind="checked:isRow" />'),$(y).append(s("Apply to Row",f)),k=$("<div>");var P=$("<ul>");P.append($('<li class="k-state-active" id="basicTab">Basic Rule</li>')),P.append($('<li id="advancedTab">Advanced</li>')),k.append(P);var A=$('<div style="padding:5px;">');k.append(A);var L=$('<div style="padding:5px;">');k.append(L),c=$('<textarea style="vertical-align:top; width:calc(100% - 5px); height: 97px; font-family:monospace; font-size:14px;" data-bind="value:expression">');var M=[];Object.each(F,function(e){M.push({text:e.name,type:e.type,value:e.displayName})}),i.initMenu(L,c,F),$(L).append(c);var G=$('<label style="padding-right:5px">Format items with values that</label><br />');A.append(G),v=$('<input style="margin:3px 0px 3px 0px;" data-bind="value:basicOperator">'),A.append(v),v.kendoDropDownList({dataTextField:"label",dataValueField:"expression",valuePrimitive:!0}),b=$("<div>"),A.append(b),y.append(k),k.kendoTabStrip({animation:{open:{effects:"none"},close:{effects:"none"}},activate:function(e){var t=o.selectedRule();t&&(t.isBasic="basicTab"===e.item.id)}}),d.kendoDropDownList({dataTextField:"value",dataValueField:"text",dataSource:M,optionLabel:"Select a field...",template:'<span title="#:value#">#:value#</span>',cascade:function(e){var t=d.data("kendoDropDownList").dataItem(),i=o.selectedRule(),n=e.userTriggered&&$(this)[0].kendoBindingTarget;if(i)if(i.isBasic)n&&(i.set("basicValue",void 0),i.set("basicOperator",void 0)),o.createBasicRuleUI(t);else{var a=d.val()+' == ""';if(t&&t.type)switch(t.type.toLowerCase()){case"string":case"combobox":case"email":case"multipicklist":case"picklist":case"textarea":case"no formatting":case"url":a=d.val()+".contains('')";break;case"date":case"datetime":case"time":a=d.val()+".inLast(30,'days')";break;case"currency":case"decimal":case"integer":case"double":case"percent":a=d.val()+" > 0";break;case"boolean":a=d.val()+" == true"}!n&&i.expression||i.set("expression",a)}}});var V=$('<div style="float:right; margin:3px;">'),B=$('<button class="k-primary" style="margin:3px;">Apply Rules</button>');V.append(B),B.on("click",function(){o.apply()}),B.kendoButton(),$(y).append(V),x=$(e).kendoWindow({title:"Conditional Formatting Rules",width:"800px",minWidth:"400px",minHeight:"400px",resizable:!0,resize:function(){var t=$(e).height()-290;t<97&&(t=97),c.css("height",t);var i=$(e).height()-46;i<330&&(i=330),m.css("height",i)},modal:!0}).data("kendoWindow").center().open(),this.refresh(),this.createBasicRuleUI(d.data("kendoDropDownList").dataItem())},createBasicRuleUI:function(e){var t=e&&e.type?e.type:"string",i=this.operatorsForType(t),n=v.data("kendoDropDownList");n.setDataSource(i);var a,o=this.selectedRule();if(o&&i.length>0){var r=Object.first(i,function(e){return e.expression==o.basicOperator});r||o.set("basicOperator",i[0].expression)}this.valueInputForType(t,a)},valueInputForType:function(e,t){b.empty();var i=this.selectedRule();switch(e.toLowerCase()){case"string":case"no formatting":case"combobox":case"email":case"multipicklist":case"picklist":case"textarea":case"url":default:var n=$('<input type="search" style="width:calc(100% - 7px); max-width:500px" data-bind="value:basicValue">');b.append(n);break;case"date":case"datetime":case"time":if("{0}.inNext({1},'{2}')"==t||"{0}.inLast({1},'{2}')"==t){var n=$('<input style="width:100px;" data-bind="value:basicValue">');b.append(n),n.kendoNumericTextBox({format:"n0"});var a=$('<input style="width:100px;" data-bind="value:basicDateUnits">');b.append(a),a.kendoDropDownList({dataSource:["days","weeks","months","years"]}),i&&!i.basicValue&&(i.set("basicDateUnits","days"),i.set("basicValue","1"))}else if("{0} > new Date('{1}')"==t||"{0} < new Date('{1}')"==t){var n=$('<input data-role="datepicker" style="width:195px;" data-bind="value:basicValue">');if(b.append(n),i&&!i.basicValue){var o=new Date;i.set("basicValue",new Date(o.getFullYear(),o.getMonth(),o.getDay()))}}break;case"currency":case"integer":case"number":case"decimal":case"double":case"percent":var n=$('<input style="width:195px;" data-bind="value:basicValue">');b.append(n),n.kendoNumericTextBox(),i&&!i.basicValue&&i.set("basicValue","0");break;case"boolean":var n=$('<input style="width:195px;" data-bind="value:basicValue">');b.append(n),n.kendoDropDownList({dataSource:["true","false"]}),i&&!i.basicValue&&i.set("basicValue","true")}kendo.bind(b,this.selectedRule())},operatorsForType:function(e){var t={};switch(e.toLowerCase()){case"string":case"combobox":case"email":case"no formatting":case"multipicklist":case"picklist":case"textarea":case"url":t={contains:"{0}.contains('{1}')","does not contain":"!{0}.contains('{1}')",equals:"{0} == '{1}'","does not equal":"{0} != '{1}'","is blank":"{0} == null","is not blank":"{0} != null"};break;case"date":case"datetime":case"time":t={"are in the future":"{0} > new Date()","are in the past":"{0} < new Date()","are in next X":"{0}.inNext({1},'{2}')","are in last X":"{0}.inLast({1},'{2}')","are greater than":"{0} > new Date('{1}')","are less than":"{0} < new Date('{1}')","is blank":"{0} == null","is not blank":"{0} != null"};break;case"currency":case"integer":case"number":case"decimal":case"double":case"percent":t={"are greater than":"{0} > {1}","are less than":"{0} < {1}",equals:"{0} == {1}","does not equal":"{0} != {1}","is blank":"{0} == null","is not blank":"{0} != null"};break;case"boolean":t={equals:"{0} == {1}","does not equal":"{0} != {1}"}}var i=[];return Object.each(t,function(e,t){i.push({label:t,expression:e})}),i},selectedRule:function(){var e=m.data("kendoListView"),t=e.dataItem(e.select());return t},deleteRule:function(){var e=m.data("kendoListView");if(this.selectedRule()){var t=e.select();this.canMoveForward(1,66,28)&&(e.remove(t),this.apply(),0==w.data().length||e.select(e.element.children().eq(0)))}},canMoveForward:function(){return this.arguments=arguments,l.val()&&0!=l.val().length?!(!d.val()||0==d.val().length)||(e.popup("Field Required","Please select a field to apply custom formatting rules to.",void 0,void 0,void 0,{close:{handler:function(){x.setOptions({modal:!0})},scope:this}}),!1):(e.popup("Name Required","Rule Name is required",void 0,void 0,void 0,{close:{handler:function(){x.setOptions({modal:!0})},scope:this}}),!1)},newRule:function(){var e=m.data("kendoListView");e.add(),e.select(e.element.children().first()),y.show()},updateExpression:function(e){if(e.basicOperator&&e.field){var t=e.basicValue;t&&t.toISOString&&(t=t.toISOString()),e.set("expression",kendo.format(e.basicOperator,e.field,t,e.basicDateUnits))}},refresh:function(){var e=m.data("kendoListView"),t=e.select().prevAll().length,i=[],n=this;Object.each(u.grid.settings.conditionalRules,function(e,t){Object.each(e,function(e){var t=new kendo.data.ObservableObject(e);i.push(t)})}),w=new kendo.data.DataSource({data:i.reverse(),change:function(e){if("itemchange"==e.action&&1==e.items.length&&("basicOperator"==e.field||"basicValue"==e.field||"basicDateUnits"==e.field||"field"==e.field)){if("basicOperator"==e.field){var t=d.data("kendoDropDownList").dataItem();t&&t.type&&["date","datetime","time"].indexOf(t.type.toLowerCase())>-1&&(e.items[0].set("basicValue",void 0),n.valueInputForType(t.type,e.items[0].basicOperator))}n.updateExpression(e.items[0])}},schema:{model:{id:"id",fields:{id:{nullable:!1,type:"string",validation:{required:!0},defaultValue:function(){var e=C,t=Object.where(w.data(),function(e){return e.id&&e.id.indexOf(C)>-1});return t&&t.length>0&&(e+=t.length),e}},field:{type:"string",validation:{required:!0}},expression:{type:"string"},basicOperator:{type:"string"},basicDateUnits:{type:"string",defaultValue:"days"},foreColor:{type:"string",defaultValue:I},backColor:{type:"string",defaultValue:S},isRow:{type:"boolean"},isBasic:{type:"boolean",defaultValue:!0},dependentFields:{type:"array",defaultValue:[]}}}}});var a=new kendo.observable({items:w});kendo.bind(m,a),0==i.length?y.hide():y.show(),e.select(e.element.children().eq(t))},apply:function(){if(this.canMoveForward()){u.grid.settings.conditionalRules={};var e=w.data().slice(0);e.reverse(),Object.each(e,function(e){var t=u.grid.settings.conditionalRules[e.field]||{};t[e.id]=e,u.grid.settings.conditionalRules[e.field]=t}),u.grid.refresh(),this.refresh()}},setSelected:function(e){e.property&&("background-color"==e.property?(e.backColor=e.backColor||e.color,e.foreColor=e.foreColor||I):(e.foreColor=e.foreColor||e.color,e.backColor=e.backColor||S)),kendo.bind(y,e),g.data("kendoToolBar").toggle("#btnBold",e.bold===!0),g.data("kendoToolBar").toggle("#btnItalic",e.italic===!0),g.data("kendoToolBar").toggle("#btnUnderline",e.underline===!0),e.isBasic?k.data("kendoTabStrip").activateTab("#basicTab"):k.data("kendoTabStrip").activateTab("#advancedTab")},options:{name:"ConditonalFormatting"}});o.plugin(D)}),crmc.define("SessionHandler",["KendoPopup","sfdc"],function(e,t){var i="3MVG9xOCXq4ID1uE34nf8DNiyztaNiv56eD4cVqdDIBefde_rcT7idkDRmvHm7m9vUUr63EgH.NA8hUmsfjnC",n="https://login.salesforce.com/services/oauth2/authorize",a="https://test.salesforce.com/services/oauth2/authorize",o={authorize:function(){t.executeRemoteAction("getAccessToken",[],function(r,s){if(r){var l=new CustomEvent("gotSessionId",{detail:r});window.dispatchEvent(l)}else{var d=t.getNamespace(!0),c=encodeURIComponent(kendo.format("https://{1}.salesforce.com/apex/{0}OAuthHandler",d,t.isSandbox()?"cs1":"na1"));e.popup("Invalid Session","ActionGrid needs your permission to continue communicating with Salesforce.","Authorize",function(){var e=kendo.format("{0}?response_type=code&scope=full+refresh_token&client_id={1}&redirect_uri={2}",t.isSandbox()?a:n,i,c),r="width=670,height=850,toolbar=no,status=no,directories=no,menubar=no,resizable=yes,scrollable=no";o.win=window.open(e,"authWindow",r)},"Not Now")}})},authorized:function(e){o.win&&o.win.close()}};return $(window).on("getSessionId",function(){o.authorize()}),window.addEventListener("gotSessionId",function(e){o.authorized(e.detail)}),o}),crmc.define("GridBase",["GridDataProvider","FieldChooser","sfdc","SFRest","GridConstants","KendoPopup","KendoEntry","ActionGridDelegate","MultiSelectGridFilter","CustomSettings","tooling","Notification","ColumnFactory","FilterLogic","Toolbar","HoverHelp","FormulaHelpers","LightningDelegate","mixpanel","customPanes/detailGrid","customPanes/chart","ViewHelpers","extensions","Patches","ConditionalFormat","Formula","SessionHandler"],function(e,t,i,n,a,o,r,s,l,d,c,u,f,p,h,g,m,v,b,y,k,w){var x={},I=function(){var e=i.getNamespace(!1),t=e?e+".":"",n={getPageAction:t+a.VF_APEX_CONTROLLER+".getPage",getFieldMetaAction:t+a.VF_APEX_CONTROLLER+".getFieldMetaForObjectColumns",getColumnAction:t+a.VF_APEX_CONTROLLER+".getFieldMetaForObject",isPackageInstalled:t+a.VF_APEX_CONTROLLER+".isPackageInstalled",getDefaultFieldsAction:t+a.VF_APEX_CONTROLLER+".getDefaultFieldsForObject",getFieldSetDescribe:t+a.VF_APEX_CONTROLLER+".getFieldSetDescribe"};return n},S=new Date(Date.now()),C=!1,D=function(e){if(C){var t=new Date(Date.now()).getTime(),i=S.getTime();console.log(e+": "+kendo.format("{0:n0}",parseInt(t-i))+"ms")}},N={pageInfo:{objectName:void 0,columns:[],takeCount:100},metadata:void 0,id:void 0,pageURL:"",fkField:void 0,fkValue:void 0,viewId:void 0,enableNewButton:!0,enableNewInline:!0,enableEdit:!0,enableFieldChooser:!0,enableToolbar:!0,enableActions:!0,enableStickyViews:!0,enableViews:!0,enableDetailGrid:!0,enableAutoFill:!0,enableHover:!i.isLightningExperienceOrSalesforce1(),enableFullscreen:!0,enableFormatting:!0,enableReadingPane:!0,enableActionsColumn:!0,editable:!0,isFullscreen:!0,fieldChooserDelay:1500,groupExpandAll:void 0,lockedColumns:!1,readingPane:{showGraphs:!1,showText:!0,expanded:!1,selectedField:void 0,position:"right",height:150,width:"30%",chart:{fieldNames:{}},detailGrid:{fieldNames:[]}},delegate:{selectionChanged:function(){},rowDoubleClick:function(){},createColumn:function(){},getActionItems:function(){},getColumnNames:function(){},dataReady:function(){}}},T={init:function(e){D("init");var n=Object.create(N);Object.copy(e,n),this.settings=n;var a;a=i.isLightningExperienceOrSalesforce1()?Object.create(v):Object.create(s),Object.copy(e.delegate,a),this.settings.delegate=a,this.settings.remoteActions||(this.settings.remoteActions=I()),this.columnFactory||(this.columnFactory=Object.create(f));var r=$("#"+this.settings.id);if(r){r.empty();var l=this.getElement("contextMenu");if(0==l.length){var c=kendo.template('<ul class="forceNormalStyle" id="#=id#_contextMenu"></ul>'),u=kendo.template('<ul class="forceNormalStyle" id="#=id#_headerMenu"></ul>');$(document.body).append(c({id:this.settings.id})),$(document.body).append(u({id:this.settings.id}))}var p='<div id="#=id#_split" style="height:100%;"><div id="#=id#_paneSplit" class="k-content crmc-grid" style="height:100%;overflow: hidden;"><div id="#=id#_grid"></div></div><div id="#=id#_fieldTreeView"></div>',h=kendo.template(p),m=h({id:this.settings.id});r.append(m)}else console.log("Unable to find parent DOM element with id: "+this.settings.id);if(this.settings.pageURL.indexOf("?")>-1&&(this.settings.pageURL=this.settings.pageURL.split("?")[0]+"?object="+this.settings.pageInfo.objectName),!this.settings.metadata)try{this.settings.metadata=i.getSObjectDescribe(e.pageInfo.objectName),this.settings.metadata.childRelationships=[].concat(this.settings.metadata.childRelationships)}catch(t){t.faultcode&&"sf:INVALID_SESSION_ID"==t.faultcode?o.popup("Expired Session"," Salesforce session has expired, please refresh the page to continue working"):t.faultcode&&"sf:INVALID_TYPE"==t.faultcode?o.popup("Error","sObject type '"+e.pageInfo.objectName+"' is not supported. If you are attempting to use a custom object, be sure to append the '__c' after the entity name. Double check your security to this object."):o.popup("Error",t.toString());
}if(this.settings.fkField&&this.settings.fkField.length>0&&this.settings.fkValue&&this.settings.fkValue.length>0&&!this.settings.fkDisplayName){var b=this,y=Object.first(this.settings.metadata.fields,function(e){return e.name==b.settings.fkField});if(y&&y.referenceTo){var k=[].concat(y.referenceTo);try{sforce.connection.retrieve("Name",k[0],[this.settings.fkValue],{onSuccess:function(e){b.settings.fkDisplayName=e&&e.length>0&&e[0]?e[0].Name:""},onFailure:function(){}})}catch(e){}}}var w=this;w.getElement("grid").on("dblclick","td",function(e){w.rowDoubleClick(e)}),this.settings.enableActions&&(this.actionMenuItems={},this.actionMenu=this.initContextMenu("contextMenu"),this.headerMenu=this.initContextMenu("headerMenu",!0),w.getElement("grid").on("contextmenu","tbody a, input, textarea",function(e){e.stopPropagation()}));var x=w.getElementId("grid"),S=x+" .k-footer-template .k-icon.k-i-info",C=x+" .k-group-footer .k-icon.k-i-info";$(document).off("click",S),$(document).on("click",S,function(){w.totalToolTipHandler(this)}),$(document).off("click",C),$(document).on("click",C,function(){w.subTotalToolTipHandler(this)});var T="paste."+w.getElementId("grid");$(document).off(T),$(document).on(T,function(e){$(document.activeElement).closest(".k-grid").attr("id")==w.getElementId("grid").replace("#","")&&w.onPaste(e)});var _="resize."+w.getElementId("grid");if($(window).off(_),$(window).on(_,function(){w.resize()}),w.resize(),1==w.settings.enableStickyViews&&(window.self!==window.top?$(window).on("unload",function(){w.saveStickyView()}):window.onbeforeunload=function(){w.saveStickyView()}),!this.settings.isChildGrid){var O=this.settings.enableFieldChooser&&d.getSetting(this.settings.pageInfo.objectName,"fieldChooser")!==!1;w.fieldSplitter=w.getElement("split").kendoSplitter({orientation:"horizontal",panes:[{collapsible:!1},{collapsible:O,size:"260px",collapsed:!0}]}).data("kendoSplitter"),O&&(this.fieldChooser=Object.create(t),this.fieldChooser.init({elementId:this.getElementId("fieldTreeView"),delegate:this,objectName:this.settings.pageInfo.objectName,objectLabel:this.settings.metadata.label,enableAutoUpdate:!0}),w.fieldSplitter.bind("expand",function(){var e=w.getElement("configButton");e&&e.length>0&&e.addClass("k-state-selected")}),w.fieldSplitter.bind("collapse",function(){var e=w.getElement("configButton");e&&e.length>0&&e.removeClass("k-state-selected"),w.fieldChooser.clearSearch(),w.fieldChooser.collapseRootNodes()}))}this.settings.enableHover&&d.getSetting(this.settings.pageInfo.objectName,"lookupHoverDetail")!==!1&&g.init(this),!i.isInConsole()||window.srcUp||"undefined"!=typeof sforce&&sforce.console||i.importScript("/support/console/34.0/integration.js"),this.loadStickyView()},onPaste:function(e){var t=e&&e.originalEvent&&e.originalEvent.clipboardData;if(t&&t.getData){var i=t.getData("text/html"),a=$(i),r=$(document.activeElement),s=this;if(this.settings.editable&&x.editModeContext&&x.editModeContext.has(r).length>0&&a&&a.length>0){var l=x.editModeContext.prevAll().length,c=x.editModeContext.closest("tr"),u=0,f=c.attr("data-uid"),p=s.gridDataSource.getByUid(f),h=s.kendoGrid.lockedTable&&s.kendoGrid.lockedTable.has(r).length>0,g=s.kendoGrid.lockedTable&&s.kendoGrid.lockedTable.find("tr:eq(0) td").length,m=a.find("tr"),v=".k-footer-template,.k-detail-row,.k-grouping-row,.k-group-footer",y=p&&void 0!=p.Id&&0==p.Id.length,k=d.getSetting(s.settings.pageInfo.objectName,"pasteUpdate")===!0,w=d.getSetting(s.settings.pageInfo.objectName,"pasteInsert")!==!1,I=!0,S=function(e){var t="{0} div.k-grid-header-wrap tr:eq(0) th:eq({1})";return h&&g>0&&(e>=g?e-=g:t="{0} div.k-grid-header-locked tr:eq(0) th:eq({1})"),$(kendo.format(t,s.getElementId("grid"),e))},C=function(e,t){var i=s.getElementId("grid")+" div.k-grid-content",n="{0} tr:not({3}):eq({1}) td:eq({2})";return h&&g>0&&(t>=g?t-=g:i=s.getElementId("grid")+" div.k-grid-content-locked"),$(kendo.format(n,i,e,t,v))},D=function(){I&&$(m).each(function(){s.gridDataSource.insert(0,{})}),$(m).each(function(e,t){setTimeout(function(){var i=$(t).find("td").toArray();i.map(function(t,i){var a=l+i,o=$(t).text().trim(),r=S(a),d=r.attr("data-field");if(d&&d.length>0){var c=C(u,a),p=Object.first(s.fieldMeta,function(e){return e.name.toLowerCase()==d.toLowerCase()});if(p){p.isNameField&&p.parentMeta&&(p=p.parentMeta),f=c.parent("tr").attr("data-uid");var h=s.gridDataSource.getByUid(f);switch(p.type.toLowerCase()){case"reference":n.query(kendo.format("select Id from {0} where {1} = '{2}'",p.relObjectName,d,o),function(e){var t,i;e&&e.length>0&&(t=o,i=e[0].Id),s.kendoGrid.editCell(c),h[d]=t,h[p.relationshipName].Id=i,h.set(d,t),h.set(p.name,i)},function(e){console.log(e)});break;case"boolean":o=o.toLowerCase().trim(),o="true"==o||"yes"==o||"1"==o||"on"==o||"active"==o;break;case"currency":case"integer":case"double":case"integer":case"percent":o=+o.replace(/[^\d\.e\+\-]*/g,"");break;case"date":case"datetime":case"time":o=kendo.parseDate(o),null==o&&(o=Date.parse($(t).text().trim()))}s.kendoGrid.editCell(c),h.set(d,o),h[d]=o,e==m.length-1&&s.kendoGrid.editCell(c)}}}),u++})})},N=0==m.length;if(N|=1==m.length&&1==$(m[0]).find("td").length)return;e.preventDefault(),b.track("Paste",{objectName:s.settings.pageInfo.objectName,numRows:m.length}),m.length>100?o.popup("Max Row Limit","Please paste less than 100 rows at a time"):k&&w&&!y?o.popupWithButtons("Pasting Data","You are pasting structured data into ActionGrid.<br/> Would you like to insert new rows or overwrite existing rows relative to the currently selected cell?",[{label:"Insert Rows",click:function(){D()}},{label:"Overwrite",click:function(){I=!1,u=c.prevAll(kendo.format(":not({0})",v)).length,D()}},{label:"Cancel"}]):w?D():k&&(I=!1,u=c.prevAll(kendo.format(":not({0})",v)).length,D())}}},destroy:function(){this.kendoGrid&&this.kendoGrid.destroy(),this.paneSplitter&&this.paneSplitter.destroy(),this.gridDataSource&&this.gridDataSource.unbind()},toogleSelectedItems:function(e){var t=this;$(this.getElementId("grid")+" .k-grouping-row").each(function(){t.kendoGrid[e](this)})},setupToggleButton:function(e){var t=this;t.settings.groupExpandAll=0!=t.settings.groupExpandAll;var i=$('<button type="button">+/-</button>').css({border:"0px",padding:"5px","font-weight":"bold"});$(e).find(".k-group-cell.k-header").html(""),$(e).find(".k-group-cell.k-header").first().css({padding:"0px"}).html(i),i.on("click",function(){var e="collapseGroup";$('.k-grouping-row > td[aria-expanded="false"]').length>0&&(e="expandGroup"),t.toogleSelectedItems(e),t.settings.groupExpandAll=!t.settings.groupExpandAll})},onKendoDataBound:function(){this.delegateEvent("dataReady",this.getActionContext());var e=this.kendoGrid,t=this,i=this.getElementId("grid");e.dataSource.group()&&e.dataSource.group().length>0&&this.getElement("check-all").attr("checked",!1),this.setupToggleButton(i),this.refreshFormatting();var n=function(e,i){var n=$(e);t.settings.lockedColumns&&(n=$("[data-uid="+n.data("uid")+"]")),i?n.addClass("k-state-selected"):n.removeClass("k-state-selected")};$("input[name='selectedBox"+this.settings.id+"']").change(function(){this.checked=$(this).parent().parent().hasClass("k-state-selected")}),$("input[name='selectedBox"+this.settings.id+"']").parent().on("mousedown",function(e){var i=!$(this).parent().hasClass("k-state-selected");n(this.parentElement,i),this.children[0].checked=i,e.stopPropagation(),t.selectionChanged()}),this.selectionChanged();var a=$(".check-group_"+t.settings.id);a.off("change"),a.on("change",function(){var e=this,i=this.name.split("|");i.length<=1||($(t.kendoGrid.element).find("input[name='selectedBox"+t.settings.id+"']").each(function(){if(0==!$(this).closest(".crmc-grid").attr("id").indexOf(t.settings.id+"_"))return!0;var a=$(this).parents("tr").first().data("uid"),o=t.gridDataSource.getByUid(a),r=""==i[2]?void 0:i[2],s=o[i[1]]==r;s&&(this.checked=e.checked,n(this.parentElement.parentElement,this.checked))}),t.selectionChanged())});var o=$("#"+this.settings.id+"_showFilter").find("span");p.hasFilter(this)?(o.removeClass("k-i-funnel"),o.addClass("k-i-funnel-active")):(o.removeClass("k-i-funnel-active"),o.addClass("k-i-funnel")),0==this.settings.groupExpandAll&&setTimeout(function(){t.toogleSelectedItems("collapseGroup")}),this.setKeyboardFocus(),this.resize(),this.redraw(),$(window).trigger("resize")},setKeyboardFocus:function(){var e=this,t=window.top!=window;if(e.settings.isChildGrid)e.settings.parentGrid.setKeyboardFocus();else if(!t){var i=e.getElement("check-all"),n=i.offset().left<window.scrollX+$(window).width()&&i.offset().left>window.scrollX,a=i.offset().top<window.scrollY+$(window).height()&&i.offset().top>window.scrollY;if(n&&a){var o=$(document.activeElement),r=e.kendoGrid.table.has(o).length>0,s=e.kendoGrid.lockedTable&&e.kendoGrid.lockedTable.has(o).length>0,l=e.getElement("pane").has(o).length>0,d=e.kendoGrid.content.scrollLeft()>0,c=e.getElement("toolbar").has(o).length>0;r||s||l||d||c||e.forceKeyboardFocus()}}},forceKeyboardFocus:function(){var e=this.getElement("check-all");e.length>0&&e[0].focus()},getKendoGridOptions:function(e){var t,n=this,o=kendo&&kendo.support&&kendo.support.mobileOS,r="border:none;",s=kendo.format('<div class="toolbar" id="{0}_toolbar" style="{1}"></div><div id="{0}_toolbarHandle" class="k-icon toolbarHandle">...</div>',n.settings.id,r),l=d.getSetting(this.settings.pageInfo.objectName,"toolBar")!==!1,c={columns:this.columns,toolbar:l&&this.settings.enableToolbar?kendo.template(s):void 0,selectable:o?"row":"multiple",groupable:{showFooter:!0},navigatable:!1,filterable:{extra:!1,operators:a.operators},height:$("#"+this.settings.id).height(),resizable:!0,reorderable:!0,sortable:!0,dataSource:e,autoBind:!1,editable:!!this.settings.editable&&"incell",pageable:{refresh:!0,pageSizes:[50,100,500,1e3],buttonCount:5},excelExport:function(e){Object.each(e.workbook.sheets,function(e){Object.each(e.rows,function(e){(e.type.indexOf("footer")>-1||e.type.indexOf("group-header")>-1)&&Object.each(e.cells,function(e){if(e.value){var t=$(e.value.trim());t.length>0&&(e.value=t.text())}})})})},change:function(e){var i=this,a=n.isReadingPaneShowing(),o=i.select();o=o.length>0&&o;var r=n.checkForDirtyRelatedChildInstance(),s=o?n.kendoGrid.dataItem(String.format("tr[data-uid={0}]",o[0].dataset.uid)):o;if(!a||0==r.length||r.length>0&&s&&""==s.Id)clearTimeout(t),t=setTimeout(function(){$.each($("input:checked[name='selectedBox"+n.settings.id+"']"),function(e,t){t.checked=!1});for(var e=0;e<o.length;e++){var t=$(o[e]).find("input[name='selectedBox"+n.settings.id+"']");t.length>0&&(t[0].checked=!0)}var i=!0;if(1==o.length&&x.prevSelectedRows&&1==x.prevSelectedRows.length)var i=Object.first(o,function(e){var t=Object.first(x.prevSelectedRows,function(t){return $(t).attr("data-uid")===$(e).attr("data-uid")});return!t});x.prevSelectedRows=o,i&&n.selectionChanged()},300);else{var l=$(n.getElementId("grid")+" .k-grid-content .k-state-selected"),d=$(n.getElementId("grid")+" input[name='selectedBoxgrid']:checked");l.removeClass("k-state-selected"),d.parent().parent().addClass("k-state-selected"),n.saveDirtyRowsPrompt(r,function(){d.parent().parent().removeClass("k-state-selected"),d.prop("checked",!1),n.kendoGrid.select(l)})}},save:function(e){var t=n.kendoGrid.dataItem(String.format("tr[data-uid={0}]",e.model.uid));if(t){var a=Object.create(t);t.dirtyFields||(n.setSaveButtonDirty(!0),t.dirtyFields={}),Object.each(e.values,function(e,o){a[o]=e;var r=function(i){t.dirtyFields[i]=e};if(o.indexOf(".")>-1){var s=o.split(".");if(2!=s.length||!i.isSalesforceId(e)&&null!=e){if(n.allowParentalEditing()){var l=s[0],d=t[l].Id;if(d){var c=s[1],u=Object.first(n.fieldMeta,function(e){return e.relationshipName==l});if(s.length>2){var f=Object.first(n.fieldMeta,function(e){return e.name==o});c=f.parentMeta.name.split(".")[1],n.updateOperationLabels||(n.updateOperationLabels={});var p=$('[name="'+o+'_input"]').val();p&&(n.updateOperationLabels[e]=p)}var h=u.relObjectName,g=i.getSObjectNameField(i.getSObjectDescribe(h));if(c==g||o.indexOf("_input")>-1)return;n.updateOperations||(n.updateOperations={}),n.updateOperations[h]||(n.updateOperations[h]={}),n.updateOperations[h][d]||(n.updateOperations[h][d]={}),n.updateOperations[h][d][c]=e,n.decorateDirtyParents(o,d,h)}}}else r(i.getIdFieldFromRelationshipName(s[0]))}else o.indexOf("_input")>-1&&!t.hasOwnProperty(o)?r(o.substring(0,o.lastIndexOf("_input"))):"_events"===o||r(o)}),n.refreshFormatting(a)}n.toolbar.enable("#"+n.settings.id+"_saveButton",!0)},saveChanges:function(e){x.rowErrors=[],x.dirtyRows=e.sender.dataItems().filter(function(e){return e.dirty||e.isNew()});var t=n.settings.metadata.name;Object.each(x.dirtyRows,function(e){if(e.UID=e.uid,("OpportunityLineItem"==t||"QuoteLineItem"==t)&&e.Quantity&&e.UnitPrice){var i=e.dirtyFields;i.Quantity&&!i.UnitPrice?i.UnitPrice=e.UnitPrice:i.UnitPrice&&!i.Quantity&&(i.Quantity=e.Quantity)}})},dataBound:function(){D("dataBound"),n.onKendoDataBound()},cancel:function(){x.isInEditMode=!1,x.editModeContext=null},edit:function(e){x.isInEditMode=!0,x.editModeContext=e.container,x.rowErrors=[],x.dirtyRows=[],x.grid=this,e.model.isNew()&&Object.each(e.model,function(t,i){if(i.indexOf(".")>=0){var n=i.split(".")[0];e.model[n]||(e.model[n]={})}})},columnReorder:function(e){var t=e.column.headerTemplate,i=t&&t.indexOf("grid_check-all")!=-1,a=t&&t.indexOf("Action")!=-1,o=e.sender.columns[1],r=o.headerTemplate&&o.headerTemplate.indexOf("Action")!=-1?1:0;if(i||a){var s=this;setTimeout(function(){s.reorderColumn(e.oldIndex,e.column)})}else if(e.oldIndex>r&&e.newIndex<=r){var s=this;setTimeout(function(){s.reorderColumn(e.oldIndex,e.column)})}setTimeout(function(){n.modifySelectedView()}),$(document.activeElement).blur(),n.setKeyboardFocus()},columnResize:function(e){e.column.isResized=!0,n.modifySelectedView(),$(kendo.format("input[name='{0}']",e.column.field)).trigger("resize",e.newWidth-7)}};if(1==n.settings.enableDetailGrid&&!n.isReadingPaneShowing()&&!n.settings.lockedColumns){var u=!1;c.detailTemplate=function(e){var t=n.checkForDirtyRelatedChildInstance();return t.length>0&&(u=!0,n.saveDirtyRowsPrompt(t,function(){setTimeout(function(){n.kendoGrid.expandRow("[data-uid='"+e.uid+"']")})})),n.getPreviewTabStripTemplate(e)},c.detailInit=function(e){n.initKendoGridDetail(e)},c.detailExpand=function(e){u?(u=!1,setTimeout(function(){n.kendoGrid.collapseRow(e.masterRow)})):n.onKendoGridDetailExpand(e)}}return c},_readingPaneTextFields:void 0,getReadingPaneTextFields:function(){var e=this;if(void 0==e._readingPaneTextFields){var t=[];Object.each(e.settings.metadata.fields,function(e){("textarea"==e.type||"string"==e.type)&&e.length>255&&t.push({name:e.name,label:e.label})}),t=Array.orderBy(t,function(e){return e.label}),e._readingPaneTextFields=t}return e._readingPaneTextFields},isReadingPaneTabEnabled:function(e,t){var i=!1,n=e;switch(e.contains("vfPage")&&!t&&(n="vfPage"),n){case"readingPane":void 0!==t&&(this.settings.readingPane.showText=t);var a=this.getReadingPaneTextFields();i=this.settings.readingPane.showText&&a.length>0;break;case"quickView":void 0!==t&&(this.settings.readingPane.showChatter=t),i="true"==this.settings.metadata.feedEnabled&&this.settings.readingPane.showChatter!==!1;break;case"detailGrid":void 0!==t&&(this.settings.readingPane.showDetailGrid=t),i=this.settings.readingPane.showDetailGrid&&d.getSetting(this.settings.pageInfo.objectName,"detailGrid")!==!1,t===!1&&(this.settings.readingPane.detailGrid.fieldNames=[],this.getElement("fieldTreeView").data("kendoTreeList").refresh());break;case"chart":void 0!==t&&(this.settings.readingPane.showChart=t),i=this.settings.readingPane.showChart&&d.getSetting(this.settings.pageInfo.objectName,"chart")!==!1,t===!1&&(this.settings.readingPane.chart.fieldNames={},this.getElement("fieldTreeView").data("kendoTreeList").refresh());break;case"vfPage":for(var o=this.settings.readingPane.rpvfPages,r=0;r<o.length;r++)if(o[r].name&&o[r].name==e.replace(n+"_","")){o.splice(r,1);break}}return i},onRPTabFieldChecked:function(e,t,i){var n,a=!1,o=e;switch(Object.each(this.columns,function(e){e.field==t&&(n=e)}),o){case"detailGrid":if(void 0!==i)if(i&&this.settings.readingPane[o].fieldNames&&this.settings.readingPane[o].fieldNames.indexOf(t)<0)this.isReadingPaneTabEnabled(o,i),this.settings.readingPane[o].fieldNames.push(t);else if(0==i){var r=this.settings.readingPane[o].fieldNames.indexOf(t);this.settings.readingPane[o].fieldNames.splice(r,1)}this.modifySelectedView(),this.settings.readingPane[o]&&this.settings.readingPane[o].fieldNames&&(a=this.settings.readingPane[o].fieldNames.indexOf(t)>-1),void 0==n&&void 0!=i&&(console.log("changing columns",t,i,i?0:-1),this.addRemoveColumn(t,i?0:-1,i,!i));break;case"chart":if(void 0!==i)if(i&&this.settings.readingPane[o].fieldNames&&void 0==this.settings.readingPane[o].fieldNames[t]){this.isReadingPaneTabEnabled(o,i);var s=n?n.label:t;this.settings.readingPane[o].fieldNames[t]={fieldName:t,type:"bar",label:s}}else 0==i&&delete this.settings.readingPane[o].fieldNames[t];this.modifySelectedView(),this.settings.readingPane[o]&&this.settings.readingPane[o].fieldNames&&(a=void 0!==this.settings.readingPane[o].fieldNames[t]),i&&void 0==n&&(this.addRemoveColumn(t,0),this.preserveSelectedRows(this.settings.editable,!1,void 0,function(){}))}return a},onVFPageChecked:function(e){var t=this.settings.readingPane.rpvfPages||[],i=Object.first(t,function(t){return t.name==e.name});i?t.splice(t.indexOf(i),1):t.push(e),this.settings.readingPane.rpvfPages=t},getPreviewTabStripTemplate:function(e){e=e||{Id:this.getElementId("rp").replace("#","")};var t=this,n=t.getChildTables(),a=$('<div class="tabstrip"></div>'),o={},r={},s=["readingPane","quickView"],l=$("<ul></ul>");if(this.isReadingPaneTabEnabled("quickView")&&(o.quickView='<li id="quickView__tab__'+e.Id+'" >Chatter</li>'),t.isReadingPaneShowing()){t.getReadingPaneTextFields();t.isReadingPaneTabEnabled("readingPane")&&(o.readingPane='<li id="readingPane">Reading Pane</li>',r.readingPane=kendo.format('<div style="height:100%"><div id="{0}"></div></div>',t.getElementId("readingPane").replace("#",""))),t.isReadingPaneTabEnabled("graphTab")&&(o.graphs='<li id="graphTab">Graphs</li>',r.graphs=kendo.format('<div><div id="{0}" style="height:100%"></div></div>',t.getElementId("graph").replace("#","")))}var c=[];if($.each(n,function(e,n){void 0==n.childRelationship.meta&&(n.childRelationship.meta=i.getSObjectDescribe(n.childRelationship.childSObject));var a=n.childRelationship.meta,o=!1,r=0;$.each(t.settings.metadata.childRelationships,function(e,t){if(t.childSObject==n.childRelationship.childSObject&&void 0!=t.relationshipName&&""!=t.relationshipName&&(r++,r>1))return o=!0,!1});var s;$.each(a.fields,function(e,t){if(t.name==n.childRelationship.field)return s=t.label,!1}),c.push({objectName:n.childRelationship.childSObject,labelPlural:a.labelPlural,relName:n.childRelationship.relationshipName,parentFieldLabel:s,showParentFieldLabel:o})}),$.each(c,function(i,n){var a=n.labelPlural,r=kendo.format("{0}-{1}__tab__{2}",t.settings.pageInfo.objectName,n.relName,e.Id);1==n.showParentFieldLabel&&(a+=" ("+n.parentFieldLabel+")"),o[t.settings.pageInfo.objectName+"-"+n.relName]='<li id="'+r+'"><span class="k-link" >'+a+"</span></li>",s.push(t.settings.pageInfo.objectName+"-"+n.relName)}),"true"==this.settings.metadata.feedEnabled&&this.isReadingPaneTabEnabled("quickView")&&(r.quickView='<div style="overflow:auto;"><div class="quick-view" style="height:calc(100% - 30px); padding:15px;"><span class="crmc-message"><p>Please select a record.</p></span><iframe class="chatterFrame" style="height:100%; width:100%;" seamless="true" width="100%" scrolling="yes"/></div></div>'),$.each(n,function(i,n){var a=t.getChildGridId(n.childRelationship.relationshipName,e.Id),o=$('<div style="height:100%" />');o.append(kendo.format('<div id="{0}"><p>Please select a record.</p></div>',a)),r[t.settings.pageInfo.objectName+"-"+n.childRelationship.relationshipName]=o}),t.settings.readingPane.rpvfPages&&t.settings.readingPane.rpvfPages.length>0&&Object.each(t.settings.readingPane.rpvfPages,function(i){o["vfPage_"+i.name]='<li id="'+kendo.format("vfPage_{0}__tab__{1}",i.name,e.Id)+'"><span class="k-link" >'+i.title+"</span></li>",r["vfPage_"+i.name]='<div style="height:300px;"><iframe seamless="true" width="100%" scrolling="yes" id="'+t.settings.id+"_rpvf_"+i.name+'" style="width: calc(100% - 4px);height: calc(100% - 7px);" /></div>',s.push("vfPage_"+i.name)}),t.customReadingPanes&&t.isReadingPaneShowing()){var u=t.getActionContext();Object.each(t.customReadingPanes,function(i,n){var a=i.getLabel(u);o["customRP_"+n]='<li id="'+kendo.format("{1}_customRP_{0}__tab__",n,e.Id)+'"><span class="k-link" >'+a+"</span></li>",r["customRP_"+n]='<div><div id="'+t.settings.id+"_customRP_"+n+'" style="width: calc(100% - 4px);height: calc(100% - 7px);"></div></div>',s.push("customRP_"+n)})}if(t.settings.childTabOrder&&t.settings.childTabOrder.length>1){var f=$(s).not(t.settings.childTabOrder).get();s=t.settings.childTabOrder,s=s.concat(f)}if(t.settings.childTabOrder=s,a.append(l),Object.each(s,function(e){l.append(o[e]),a.append(r[e])}),0!=d.getSetting(t.settings.pageInfo.objectName,"fieldChooser")){var p=$('<li id="'+t.settings.id+'_rpNewTab">+</li>');l.append(p)}return a.append("<div></div>"),a.append("<style>.quick-view td { border-style: none; } .chatterFrame { border-style: none; } "+(t.isReadingPaneShowing()?"":t.getElementId("grid")+' div.k-tabstrip .k-grid-content { min-height: 200px; max-height:300px; "} ')+"</style>"),a.get(0).outerHTML},isReadingPaneShowing:function(){return this.settings.readingPane&&this.settings.readingPane.expanded},dataSourceHasChanges:function(){return this.gridDataSource&&this.gridDataSource.hasChanges()},decorateDirtyParents:function(e,t,i){var n=this,a=e.split("."),o=a[0],r=a[1];if(a.length>2){var s=Object.first(n.fieldMeta,function(t){return t.name==e});r=s.parentMeta.name.split(".")[1]}if(n.updateOperations&&n.updateOperations[i]&&n.updateOperations[i][t]&&n.updateOperations[i][t][r]){var l=n.updateOperations[i][t][r];a.length>2&&(l=n.updateOperationLabels[l]);var d=n.kendoGrid.editable.element.index();n.kendoGrid.editable.element.addClass("dirtyParent"),Object.each(n.kendoGrid.dataSource.data(),function(i){if(i[o]&&i[o].Id==t){i[o][r]=l,i[e]=l,i.dirty=!0,i.dirtyFields||(i.dirtyFields={}),i.dirtyFields[e]=l;var a=n.kendoGrid.element.find("[data-uid="+i.uid+"]"),s=a.children(":eq("+d+")");s.html(n.kendoGrid.columns[d-1].template(i)),s.prepend('<span class="k-dirty"></span>'),s.addClass("dirtyParent"),setTimeout(function(){s.prepend('<span class="k-dirty"></span>')}),s.on("blur","input",function(){i.dirtyFields[e]&&setTimeout(function(){s.prepend('<span class="k-dirty"></span>')})})}})}},checkForDirtyRows:function(e,t){var i=this,n=$(document.activeElement),a=i&&i.kendoGrid&&i.kendoGrid.table&&i.kendoGrid.table.has(n).length>0,o=i&&i.kendoGrid&&i.kendoGrid.lockedTable&&i.kendoGrid.lockedTable.has(n).length>0;(a||o)&&n.blur();var r=this.checkForDirtyRelatedChildInstance();return this.dataSourceHasChanges()&&r.push(this.settings.id),i.saveDirtyRowsPrompt(r,t,e)},checkForDirtyRelatedChildInstance:function(){var e=[];for(var t in _.instances){var i=t.split("-");if(i[0]==this.getElementId("grid").replace("#","")){var n=_.instances[t];n.blurEditCell(),n.dataSourceHasChanges()&&e.push(t)}}return e},saveDirtyRowsPrompt:function(e,t,i){return e.length>0&&(o.popupWithButtons("Unsaved Related Data","You have unsaved changes, if you continue they will be lost.",[{label:"Revert",click:function(){for(var n=0;n<e.length;n++){var a=_.instances[e[n]];i&&(a.settings.stayInEdit=!1,a.settings.skipRefresh=!1,a.preserveSelectedRows(!1)),a.kendoGrid.cancelChanges()}t&&t()}},{label:"Save",click:function(){for(var i=0;i<e.length;i++)_.instances[e[i]].saveButtonClick(t)}},{label:"Cancel"}]),!0)},getChildGridId:function(e,t){var t=this.isReadingPaneShowing()?"":t;return kendo.format("{0}-{1}-{2}",this.getElementId("grid").replace("#",""),e,t)},initChildGrids:function(e,t){var n=this,a=n.getChildTables();$.each(a,function(a,o){var r=o.childRelationship.field,s=n.getChildGridId(o.childRelationship.relationshipName,e),l=null;for(var d in _.instances){var c=d.split("-");d!=s&&3==c.length&&c[0]==n.getElementId("grid").replace("#","")&&c[1]==o.childRelationship.relationshipName&&(l=_.instances[d])}var u=$("#"+s),f=_.instances[s],p=!0;if(n.isReadingPaneShowing()){var h=u.is(":visible"),g=u.find(".crmc-grid");f&&f.settings.fkValue==e&&g.length>0?p=!1:(f&&f.kendoGrid&&n.saveStickyView(),p=h,u.empty())}if(u&&u.length>0&&p){var m={pageInfo:{objectName:o.childRelationship.childSObject,columns:o.fields.slice()},id:s,fkField:r,fkValue:e,fkDisplayName:t,fkRelationship:o.childRelationship.relationshipName,baseFilter:{field:r,operator:"eq",value:e},pageURL:window.location.href,enableStickyViews:!1,enableToolbar:!0,enableViews:!1,enableDetailGrid:!1,enableReadingPane:!1,editable:n.settings.editable,Partner_Server_URL_290:n.settings.Partner_Server_URL_290,isChildGrid:!0,parentGrid:n,delegate:{getColumnNames:function(){return o.fields.slice()},dataReady:function(){}}};if(null!=l)m.pageInfo.sorts=l.gridDataSource.sort(),m.pageInfo.groups=l.gridDataSource.group(),m.pageInfo.filter=l.gridDataSource.filter(),m.pageInfo.displayColumns=l.kendoGrid.columns,m.conditionalRules=l.settings.conditionalRules,m.toolbarCollapsed=l.toolbarCollapsed,m.formulaFields=l.formulaFields,m.hiddenColumns=l.hiddenColumns,m.searchText=l.settings.searchText,m.groupExpandAll=l.groupExpandAll,m.toolbarState=l.toolbarState,m.lockedColumns=l.lockedColumns;else if(void 0!=n.settings.pageInfo.childGridSettings){var v=n.settings.pageInfo.childGridSettings[o.childRelationship.relationshipName];void 0!=v&&(m.pageInfo.sorts=v.sorts,m.pageInfo.groups=v.groups,m.pageInfo.filter=v.filter,m.pageInfo.displayColumns=v.displayColumns,m.conditionalRules=v.conditionalRules,m.toolbarCollapsed=v.toolbarCollapsed,m.formulaFields=v.formulaFields,m.hiddenColumns=v.hiddenColumns,m.searchText=v.searchText,m.groupExpandAll=v.groupExpandAll,m.toolbarState=v.toolbarState,m.lockedColumns=v.lockedColumns)}var b=_.create(m);crmc.require(["DrillUpMenuItem"],function(e){var t={gridId:b};e.init(t,{remoteActions:{getDrillUpItemsForObject:i.getRemoteAction("DrillUpController","getDrillUpItemsForObject"),getDrillDownItemsForObject:i.getRemoteAction("DrillUpController","getDrillDownItemsForObject")}})})}})},showFieldChooser:function(e){this.fieldSplitter&&this.fieldSplitter.options&&this.fieldSplitter.options.panes&&this.fieldSplitter.options.panes[1]&&this.fieldSplitter.options.panes[1].collapsible&&(e?(this.fieldSplitter.toggle(".k-pane:last",!0),this.fieldSplitter.trigger("expand")):(this.fieldSplitter.toggle(".k-pane:last",!1),this.fieldSplitter.trigger("collapse")))},initPreviewTabStrip:function(e){var t=this,i=$(e).kendoTabStrip({animation:{open:{effects:"fadeIn"}},select:function(i){"+"==$(i.item).text()&&e.find("li").length>1?i.preventDefault():t.settings.selectedReadingPane=i.item.id.replace(t.settings.id+"_","")},activate:function(e){if(t.isReadingPaneShowing()){var i=t.getSelectedItems();i.length>0&&t.updateReadingPane(i[0].Id),t.paneSplitter&&t.paneSplitter.trigger("resize")}$(e.contentElement).find(".crmc-grid").each(function(){var e=$(this).parent().parent().attr("id"),i=_.instances[e];if(i&&i.kendoGrid){i.resize(),i.refreshIfColumnsOutOfSync();var n=$(this).find(t.getElementId("check-all"));n.closest("th").width()>35&&i.adjustColumnWidths()}})}}).data("kendoTabStrip");t.settings.enableFieldChooser&&d.getSetting(t.settings.pageInfo.objectName,"fieldChooser")!==!1&&t.getElement("rpNewTab").on("click",function(e){t.showFieldChooser(!0),t.fieldChooser.showChildRelationshipHelp()});var n=function(e){var i="after";e.newIndex<e.oldIndex&&(i="before"),this.tabGroup.children(".k-item:eq("+e.newIndex+")")[i](this.tabGroup.children(".k-item:eq("+e.oldIndex+")")),this.element.children(".k-content:eq("+e.newIndex+")")[i](this.element.children(".k-content:eq("+e.oldIndex+")")),t.settings.childTabOrder=[],this.tabGroup.children("li").each(function(e,i){var n=i.id.split("__tab__")[0].replace(t.settings.id+"_rp_","");t.settings.childTabOrder.push(n)}),this._updateClasses()};if(i.tabGroup.kendoReorderable({group:"tabs",filter:".k-item[id]",navigatable:!1,hint:function(e){var t=e.clone().wrap('<ul class="k-tabstrip-items k-reset"/>').parent();return t.css({opacity:.8})},change:$.proxy(n,i)}),i.tabGroup.data("kendoReorderable").draggable.bind("dragend",function(e){var n=$(e.currentTarget).closest("li");if(!this.dropped){this.hint.css("display","none");var a=n.attr("id").split("__tab__")[0].replace(t.settings.id+"_rp_customRP_","");if(t.settings.childTabOrder.remove(a),a=a.split("-"),a.length>0)if(1==a.length)t.isReadingPaneTabEnabled(a[0],!1),t.refresh();else{var o=!1;Object.each(t.settings.pageInfo.columns,function(e){e.startsWith("."+a[1]+".")&&(t.onItemChecked(e),o=!0)}),o&&i.disable(i.items())}}}),t.settings.selectedReadingPane){var a=t.getElement(t.settings.selectedReadingPane);0==a.length&&(a=i.element.find("[id^="+t.settings.selectedReadingPane.split("__tab__")[0]+"__tab__]:visible")),a.length>0&&i.select(a.prevAll().length)}return 0==i.select().length&&i.activateTab(i.tabGroup.children("li").first()),i},initPreviewChatter:function(e){var t=$(".chatterFrame"),n="";if(e){t.is(":visible")||t.show();var a=i.getNamespace(!0),o=String.format("/apex/{0}ChatterFeed?entityId={1}",a,e),r=t.attr("src");r!=o&&t.attr("src",o)}else n="<p>Please select a record.</p>",t.is(":visible")&&t.hide();$(".quick-view .crmc-message").html(n)},initKendoGridDetail:function(e){var t=this,i=(this.kendoGrid,t.getChildTables(),e.detailRow);e.detailCell.removeClass("k-detail-cell"),e.detailCell.addClass("k-hierarchy-cell"),this.initPreviewTabStrip(i.find(".tabstrip")),this.initPreviewChatter(e.data.Id),t.saveStickyView(),this.initChildGrids(e.data.Id,e.data.Name),t.settings.readingPane.rpvfPages&&t.settings.readingPane.rpvfPages.length>0&&Object.each(t.settings.readingPane.rpvfPages,function(i){t.getElement("rpvf_"+i.name).attr("src","/apex/"+i.name+"?id="+e.data.Id)})},onKendoGridDetailExpand:function(e){var t=this,i=e.masterRow.attr("data-uid");t.kendoGrid.element.find(".k-master-row").each(function(){var e=$(this).attr("data-uid");e!=i&&(t.kendoGrid.collapseRow(this),$(this).next(".k-detail-row").find(".crmc-grid").each(function(){var e=$(this).parent().parent().attr("id"),t=_.instances[e];t&&t.kendoGrid&&t.kendoGrid.element&&(t.kendoGrid.destroy(),t.kendoGrid=null,delete _.instances[e])}),$(this).next(".k-detail-row").remove())});var n=e.detailRow.find(".k-tabstrip").data("kendoTabStrip"),a=n.select().index();$(n.contentElement(a)).find(".crmc-grid").each(function(){var e=_.instances[$(this).parent().parent().attr("id")];e&&e.kendoGrid&&e.refreshIfColumnsOutOfSync()})},showConfigure:function(){var e=this;this.settings.isChildGrid&&(e=this.settings.parentGrid),e.fieldSplitter&&!e.fieldSplitter.options.panes[1].collapsed?e.showFieldChooser(!1):e.showFieldChooser(!0)},keyEvents:function(e){var t=this,i=$(document.activeElement),n=i.closest(".k-grid");if(0==t.getElement("toolbar").has(i).length&&n.is(t.getElement("grid")))switch(e.keyCode){case kendo.keys.TAB:t.settings.editable&&t.getElementId("check-all").replace("#","")==document.activeElement.id?(t.navigateSelection(e.shiftKey,!0,!0),e.preventDefault()):"#"+$(e.currentTarget).attr("id")===t.getElementId("grid")&&(setTimeout(function(){t.editNextCell(e.shiftKey)}),e.preventDefault());break;case"S".charCodeAt(0):t.settings.editable&&!e.shiftKey?(e.ctrlKey||e.metaKey)&&(setTimeout(function(){t.editNextCell(),t.saveButtonClick()}),e.preventDefault()):e.shiftKey&&(e.ctrlKey||e.metaKey)&&0!=d.getSetting(t.settings.pageInfo.objectName,"saveView")&&(setTimeout(function(){t.quickSaveView()}),e.preventDefault());break;case"I".charCodeAt(0):t.settings.editable&&0!=d.getSetting(t.settings.pageInfo.objectName,"inlineNew")&&(e.ctrlKey||e.metaKey)&&(setTimeout(function(){
t.createNewInline()}),e.preventDefault());break;case"D".charCodeAt(0):t.settings.editable&&0!=d.getSetting(t.settings.pageInfo.objectName,"autoFill")&&(e.ctrlKey||e.metaKey)&&(setTimeout(function(){t.editNextCell(),t.fillDown()}),e.preventDefault());break;case"E".charCodeAt(0):0!=d.getSetting(t.settings.pageInfo.objectName,"editButton")&&(e.ctrlKey||e.metaKey)&&(setTimeout(function(){t.toggleEditMode()}),e.preventDefault());break;case 191:(e.ctrlKey||e.metaKey)&&setTimeout(function(){t.showKeyboardHelp(!1)},1e3);break;case 219:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){t.keyNextPrevious(!1)}),e.preventDefault());break;case 221:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){t.keyNextPrevious(!0)}),e.preventDefault());break;case 220:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){t.showConfigure()}),e.preventDefault());break;case kendo.keys.LEFT:case kendo.keys.UP:if(t.settings.editable&&t.getElementId("check-all").replace("#","")==document.activeElement.id){t.navigateSelection(!0,!1,!0);break}case kendo.keys.RIGHT:t.settings.editable&&t.getElementId("check-all").replace("#","")==document.activeElement.id&&t.navigateSelection(!1,!0,!0);break;case kendo.keys.ENTER:case kendo.keys.DOWN:if(t.settings.editable&&t.getElementId("check-all").replace("#","")==document.activeElement.id){t.navigateSelection(e.shiftKey,!0,!0);break}"#"+$(e.currentTarget).attr("id")===t.getElementId("grid")&&(setTimeout(function(){var i=e.keyCode==kendo.keys.UP||e.keyCode==kendo.keys.ENTER&&e.shiftKey;t.navigateSelection(i,e.keyCode==kendo.keys.ENTER)}),e.preventDefault())}},keyNextPrevious:function(e){for(var t,i=this,n=$(".k-grid:visible").not(i.settings.isChildGrid?i.settings.parentGrid.getElementId("fieldTreeView"):i.getElementId("fieldTreeView")),a=0,o=0;o<n.length;o++)if("#"+n[o].id==i.getElementId("grid")){a=o;break}if(n[a+1]&&"detailGridDiv"==$(n[a+1]).attr("name")){var r=$(n[a+1]).data().kendoGrid;r.editCell($(r.items().first()).children().last())}else{t=e?a==n.length-1?0:a+1:0==a?n.length-1:a-1;var s=Object.first(_.instances,function(e){return e.getElementId("grid").replace("#","")==n[t].id});s.forceKeyboardFocus()}},initKeyboardHelp:function(){var e,t=this,i=$(this.kendoGrid.table.parent().parent());i.off("keydown.keyboardHelp keyup.keyboardHelp"),i.on("keydown.keyboardHelp keyup.keyboardHelp",function(i){clearTimeout(e);var n=i.keyCode;"keydown"==i.type&&(91!=n&&17!=n||(e=setTimeout(function(){t.showKeyboardHelp(!1)},2e3)))})},showKeyboardHelp:function(e){var t="<div style='padding-left:1em; font-size:medium;'><table><tr><th> Navigation </th><th> Actions </th></tr><td>"+["<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> TAB</span>: move to next field.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> SHIFT+TAB</span>: move to previous field.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> ENTER</span>: move to next row.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> SHIFT+ENTER</span>: move to previous row.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+[</span>: traverse left through ActionGrids.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+]</span>: traverse right through ActionGrids.</span>"].join("</br>")+"</td><td>"+["<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+SHIFT+S</span>: display the Save View screen.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+\\</span>: expand/collapse field chooser.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+I</span>: insert a new empty row.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+S</span>: save your edits.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+D</span>: fill up or fill down.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+E</span>: enable or disable Edit mode.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+V</span>: paste data from external table.</span>"].join("</br>")+"</td></table>";u.showOverlay({title:"<div style='text-align: center; font-size:large;'> ( CTRL + / ) Keyboard Shortcuts: "+this.settings.metadata.label+"  </div>",message:t},"keyboard",e)},initKendoGrid:function(e,t){var i=this.getElement("grid"),n=this;if(this.kendoGrid&&this.kendoGrid.element)try{this.kendoGrid.destroy()}catch(e){console.log(e),b.trackException(e)}i&&i.length>0&&i.empty();var a=this.getKendoGridOptions(e);if(this.kendoGrid=i.kendoGrid(a).data("kendoGrid"),t(e),this.kendoGrid){this.kendoGrid.wrapper.find(".k-grid-header-wrap").off("scroll.kendoGrid");var o=$(this.kendoGrid.table.parent().parent());o.off("keydown.ag"),o.on("keydown.ag",this.keyEvents.bind(this)),n.initKeyboardHelp();var r=$(this.kendoGrid.content);if(r.off("click.ag"),r.on("click.ag",function(){setTimeout(function(){n.setKeyboardFocus()},300)}),this.kendoGrid.lockedContent&&this.kendoGrid.lockedContent[0]){var s=$(this.kendoGrid.lockedContent[0]);s.off("click.ag"),s.on("click.ag",function(){setTimeout(function(){n.setKeyboardFocus()},300)})}$("#"+this.settings.id+" .k-grid-header:first th.k-header[ag-data-tooltip]").kendoTooltip({showAfter:2e3,position:"top",relative:!0,filter:"a:not(.k-grid-filter)",content:function(e){return r=unescape($(e.target).parent().attr("ag-data-tooltip"))}})}this.getElement("check-all").change(function(){var e=this;if($(i).find("input[name='selectedBox"+n.settings.id+"']").each(function(){return 0==!$(this).closest(".crmc-grid").attr("id").indexOf(n.settings.id+"_")||void(this.checked=e.checked)}),this.checked){var t="tr:not(.k-footer-template):not(.k-detail-row):not(.k-grouping-row):not(.k-group-footer)";n.kendoGrid.tbody.find(t).addClass("k-state-selected"),n.kendoGrid.lockedTable&&n.kendoGrid.lockedTable.length>0&&n.kendoGrid.lockedTable.find(t).addClass("k-state-selected")}else n.kendoGrid.clearSelection();n.delegateEvent("select",n.getActionContext()),n.updateFooter(n.getSelectedItems())}),this.kendoGrid&&(this.kendoGrid.parent=this),this.settings.enableToolbar&&(this.toolbar=h.init(this,this.getElement("toolbar"),this.settings.toolbarState,this.settings.toolbarCollapsed)),i&&i.length>0&&i.data().kendoReorderable.draggable.bind("dragend",function(e){var t=$(e.target).find("span").hasClass("k-denied")&&!this.dropped;if(t){$(".k-header.k-drag-clue").css("display","none");var i=e.currentTarget.data("field");if(i){var a=n.toggleColumn(i);a&&n.settings.isChildGrid&&n.settings.parentGrid.refreshWithDisabledFieldChooser(),n.refreshWithDisabledFieldChooser()}}}),n.initReadingPane()},addFormulaDependentFields:function(){var e=this;this.settings.formulaFields&&Object.each(this.settings.formulaFields,function(t){Object.each(t.dependentFields,function(t){"string"==typeof t&&e.settings.pageInfo.columns&&e.settings.pageInfo.columns.indexOf(t)<0&&e.addRemoveColumn(t,void 0,!0)})}),this.settings.conditionalRules&&Object.each(this.settings.conditionalRules,function(t,i){Object.each(t,function(t){Object.each(t.dependentFields,function(t){"string"==typeof t&&e.settings.pageInfo.columns&&e.settings.pageInfo.columns.indexOf(t)<0&&e.addRemoveColumn(t,void 0,!0)})})})},initDataSource:function(t,n){this.addFormulaDependentFields();var a=Object.create(this.settings);this.columns=[];var r=[];void 0!==n&&(a.restoreColumns=n);var s=this,l=function(e,t){if(x.dirtyRows=Object.where(x.dirtyRows,function(t){return t.uid!==e}),0==x.dirtyRows.length&&x.rowErrors.length>0){var i="<style>div.overflow{overflow: auto; max-height: 600px;} </style><div> The following errors have occurred: <br /><div class='overflow'><ul><li>"+x.rowErrors.join("</li><br/><li>")+"</li></ul></div></div>";o.popup("Errors!",i),s.settings.enableToolbar&&s.toolbar.enable("#"+s.settings.id+"_saveButton",!0)}};e.create(a,{allowParentalEditing:function(){return s.allowParentalEditing()},getUpdateOperations:function(){return!!s.allowParentalEditing()&&s.updateOperations},onReadFieldMetadata:function(e,t,i){if(s.factory||(s.factory=f.initFactory({settings:s.settings,getRecordTypes:function(e){return s.getRecordTypes(e)},picklistValuesFactory:function(e,t){return s.getPicklistValues(e,t)},decorateDirtyParents:function(e,t,i){s.decorateDirtyParents(e,t,i)}})),s.factory.config.fieldMeta=t,!s.settings.hiddenColumns||s.settings.hiddenColumns.indexOf(e.name)<0){var a=s.delegateEvent("createColumn",e,t,i)||s.columnFactory.createColumn.apply(s,[e,t,i]);void 0!==a&&(w.restoreColumn(a,n),r.push(a))}},onSync:function(e){s.settings.stayInEdit||(s.settings.editable=!1),s.settings.skipRefresh||s.refresh()},onRowSuccess:function(e){s.kendoGrid.table.find("tr[data-uid="+e+"]").find(".k-dirty").removeClass("k-dirty"),s.kendoGrid.table.find("tr[data-uid="+e+"]").find(".k-dirty-cell").removeClass("k-dirty-cell"),l(e)},onRowFailure:function(e,t){t&&x.rowErrors.push(t.message||t),l(e),s.kendoGrid.select(s.kendoGrid.table.find("tr[data-uid="+e+"]"))},onDataSourceReady:function(e,l){s.fieldMeta=l,s.gridDataSource=e,s.allowParentalEditing()&&(s.updateOperations={},s.updateOperationLabels={}),s.columns=r,s.settings.formulaFields&&Object.each(s.settings.formulaFields,function(e){var t=s.columnFactory.createFormulaColumn(e),i=m.getFormulaFieldName(e);if(w.restoreColumn(t,n),s.settings.conditionalRules&&s.settings.conditionalRules[i]){var a=s.settings.conditionalRules[i];s.columnFactory.decorateColumnConditionalFormatting(t,a)}s.columns.push(t)}),s.setDataSourceAggregates(),s.columns=Array.orderBy(s.columns,function(e){return e.ordinal}),s.settings.enableActionsColumn&&d.getSetting(s.settings.pageInfo.objectName,"actionColumn")!==!1&&s.columns.unshift({editable:!1,locked:s.settings.lockedColumns,headerTemplate:'<a class="k-link" href="#">Action</a>',template:function(e){var t="";if(e.Id){var n=i.getRecordURL(e.Id),a=0==n.indexOf("javascript:"),o=kendo.format('<a class="recordLink" href="{0}" {1}>View</a> ',n,a?"":'target="_blank"'),r=kendo.format('<a class="recordLink" href="{0}" {1}>Edit</a>',i.getRecordURL(e.Id,!0,"/"+e.Id),a?"":'target="_blank"'),s=' <span style="vertical-align:top;">{0}</span>';t+=kendo.format(s,o+r)}return t},width:"95px",attributes:{class:"selectedBox"}}),s.columns.unshift({headerTemplate:kendo.format('<input type="checkbox" id="{0}_check-all"/>',s.settings.id),editable:!1,type:"boolean",locked:s.settings.lockedColumns,template:function(e){var t=kendo.format('<input type="checkbox" name="selectedBox{0}" data-id="{1}"/>',s.settings.id,e.Id);return t},width:d.getSetting(s.settings.pageInfo.objectName,"checkboxColumn")!==!1?"35px":"1px",attributes:{class:"selectedBox"},headerAttributes:{class:"selectedBox"}}),s.columns.push({headerTemplate:"",headerAttributes:{style:"pointer-events:none;"},editable:!1,filterable:!1,groupable:!1,sortable:!1,template:"",width:"1px",attributes:{class:"fillerColumn",style:"background-color:white !important;pointer-events:none;"}}),s.initKendoGrid(e,t),s.fieldChooser&&s.fieldChooser.refresh();var c="",u=i.getUserInfo();u&&u.organizationId&&(c=u.organizationId);s.getElementId("fieldTreeView");e.bind("requestStart",function(e){D("requestStart");var t=!1;if(s.showCancelLoadButton(!0),"read"==e.type&&s.checkForDirtyRows())return t=!0,void e.preventDefault();if(s.settings.pageInfo.filterId){var i=this.sort(),n=this.filter();if(i&&i.length>0||n&&(n.length>0||n.filters&&n.filters.length>0)){var r=!1,l=c+"SystemViewWarning";try{r=localStorage.getItem(l)}catch(e){}r?delete a.pageInfo.filterId:(o.popupWithButtons("Cannot modify a system view","You can view saved system views but you cannot modify them.<br/> Would you like to reset the view to all records and customize it?<br/> You could then save an ActionGrid view.",[{label:"Dismiss"},{label:"Never Show Again",click:function(){try{localStorage.setItem(l,!0)}catch(e){}}},{label:"Reset View",click:function(){s.resetView()}}]),e.preventDefault(),t=!0)}}}),e.bind("requestEnd",function(e){s.showCancelLoadButton(!1)}),e.bind("change",function(e){if(s.kendoGrid){s.gridDataSource!==s.kendoGrid.dataSource&&s.kendoGrid.setDataSource(s.gridDataSource);var t=e.action&&"itemchange"==e.action,i=e.action&&"sync"==e.action,n=e.action&&"add"==e.action,a=e.action&&"remove"==e.action;!s.selectedViewIsLoaded||t||i||n||a||void 0!=s.firstDataSync&&s.firstDataSync&&!s.selectedViewIsDirty||s.modifySelectedView(),s.firstDataSync&&delete s.firstDataSync,i&&(s.firstDataSync=!0),s.selectedViewIsLoaded=!0;var o=this.group();if(o){var r=o.slice(0);Object.each(s.kendoGrid.columns,function(e){var t=Object.first(o,function(t){return t.field==e.field&&r.remove(t),t.field==e.field});void 0!==t?s.kendoGrid.hideColumn(t.field):e.hidden&&!e.forceHidden&&s.kendoGrid.showColumn(e.field)}),Object.each(r,function(e){o.remove(e)})}var l=s.kendoGrid.element.find(".k-group-indicator");if(l&&l.length>0){var d=l[0];d.children&&d.children.length>0&&(d.children[0].innerHTML+=" ("+s.gridDataSource.view().length+")")}if(s.adjustColumnWidths(),Object.each(o,function(e){e.aggregates=s.gridDataSource.aggregate()}),s.settings.readingPane.expanded&&s.kendoGrid.select().length<1&&!s.preservedRows){var c=s.kendoGrid.table.find("tr[data-uid]").first();s.settings.lockedColumns&&(c=$("[data-uid="+c.data("uid")+"]")),c.find("input[name='selectedBox"+s.settings.id+"']").prop("checked",!0),c.addClass("k-state-selected"),s.selectionChanged()}}})}})},resize:function(){if(this.settings.isFullscreen){var e=$("#"+this.settings.id);if(this.settings.isChildGrid)e.css({height:"100%"});else{var t=e.offset();t=t||{top:0};var i=$("#AppBodyHeader").length>0&&!this.settings.fkValue,n=i?$(window).height()-a.SFDC_HEADER_PX:$(window).height()-t.top-10;e.css({height:Math.floor(n)+"px"})}this.getElement("grid").css({height:"100%"}),this.getElement("paneSplit").css({height:"100%"});var o=$(this.getElementId("fieldTreeView")+">div.k-pager-wrap").outerHeight(),r=$(this.getElementId("fieldTreeView")+">div.k-grid-header").outerHeight();$(this.getElementId("fieldTreeView")+">div.k-grid-content").css({"max-height":n-(r+o)})}},refreshIfColumnsOutOfSync:function(){var e=this,t=Object.first(e.settings.pageInfo.columns,function(t){var i=Object.first(e.kendoGrid.columns,function(e){return e.field==t});return!i});t||(t=Object.first(e.kendoGrid.columns,function(t){if(t.field)var i=Object.first(e.settings.pageInfo.columns,function(e){return t.field==e});return!i&&t.field})),t&&e.refresh()},showCancelLoadButton:function(e){var t=this,i=$(kendo.format("{0} a.k-pager-refresh span.k-icon",t.getElementId("grid")));i.length>0&&(e?(i.addClass("k-i-close"),i.removeClass("k-i-refresh"),i.one("click",function(e){i.hasClass("k-i-close")&&(t.kendoGrid.setDataSource([]),t.showCancelLoadButton(!1),e.preventDefault(),i.one("click",function(e){t.kendoGrid.setDataSource(t.gridDataSource)}))})):(i.removeClass("k-i-close"),i.addClass("k-i-refresh")))},adjustColumnWidths:function(){if(!this.settings.lockedColumns){var e=this,t=e.kendoGrid.parent.getElementId("grid"),i=0,n=["date","datetime","time","currency","integer","double","percent","boolean"];$.each(e.kendoGrid.options.columns,function(e,t){t.width&&(i+=parseInt(t.width))});var a=!1,o=$(t+" .k-grid-header-wrap > table"),r=$(t+" .k-grid-content > table"),s=$(t+" .k-grid-footer-wrap > table"),l=i<$(t).width(),d=e.gridDataSource.group(),c=[];$.each(e.kendoGrid.columns,function(e,t){var i=t.field,n=$.grep(d,function(e){return e.field==i});0==n.length?0==e?c.push("checkbox"):c.push(i):c.unshift(i)});var u=e.settings.enableDetailGrid&&!e.isReadingPaneShowing();if($.each(e.kendoGrid.columns,function(t,i){var f=i.field,p=$.grep(d,function(e){return e.field==f});if(t>0&&f){var h=$.grep(e.kendoGrid.parent.fieldMeta,function(e){return e.name==f});if(h&&h.length>0&&$.inArray(h[0].type.toLowerCase(),n)==-1&&0==p.length){var g=$.inArray(f,c)+(u?1:0),m=l&&!i.isResized?"":i.width;0!=o.length&&o.find("colgroup col").eq(g).css("width",m),0!=r.length&&r.find("colgroup col").eq(g).css("width",m),0!=s.length&&s.find("colgroup col").eq(g).css("width",m),""==m&&(a=!0)}}}),e.kendoGrid.columns.length>1){var f=a?"1px":"";o.find("colgroup col").eq(e.kendoGrid.columns.length-1+(u?1:0)).css("width",f),r.find("colgroup col").eq(e.kendoGrid.columns.length-1+(u?1:0)).css("width",f),s.find("colgroup col").eq(e.kendoGrid.columns.length-1+(u?1:0)).css("width",f)}0!=o.length&&o.css("width",""),0!=r.length&&r.css("width",""),0!=s.length&&s.css("width","")}},getChildTables:function(){var e=this,t={fields:[],childRelationship:{relationshipName:"Opportunities"}},i=window.isDebug?[t]:[];return e.settings.pageInfo.columns&&$.each(e.settings.pageInfo.columns,function(t,n){var a=n.match(/^\./);if(null!=a){var o,r=n.split("."),s=r[1],l=r.slice(2).join(".");if($.each(i,function(e,t){if(t.childRelationship.relationshipName==s)return o=t,!1}),void 0===o){var d;if($.each(e.settings.metadata.childRelationships,function(e,t){if(t.relationshipName==s)return d=t,!1}),void 0==d&&"Account"==e.settings.pageInfo.objectName&&"TasksAccountId"==s&&(d=Object.first(e.settings.metadata.childRelationships,function(e){return"Task"==e.childSObject&&"AccountId"==e.field}),d.relationshipName="TasksAccountId"),void 0!=d){var c=[];l&&l.length>0&&c.push(l),i.push({childRelationship:d,fields:c})}}else o.fields.push(l)}}),i},enterEditMode:function(){this.preserveSelectedRows(!0)},preserveSelectedRows:function(e,t,i,n){var a=this,o=a.kendoGrid.select(),r=[];if(i&&i.length>0?r=i:o&&o.length>0&&o.each(function(e,t){return r.push($(t).prevAll().length),!0}),r.length>0){var s=r[0],l=$(kendo.format("{0} tr:eq({1}) td:not(.k-group-cell,.k-hierarchy-cell,.selectedBox,.readOnly,.fillerColumn)",a.getElementId("grid"),s));if(l&&l.length>0)var d=$(l[0]).prevAll().length}return t||(a.preservedRows=r,a.refresh(function(){a.settings.editable=e;try{r&&(Object.each(r,function(e){var t=a.kendoGrid.table.find(kendo.format("tr:eq({0})",e)).first();t.find("input[name='selectedBox"+a.settings.id+"']").prop("checked",!0),a.settings.lockedColumns&&(t=$("[data-uid="+t.data("uid")+"]")),t.addClass("k-state-selected")}),a.selectionChanged()),e&&s&&d&&(a.settings.lockedColumns?s+=2:s++,a.kendoGrid.editCell($(kendo.format("{2} tr:eq({0}) td:eq({1})",s,d,a.getElementId("grid")))),a.syncScrollContent(!0)),"function"==typeof n&&n(a)}catch(e){}delete a.preservedRows})),r},cancelEditMode:function(){var e=this;e.gridDataSource.hasChanges()?e.checkForDirtyRows(!0):(e.settings.stayInEdit=!1,e.settings.skipRefresh=!1,e.preserveSelectedRows(!1),e.kendoGrid.cancelChanges())},toggleEditMode:function(){this.settings.editable=!this.settings.editable,$(kendo.format("#{0}_fieldTreeView_tt_active",this.settings.id)).hide(),this.settings.editable?this.enterEditMode():this.cancelEditMode()},saveButtonClick:function(e){var t=this,i=t.getElement("saveButton");if(i&&i.length>0&&!i.hasClass("k-state-disabled")){this.toolbar.enable("#"+t.settings.id+"_saveButton",!1),t.settings.skipRefresh=!0,t.settings.stayInEdit=!0;var n=$(document.activeElement);n.length>0&&n.blur(),t.delegateEvent("save",t.getActionContext()),t.kendoGrid.trigger("saveChanges");var a=t.preserveSelectedRows(!0,!0);t.settings.groupExpandAll=void 0;var o=function(){t.gridDataSource.sync().done(function(){t.preserveSelectedRows(!0,!1,a,e)})},r=t.checkForDirtyRelatedChildInstance();!t.settings.isChildGrid&&r.length>0?t.saveDirtyRowsPrompt(r,function(){o()},!1):o()}},setSaveButtonDirty:function(e){var t=this.getElement("saveButton");t.length>0&&(e?t.addClass("k-primary"):t.removeClass("k-primary"))},searchText:function(e){var t=this,i=/[\?\&\|\!\{\}\[\]\(\)\^\~\*\:\\\"\'\+\-]/g,a=kendo.format("FIND {{0}*} IN ALL FIELDS RETURNING {1}",e.replace(i,"\\$&"),t.settings.pageInfo.objectName);a+=t.settings.fkValue?kendo.format(" (Id WHERE {0} = '{1}')",t.settings.fkField,t.settings.fkValue):" (Id WHERE Id != null)";var o=function(e){var i=e.searchRecords.map(function(e){return e.Id}),n=function(){var e=t.getElement("searchText");e&&e.length>0&&e.focus()};i.length>0?(t.settings.pageInfo.selectedRecordIds=i,t.gridDataSource.read().then(function(){t.redraw()})):0==i.length&&(u.showMessage({title:"Search",message:"No records were found"},"error"),n())},r=function(e){var t=e.responseJSON||JSON.parse(e.responseText);console.log(t),t.length>0&&(t=t[0]),u.showMessage({title:"Search Failed",message:t.message},"error")};n.search(a,o,r)},toggleFullscreen:function(e){var t=i.parseAsObject(),n="isdtp",a=t[n],o=this.settings.pageName,r=this.settings.pageNamespace||"c",s=window.top!=window;if(this.settings.fkValue&&this.settings.pageLayoutId){var l=this.settings.pageLayoutId;i.isSalesforceId(l)&&(t.id=l)}a?(delete t[n],delete t.agFS):(t[n]="vw",t.agFS=1),this.checkForDirtyRows(!1)||(o&&s?(t.disableFS=1,i.navigateToVFPage(r,o,t,s)):i.navigateToPage(window.location.pathname.substring(1),t,s,void 0,window.location.hash))},createInNewWindow:function(){this.delegateEvent("createInNewWindow")},createNewInline:function(){var e=this,t=(this.isReadingPaneShowing(),this.checkForDirtyRelatedChildInstance()),n=function(){var t=!1,n=function(){if(e.settings.editable)if(t)e.gridDataSource.hasChanges()?o.popupWithButtons("Required Fields","Required fields needed to add inline. Would you like to save your pending changes?",[{label:"Save",click:function(){e.saveButtonClick(function(){e.kendoGrid.addRow()})}},{label:"Revert",click:function(){e.refreshWithDisabledFieldChooser(function(){e.kendoGrid.addRow()})}}]):e.refreshWithDisabledFieldChooser(function(){e.kendoGrid.addRow()});else{e.kendoGrid.addRow();var i=e.gridDataSource.data().filter(function(e){return e.dirty});Object.each(i,function(t){var i=e.kendoGrid.table.find("[data-uid="+t.uid+"]");Object.each(t.dirtyFields,function(e,t){var n=i.find("[headers=grid_col"+t+"]");n.addClass("k-dirty-cell"),n.prepend($("<span class='k-dirty'></span>"))})})}else e.settings.editable=!0,e.refreshWithDisabledFieldChooser(function(){e.kendoGrid.addRow()})},r=[],s=e.settings.metadata;Object.each(s.fields,function(t){if("boolean"!=t.type&&"false"==t.nillable&&"true"==t.createable&&a.ignoreRequiredFields.indexOf(t.name)<0)if(t.relationshipName){var n=t.referenceTo;n instanceof Array&&(n=n[0]);var o=i.getSObjectNameField(i.getSObjectDescribe(n));e.settings.pageInfo.columns.indexOf(t.relationshipName+"."+o)<0&&r.push(t.relationshipName+"."+o)}else e.settings.pageInfo.columns.indexOf(t.name)<0&&r.push(t.name)}),r.length>0&&Object.each(r,function(i){t|=e.toggleColumn(i)}),s.recordTypeInfos&&s.recordTypeInfos.length>1&&e.settings.pageInfo.columns.indexOf("RecordType.Name")<0?e.getRecordTypes(function(i){i&&i.selectorRequired&&(t|=e.toggleColumn("RecordType.Name",0)),n()}):n()};t.length>0?this.saveDirtyRowsPrompt(t,n):n()},destroyReadingPane:function(e){var t=this.getElement("paneSplit"),i=t.data("kendoSplitter"),n=this.getElement("pane");i&&(i.unbind(),i.remove(n))},updateReadingPane:function(e){var t=this,i=$(t.getElementId("pane")+" .k-item.k-state-active");if(i&&i.length>0&&0==i.attr("id").indexOf("vfPage")&&e&&t.settings.readingPane.rpvfPages&&t.settings.readingPane.rpvfPages.length>0){var n=Object.first(t.settings.readingPane.rpvfPages,function(e){return i.attr("id").indexOf(e.name)>-1});n&&n.name&&t.getElement("rpvf_"+n.name).attr("src","/apex/"+n.name+"?id="+e)}var a=this.getElement("readingPane"),o=$(".quick-view");if(a&&a.is(":visible"))this.setReadingPaneText(this.settings.readingPane.selectedField);else if(o&&o.is(":visible"))this.initPreviewChatter(e);else if(e){var r=this.getSelectedItems();r.length>0&&this.initChildGrids(e,r[0].Name)}else;},initCustomPane:function(e,t,i){var n=this;n.getElement(kendo.format("rp_customRP_{0}__tab__",t)).html('<span class="k-link" >'+e.getLabel(i)+"</span>");var a=n.getElement("customRP_"+t);e.saveData&&n.subscribeEvent("save",t,function(i){var a=n.getElement("customRP_"+t);n.settings.readingPane.expanded&&a.length>0&&e.saveData(i,a)}),e.saveView&&n.subscribeEvent("saveView",t,function(i,a){var o=n.getElement("customRP_"+t);n.settings.readingPane.expanded&&o.length>0&&e.saveView(n.getActionContext(),o,a)}),e.loadView&&n.subscribeEvent("loadView",t,function(i){var a=n.getElement("customRP_"+t);n.settings.readingPane.expanded&&a.length>0&&e.loadView(n.getActionContext(),a,i)}),e.select&&n.subscribeEvent("select",t,function(){var i=n.getElement("customRP_"+t);n.settings.readingPane.expanded&&i.length>0&&e.select(n.getActionContext(),i)}),a.is(":parent")||e.loadView(n.getActionContext(),a,n.saveView())},initReadingPane:function(e){if(!this.settings.isChildGrid&&this.settings.enableReadingPane&&d.getSetting(this.settings.pageInfo.objectName,"readingPane")!==!1){var t=this;!t.customReadingPanes&&t.settings.readingPane.expanded&&i.getLicensedPackages(this.settings.delegate.appNameSpaces,function(e,n){t.customReadingPanes={},$(document).off("customRPLoad").on("customRPLoad",function(e,t,i){$(kendo.format("[id$=_rp_customRP_{0}__tab__]",t)).each(function(e,n){var a=_.instances[n.id.split("_rp_customRP_")[0]],o=a.getActionContext();if(a.customReadingPanes[t]=i,i.isAvailable(o))a.initCustomPane(i,t,o);else{var r=$(n);r.parent().parent().data("kendoTabStrip").remove(r)}})});t.customReadingPanes.detailGrid=y,t.customReadingPanes.chart=k,Object.each(e,function(e){if(!(e.indexOf("CustomPane:")<0)){var n=e.split("CustomPane:")[1];t.customReadingPanes[n]={getLabel:function(){return n},loadView:function(){}},i.importScript(String.format("/resource/{0}/{1}",1e5*Math.floor((new Date).valueOf()/1e5),n),function(){})}}),t.initReadingPane(),crmc.addReadingPane(y),crmc.addReadingPane(k)});var n="vertical",a={collapsible:!1,size:t.settings.readingPane.height,collapsed:!0,resizable:!0};if($.inArray(this.settings.readingPane.position,["left","right"])>-1&&(n="horizontal",a.size=t.settings.readingPane.width),t.paneSplitter&&t.paneSplitter.element&&(t.paneSplitter.orientation=n,this.destroyReadingPane(),e))return t.modifySelectedView(),t.saveStickyView(),t.paneSplitter.destroy(),void t.init(t.settings);if(t.settings.readingPane.expanded){var o=this.getElement("paneSplit"),r='<div id="'+this.settings.id+'_pane" style="width:100%;"></div>',s=[{collapsible:!1,resizable:!0}];$.inArray(this.settings.readingPane.position,["bottom","right"])>-1?(o.append(r),s.push(a)):(o.prepend(r),s.unshift(a));var l=$(this.getPreviewTabStripTemplate());l.css({height:"calc(100% - 2px)",width:"calc(100% - 2px)",position:"absolute",overflow:"hidden"});var c=function(){var e=l.data("kendoTabStrip");e.resize(!0);var t=e.element.find("div.k-state-active");t.length>0&&t.css({height:"calc(100% - 3em)",width:"100%",position:"absolute"})};this.getElement("pane").append(l),l.id=this.getElementId("readingPaneTabs").replace("#",""),this.initPreviewTabStrip(l);var u=this.getElement("readingPane"),f=this.getElement("graph");if(this.paneSplitter=o.kendoSplitter({orientation:n,collapse:function(e){t.settings.readingPane.expanded=!1},expand:function(e){t.settings.readingPane.expanded=!0},resize:function(e){t.adjustColumnWidths(),t.settings.readingPane.expanded&&c(),"vertical"==this.orientation?t.getElement("pane").height()&&(t.settings.readingPane.height=t.getElement("pane").height()):t.getElement("pane").width()&&(t.settings.readingPane.width=t.getElement("pane").width())},panes:s}).data("kendoSplitter"),t.settings.readingPane.showText){var p=$('<input id="'+t.settings.id+'_readingPaneTextDropdown" />');p.css("margin","2px");var h=$('<iframe id="'+t.settings.id+'_readingPaneText" />');h.css({width:"calc(100% - 7px)",height:"calc(100% - 38px)",position:"absolute"}),u.append(p),u.append("<br />"),u.append(h),u.append('<span id="'+t.settings.id+'_readingPaneDirty" class="k-dirty" style="margin: 5px; display:none;"></span>');var g=p.kendoDropDownList({valueTemplate:'<span title="#:label#">#:label#</span>',dataSource:t.getReadingPaneTextFields(),dataTextField:"label",dataValueField:"name",value:t.settings.readingPane.selectedField,change:function(){t.setReadingPaneText(this.value())}}).data("kendoDropDownList");t.setReadingPaneText(g.value())}t.settings.readingPane.showGraphs&&(f.empty(),Object.each(t.columns,function(e){if(e.attributes&&"number"==e.attributes.class){var i=$('<div id="visualizer_'+e.field+'" style="float:left; width:50%; height:100%"/>');i.kendoChart({dataSource:t.gridDataSource,title:{text:e.title},valueAxis:[{labels:{format:e.format}}],autoBind:!1,series:[{field:e.field}],tooltip:{visible:!0,template:"#= dataItem.Name #:#= value #"}}),i.appendTo(f),i.data().kendoChart.refresh()}}));var m=t.getActionContext();Object.each(t.customReadingPanes,function(e,i){if(e.isAvailable)if(e.isAvailable(m)){var n=t.getElement("customRP_"+i);n.is(":parent")||t.initCustomPane(e,i,m)}else{var a=t.getElement("rp_customRP_"+i+"__tab__");l.data("kendoTabStrip").select().attr("id")==a.attr("id")&&setTimeout(function(){l.data("kendoTabStrip")&&l.data("kendoTabStrip").select(0)},300),a.parent().parent().data("kendoTabStrip")&&a.parent().parent().data("kendoTabStrip").remove(a)}}),t.settings.readingPane.expanded&&(t.paneSplitter.expand(t.getElement("pane")),t.paneSplitter.trigger("resize"));var a=$(t.getElement("pane"));a.off("keydown"),a.on("keydown",t.keyEvents.bind(t))}}},setReadingPaneText:function(e){var t=e,n="";if(t){var a;if(this.kendoGrid.element&&(a=this.getSelectedItems()[0]),a)if(a.hasOwnProperty(t))n=a[t];else try{var o,r=this.settings.metadata.getBoolean("queryable");if(this.settings.readingPane.selectedField=e,r)o=i.query("Select {0}, Id FROM {1} WHERE Id = '{2}'",t,this.settings.pageInfo.objectName,a.Id),o.length>0&&(n=o[0][t]);else{if(!this.settings.fkObjectParent){var s=i.getDescribeGlobal(),l=this.settings.fkValue.substring(0,3),c=Object.first(s.sobjects,function(e){return e.keyPrefix==l});this.settings.fkObjectParent=c.name}o=i.query("Select (select {0} FROM {3} WHERE Id = '{4}'), Id FROM {1} WHERE Id = '{2}'",t,this.settings.fkObjectParent,this.settings.fkValue,this.settings.fkRelationship,a.Id),o.length>0&&(n=o[0][this.settings.fkRelationship].records[t])}}catch(e){n=e.toString(),delete this.settings.readingPane.selectedField}else n="Please select a record.";this.settings.readingPane.selectedField=e}var u=this.getElement("readingPaneText");n=n||"";var f=!1,p=!1,h=!1,g=this;if(Object.each(this.settings.metadata.fields,function(e){return e.name!=t||(d.getSetting(g.settings.pageInfo.objectName,t,"fieldInlineEdit")!==!1&&(p=e.getBoolean("updateable")),f="richtextarea"==e.extraTypeInfo,!1)}),a&&this.settings.editable&&p){$("#"+this.settings.id+"_readingPaneRichText").data("kendoEditor")&&$("#"+this.settings.id+"_readingPaneRichText").data("kendoEditor").destroy(),a.dirtyFields&&a.dirtyFields[t]&&(h=!0);var m=function(){for(a.dirty=!0,$("#"+g.settings.id+"_readingPaneDirty").css("display","inline"),a.dirtyFields||(a.dirtyFields={}),a.dirtyFields[t]=a[t],idx=0,length=g.kendoGrid.columns.length;idx<length;idx++){var e=g.kendoGrid.columns[idx];if(e.field===t){var i=$(kendo.format("{2} tr[data-uid={0}] td:not(.k-group-cell,.k-hierarchy-cell):eq({1})",a.uid,idx,g.getElementId("grid")));if(i){i.hasClass("k-dirty-cell")||(i.addClass("k-dirty-cell"),i.prepend("<span class='k-dirty'></span>"));break}}}};$("#"+this.settings.id+"_readingPaneDirty").css("display",h?"inline":"none"),f?($("#"+this.settings.id+"_readingPaneDirty").css("margin","70px 0px 0px 11px"),u.replaceWith('<div id="'+this.settings.id+'_readingPaneText"><textarea style="height:100%;" id="'+this.settings.id+'_readingPaneRichText">'+n+"</textarea></div>"),$("#"+this.settings.id+"_readingPaneRichText").kendoEditor({change:function(e){a[t]=this.value(),m()}})):($("#"+this.settings.id+"_readingPaneDirty").css("margin","5px"),u.replaceWith('<textarea onmouseover = "this.style.cursor = \'pointer\'"onfocus = "this.style.cursor = \'text\'" id="'+this.settings.id+'_readingPaneText">'+n+"</textarea>"),$("#"+this.settings.id+"_readingPaneText").bind("change",function(e){a[t]=$("#"+g.settings.id+"_readingPaneText").val(),m()}),$("#"+this.settings.id+"_readingPaneText").css({
cursor:"pointer","font-family":"'Salesforce Sans', Arial, sans-serif"}))}else n=n.toLowerCase().indexOf("<html")<0?'<div id="'+this.settings.id+'_readingPaneText" style="margin:5px; white-space: pre-wrap;overflow: auto">'+n+"</div>":'<iframe id="'+this.settings.id+'_readingPaneText"  src="data:text/html;charset=utf-8,'+encodeURI(n||"")+'" />',u.replaceWith(n);this.settings.editable&&!p&&$("#"+this.settings.id+"_readingPaneText").addClass("readOnly"),$("#"+this.settings.id+"_readingPaneText").css({width:"calc(100% - 2.4em)",height:"calc(100% - 4.6em)",position:"absolute",margin:"5px"})},getSavedViewById:function(e){var t;try{t=i.query("select Id, Name, {0}JSON__c from {0}GridView__c where Id = '{1}' and isDeleted = false order by Name limit 1",i.getNamespace(!0),e)[0]}catch(e){}return t},getSavedViews:function(e){return w.getSavedViews(this.settings.pageInfo.objectName,this.getContextName(),e)},modifySelectedView:function(){var e=!0;if(this.settings.isChildGrid)this.settings.parentGrid.modifySelectedView();else if(this.settings.enableViews&&this.settings.enableToolbar){var t=this.getElement("views");if(t&&t.length>0){var i=t.data("kendoDropDownList"),n=this.getElement("modifiedFlag");if(this.selectedViewJSON&&this.selectedViewJSON.length>0)try{var a=JSON.stringify(this.saveView());e=this.selectedViewJSON!=a}catch(e){console.log(e)}this.selectedViewName?n&&n.length>0&&e&&n.show():i.text({Name:"*Unsaved View"})}this.selectedViewName&&e&&(this.selectedViewIsDirty=!0)}},manageViewsClick:function(){var e=this.getSavedViews();i.getUserInfo()?i.getUserInfo().userId:"";if(e&&e.length>0){var t,n="manageGrid"+a.UNIQUE_ID,r=i.getNamespace(!0),s=this,l=function(){var i=t.getSelectedItems();if(1===i.length){var n=Object.first(e,function(e){return e.Id===i[0].Id});n&&(s.settings.pageInfo={objectName:s.settings.pageInfo.objectName},s.loadSavedView(n))}else o.popup("Select View","You must select only a single view to load.")},d=$(this.getElementId("grid")).height();d>415?d=415:d<250?d=250:d-=.2*d;var c={resizable:!0,width:1100,height:d,maxHeight:415,minHeight:200};o.popupWithButtons("Manage Views",String.format("<div id='{0}' style='height:{1}px;'></div>",n,d-70),[{label:"Load View",click:l},{label:"Open View",click:function(){t.openSelectedRecord()}},{label:"Delete View",click:function(){return crmc.require(["BatchDelete"],function(e){e.click(t.getActionContext())}),!1}},{label:"Share View",click:function(){var e=t.getActionContext();if(1==e.selectedRows.length){var i=e.selectedRows[0].Id;window.open(kendo.format("/p/share/CustomObjectSharingDetail?parentId={0}",i))}else o.popup("Select A View","Please select one view to share.");return!1}}],c),t=_.create({pageInfo:{objectName:r+"GridView__c"},baseFilter:{logic:"and",filters:[{field:r+"ObjectName__c",operator:"eq",value:s.settings.pageInfo.objectName},{logic:"or",filters:[{field:r+"Context__c",operator:"eq",value:""},{field:r+"Context__c",operator:this.getContextName()==a.viewContext.pageLayout?"eq":"neq",value:a.viewContext.pageLayout}]}]},id:n,editable:!0,enableDetailGrid:!1,enableStickyViews:!1,enableFormatting:!1,enableNewButton:!1,enableNewInline:!1,enableViews:!1,enableHover:!1,isFullscreen:!1,enableFullscreen:!1})}else o.popup("No Saved Views","There are no saved views for "+this.settings.metadata.label)},loadViewDropDown:function(){var e=[],t=i.getUserInfo()?i.getUserInfo().userId:"",n=i.getNamespace(!0),a=i.parseAsObject(),o=w.validateView(this.settings.pageInfo,!1),r=this,s={transport:{read:function(i){r.getSavedViews(function(a){var o=Array.orderBy(Object.where(a,function(e){return"Private"===e[n+"Privacy__c"]&&e.OwnerId===t}),function(e){return e.Name.toLowerCase()}),r=Array.orderBy(Object.where(a,function(e){return"Private"===e[n+"Privacy__c"]&&e.OwnerId!==t}),function(e){return e.Name.toLowerCase()}),s=Array.orderBy(Object.where(a,function(e){return"Private"!==e[n+"Privacy__c"]}),function(e){return e.Name.toLowerCase()});o.length>0&&(e.push({Name:"My Views:"}),Object.each(o,function(t){e.push(t)})),s.length>0&&(e.push({Name:"Public Views:"}),Object.each(s,function(t){e.push(t)})),r.length>0&&(e.push({Name:"Shared Views:"}),Object.each(r,function(t){e.push(t)})),0===e.length&&e.push({Name:"No Saved Views"}),i.success(e)})}}},l=this,d=this.getElement("views");if(d&&d.length>0){var c=d.kendoDropDownList({autoBind:!1,optionLabel:{Name:"*Unsaved View"},valueTemplate:function(e){var t=l.selectedViewIsDirty,i=e.Name,n=t?"block":"none";return kendo.format('<div style="overflow: hidden;"><div id="{0}_modifiedFlag" style="display: {1}; float: right;">(Modified)</div><div style="text-overflow: ellipsis; overflow: hidden;" title="{2}">{2}</div></div>',l.settings.id,n,a&&a.viewTitle&&!o?decodeURIComponent(a.viewTitle):i)},dataSource:s,dataTextField:"Name",dataValueField:"Name",template:function(e){return e.Id?e[n+"IsDefault__c"]===!0?kendo.format('<div style="overflow: hidden; padding-left:10px;"><div style="display: true; float: right;"><b>(Default)</b></div><div style="text-overflow: ellipsis; overflow: hidden;" title="{0}">{0}</div></div>',e.Name):kendo.format('<div style="padding-left:10px;" title="{0}">{0}</div>',e.Name):"<strong>"+e.Name+"</strong>"},change:function(){var t=this.value();if(t){var i=Object.first(e,function(e){return e.Name===t});i&&i.Id&&(i.Id!=l.selectedViewId||i.Id==l.selectedViewId&&l.selectedViewIsDirty)&&(l.settings.pageInfo={objectName:l.settings.pageInfo.objectName},l.loadSavedView(i))}}}).data("kendoDropDownList");l.selectedViewName&&c.value(l.selectedViewName)}},setDataSourceAggregates:function(){var e=this;Object.each(this.columns,function(t){if(void 0!==t.aggregates&&t.aggregates.length>0)for(var i=e.gridDataSource.aggregates(),n=0;n<t.aggregates.length;n++)void 0!==i&&void 0!==i[t.field]||(jQuery.isEmptyObject(i)&&e.gridDataSource.aggregate([]),e.gridDataSource.aggregate().push({field:t.field,aggregate:t.aggregates[n]}))})},initContextMenu:function(e,t){var i=this.getElement(e);if(i){var n=i.data("kendoContextMenu");n&&n.destroy(),i.empty()}var a=this,o=i.kendoContextMenu({animation:{open:{effects:"fadeIn"},duration:300},open:function(i){if(i.item&&i.item.length>0&&"#"+i.item[0].id==a.getElementId(e)){var n=$(i.target).attr("data-field");if(n)var o=Object.first(a.kendoGrid.columns,function(e){return e.field==n});a.addActionItems(a.getActionContext(t,o))}},target:this.getElementId("grid"),filter:t?"thead th":"tbody tr:not(.k-detail-row)",select:function(e){var t=a.getSelectedItems();e.item.classList||(e.item.classList=e.item.className.split(" "));var i=Object.first(e.item.classList,function(e){return 0==e.indexOf("menuItem")}),n=a.menuItems;if(void 0!==n[i]&&"function"==typeof n[i].click){n[i].click({selection:t,grid:a,menuItem:n[i]});var o=i;"string"==typeof n[i].text&&(o=n[i].text);var r={selectedRows:t&&t.length,objectName:a.settings.pageInfo.objectName,type:"Action"};n[i].isCustom&&(r.label=o,o="Custom Action"),b.track(o,r)}}}).data("kendoContextMenu");return o},getElement:function(e){return $(this.getElementId(e))},getElementId:function(e){return kendo.format("#{0}_{1}",this.settings.id,e)},addMenuItems:function(e,t,i){void 0===this.menuId&&(this.menuId=0);var n="menuItem"+this.menuId++;if(t.cssClass=t.cssClass?t.cssClass+" "+n:n,t.encoded=!1,t.isChild=i,t.__proto__={},void 0===t.text&&(t.text=t.label),e[n]=t,void 0!==t.items&&t.items.length>0){var a=this;Object.each(t.items,function(t){a.addMenuItems(e,t,!0)})}},addContextMenuItem:function(e){this.actionMenuItems||(this.actionMenuItems={}),this.addMenuItems(this.actionMenuItems,e)},addActionItems:function(e){var t=e.isHeader?this.headerMenu:this.actionMenu;t.element.empty();var i=this.delegateEvent("getActionItems",e);if(this.menuItems=e.isHeader?[]:Object.copy(this.actionMenuItems),i&&i.length>0){var n=this;Object.each(i,function(e){n.addMenuItems(n.menuItems,e)})}var a=[];Object.each(this.menuItems,function(e){e.isChild||a.push(e)}),a=Array.orderBy(a,function(e){return e.customOrder||e.text}),Object.each(a,function(e){t.append(e)})},showContextMenu:function(e,t){this.addActionItems(this.getActionContext()),this.actionMenu.open(e,t),this.getElement("contextMenu").attr("style","")},getActionContext:function(e,t){var i=this;return{selectedRows:this.getSelectedItems(),objectDescribe:this.settings.metadata,selectedColumn:t,isHeader:!!e&&e,kendoGrid:this.kendoGrid,actionGrid:this,subscribeEvent:function(e,t,n){return i.subscribeEvent(e,t,n)},unsubscribeEvent:function(e,t,n){return i.unsubscribeEvent(e,t,n)}}},isItemChecked:function(e){var t=this.settings.pageInfo.columns&&this.settings.pageInfo.columns.indexOf(e)>-1,i=this.settings.hiddenColumns&&this.settings.hiddenColumns.indexOf(e)>-1;return t&&!i},onToolbarItemChecked:function(e){this.toolbar&&this.toolbar.toggleGroup(e)},getColumns:function(e){var t=this;return e.unshift({title:" ",field:"check",sortable:{compare:function(e,i){var n=t.isItemChecked(e.name),a=t.isItemChecked(i.name),o=0;return n&&!a?o=1:!n&&a&&(o=-1),o}},filterable:!1,width:"45px",headerTemplate:'<span class="k-icon k-i-kpi"/>',template:function(e){if(e.showCheckbox===!1)return"";var i,n=e.name,a=e.parentModel,o=[],r=!1,s=!1;if("childgridnode"==a.type)n="."+e.name,i=kendo.format("$('{0}').data('kendoTreeList').parent.onChildGridNodeChecked('{1}','{2}')",t.getElementId("fieldTreeView"),e.relObjectName,e.name);else if(void 0!=e.tabName)r=t.isReadingPaneTabEnabled(e.tabName),n=void 0,"quickView"==e.tabName&&"true"!=t.settings.metadata.feedEnabled&&(s=!0),i=kendo.format("$('{0}').data('kendoTreeList').parent.onRPTabChecked('{1}')",t.getElementId("fieldTreeView"),e.tabName);else if("pagenode"==e.type){n=void 0;var l=t.settings.readingPane.rpvfPages;r=l&&l.length>0&&Object.first(l,function(t){return t.name==e.name}),i=kendo.format("$('{0}').data('kendoTreeList').parent.onVFPageChecked({name:'{1}', title:'{2}'})",t.getElementId("fieldTreeView"),e.name,e.nodeName)}else if("toolbargroupnode"==e.type){n=void 0;var d=t.toolbar&&t.toolbar.saveState()||t.settings.toolbarState;r=d&&d[e.nodeName]&&d[e.nodeName].visible,i=kendo.format("$('{0}').data('kendoTreeList').parent.onToolbarItemChecked('{1}')",t.getElementId("fieldTreeView"),e.nodeName)}if(e.isChild===!0){for(var c=["objectnode","readingpanenode","detailgridnode","chartnode"];a&&c.indexOf(a.type)==-1;)o.unshift(a.relationshipName),a=a.parentModel;n=kendo.format("{0}.{1}",o.join("."),n)}var u;if(a&&(u=a.type),n)switch(u){case"detailgridnode":r=t.settings.readingPane.detailGrid&&t.settings.readingPane.detailGrid.fieldNames&&t.settings.readingPane.detailGrid.fieldNames.indexOf(n)>-1;break;case"chartnode":r=t.settings.readingPane.chart&&t.settings.readingPane.chart.fieldNames&&void 0!==t.settings.readingPane.chart.fieldNames[n];break;default:r=t.isItemChecked(n)}var f=r?'checked="true" ':"";switch(f+=s?'disabled="disabled" ':"",u){case"detailgridnode":i=i||kendo.format("return $('{0}').data('kendoTreeList').parent.onRPTabFieldChecked('detailGrid', '{1}')",t.getElementId("fieldTreeView"),n);break;case"chartnode":i=i||kendo.format("return $('{0}').data('kendoTreeList').parent.onRPTabFieldChecked('chart', '{1}')",t.getElementId("fieldTreeView"),n);break;default:i=i||kendo.format("return $('{0}').data('kendoTreeList').parent.onItemChecked('{1}','{0}')",t.getElementId("fieldTreeView"),n)}return kendo.format('<input type="checkbox" onclick="{0}" {1} data-field-name="{2}"/>',i,f,n)}}),e},onChildGridNodeChecked:function(e,t){var i=this;this.fieldQueue=this.fieldQueue||[],this.loadDefaultFieldSet(e,function(e){Object.each(e,function(e){i.fieldQueue.push("."+t+"."+e)}),i.onItemChecked()})},onItemChecked:function(e){var t=this;if(this.checkForDirtyRows(!1,function(){t.onItemChecked(e)}))return!1;this.fieldQueue=this.fieldQueue||[];var i=this.fieldQueue;e&&i.push(e),clearTimeout(this.fieldTimer),this.settings.fieldChooserDelay>=0&&i.length>0&&(this.fieldTimer=setTimeout(function(){for(var e=!1,n={};i.length>0;){var a=i.shift();t.addRemoveColumn(a);var o=0==a.lastIndexOf(".",0);if(o){var r=a.split("."),s=r[1];e=t.addRemoveChildColumn(a);var l=t.findChildGrid(s);l&&(n[s]=l)}else e=!0}e&&($(t.getElementId("fieldTreeView")+" :checkbox").attr("disabled",!0),t.preserveSelectedRows(t.settings.editable,!1,void 0,function(){$(t.getElementId("fieldTreeView")+" :checkbox").attr("disabled",!1)})),Object.each(n,function(e){e&&e.kendoGrid&&e.kendoGrid.element&&$(e.kendoGrid.element).is(":visible")&&($(t.getElementId("fieldTreeView")+" :checkbox").attr("disabled",!0),e.refresh(function(){$(t.getElementId("fieldTreeView")+" :checkbox").attr("disabled",!1)}))})},this.settings.fieldChooserDelay))},autoUpdateChecked:function(e){e?(this.settings.fieldChooserDelay=1500,this.onItemChecked()):this.settings.fieldChooserDelay=-1},toggleColumn:function(e,t){if(this.settings.isChildGrid){var i=this.settings.id.split("-")[1];e="."+i+"."+e;var n=this.settings.parentGrid;return n.addRemoveColumn(e,t),n.addRemoveChildColumn(e,t)}return this.addRemoveColumn(e,t),!0},addRemoveColumn:function(e,t,i,n){this.settings.pageInfo.columns=this.settings.pageInfo.columns||[];var a=this.settings.hiddenColumns&&this.settings.hiddenColumns.indexOf(e)>-1;a&&(this.settings.pageInfo.columns.splice(this.settings.pageInfo.columns.indexOf(e),1),this.settings.hiddenColumns.splice(this.settings.hiddenColumns.indexOf(e),1));var o=this.settings.pageInfo.columns.indexOf(e);if(n)o>-1&&this.settings.pageInfo.columns.splice(o,1);else if(o<0)t="number"==typeof t?t:this.settings.pageInfo.columns.length,this.settings.pageInfo.columns.splice(t,0,e),i&&(this.settings.hiddenColumns||(this.settings.hiddenColumns=[]),this.settings.hiddenColumns.push(e));else{this.settings.pageInfo.columns.splice(o,1);var r=this.gridDataSource.group();Object.each(r,function(t){t.field==e&&r.remove(t)})}},findChildGrid:function(e){var t=this;for(var i in _.instances){var n=i.split("-");if(3==n.length&&n[0]==t.getElementId("grid").replace("#","")&&n[1]==e){var a=_.instances[i];break}}return a},addRemoveChildColumn:function(e,t){var i=!1,n=e.split("."),a=n[1],o=n.slice(2).join("."),r=!1,s=!1,l=this.findChildGrid(a);return l&&(r=!0,l.addRemoveColumn(o,t),0==l.settings.pageInfo.columns.length&&(s=!0,l.kendoGrid&&(l.kendoGrid.destroy(),l.kendoGrid=null),Object.each(_,function(e,t){e===l&&delete _.instances[t]}))),!r&&this.kendoGrid&&(this.kendoGrid.element.find(".k-detail-row").length>0||!s)||s?i=!0:this.fieldChooser.fieldTreeView.refresh(),i},getItemAtIndex:function(e){var t=kendo.format("tr:eq({0})",e);return this.kendoGrid.dataItem(t)},updateFooter:function(e){$("#selectedCount"+this.settings.id).length<1&&$("#"+this.settings.id+"_grid>[data-role=pager]").append($('<span id="selectedCount'+this.settings.id+'" />'));var t="";e||(e=this.getSelectedItems()),e.length>0&&(t=e.length+" row"+(1!=e.length?"s":"")+" selected"),$("#selectedCount"+this.settings.id).text(t)},getRecordTypes:function(e){n.getDescribeLayout(this.settings.pageInfo.objectName,function(t){var n=i.getPicklistsForRecordTypes(t);"function"==typeof e&&e(n)},function(e){console.log(e),b.trackException(e)})},getPicklistValues:function(e,t,n){var a={fieldName:e,picklistValues:t,objectName:this.settings.pageInfo.objectName,fields:this.settings.metadata.fields,recordTypeInfos:this.settings.metadata.recordTypeInfos};return i.getPicklistValueFactory(a)},getSelectedItems:function(){var e,t={};if(this.kendoGrid)try{e=this.kendoGrid.select()}catch(e){console.log(e),b.trackException(e)}if(e&&e.length>0)for(var i=0;i<e.length;i++)t[e[i].dataset.uid]||(t[e[i].dataset.uid]=this.kendoGrid.dataItem(e[i]));return $.map(t,function(e){return e})},getLockedColumns:function(){var e=this.columns;return this.kendoGrid&&(e=this.kendoGrid.columns),e.filter(function(e){return e.locked})},getSelectedView:function(){var e=this.selectedViewName,t=Object.first(this.getSavedViews(),function(t){return t.Name===e});return t},newView:function(){var e=this,t=function(){e.loadDefaultFieldSet(e.settings.pageInfo.objectName,function(t){e.resetViewSettings(),e.settings.pageInfo.columns=t,e.refresh(function(){e.modifySelectedView(),e.saveNamedView()})})};this.selectedViewIsDirty?o.popupWithButtons("Unsaved View","Your view is modified, if you continue changes will be lost.",[{label:"New View",click:function(){t()}},{label:"Cancel"}]):t()},saveNamedView:function(){var e=this,t=function(){w.saveMenu(e)};w.validateView(this.settings.pageInfo,!0,t)&&t()},blurEditCell:function(){this.getElement("grid").has($(document.activeElement)).length>0&&$(".k-edit-cell").find("input, textarea").blur()},quickSaveView:function(e){var t=this,n=e?e:this.getSelectedView();if(n){var a=i.getUserInfo().userId;if(a==n.OwnerId||"Public"==n.Privacy__c){var o=function(){w.saveMenu(t)};if(w.validateView(this.settings.pageInfo,!1,o)){var r=this.saveView();n[i.getNamespace(!0)+"JSON__c"]=JSON.stringify(r),n[i.getNamespace(!0)+"ObjectName__c"]=this.settings.pageInfo.objectName;var s=function(e){u.showMessage({title:"View Updated",message:"Successfully updated view"},"success"),t.setSelectedView(e,!1,!0)};w.saveAGView(n,s)}}else if(a!=n.OwnerId&&"Public Read-Only"==n.Privacy__c){var l=t.getElementId("grid")+"_SaveViewAs_Alert";u.showMessage({title:"Public Read-Only View",message:kendo.format(' (<a id="{0}" href="#" >Click to Save View As…</a>)',l.replace("#",""))},"success"),$(l).parent().parent().on("click",function(){w.saveMenu(t)})}}else w.saveMenu(this)},saveDataAndView:function(e){var t=this;if(this.blurEditCell(),!e&&this.gridDataSource.hasChanges()&&this.saveButtonClick(),this.settings.isChildGrid)this.settings.parentGrid.saveDataAndView(!0);else if(d.getSetting(this.settings.pageInfo.objectName,"saveView")!==!1&&this.settings.enableViews){var i=this.getSelectedView();if(i){var n=t.getElementId("grid")+"_SaveView_Alert";u.showMessage({title:"View has been modified",message:kendo.format(' (<a id="{0}" href="#" >Click to save view</a>)',n.replace("#",""))},"success"),$(n).parent().parent().on("click",function(){t.quickSaveView(i)})}else{var n=this.getElementId("grid")+"_SaveViewAs_Alert";u.showMessage({title:"No Saved Views",message:kendo.format(' (<a id="{0}" href="#" >Click to save new view</a>)',n.replace("#",""))},"success"),$(n).parent().parent().on("click",function(){w.saveMenu(t)})}}},saveView:function(){var e=this,t={};if(Object.copy(this.settings.pageInfo,t),t.readingPane=this.settings.readingPane,t.childTabOrder=this.settings.childTabOrder,t.selectedReadingPane=this.settings.selectedReadingPane,t.lockedColumns=this.settings.lockedColumns,t.groupExpandAll=this.settings.groupExpandAll,t.hiddenColumns=this.settings.hiddenColumns,this.kendoGrid&&this.kendoGrid.columns){var n=[];Object.each(this.kendoGrid.columns,function(e,t){var i=w.saveColumnMeta(e);i.ordinal=parseInt(t),n.push(i)}),t.displayColumns=n}return this.settings.conditionalRules&&(t.conditionalRules=this.settings.conditionalRules),this.settings.formulaFields&&(t.formulaFields=this.settings.formulaFields),this.settings.editable&&(t.editable=this.settings.editable),this.settings.fkField&&(t.fkField=this.settings.fkField),this.toolbar&&(t.toolbarState=this.toolbar.saveState()),this.settings.searchText&&(t.searchText=this.settings.searchText),t.toolbarCollapsed=this.settings.toolbarCollapsed,void 0!==this.gridDataSource&&(t.filter=this.gridDataSource.filter(),i.convertDateFilters(t.filter,this.fieldMeta),t.groups=this.gridDataSource.group(),t.takeCount=this.gridDataSource.pageSize(),t.skipCount=(this.gridDataSource.page()-1)*t.takeCount,t.sorts=this.gridDataSource.sort(),e.settings.isChildGrid!==!0&&$.each(this.getChildTables(),function(i,n){for(var a in _.instances){var o=_.instances[a],r=a.split("-");if(3==r.length&&r[0]==e.getElementId("grid").replace("#","")&&r[1]==n.childRelationship.relationshipName){void 0==t.childGridSettings&&(t.childGridSettings={}),o.kendoGrid?t.childGridSettings[r[1]]=o.saveView():delete t.childGridSettings[r[1]];break}}})),t},saveStickyView:function(){if(this.settings.enableStickyViews){var e=this.saveView();this.delegateEvent("saveView",e),this.selectedViewName&&(e.selectedViewName=this.selectedViewName,e.isDirty=this.selectedViewIsDirty,e.viewId=this.selectedViewId);try{localStorage.setItem(this.getStickViewId(),JSON.stringify(e))}catch(e){}}},loadSavedView:function(e){var t=i.getNamespace(!0),n=this.deserializeView(e[t+"JSON__c"]);this.resetViewSettings(),this.loadView(n),this.setSelectedView(e)},setSelectedView:function(e,t,n){var a=i.getNamespace(!0);this.selectedViewName=e.Name,this.selectedViewJSON=e[a+"JSON__c"],this.selectedViewId=e.Id,void 0!=n?this.selectedViewIsLoaded=n:this.selectedViewIsLoaded=!1,void 0!=t?this.selectedViewIsDirty=t:this.selectedViewIsDirty=!1,this.selectedViewIsDirty||this.getElement("modifiedFlag").hide()},loadView:function(e,t){if(null!==e&&void 0!==e){var i=e.filter,n=e.groups,a=e.takeCount,o=e.skipCount,r=e.sorts;this.settings.pageInfo.objectName=e.objectName,this.settings.pageInfo.columns=e.columns,this.settings.pageInfo.sorts=e.sorts,this.settings.pageInfo.groups=n,this.settings.pageInfo.takeCount=a,this.settings.pageInfo.skipCount=o,this.settings.pageInfo.childGridSettings=e.childGridSettings,this.settings.pageInfo.scope=e.scope,this.settings.hiddenColumns=e.hiddenColumns,this.settings.groupExpandAll=e.groupExpandAll,this.settings.readingPane=e.readingPane,this.settings.childTabOrder=e.childTabOrder,this.settings.selectedReadingPane=e.selectedReadingPane,this.settings.conditionalRules=e.conditionalRules,this.settings.formulaFields=e.formulaFields,this.settings.searchText=e.searchText,this.settings.editable=e.editable,(this.settings.editable&&this.settings.metadata&&this.settings.metadata.getBoolean("updateable")===!1||d.getSetting(this.settings.pageInfo.objectName,"editButton")===!1)&&(this.settings.editable=!1),this.settings.lockedColumns=e.lockedColumns,this.settings.toolbarState=e.toolbarState,this.settings.toolbarCollapsed=e.toolbarCollapsed,delete e.conditionalRules,delete e.editable;var s=this,l=[];if(this.settings.readingPane||(this.settings.readingPane=Object.copy(N.readingPane)),Object.each(this.settings.pageInfo.columns,function(t){d.getSetting(e.objectName,t,"field")===!1&&l.push(t)}),Object.each(l,function(e){s.settings.pageInfo.columns.remove(e)}),e.selectedRecordIds&&e.selectedRecordIds.length>0){var c=Object.first(e.selectedRecordIds,function(e){return e&&e.length>0});c&&(this.settings.pageInfo.selectedRecordsPassed?(i=void 0,delete this.settings.pageInfo.filter,delete this.settings.pageInfo.filterId):this.settings.pageInfo.selectedRecordIds=e.selectedRecordIds)}else e.filterId&&e.filterId.length>0?(this.settings.pageInfo.filterId=e.filterId,delete this.settings.pageInfo.sorts,delete this.settings.pageInfo.filter):this.settings.pageInfo.selectedRecordsPassed?(i=void 0,delete this.settings.pageInfo.filter,delete this.settings.pageInfo.filterId):(this.settings.pageInfo.filter=i,delete this.settings.pageInfo.filterId);this.initDataSource(function(e){var l={page:1,group:[],aggregate:e.aggregate()};i&&(l.filter=i),o&&o>0&&a>0&&(l.page=o/a+1),n&&n.length>0&&(Object.each(n,function(e){e.aggregates=l.aggregate}),l.group=n),r&&r.length>0&&(l.sort=r),a?l.pageSize=a:l.pageSize=N.pageInfo.takeCount,s.delegateEvent("beforeQuery",l);var d=e.query(l),c=d.then(function(){$(".k-context-menu").data("kendoContextMenu")&&$(".k-context-menu").data("kendoContextMenu").close()});"function"==typeof t&&c.then(t)},e.displayColumns),this.delegateEvent("loadView",e)}else{var u=this;this.loadDefaultFieldSet(u.settings.pageInfo.objectName,function(e){u.settings.pageInfo.columns=e,u.refresh()})}},getStickViewId:function(){var e="",t=i.getUserInfo();return t&&t.organizationId&&(e+=t.organizationId),e+=this.settings.viewId&&""!==this.settings.viewId?this.settings.viewId:this.settings.fkField&&""!==this.settings.fkField?this.settings.pageInfo.objectName+this.settings.fkField:window.location.pathname.indexOf("Explorer")>-1?this.settings.pageInfo.objectName+"Explorer":this.settings.pageInfo.objectName},getContextName:function(){var e=a.viewContext.vfPage;return window.location.pathname.indexOf("Explorer")>-1?e=a.viewContext.explorer:this.settings.fkField&&""!==this.settings.fkField&&(e=a.viewContext.pageLayout),e},deserializeView:function(e){var t;try{t=JSON.parse(e)}catch(i){t=JSON.parse(unescape(e))}return t},loadStickyView:function(){var e=void 0;if(this.settings.enableStickyViews)try{e=localStorage.getItem(this.getStickViewId())}catch(e){}if(e&&e.length>0){var t=this.deserializeView(e);if(this.settings.pageInfo.selectedRecordsPassed&&this.settings.pageInfo.selectedRecordIds&&this.settings.pageInfo.selectedRecordIds.length>0)return this.loadDefaultView(),this.selectedViewIsLoaded=void 0,this.selectedViewIsDirty=void 0,void(this.selectedViewId=void 0);if(this.settings.pageInfo.filterId&&(delete t.sorts,delete t.filter,delete t.selectedRecordIds,t.isDirty=!0,t.filterId=this.settings.pageInfo.filterId),t.selectedViewName&&(this.selectedViewName=t.selectedViewName,this.selectedViewIsLoaded=!0,this.selectedViewIsDirty=!0,this.selectedViewId=t.viewId),this.settings.viewId&&this.settings.viewId.length>0&&(this.settings.viewId!=t.viewId||!t.isDirty))return void this.loadDefaultView();if(!t.isDirty&&t.viewId){var i=this.getSavedViewById(t.viewId);if(i)return void this.loadSavedView(i)}t.columns&&t.columns.length>0?this.loadView(t):(this.selectedViewName=void 0,this.selectedViewIsLoaded=void 0,this.selectedViewIsDirty=void 0,this.selectedViewId=void 0,this.loadDefaultView())}else this.loadDefaultView()},loadDefaultView:function(){var e;if(this.delegateEvent("getColumnNames"))return this.settings.pageInfo.columns=this.settings.delegate.getColumnNames(),void this.refresh();if(this.settings.viewId&&this.settings.viewId.length>0)e=[this.getSavedViewById(this.settings.viewId)];else{var e,t=i.getNamespace(!0),n=this.getContextName(),o=[];switch(n){case a.viewContext.vfPage:case a.viewContext.explorer:o.push(kendo.format("'{0}'",a.viewContext.vfPage)),o.push(kendo.format("'{0}'",a.viewContext.explorer));break;default:case a.viewContext.pageLayout:o.push(kendo.format("'{0}'",n))}try{e=i.query("select {0}JSON__c, Name, Id from {0}GridView__c where {0}ObjectName__c = '{1}' and {0}Context__c in ({2}) and {0}IsDefault__c = true and isDeleted = false",t,this.settings.pageInfo.objectName,o.join(","))}catch(e){console.log(e),b.trackException(e)}}if(e&&e.length>0)this.loadSavedView(e[0]);else{var r=this;this.loadDefaultFieldSet(r.settings.pageInfo.objectName,function(e){r.settings.pageInfo.columns=e,r.settings.metadata.getBoolean("updateable")&&(r.settings.editable=!0),r.refresh()})}},loadDefaultFieldSet:function(e,t){i.executeRemoteAction("getDefaultFieldsForObject",[e],function(e,i){i.status?t(e):o.popup("Error",String.format("Failed getting default columns for {0} with error: {1}",grid.settings.metadata.label,i.message))},{escape:!1,buffer:!1})},resetViewSettings:function(){try{localStorage.removeItem(this.getStickViewId())}catch(e){}this.selectedViewName=void 0,this.selectedViewIsLoaded=void 0,this.selectedViewIsDirty=void 0,this.selectedViewId=void 0,this.settings.pageInfo.filter=void 0,this.settings.pageInfo.groups=void 0,this.settings.pageInfo.skipCount=0,this.settings.pageInfo.takeCount=100,this.settings.pageInfo.sorts=void 0,this.settings.pageInfo.selectedRecordsPassed||(this.settings.pageInfo.selectedRecordIds=[]),this.settings.pageInfo.filterId=void 0,this.settings.pageInfo.childGridSettings=void 0,this.settings.selectedReadingPane=void 0,this.settings.childTabOrder=void 0,this.settings.hiddenColumns=[],this.settings.toolbarState=void 0,this.settings.readingPane=void 0,this.settings.searchText=void 0,this.settings.groupExpandAll=void 0,this.settings.formulaFields=void 0,this.settings.conditionalRules=void 0,this.gridDataSource=void 0,this.destroyReadingPane();var e=this;for(var t in _.instances){var i=t.split("-");3==i.length&&i[0]==e.getElementId("grid").replace("#","")&&delete _.instances[t]}},resetView:function(){this.resetViewSettings(),this.loadStickyView()},refresh:function(e){this.loadView(this.saveView(),e)},redraw:function(){kendo.resize($(".k-splitter"),!0),kendo.resize($(".k-grid"),!0)},clearFilters:function(){var e=this,t=this.getElement("searchText");t&&t.length>0&&t.val(""),delete e.settings.pageInfo.filter,delete e.settings.pageInfo.filterId,delete e.settings.pageInfo.selectedRecordIds,delete e.settings.pageInfo.scope,e.gridDataSource.filter({})},refreshWithDisabledFieldChooser:function(e){var t=this.getElementId("fieldTreeView");this.settings.isChildGrid&&(t=this.settings.parentGrid.getElementId("fieldTreeView")),$(t+" :checkbox").attr("disabled",!0),this.refresh(function(){$(t+" :checkbox").attr("disabled",!1),"function"==typeof e&&e()})},refreshFormatting:function(e){var t=this;if(e){var i=function(i,n){return $(kendo.format("{2} tr[data-uid={0}] td:not(.k-group-cell,.k-hierarchy-cell):eq({1})",e.uid,n,t.getElementId("grid")))},n=function(t,i){var n=kendo.template(i.template);t.html(n(e))};Object.each(this.settings.conditionalRules,function(a,o){for(var r,s,l=0,d=t.kendoGrid.columns.length;l<d;l++)if(s=t.kendoGrid.columns[l],s.field===o&&!s.hidden){var c=$(kendo.format("{1} tr[data-uid={0}]",e.uid,t.getElementId("grid")));c.find("a").removeAttr("style"),c.removeAttr("style");var r=i(e.uid,l);r.removeAttr("style"),n(r,s);break}}),Object.each(this.settings.formulaFields,function(a,o){for(var r,s,l=0,d=t.kendoGrid.columns.length;l<d;l++){var s=t.kendoGrid.columns[l];if(s&&s.formula&&s.formula.id&&s.formula.id===o){var c=s.formula,u=m.getFormulaFieldName(c);e[u]=m.parseFormula(c,e);var r=i(e.uid,l);n(r,s);break}}})}Object.each(this.settings.conditionalRules,function(e,i){var n=0;Object.each(e,function(e,a){var o={};e.property&&(o[e.property]=e.color),e.backColor&&"rgba(255, 255, 255, 0)"!=e.backColor&&(o["background-color"]=e.backColor),e.foreColor&&(o.color=e.foreColor),e.italic&&(o["font-style"]="italic"),e.bold&&(o["font-weight"]="bold"),e.underline&&(o["text-decoration"]="underline");var r=".crmc_"+i.replace(/[^A-Z0-9a-z]*/g,"")+n++;if(e.isRow)for(var s=$(r).parent().parent("tr[data-uid]"),l=0;l<s.length;l++){var d=s[l],c=$(d).attr("data-uid");d=$(kendo.format("{1} tr[data-uid={0}]",c,t.getElementId("grid"))),d.css(o),d.attr("title",e.id),d.find("a").css(o)}else $(r).parent().css(o),$(r).parent().attr("title",e.id),$(r).parent().find("a").css(o)})})},rowDoubleClick:function(e){this.settings.editable||this.delegateEvent("rowDoubleClick")||this.openSelectedRecord(e.ctrlKey)},fillDown:function(){var e=this,t=e.getSelectedItems(),i=Object.where(t,function(e){return e.dirtyFields});if(i&&i.length>0)if(t&&t.length>0){var n=i[0],a=t[t.length-1];e.kendoGrid._progress&&e.kendoGrid._progress(!0),Object.each(t,function(t,i){setTimeout(function(){Object.each(n.dirtyFields,function(i,o){var r=Object.first(e.fieldMeta,function(e){return e.name==o}),s=o;if(r&&"REFERENCE"===r.type){var l=Object.first(e.fieldMeta,function(e){return e.parentMeta&&e.parentMeta.name==o});l&&(s=l.name)}for(idx=0,length=e.kendoGrid.columns.length;idx<length;idx++){var d=e.kendoGrid.columns[idx];if(d.field===s){var c=$(kendo.format("{2} tr[data-uid={0}] td:not(.k-group-cell,.k-hierarchy-cell):eq({1})",t.uid,idx,e.getElementId("grid")));if(c){e.kendoGrid.editCell(c);break}}}var u=t===a;if(u||(e.kendoGrid.editable={}),o!=s){var f=n[s];t[l.name]=f,l.parentMeta&&l.parentMeta.relationshipName&&t[l.parentMeta.relationshipName]&&(t[l.parentMeta.relationshipName].Id=i),t.set(s,f)}t.set(o,i),u?(e.kendoGrid._progress&&e.kendoGrid._progress(!1),e.kendoGrid.editCell(c)):delete e.kendoGrid.editable})})})}else o.popup("Selection Required","Auto Fill requires at least one row selected to fill to.");else o.popup("Auto Fill Unavailable","Auto Fill works by copying edited values to all selected rows, <br/>however you must have at least one row selected with modified values.")},editNextCell:function(e){if(x.isInEditMode&&(!this.kendoGrid.editable||this.kendoGrid.editable&&this.kendoGrid.editable.validatable.validate())){var t=x.editModeContext,i=":not(.k-group-cell,.k-hierarchy-cell,.fillerColumn,.selectedBox,.readOnly):visible",n=e?t.prevAll(i+":first"):t.nextAll(i+":first"),a=!1;
if(!n.length){if(n=t.parent(),this.settings.lockedColumns){var o=t.parents(".k-grid-content-locked").length>0,r=$(t.parent()).data("uid");n=o?$("[data-uid="+r+"]:last"):$("[data-uid="+r+"]:first"),a=!0}(!this.settings.lockedColumns||this.settings.lockedColumns&&(o&&e||!o&&!e))&&(n=$(n)[e?"prevAll":"nextAll"]("tr:not(.k-grouping-row):not(.k-detail-row):visible:first")),n=n.children(i+(e?":last":":first")),n&&n.length>0&&(this.kendoGrid.clearSelection(),this.kendoGrid.select(n.parent()))}if(t.find("input").blur(),this.kendoGrid.editCell(n&&n.length>0?n:t),a){this.kendoGrid.content&&this.kendoGrid.content.length>0&&this.kendoGrid.lockedContent&&this.kendoGrid.lockedContent.length>0;this.syncScrollContent(!e)}var s=n.find("input:visible");s.length>0&&s[0].select()}},syncScrollContent:function(e){this.kendoGrid&&this.kendoGrid.lockedContent&&(e?this.kendoGrid.content[0].scrollTop=this.kendoGrid.lockedContent[0].scrollTop:this.kendoGrid.lockedContent[0].scrollTop=this.kendoGrid.content[0].scrollTop)},navigateSelection:function(e,t,i){var n=this.kendoGrid.select();if(n.length>0&&!i){var a=$(document.activeElement),o=n.has(a);if(n.length>1&&(n=o&&o.length>0?o:n.first()),0==o.length||a.is("input[type=checkbox]")||t){var r="tr:not(.k-grouping-row,.k-group-footer)";if(n=e?$(n).prevAll(r):$(n).nextAll(r),n&&n.length>0){this.kendoGrid.clearSelection(),this.kendoGrid.select(n[0]);var s=n.position().top,l=this.kendoGrid.content.height();if(s>l||s<0){var d=this.kendoGrid.content.scrollTop();this.kendoGrid.content.scrollTop(d+s)}if(t&&this.kendoGrid.editable){var c=this.kendoGrid.editable.element.index();this.kendoGrid.editable.element.find("input").blur();var u=$(n.children(":eq("+c+")"));this.kendoGrid.editCell(u);var f=u.find("input:visible");f.length>0&&f[0].select()}}}}else if(i){for(var p,h,g=0,m=this.kendoGrid.items(),v=this.kendoGrid.columns,b=0;b<v.length;b++)if(v[b].schema&&v[b].schema.editable){g=b;break}if(n.length>0)p=n[0];else{var y=e?m.length-1:0;p=$(kendo.format("tr[data-uid={0}]",$(this.kendoGrid.items()[y]).attr("data-uid")))}if(this.settings.lockedColumns){var k=this.getElement("grid").find($(kendo.format("tr[data-uid={0}]",$(n.first()).attr("data-uid")))),w=k.first().children();h=w.length>=g+1?w[g]:$(p).children()[$(p).children().length-w.length]}else this.settings.isChildGrid||this.isReadingPaneShowing()||g++,h=$(p).children()[g];this.kendoGrid.select(p),this.kendoGrid.editCell(h),e&&this.syncScrollContent(!0)}},selectionChanged:function(){if(!this.delegateEvent("selectionChanged")){var e=this.getSelectedItems();if(this.updateFooter(e),this.isReadingPaneShowing()&&e&&e.length>0){var t=e[0].Id;this.updateReadingPane(t)}}this.delegateEvent("select",this.getActionContext())},openSelectedRecord:function(e){var t=this.kendoGrid.dataItem(this.kendoGrid.select());if(t&&void 0!==t.Id){var n={retURL:this.settings.pageURL};e?i.navigateToPage(t.Id,n,!1,"_BLANK"):i.navigateToPage(t.Id,n)}},delegateEvent:function(e,t){var i=this.settings.delegate;return i&&i[e]&&"function"==typeof i[e]?i[e].apply(this,[t]):void this.getElement("grid").trigger(e,t)},subscribeEvent:function(e,t,i){this.getElement("grid").off(e+"."+t).on(e+"."+t,i)},unSubscribeEvent:function(e,t,i){this.getElement("grid").off(e+"."+t)},allowParentalEditing:function(){return d.getSetting(this.settings.pageInfo.objectName,"editParents")!==!1},totalToolTipHandler:function(e){var t=$(e).attr("data-title"),i=this,n=$("<div>").kendoTooltip({position:"left",autoHide:!1,content:function(){var e=$('<div style="text-align:left;">Totals are for this page only </div>'),n=$('<a href="javascript:void(0);">(see all)</a>');return n.click(function(){i.summarizeColumn(t)}),e.append(n),e}}).data("kendoTooltip");n.show($(e))},subTotalToolTipHandler:function(e){var t=$("<div>").kendoTooltip({position:"left",autoHide:!1,content:"<div style='text-align:left;'>Subtotals for grouping are for this page only</div>"}).data("kendoTooltip");t.show($(e))},summarizeColumn:function(e,t,n){var a=this,s={objectName:this.settings.pageInfo.objectName,columns:[e],filter:this.settings.pageInfo.filter,selectedRecordIds:t||this.settings.pageInfo.selectedRecordIds,filterId:this.settings.pageInfo.filterId},l=Object.first(this.kendoGrid.columns,function(t){return t.field==e}),d=function(e,t,i,n,o,s){r.entry(e,[{label:"Count",name:"Count",help:kendo.format("Count of non-empty records for '{0}'.",l.title),attributes:"readonly",value:t},{label:"Sum",name:"Sum",attributes:"readonly",value:i},{label:"Average",name:"Average",attributes:"readonly",value:n},{label:"Minimum",name:"Minimum",attributes:"readonly",value:o},{label:"Maximum",name:"Maximum",attributes:"readonly",value:s}],{grid:a,width:300,buttons:[{name:"Dismiss",label:"Dismiss"}]})},c=t?l.title+" summary for selected records":l.title+" summary for all results";if(n){var u=this.getSelectedItems(),f=u.length,p=0,h=parseFloat(u[0][e]),g=parseFloat(u[0][e]),m=function(e){return kendo.format("{0:"+l.formula.format+"}",e)};Object.each(u,function(t){var i=parseFloat(t[e]);p+=i,h=h<i?h:i,g=g>i?g:i}),d(c,f,m(p),m(p/f),m(h),m(g))}else i.executeRemoteAction("getResultSOQL",[s],function(n,a){if(a.status){var r=["IsDeleted = false"];n.whereSOQL&&n.whereSOQL.length>0&&r.push(n.whereSOQL);var c=kendo.format("select sum({0}) sum, count({0}) c, avg({0}) avg, min({0}) min, max({0}) max from {1} where ",e,s.objectName)+r.join(" and ");try{var u=i.query(c)}catch(e){return void o.popup("Error","Error running aggregate query:"+e)}if(u&&u.length>0){var n=u[0],f=t?l.title+" summary for selected records":l.title+" summary for all results",p=kendo.format("{0:n0}",parseInt(n.c)||0),h=kendo.format(l.format,parseFloat(n.sum)||0),g=kendo.format(l.format,parseFloat(n.avg)||0),m=kendo.format(l.format,parseFloat(n.min)||0),v=kendo.format(l.format,parseFloat(n.max)||0);d(f,p,h,g,m,v)}}else o.popup("Error",String.format("Unable to summarize {0} with error: {1}",e,a.message))},{escape:!1,buffer:!1})}},_={instances:{},create:function(e){var t=Object.create(T);return t.init(e),this.instances[e.id]=t,b.track("ActionGrid Initialized",{context:t.getContextName(),objectName:e&&e.pageInfo&&e.pageInfo.objectName,pageName:e&&e.pageName,pageLayoutId:e&&e.pageLayoutId,fkField:e&&e.fkField,newButtonURL:e&&e.newButtonURL,viewId:e&&e.viewId,enableNewButton:e&&e.enableNewButton,enableNewInline:e&&e.enableNewInline,enableEdit:e&&e.enableEdit,enableFieldChooser:e&&e.enableFieldChooser,enableToolbar:e&&e.enableToolbar,enableActions:e&&e.enableActions,enableStickyViews:e&&e.enableStickyViews,enableViews:e&&e.enableViews,enableFormatting:e&&e.enableFormatting,enableReadingPane:e&&e.enableReadingPane,isFullscreen:e&&e.isFullscreen}),t}};return _}),crmc.define("DrillUpMenuItem",["sfdc","KendoPopup","CustomSettings","GridConstants","extensions"],function(e,t,i,n){var a=function(t,i,a){var o={object:t,viewTitle:a},r=e.getNamespace(!1);if(i.length>200){var s={Ids:i.join()};e.postToVFPage(r,n.VF_PAGE_NAME,o,s,!1,"_blank")}else o.Ids=i.join(),e.navigateToVFPage(r,n.VF_PAGE_NAME,o,!1,"_blank")},o={createSubMenuItem:function(e,t){return{text:e,meta:t}},init:function(e,t){t=t||{},Object.each(e,function(e){var n=e.settings.pageInfo.objectName;if(i.getSetting(e.settings.pageInfo.objectName,"drillUp")!==!1){var a={text:"Drill Up..."};Visualforce.remoting.Manager.invokeAction(t.remoteActions.getDrillUpItemsForObject,n,function(t,n){n.status&&(t=Array.orderBy(t,function(e){return e.name}),Object.each(t,function(e){if(void 0===a.items&&(a.items=[]),i.getSetting("global",e.objectName,"explorer")!==!1){var t=o.createSubMenuItem(String.format("{0} ({1})",e.name,e.relationshipLabel),e);t.click=o.drillUp,a.items.push(t)}}),e.addContextMenuItem(a))},{escape:!1})}if(i.getSetting(e.settings.pageInfo.objectName,"drillDown")!==!1){var r={text:"Drill Down..."};Visualforce.remoting.Manager.invokeAction(t.remoteActions.getDrillDownItemsForObject,n,function(t,n){n.status&&(t=Array.orderBy(t,function(e){return e.name}),Object.each(t,function(e){if(void 0===r.items&&(r.items=[]),i.getSetting("global",e.objectName,"explorer")!==!1){var t=o.createSubMenuItem(String.format("{0} ({1})",e.name,e.relationshipLabel),e);t.click=o.drillDown,r.items.push(t)}}),e.addContextMenuItem(r))},{escape:!1})}})},drillUp:function(i){if(i.selection.length>0){var n=this.meta.relationshipName,o=[];if(void 0===i.selection[0][n]){var r=i.grid.settings.pageInfo.objectName;Object.each(i.selection,function(e){o.push("'"+e.Id+"'")}),i.selection=e.batchQueryIn(r,n+".Id","Id",o)}if(o=[],Object.each(i.selection,function(e){e[n]&&void 0!==e[n].Id&&o.push(e[n].Id)}),o.length>0){var s=this.meta.objectName;a(s,o,encodeURIComponent("Drill Up Results"))}else t.popup("Drill Up","No records to display")}else t.popup("Please select records","Select at least one record to Drill Up")},drillDown:function(i){if(i.selection.length>0){var n=this.meta.relationshipName,o=this.meta.objectName,r=[];Object.each(i.selection,function(e){void 0!==e.Id&&r.push("'"+e.Id+"'")});var s=e.batchQueryIn(o,"Id",n+".Id",r);s.length>0?(r=[],Object.each(s,function(e){r.push(e.Id)}),a(o,r,encodeURIComponent("Drill Down Results"))):t.popup("Drill Down","No records to display")}else t.popup("Please select records","Select at least one record to Drill Down.")}};return o}),crmc.define("ObjectList",["sfdc","CustomSettings"],function(e,t){var i={settings:{},kendoListView:void 0,kendoDataSource:void 0,init:function(i){this.settings=i;var n=$(i.elementId);n.empty();var a=$("<span>");a.appendTo(n),a.css({"margin-bottom":"5px",width:"100%"}),a.addClass("k-textbox k-space-right");var o=$("<input id='objectList_SearchBox' type='search'/>");o.css({margin:"3px"}),o.appendTo(a);var r=$("<a>");if(r.appendTo(a),r.addClass("k-icon k-i-search"),i.delegate&&i.delegate.dataSource)this.kendoDataSource=i.delegate.dataSource;else{var s=[{label:"Contact"},{label:"Opportunity"},{label:"Lead"},{label:"Order"},{label:"Account"}];this.kendoDataSource=new kendo.data.DataSource({data:window.isDebug?s:void 0,transport:{read:function(n){var a=function(e){return t.getSetting("global",e,i.permissionName)};results=e.getAvailableObjects(i.permissionName,a),i.includeGlobal&&results.unshift({label:"— Global Defaults —",name:"global"}),n.success(results)}}})}var l=this,d="label",c="name";if(i.filterField&&(d=i.filterField,c="Id"),o.on("keyup search input paste",function(){l.kendoDataSource.filter({field:d,operator:"contains",value:o.val()})}),i.header){var u=$("<div>");u.html(i.header),u.appendTo(n)}var f=$("<div>");f.appendTo(n),f.addClass("k-block"),f.css({"max-height":"500px",overflow:"scroll"});var p=$("<div>");i.listViewTemplate&&(template=i.listViewTemplate),p.appendTo(f),p.kendoListView({dataSource:this.kendoDataSource,template:function(e){return kendo.format("<div id='{0}' style='padding:0.5em;'>{1}</div>","objectList_"+e[c],e[d])},selectable:!0,change:function(){l.onSelectedChanged()}}),this.kendoListView=p.data("kendoListView")},onSelectedChanged:function(){var e=this.kendoListView.select(),t=this.kendoListView.dataSource.view()[e.index()];this.settings.delegate&&"function"==typeof this.settings.delegate.onSelectedChanged&&this.settings.delegate.onSelectedChanged(e.text(),t)}};return function(e){var t=Object.create(i);return t.init(e),t}}),crmc.define("ListButton",["sfdc","GridConstants"],function(e,t){return{getColumns:function(e){return[]},showInGrid:function(i,n,a,o){var r;try{if(void 0!==ListViewport&&void 0!==ListViewport.instances){var s=Object.first(ListViewport.instances,function(e){return!0});void 0!==s.filter&&void 0!==s.filter.id&&(r=s.filter.id)}}catch(e){}var l={object:i,filterId:void 0===r?"":r,FKName:a,FKValue:o},d=t.namespace;if(n.length>200){var c={Ids:n.join()};e.postToVFPage(d,t.VF_PAGE_NAME,l,c)}else l.Ids=n.join(),e.navigateToVFPage(d,t.VF_PAGE_NAME,l)}}});
//# sourceMappingURL=GridCore.resource.map
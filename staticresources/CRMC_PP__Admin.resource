var crmc;!function(){if(!crmc||!crmc.requirejs){crmc?t=crmc:crmc={};var e,t,a;!function(i){function n(e,t){return k.call(e,t)}function o(e,t){var a,i,n,o,r,s,l,d,c,u,p,f=t&&t.split("/"),m=b.map,h=m&&m["*"]||{};if(e&&"."===e.charAt(0))if(t){for(f=f.slice(0,f.length-1),e=e.split("/"),r=e.length-1,b.nodeIdCompat&&x.test(e[r])&&(e[r]=e[r].replace(x,"")),e=f.concat(e),c=0;c<e.length;c+=1)if(p=e[c],"."===p)e.splice(c,1),c-=1;else if(".."===p){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((f||h)&&m){for(a=e.split("/"),c=a.length;c>0;c-=1){if(i=a.slice(0,c).join("/"),f)for(u=f.length;u>0;u-=1)if(n=m[f.slice(0,u).join("/")],n&&(n=n[i])){o=n,s=c;break}if(o)break;!l&&h&&h[i]&&(l=h[i],d=c)}!o&&l&&(o=l,s=d),o&&(a.splice(0,s,o),e=a.join("/"))}return e}function r(e,t){return function(){return f.apply(i,w.call(arguments,0).concat([e,t]))}}function s(e){return function(t){return o(t,e)}}function l(e){return function(t){g[e]=t}}function d(e){if(n(v,e)){var t=v[e];delete v[e],y[e]=!0,p.apply(i,t)}if(!n(g,e)&&!n(y,e))throw new Error("No "+e);return g[e]}function c(e){var t,a=e?e.indexOf("!"):-1;return a>-1&&(t=e.substring(0,a),e=e.substring(a+1,e.length)),[t,e]}function u(e){return function(){return b&&b.config&&b.config[e]||{}}}var p,f,m,h,g={},v={},b={},y={},k=Object.prototype.hasOwnProperty,w=[].slice,x=/\.js$/;m=function(e,t){var a,i=c(e),n=i[0];return e=i[1],n&&(n=o(n,t),a=d(n)),n?e=a&&a.normalize?a.normalize(e,s(t)):o(e,t):(e=o(e,t),i=c(e),n=i[0],e=i[1],n&&(a=d(n))),{f:n?n+"!"+e:e,n:e,pr:n,p:a}},h={require:function(e){return r(e)},exports:function(e){var t=g[e];return"undefined"!=typeof t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:u(e)}}},p=function(e,t,a,o){var s,c,u,p,f,b,k=[],w=typeof a;if(o=o||e,"undefined"===w||"function"===w){for(t=!t.length&&a.length?["require","exports","module"]:t,f=0;f<t.length;f+=1)if(p=m(t[f],o),c=p.f,"require"===c)k[f]=h.require(e);else if("exports"===c)k[f]=h.exports(e),b=!0;else if("module"===c)s=k[f]=h.module(e);else if(n(g,c)||n(v,c)||n(y,c))k[f]=d(c);else{if(!p.p)throw new Error(e+" missing "+c);p.p.load(p.n,r(o,!0),l(c),{}),k[f]=g[c]}u=a?a.apply(g[e],k):void 0,e&&(s&&s.exports!==i&&s.exports!==g[e]?g[e]=s.exports:u===i&&b||(g[e]=u))}else e&&(g[e]=a)},e=t=f=function(e,t,a,n,o){if("string"==typeof e)return h[e]?h[e](t):d(m(e,t).f);if(!e.splice){if(b=e,b.deps&&f(b.deps,b.callback),!t)return;t.splice?(e=t,t=a,a=null):e=i}return t=t||function(){},"function"==typeof a&&(a=n,n=o),n?p(i,e,t,a):setTimeout(function(){p(i,e,t,a)},4),f},f.config=function(e){return f(e)},e._defined=g,a=function(e,t,a){t.splice||(a=t,t=[]),n(g,e)||n(v,e)||(v[e]=[e,t,a])},a.amd={jQuery:!0}}(),crmc.requirejs=e,crmc.require=t,crmc.define=a}}(),crmc.define("../Util/almond",function(){}),crmc.define("GridConstantsProd",[],function(){return{namespace:"CRMC_PP",VF_PAGE_NAME:"crmc_grid",VF_APEX_CONTROLLER:"AGComponentController",RELATED_LIST_OFFSET_PX:0,SFDC_HEADER_PX:225,UNIQUE_ID:0,viewContext:{pageLayout:"Page Layout",vfPage:"Visualforce Page",explorer:"Explorer"},viewPrivacy:{private:"Private",public:"Public",publicReadOnly:"Public Read-Only"},localStorageKeys:{getUserInfo:"getUserInfo",SFRestCache:"SFRestCache"},ignoreRequiredFields:["CreatedDate","CreatedById","LastModifiedById","LastModifiedDate"],operators:{string:{contains:"Contains",doesnotcontain:"Does not contain",eq:"Is equal to",neq:"Is not equal to",startswith:"Starts with",endswith:"Ends with",includes:"Includes (',' delimited)",excludes:"Excludes (',' delimited)",isnull:"Is empty",isnotnull:"Is not empty"},number:{gte:"Is greater or equal to",gt:"Is greater than",lte:"Is less or equal to",lt:"Is less than",eq:"Is equal to",neq:"Is not equal to",isnull:"Is empty",isnotnull:"Is not empty"},date:{eq:"Is equal to",neq:"Is not equal to",gte:"Is greater or equal to",gt:"Is greater than",lte:"Is less or equal to",lt:"Is less than",isnull:"Is empty",isnotnull:"Is not empty"},enums:{eq:"Is equal to",neq:"Is not equal to",isnull:"Is empty",isnotnull:"Is not empty"},multipicklist:{eq:"Is equal to",neq:"Is not equal to",includes:"Includes (',' delimited)",excludes:"Excludes (',' delimited)"},Object:{contains:"Contains",doesnotcontain:"Does not contain",eq:"Is equal to",neq:"Is not equal to",startswith:"Starts with",endswith:"Ends with",notexists:"Doesn't Exist",exists:"Exists"}},dateParts:{DAY_IN_MONTH:"Day",CALENDAR_MONTH:"Month",CALENDAR_YEAR:"Year",CALENDAR_QUARTER:"Quarter"},relativeDates:[{displayName:"Blank",dateLiteral:"NULL",period:"",requiresN:!1},{displayName:"Yesterday",dateLiteral:"YESTERDAY",period:"Day",requiresN:!1},{displayName:"Today",dateLiteral:"TODAY",period:"Day",requiresN:!1},{displayName:"Next Day",dateLiteral:"TOMORROW",period:"Day",requiresN:!1},{displayName:"Last 90 Days",dateLiteral:"LAST_90_DAYS",period:"Day",requiresN:!1},{displayName:"Next 90 Days",dateLiteral:"NEXT_90_DAYS",period:"Day",requiresN:!1},{displayName:"Last Week",dateLiteral:"LAST_WEEK",period:"Week",requiresN:!1},{displayName:"Next Week",dateLiteral:"NEXT_WEEK",period:"Week",requiresN:!1},{displayName:"Last n Days",formatText:"Last {0} Days",dateLiteral:"LAST_N_DAYS",period:"Day",requiresN:!0},{displayName:"Next n Days",formatText:"Next {0} Days",dateLiteral:"NEXT_N_DAYS",period:"Day",requiresN:!0},{displayName:"n Days Ago",formatText:"{0} Days Ago",dateLiteral:"N_DAYS_AGO",period:"Day",requiresN:!0},{displayName:"This Week",dateLiteral:"THIS_WEEK",period:"Week",requiresN:!1},{displayName:"Last n Weeks",formatText:"Last {0} Weeks",dateLiteral:"LAST_N_WEEKS",period:"Week",requiresN:!0},{displayName:"Next n Weeks",formatText:"Next {0} Weeks",dateLiteral:"NEXT_N_WEEKS",period:"Week",requiresN:!0},{displayName:"n Weeks Ago",formatText:"{0} Weeks Ago",dateLiteral:"N_WEEKS_AGO",period:"Week",requiresN:!0},{displayName:"Last Month",dateLiteral:"LAST_MONTH",period:"Month",requiresN:!1},{displayName:"This Month",dateLiteral:"THIS_MONTH",period:"Month",requiresN:!1},{displayName:"Next Month",dateLiteral:"NEXT_MONTH",period:"Month",requiresN:!1},{displayName:"Next n Months",formatText:"Next {0} Months",dateLiteral:"NEXT_N_MONTHS",period:"Month",requiresN:!0},{displayName:"Last n Months",formatText:"Last {0} Months",dateLiteral:"LAST_N_MONTHS",period:"Month",requiresN:!0},{displayName:"n Months Ago",formatText:"{0} Months Ago",dateLiteral:"N_MONTHS_AGO",period:"Month",requiresN:!0},{displayName:"Last Quarter",dateLiteral:"LAST_QUARTER",period:"Quarter",requiresN:!1},{displayName:"This Quarter",dateLiteral:"THIS_QUARTER",period:"Quarter",requiresN:!1},{displayName:"Next Quarter",dateLiteral:"NEXT_QUARTER",period:"Quarter",requiresN:!1},{displayName:"Next n Quarters",formatText:"Next {0} Quarters",dateLiteral:"NEXT_N_QUARTERS",period:"Quarter",requiresN:!0},{displayName:"Last n Quarters",formatText:"Last {0} Quarters",dateLiteral:"LAST_N_QUARTERS",period:"Quarter",requiresN:!0},{displayName:"n Quarters Ago",formatText:"{0} Quarters Ago",dateLiteral:"N_QUARTERS_AGO",period:"Quarter",requiresN:!0},{displayName:"Last Year",dateLiteral:"LAST_YEAR",period:"Year",requiresN:!1},{displayName:"This Year",dateLiteral:"THIS_YEAR",period:"Year",requiresN:!1},{displayName:"Next Year",dateLiteral:"NEXT_YEAR",period:"Year",requiresN:!1},{displayName:"Next n Years",formatText:"Next {0} Years",dateLiteral:"NEXT_N_YEARS",period:"Year",requiresN:!0},{displayName:"Last n Years",formatText:"Last {0} Years",dateLiteral:"LAST_N_YEARS",period:"Year",requiresN:!0},{displayName:"n Years Ago",formatText:"{0} Years Ago",dateLiteral:"N_YEARS_AGO",period:"Year",requiresN:!0},{displayName:"Last Fiscal Quarter",dateLiteral:"LAST_FISCAL_QUARTER",period:"Fiscal Quarter",requiresN:!1},{displayName:"This Fiscal Quarter",dateLiteral:"THIS_FISCAL_QUARTER",period:"Fiscal Quarter",requiresN:!1},{displayName:"Next Fiscal Quarter",dateLiteral:"NEXT_FISCAL_QUARTER",period:"Fiscal Quarter",requiresN:!1},{displayName:"Next n Fiscal Quarters",formatText:"Next {0} Fiscal Quarters",dateLiteral:"NEXT_N_FISCAL_QUARTERS",period:"Fiscal Quarter",requiresN:!0},{displayName:"Last n Fiscal Quarters",formatText:"Last {0} Fiscal Quarters",dateLiteral:"LAST_N_FISCAL_QUARTERS",period:"Fiscal Quarter",requiresN:!0},{displayName:"n Fiscal Quarters Ago",formatText:"{0} Fiscal Quarters Ago",dateLiteral:"N_FISCAL_QUARTERS_AGO",period:"Fiscal Quarter",requiresN:!0},{displayName:"Last Fiscal Year",dateLiteral:"LAST_FISCAL_YEAR",period:"Fiscal Year",requiresN:!1},{displayName:"This Fiscal Year",dateLiteral:"THIS_FISCAL_YEAR",period:"Fiscal Year",requiresN:!1},{displayName:"Next Fiscal Year",dateLiteral:"NEXT_FISCAL_YEAR",period:"Fiscal Year",requiresN:!1},{displayName:"Next n Fiscal Years",formatText:"Next {0} Fiscal Years",dateLiteral:"NEXT_N_FISCAL_YEARS",period:"Fiscal Year",requiresN:!0},{displayName:"Last n Fiscal Years",formatText:"Last {0} Fiscal Years",dateLiteral:"LAST_N_FISCAL_YEARS",period:"Fiscal Year",requiresN:!0},{displayName:"n Fiscal Years Ago",formatText:"{0} Fiscal Years Ago",dateLiteral:"N_FISCAL_YEARS_AGO",period:"Fiscal Year",requiresN:!0}]}}),crmc.define("GridConstants",["GridConstantsProd"],function(e){return e}),crmc.define("RestService",[],function(){var e={endpoint:"",cacheKey:"",clientId:"",sessionId:sforce.connection.sessionId,getSessionId:function(t){window.addEventListener("gotSessionId",function(a){var i=a.detail;e.sessionId=i,"function"==typeof t&&t()}),$(window).trigger("getSessionId")},promiseRequest:function(t,a){return new Promise(function(i,n){e.getRequest(t,i,n,a)})},getRequest:function(t,a,i,n){var o=!n&&localStorage&&localStorage.getItem(this.cacheKey);this.cacheObject||(this.cacheObject={});var r=this.cacheObject;r=o?JSON.parse(o):r;var s={Authorization:"Bearer "+e.sessionId,"Sforce-Call-Options":"client=CRMCulture/ActionGrid/"};r[t]&&r[t].dateRetrieved&&(s["If-Modified-Since"]=r[t].dateRetrieved);var l=this;$.ajax({url:t,type:"GET",headers:s,success:function(e,i,o){var s=o.getResponseHeader("Date");if(e&&s&&!n){if(r[t]={value:e,dateRetrieved:s},localStorage&&localStorage.setItem)try{localStorage.setItem(l.cacheKey,JSON.stringify(r))}catch(e){e&&"QuotaExceededError"==e.name&&localStorage.removeItem(l.cacheKey)}}else"notmodified"!=i||n||(e=r[t]&&r[t].value);"function"==typeof a&&a(e)}}).fail(function(o,r,s){var l=o.responseJSON||JSON.parse(o.responseText);if(l.length&&1==l.length&&(l=l[0]),l&&l.errorCode)switch(l.errorCode){case"API_DISABLED_FOR_ORG":e.getSessionId(function(){e.getRequest(t,a,i,n)})}}).fail(i)},postRequest:function(t,a,i,n){var o={"Content-Type":"application/json",Authorization:"Bearer "+e.sessionId,"Sforce-Call-Options":"client=CRMCulture/ActionGrid/"};$.ajax({url:t,type:"POST",dataType:"json",data:JSON.stringify(a),headers:o,success:function(e,t,a){"function"==typeof i&&i(e)}}).fail(function(a,o,r){var s=a.responseJSON||JSON.parse(a.responseText);if(s.length&&1==s.length&&(s=s[0]),s&&s.errorCode)switch(s.errorCode){case"API_DISABLED_FOR_ORG":e.getSessionId(function(){e.getRequest(t,i,n,disableCache)})}}).fail(n)}};return e}),crmc.define("SFRest",["GridConstants","RestService"],function(e,t){var a={},i={},n=Object.create(t);return n.endpoint="/services/data/v37.0/",n.cacheKey=e.localStorageKeys.SFRestCache,n.query=function(e,t,a){var i=[],n=this.endpoint+"query/?q="+encodeURIComponent(e),o=this,r=function(e){var n=!0;i=i.concat(e.records),e.done?(n=!1,t(i)):o.getRequest(e.nextRecordsUrl,r,a,!0)};return"function"!=typeof t?this.promiseRequest(n,!0):void this.getRequest(n,r,a,!0)},n.getSObjectDescribe=function(e,t,i){var n=function(i){a[e]=i,t(i)};this.getRequest(this.endpoint+"sobjects/"+encodeURIComponent(e)+"/describe",n,i)},n.getCachedDescribe=function(e,t,i){if(a[e])t(a[e]);else{var o=function(i){a[e]=i,t(i)};n.getSObjectDescribe(e,o,i)}},n.getCachedDescribeById=function(e,t,a){var o=e.substring(0,3);i[o]?n.getCachedDescribe(i[o],t,a):n.getGlobalDescribes(function(e){Object.each(e.sobjects,function(e){i[e.keyPrefix]=e.name}),i[o]?n.getCachedDescribe(i[o],t,a):"function"==typeof a&&a("Unknown Object Prefix: "+o)},a)},n.getDescribeLayout=function(e,t,a){this.getRequest(kendo.format("{0}sobjects/{1}/describe/layouts",this.endpoint,encodeURIComponent(e)),t,a)},n.getBinaryField=function(e,t,a,i,n){this.getRequest(kendo.format("{0}sobjects/{1}/{2}/{3}",this.endpoint,encodeURIComponent(e),encodeURIComponent(t),encodeURIComponent(a)),i,n)},n.getGlobalDescribes=function(e,t){this.getRequest(this.endpoint+"sobjects",e,t)},n.search=function(e,t,a){this.getRequest(kendo.format("{0}search?q={1}",this.endpoint,encodeURIComponent(e)),t,a)},n.getListViews=function(e,t,a){this.getRequest(this.endpoint+"sobjects/"+e+"/listviews/",t,a)},n.getListView=function(e,t,a,i){this.getRequest(this.endpoint+"sobjects/"+e+"/listviews/"+t+"/describe",a,i)},n.getReport=function(e,t,a){this.getRequest(this.endpoint+"analytics/reports/"+e,t,a)},n}),crmc.define("dateExt",[],function(){Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",MDT:"-0700",PDT:"-0800"}},Date.getMonthNumberFromName=function(e){for(var t=Date.CultureInfo.monthNames,a=Date.CultureInfo.abbreviatedMonthNames,i=e.toLowerCase(),n=0;n<t.length;n++)if(t[n].toLowerCase()==i||a[n].toLowerCase()==i)return n;return-1},Date.getDayNumberFromName=function(e){for(var t=Date.CultureInfo.dayNames,a=Date.CultureInfo.abbreviatedDayNames,i=(Date.CultureInfo.shortestDayNames,e.toLowerCase()),n=0;n<t.length;n++)if(t[n].toLowerCase()==i||a[n].toLowerCase()==i)return n;return-1},Date.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0},Date.getDaysInMonth=function(e,t){return[31,Date.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},Date.getTimezoneOffset=function(e,t){return t?Date.CultureInfo.abbreviatedTimeZoneDST[e.toUpperCase()]:Date.CultureInfo.abbreviatedTimeZoneStandard[e.toUpperCase()]},Date.getTimezoneAbbreviation=function(e,t){var a,i=t?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard;for(a in i)if(i[a]===e)return a;return null},Date.prototype.clone=function(){return new Date(this.getTime())},Date.prototype.compareTo=function(e){if(isNaN(this))throw new Error(this);if(e instanceof Date&&!isNaN(e))return this>e?1:this<e?-1:0;throw new TypeError(e)},Date.prototype.equals=function(e){return 0===this.compareTo(e)},Date.prototype.between=function(e,t){var a=this.getTime();return a>=e.getTime()&&a<=t.getTime()},Date.prototype.addMilliseconds=function(e){return this.setMilliseconds(this.getMilliseconds()+e),this},Date.prototype.addSeconds=function(e){return this.addMilliseconds(1e3*e)},Date.prototype.addMinutes=function(e){return this.addMilliseconds(6e4*e)},Date.prototype.addHours=function(e){return this.addMilliseconds(36e5*e)},Date.prototype.addDays=function(e){return this.addMilliseconds(864e5*e)},Date.prototype.addWeeks=function(e){return this.addMilliseconds(6048e5*e)},Date.prototype.addMonths=function(e){var t=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+e),this.setDate(Math.min(t,this.getDaysInMonth())),this},Date.prototype.addYears=function(e){return this.addMonths(12*e)},Date.prototype.add=function(e){if("number"==typeof e)return this._orient=e,this;var t=e;return(t.millisecond||t.milliseconds)&&this.addMilliseconds(t.millisecond||t.milliseconds),(t.second||t.seconds)&&this.addSeconds(t.second||t.seconds),(t.minute||t.minutes)&&this.addMinutes(t.minute||t.minutes),(t.hour||t.hours)&&this.addHours(t.hour||t.hours),(t.month||t.months)&&this.addMonths(t.month||t.months),(t.year||t.years)&&this.addYears(t.year||t.years),(t.day||t.days)&&this.addDays(t.day||t.days),this},Date._validate=function(e,t,a,i){if("number"!=typeof e)throw new TypeError(e+" is not a Number.");if(e<t||e>a)throw new RangeError(e+" is not a valid value for "+i+".");return!0},Date.validateMillisecond=function(e){return Date._validate(e,0,999,"milliseconds")},Date.validateSecond=function(e){return Date._validate(e,0,59,"seconds")},Date.validateMinute=function(e){return Date._validate(e,0,59,"minutes")},Date.validateHour=function(e){return Date._validate(e,0,23,"hours")},Date.validateDay=function(e,t,a){return Date._validate(e,1,Date.getDaysInMonth(t,a),"days")},Date.validateMonth=function(e){return Date._validate(e,0,11,"months")},Date.validateYear=function(e){return Date._validate(e,1,9999,"seconds")},Date.prototype.set=function(e){var t=e;return t.millisecond||0===t.millisecond||(t.millisecond=-1),t.second||0===t.second||(t.second=-1),t.minute||0===t.minute||(t.minute=-1),t.hour||0===t.hour||(t.hour=-1),t.day||0===t.day||(t.day=-1),t.month||0===t.month||(t.month=-1),t.year||0===t.year||(t.year=-1),t.millisecond!=-1&&Date.validateMillisecond(t.millisecond)&&this.addMilliseconds(t.millisecond-this.getMilliseconds()),t.second!=-1&&Date.validateSecond(t.second)&&this.addSeconds(t.second-this.getSeconds()),t.minute!=-1&&Date.validateMinute(t.minute)&&this.addMinutes(t.minute-this.getMinutes()),t.hour!=-1&&Date.validateHour(t.hour)&&this.addHours(t.hour-this.getHours()),t.month!==-1&&Date.validateMonth(t.month)&&this.addMonths(t.month-this.getMonth()),t.year!=-1&&Date.validateYear(t.year)&&this.addYears(t.year-this.getFullYear()),t.day!=-1&&Date.validateDay(t.day,this.getFullYear(),this.getMonth())&&this.addDays(t.day-this.getDate()),t.timezone&&this.setTimezone(t.timezone),t.timezoneOffset&&this.setTimezoneOffset(t.timezoneOffset),this},Date.prototype.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},Date.prototype.isLeapYear=function(){var e=this.getFullYear();return e%4===0&&e%100!==0||e%400===0},Date.prototype.isWeekday=function(){return!(this.is().sat()||this.is().sun())},Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())},Date.prototype.moveToFirstDayOfMonth=function(){return this.set({day:1})},Date.prototype.moveToLastDayOfMonth=function(){return this.set({day:this.getDaysInMonth()})},Date.prototype.moveToDayOfWeek=function(e,t){var a=(e-this.getDay()+7*(t||1))%7;return this.addDays(0===a?a+=7*(t||1):a)},Date.prototype.moveToMonth=function(e,t){var a=(e-this.getMonth()+12*(t||1))%12;return this.addMonths(0===a?a+=12*(t||1):a)},Date.prototype.getDayOfYear=function(){return Math.floor((this-new Date(this.getFullYear(),0,1))/864e5)},Date.prototype.getWeekOfYear=function(e){var t=this.getFullYear(),a=this.getMonth(),i=this.getDate(),n=e||Date.CultureInfo.firstDayOfWeek,o=8-new Date(t,0,1).getDay();8==o&&(o=1);var r=(Date.UTC(t,a,i,0,0,0)-Date.UTC(t,0,1,0,0,0))/864e5+1,s=Math.floor((r-o+7)/7);if(s===n){t--;var l=8-new Date(t,0,1).getDay();s=2==l||8==l?53:52}return s},Date.prototype.isDST=function(){return console.log("isDST"),"D"==this.toString().match(/(E|C|M|P)(S|D)T/)[2]},Date.prototype.getTimezone=function(){return Date.getTimezoneAbbreviation(this.getUTCOffset,this.isDST())},Date.prototype.setTimezoneOffset=function(e){var t=this.getTimezoneOffset(),a=Number(e)*-6/10;return this.addMinutes(a-t),this},Date.prototype.setTimezone=function(e){return this.setTimezoneOffset(Date.getTimezoneOffset(e))},Date.prototype.getUTCOffset=function(){var e,t=this.getTimezoneOffset()*-10/6;return t<0?(e=(t-1e4).toString(),e[0]+e.substr(2)):(e=(t+1e4).toString(),"+"+e.substr(1))},Date.prototype.getDayName=function(e){return e?Date.CultureInfo.abbreviatedDayNames[this.getDay()]:Date.CultureInfo.dayNames[this.getDay()]},Date.prototype.getMonthName=function(e){return e?Date.CultureInfo.abbreviatedMonthNames[this.getMonth()]:Date.CultureInfo.monthNames[this.getMonth()]},Date.prototype._toString=Date.prototype.toString,Date.prototype.toString=function(e){var t=this,a=function(e){return 1==e.toString().length?"0"+e:e};return e?e.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?/g,function(e){switch(e){case"hh":return a(t.getHours()<13?t.getHours():t.getHours()-12);case"h":return t.getHours()<13?t.getHours():t.getHours()-12;case"HH":return a(t.getHours());case"H":return t.getHours();case"mm":return a(t.getMinutes());case"m":return t.getMinutes();case"ss":return a(t.getSeconds());case"s":return t.getSeconds();case"yyyy":return t.getFullYear();case"yy":return t.getFullYear().toString().substring(2,4);case"dddd":return t.getDayName();case"ddd":return t.getDayName(!0);case"dd":return a(t.getDate());case"d":return t.getDate().toString();case"MMMM":return t.getMonthName();case"MMM":return t.getMonthName(!0);case"MM":return a(t.getMonth()+1);case"M":return t.getMonth()+1;case"t":return t.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"zzz":case"zz":case"z":return""}}):this._toString()},Date._now=function(){return new Date},Date.today=function(){return Date._now().clearTime()},Date.prototype._orient=1,Date.prototype.next=function(){return this._orient=1,this},Date.prototype.last=Date.prototype.prev=Date.prototype.previous=function(){return this._orient=-1,this},Date.prototype._is=!1,Date.prototype.is=function(){return this._is=!0,this},Number.prototype._dateElement="day",Number.prototype.fromNow=function(){var e={};return e[this._dateElement]=this,Date._now().add(e)},Number.prototype.ago=function(){var e={};return e[this._dateElement]=this*-1,Date._now().add(e)},function(){for(var e,t=Date.prototype,a=Number.prototype,i="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),n="january february march april may june july august september october november december".split(/\s/),o="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),r=function(e){return function(){return this._is?(this._is=!1,this.getDay()==e):this.moveToDayOfWeek(e,this._orient)}},s=0;s<i.length;s++)t[i[s]]=t[i[s].substring(0,3)]=r(s);for(var l=function(e){return function(){return this._is?(this._is=!1,this.getMonth()===e):this.moveToMonth(e,this._orient)}},d=0;d<n.length;d++)t[n[d]]=t[n[d].substring(0,3)]=l(d);for(var c=function(e){return function(){return"s"!=e.substring(e.length-1)&&(e+="s"),this["add"+e](this._orient)}},u=function(e){return function(){return this._dateElement=e,this}},p=0;p<o.length;p++)e=o[p].toLowerCase(),t[e]=t[e+"s"]=c(o[p]),a[e]=a[e+"s"]=u(e)}(),Date.prototype.toJSONString=function(){return this.toString("yyyy-MM-ddThh:mm:ssZ")},Date.prototype.toShortDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortDatePattern)},Date.prototype.toLongDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.longDatePattern)},Date.prototype.toShortTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortTimePattern)},Date.prototype.toLongTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.longTimePattern)},Date.prototype.getOrdinal=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},function(){Date.Parsing={Exception:function(e){this.message="Parse error at '"+e.substring(0,10)+" ...'"}};for(var e=Date.Parsing,t=e.Operators={rtoken:function(t){return function(a){var i=a.match(t);if(i)return[i[0],a.substring(i[0].length)];throw new e.Exception(a)}},token:function(e){return function(e){return t.rtoken(new RegExp("^s*"+e+"s*"))(e)}},stoken:function(e){return t.rtoken(new RegExp("^"+e))},until:function(e){return function(t){for(var a=[],i=null;t.length;){try{i=e.call(this,t)}catch(e){a.push(i[0]),t=i[1];continue}break}return[a,t]}},many:function(e){return function(t){for(var a=[],i=null;t.length;){try{i=e.call(this,t)}catch(e){return[a,t]}a.push(i[0]),t=i[1]}return[a,t]}},optional:function(e){return function(t){var a=null;try{a=e.call(this,t)}catch(e){return[null,t]}return[a[0],a[1]]}},not:function(t){return function(a){try{t.call(this,a)}catch(e){return[null,a]}throw new e.Exception(a)}},ignore:function(e){return e?function(t){var a=null;return a=e.call(this,t),[null,a[1]]}:null},product:function(){for(var e=arguments[0],a=Array.prototype.slice.call(arguments,1),i=[],n=0;n<e.length;n++)i.push(t.each(e[n],a));return i},cache:function(t){var a={},i=null;return function(n){try{i=a[n]=a[n]||t.call(this,n)}catch(e){i=a[n]=e}if(i instanceof e.Exception)throw i;return i}},any:function(){var t=arguments;return function(a){for(var i=null,n=0;n<t.length;n++)if(null!=t[n]){try{i=t[n].call(this,a)}catch(e){i=null}if(i)return i}throw new e.Exception(a)}},each:function(){var t=arguments;return function(a){for(var i=[],n=null,o=0;o<t.length;o++)if(null!=t[o]){try{n=t[o].call(this,a)}catch(t){throw new e.Exception(a)}i.push(n[0]),a=n[1]}return[i,a]}},all:function(){var e=arguments,t=t;return t.each(t.optional(e))},sequence:function(a,i,n){return i=i||t.rtoken(/^\s*/),n=n||null,1==a.length?a[0]:function(t){for(var o=null,r=null,s=[],l=0;l<a.length;l++){try{o=a[l].call(this,t)}catch(e){break}s.push(o[0]);try{r=i.call(this,o[1])}catch(e){r=null;break}t=r[1]}if(!o)throw new e.Exception(t);if(r)throw new e.Exception(r[1]);if(n)try{o=n.call(this,o[1])}catch(t){throw new e.Exception(o[1])}return[s,o?o[1]:t]}},between:function(e,a,i){i=i||e;var n=t.each(t.ignore(e),a,t.ignore(i));return function(e){var t=n.call(this,e);return[[t[0][0],r[0][2]],t[1]]}},list:function(e,a,i){return a=a||t.rtoken(/^\s*/),i=i||null,e instanceof Array?t.each(t.product(e.slice(0,-1),t.ignore(a)),e.slice(-1),t.ignore(i)):t.each(t.many(t.each(e,t.ignore(a))),px,t.ignore(i))},set:function(a,i,n){return i=i||t.rtoken(/^\s*/),n=n||null,function(o){for(var r=null,s=null,l=null,d=null,c=[[],o],u=!1,p=0;p<a.length;p++){l=null,s=null,r=null,u=1==a.length;try{r=a[p].call(this,o)}catch(e){continue}if(d=[[r[0]],r[1]],r[1].length>0&&!u)try{l=i.call(this,r[1])}catch(e){u=!0}else u=!0;if(u||0!==l[1].length||(u=!0),!u){for(var f=[],m=0;m<a.length;m++)p!=m&&f.push(a[m]);s=t.set(f,i).call(this,l[1]),s[0].length>0&&(d[0]=d[0].concat(s[0]),d[1]=s[1])}if(d[1].length<c[1].length&&(c=d),0===c[1].length)break}if(0===c[0].length)return c;if(n){try{l=n.call(this,c[1])}catch(t){throw new e.Exception(c[1])}c[1]=l[1]}return c}},forward:function(e,t){return function(a){return e[t].call(this,a)}},replace:function(e,t){return function(a){var i=e.call(this,a);return[t,i[1]]}},process:function(e,t){return function(a){var i=e.call(this,a);return[t.call(this,i[0]),i[1]]}},min:function(t,a){return function(i){var n=a.call(this,i);if(n[0].length<t)throw new e.Exception(i);return n}}},a=function(e){return function(){var t=null,a=[];if(arguments.length>1?t=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(t=arguments[0]),!t)return e.apply(null,arguments);for(var i=0,n=t.shift();i<n.length;i++)return t.unshift(n[i]),a.push(e.apply(null,t)),t.shift(),a}},i="optional not ignore cache".split(/\s/),n=0;n<i.length;n++)t[i[n]]=a(t[i[n]]);for(var o=function(e){return function(){return arguments[0]instanceof Array?e.apply(null,arguments[0]):e.apply(null,arguments)}},s="each any all".split(/\s/),l=0;l<s.length;l++)t[s[l]]=o(t[s[l]])}(),function(){var e=function(t){for(var a=[],i=0;i<t.length;i++)t[i]instanceof Array?a=a.concat(e(t[i])):t[i]&&a.push(t[i]);return a};Date.Grammar={},Date.Translator={hour:function(e){return function(){this.hour=Number(e)}},minute:function(e){return function(){this.minute=Number(e)}},second:function(e){return function(){this.second=Number(e)}},meridian:function(e){return function(){this.meridian=e.slice(0,1).toLowerCase()}},timezone:function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},day:function(e){var t=e[0];return function(){this.day=Number(t.match(/\d+/)[0])}},month:function(e){return function(){this.month=3==e.length?Date.getMonthNumberFromName(e):Number(e)-1}},year:function(e){return function(){var t=Number(e);this.year=e.length>2?t:t+(t+2e3<Date.CultureInfo.twoDigitYearMax?2e3:1900)}},rday:function(e){return function(){switch(e){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(e){e=e instanceof Array?e:[e];var t=new Date;this.year=t.getFullYear(),this.month=t.getMonth(),this.day=1,this.hour=0,this.minute=0,this.second=0;for(var a=0;a<e.length;a++)e[a]&&e[a].call(this);if(this.hour="p"==this.meridian&&this.hour<13?this.hour+12:this.hour,this.day>Date.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var i=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return this.timezone?i.set({timezone:this.timezone}):this.timezoneOffset&&i.set({timezoneOffset:this.timezoneOffset}),i},finish:function(t){if(t=t instanceof Array?e(t):[t],0===t.length)return null;for(var a=0;a<t.length;a++)"function"==typeof t[a]&&t[a].call(this);if(this.now)return new Date;var i=Date.today(),n=!(null==this.days&&!this.orient&&!this.operator);if(n){var o,r,s;return s="past"==this.orient||"subtract"==this.operator?-1:1,this.weekday&&(this.unit="day",o=Date.getDayNumberFromName(this.weekday)-i.getDay(),r=7,this.days=o?(o+s*r)%r:s*r),this.month&&(this.unit="month",o=this.month-i.getMonth(),r=12,this.months=o?(o+s*r)%r:s*r,this.month=null),this.unit||(this.unit="day"),null!=this[this.unit+"s"]&&null==this.operator||(this.value||(this.value=1),"week"==this.unit&&(this.unit="day",this.value=7*this.value),this[this.unit+"s"]=this.value*s),i.add(this)}return this.meridian&&this.hour&&(this.hour=this.hour<13&&"p"==this.meridian?this.hour+12:this.hour),this.weekday&&!this.day&&(this.day=i.addDays(Date.getDayNumberFromName(this.weekday)-i.getDay()).getDate()),this.month&&!this.day&&(this.day=1),i.set(this)}};var t,a=Date.Parsing.Operators,i=Date.Grammar,n=Date.Translator;i.datePartDelimiter=a.rtoken(/^([\s\-\.\,\/\x27]+)/),i.timePartDelimiter=a.stoken(":"),i.whiteSpace=a.rtoken(/^\s*/),i.generalDelimiter=a.rtoken(/^(([\s\,]|at|on)+)/);var o={};i.ctoken=function(e){var t=o[e];if(!t){
for(var i=Date.CultureInfo.regexPatterns,n=e.split(/\s+/),r=[],s=0;s<n.length;s++)r.push(a.replace(a.rtoken(i[n[s]]),n[s]));t=o[e]=a.any.apply(null,r)}return t},i.ctoken2=function(e){return a.rtoken(Date.CultureInfo.regexPatterns[e])},i.h=a.cache(a.process(a.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),n.hour)),i.hh=a.cache(a.process(a.rtoken(/^(0[0-9]|1[0-2])/),n.hour)),i.H=a.cache(a.process(a.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),n.hour)),i.HH=a.cache(a.process(a.rtoken(/^([0-1][0-9]|2[0-3])/),n.hour)),i.m=a.cache(a.process(a.rtoken(/^([0-5][0-9]|[0-9])/),n.minute)),i.mm=a.cache(a.process(a.rtoken(/^[0-5][0-9]/),n.minute)),i.s=a.cache(a.process(a.rtoken(/^([0-5][0-9]|[0-9])/),n.second)),i.ss=a.cache(a.process(a.rtoken(/^[0-5][0-9]/),n.second)),i.hms=a.cache(a.sequence([i.H,i.mm,i.ss],i.timePartDelimiter)),i.t=a.cache(a.process(i.ctoken2("shortMeridian"),n.meridian)),i.tt=a.cache(a.process(i.ctoken2("longMeridian"),n.meridian)),i.z=a.cache(a.process(a.rtoken(/^(\+|\-)?\s*\d\d\d\d?/),n.timezone)),i.zz=a.cache(a.process(a.rtoken(/^(\+|\-)\s*\d\d\d\d/),n.timezone)),i.zzz=a.cache(a.process(i.ctoken2("timezone"),n.timezone)),i.timeSuffix=a.each(a.ignore(i.whiteSpace),a.set([i.tt,i.zzz])),i.time=a.each(a.optional(a.ignore(a.stoken("T"))),i.hms,i.timeSuffix),i.d=a.cache(a.process(a.each(a.rtoken(/^([0-2]\d|3[0-1]|\d)/),a.optional(i.ctoken2("ordinalSuffix"))),n.day)),i.dd=a.cache(a.process(a.each(a.rtoken(/^([0-2]\d|3[0-1])/),a.optional(i.ctoken2("ordinalSuffix"))),n.day)),i.ddd=i.dddd=a.cache(a.process(i.ctoken("sun mon tue wed thu fri sat"),function(e){return function(){this.weekday=e}})),i.M=a.cache(a.process(a.rtoken(/^(1[0-2]|0\d|\d)/),n.month)),i.MM=a.cache(a.process(a.rtoken(/^(1[0-2]|0\d)/),n.month)),i.MMM=i.MMMM=a.cache(a.process(i.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),n.month)),i.y=a.cache(a.process(a.rtoken(/^(\d\d?)/),n.year)),i.yy=a.cache(a.process(a.rtoken(/^(\d\d)/),n.year)),i.yyy=a.cache(a.process(a.rtoken(/^(\d\d?\d?\d?)/),n.year)),i.yyyy=a.cache(a.process(a.rtoken(/^(\d\d\d\d)/),n.year)),t=function(){return a.each(a.any.apply(null,arguments),a.not(i.ctoken2("timeContext")))},i.day=t(i.d,i.dd),i.month=t(i.M,i.MMM),i.year=t(i.yyyy,i.yy),i.orientation=a.process(i.ctoken("past future"),function(e){return function(){this.orient=e}}),i.operator=a.process(i.ctoken("add subtract"),function(e){return function(){this.operator=e}}),i.rday=a.process(i.ctoken("yesterday tomorrow today now"),n.rday),i.unit=a.process(i.ctoken("minute hour day week month year"),function(e){return function(){this.unit=e}}),i.value=a.process(a.rtoken(/^\d\d?(st|nd|rd|th)?/),function(e){return function(){this.value=e.replace(/\D/g,"")}}),i.expression=a.set([i.rday,i.operator,i.value,i.unit,i.orientation,i.ddd,i.MMM]),t=function(){return a.set(arguments,i.datePartDelimiter)},i.mdy=t(i.ddd,i.month,i.day,i.year),i.ymd=t(i.ddd,i.year,i.month,i.day),i.dmy=t(i.ddd,i.day,i.month,i.year),i.date=function(e){return(i[Date.CultureInfo.dateElementOrder]||i.mdy).call(this,e)},i.format=a.process(a.many(a.any(a.process(a.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(e){if(i[e])return i[e];throw Date.Parsing.Exception(e)}),a.process(a.rtoken(/^[^dMyhHmstz]+/),function(e){return a.ignore(a.stoken(e))}))),function(e){return a.process(a.each.apply(null,e),n.finishExact)});var r={},s=function(e){return r[e]=r[e]||i.format(e)[0]};i.formats=function(e){if(e instanceof Array){for(var t=[],i=0;i<e.length;i++)t.push(s(e[i]));return a.any.apply(null,t)}return s(e)},i._formats=i.formats(["yyyy-MM-ddTHH:mm:ss","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","d"]),i._start=a.process(a.set([i.date,i.time,i.expression],i.generalDelimiter,i.whiteSpace),n.finish),i.start=function(e){try{var t=i._formats.call({},e);if(0===t[1].length)return t}catch(e){}return i._start.call({},e)}}(),Date._parse=Date.parse,Date.parse=function(e){var t=null;if(!e)return null;try{t=Date.Grammar.start.call({},e)}catch(e){return null}return 0===t[1].length?t[0]:null},Date.getParseFunction=function(e){var t=Date.Grammar.formats(e);return function(e){var a=null;try{a=t.call({},e)}catch(e){return null}return 0===a[1].length?a[0]:null}},Date.parseExact=function(e,t){return Date.getParseFunction(t)(e)},Date.prototype.isBefore=function(e){return this.compareTo(e)<0},Date.prototype.isAfter=function(e){return this.compareTo(e)>0}}),crmc.define("extensions",["dateExt"],function(){"function"!=typeof Object.create&&(Object.create=function(e){var t=function(){};return t.prototype=e,new t}),"function"!=typeof Object.copy&&(Object.copy=function(e,t){return t=t||{},Object.each(e,function(e,a){t[a]=e}),t}),"function"!=typeof Object.each&&(Object.each=function(e,t){for(var a in e)e.hasOwnProperty(a)&&t(e[a],a)}),"function"!=typeof Object.where&&(Object.where=function(e,t){var a=[];return Object.each(e,function(e,i){t(e,i)&&a.push(e)}),a}),"function"!=typeof Object.first&&(Object.first=function(e,t){for(var a in e)if(e.hasOwnProperty(a)&&t(e[a],a))return e[a]}),"function"!=typeof Array.orderBy&&(Array.orderBy=function(e,t){return e.sort(function(e,a){return t(e)<t(a)?-1:t(e)>t(a)?1:0})}),"function"!=typeof String.format&&(String.format=function(e){for(var t=e.match(/{\d+}/g),a=0;a<t.length;a++){var i=parseInt(t[a].replace(/[{}]/,""));e=e.replace(t[a],arguments[i+1])}return e}),String.prototype.toTitleCase=function(){var e=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;return this.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(t,a,i){return a>0&&a+t.length!==i.length&&t.search(e)>-1&&":"!==i.charAt(a-2)&&("-"!==i.charAt(a+t.length)||"-"===i.charAt(a-1))&&i.charAt(a-1).search(/[^\s-]/)<0?t.toLowerCase():t.substr(1).search(/[A-Z]|\../)>-1?t:t.charAt(0).toUpperCase()+t.substr(1)})},String.prototype.prettifyAPIName=function(){return this.replace("__r","").split(/(?=[A-Z])/).join(" ").replace(/\_/g," ").replace(/\ \ /g," ").toTitleCase()},String.prototype.distance=function(e){var t=this;if(0==t.length)return e.length;if(0==e.length)return t.length;var a,i=[];for(a=0;a<=e.length;a++)i[a]=[a];var n;for(n=0;n<=t.length;n++)i[0][n]=n;for(a=1;a<=e.length;a++)for(n=1;n<=t.length;n++)e.charAt(a-1)==t.charAt(n-1)?i[a][n]=i[a-1][n-1]:i[a][n]=Math.min(i[a-1][n-1]+1,Math.min(i[a][n-1]+1,i[a-1][n]+1));return i[e.length][t.length]}}),crmc.define("sfdc",["GridConstants","SFRest","extensions"],function(e,t){return{namespace:void 0,sessionId:void 0,describeCache:{},describeLayoutCache:{},describeLayoutRecordTypeCache:{},licensedPackageCache:void 0,initSforce:function(){sforce.connection.client="CRMCulture/ActionGrid/",sforce&&sforce.connection&&sforce.connection.serverUrl&&0!=sforce.connection.serverUrl.indexOf(UserContext.siteUrlPrefix)&&(sforce.connection.serverUrl=UserContext.siteUrlPrefix+sforce.connection.serverUrl),this.sessionId&&(sforce.connection.sessionId=this.sessionId)},parseAsObject:function(){for(var e=location.search.slice(1).split("&"),t={},a=0;a<e.length;a++){var i=e[a].split("=");2===i.length&&(t[unescape(i[0])]=unescape(i[1]))}return t},isSandbox:function(){var e,t=window.location.hostname.split(".");return e=5==t.length?t[1]:3==t.length?t[0]:t[1],e&&e[0]&&"c"==e[0].toLowerCase()},executeRemoteAction:function(t,a,i,n){var o=this;t=o.getRemoteAction(e.VF_APEX_CONTROLLER,t),a.unshift(t),a.push(i),n&&a.push(n),Visualforce.remoting.Manager.invokeAction.apply(Visualforce.remoting.Manager,a)},promiseRemoteAction:function(e,t,a){var i=this;return new Promise(function(n,o){i.executeRemoteAction(e,t,function(e,t){t.status?n(e,t):o(t)},a)})},parseAsArray:function(e){var t=[],a=this.parseAsObject();if(void 0!==a[e])for(var i=a[e].split(","),n=0;n<i.length;n++)""!=i[n]&&t.push(i[n]);return t},parseDate:function(e,t){var a=e;return"number"==typeof e&&(a=new Date(e),a="date"!==t.toLowerCase()?this.convertToUserDateTime(a):new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate())),a},formatPhone:function(e){var t="",a=e.trim(),n="",o=-1;if(0<a.length&&"+"!=a.charAt(0)){var r=0;for("1"==a.charAt(0)&&(a=a.substring(1,a.length)),i=0;i<a.length;i++){var s=a.charAt(i);if("0"<=s&&"9">=s&&(0==r?n+="(":3==r?n+=") ":6==r&&(n+="-"),n+=s,r++),!("0"<=s&&"9">=s)&&" "!=s&&"-"!=s&&"."!=s&&"("!=s&&")"!=s){o=i;break}}return 0<=o&&(n+=" "+a.substring(o,a.length)),10==r&&40>=n.length&&(t=n),t}},importScript:function(e,t){var a=document.createElement("script");t&&(a.onload=t),document.getElementsByTagName("HEAD").item(0).appendChild(a),a.src=e},popupWindow:function(e,t){var a=window.outerWidth-365,i=window.outerHeight-115,n=window.screenX+350,o=window.screenY+50;return window.open(e,t?t:"_blank","toolbar=yes,location=yes,menubar=yes,resizable=yes,scrollbars=yes,status=yes, height="+i+", width="+a+", left="+n+", top="+o)},navigateToVFPage:function(e,t,a,i,n){var o=[];Object.each(a,function(e,t){e&&t&&o.push(encodeURIComponent(t)+"="+encodeURIComponent(e))});var r=String.format("/apex/{0}__{1}?{2}",e,t,o.join("&"));if(i)this.popupWindow(r);else{var s=window.open(r,n?n:"_top","toolbar=yes,location=yes,menubar=yes,resizable=yes,scrollbars=yes,status=yes");s.focus()}},getRecordURL:function(e,t,a){var i="",n="";window.UserContext&&UserContext.siteUrlPrefix&&(i=UserContext.siteUrlPrefix),t&&(n="/e");var o=i+"/"+e+n,r=this.isInConsole(),s=this.isLightningExperienceOrSalesforce1();return r&&window.srcUp?"javascript:srcUp('"+encodeURIComponent(o+"?isdtp=vw'")+");":r&&sforce&&sforce.console&&sforce.console.openPrimaryTab?kendo.format("javascript:sforce.console.openPrimaryTab(null, '{0}');",o):s?kendo.format("javascript:SfdcApp.projectOneNavigator.fireContainerEvent('force:navigateToSObject', {recordId:'{0}'});",e):i+"/"+e+n+(void 0!=a?"?retURL="+encodeURIComponent(a):"")},isInConsole:function(){var e=location.search;return!("undefined"!=typeof sforce&&sforce.one)&&0!==e.length&&e.indexOf("agFS")==-1&&(e.indexOf("?isdtp=")>-1||e.indexOf("&isdtp=")>-1)||"undefined"!=typeof canvasClient&&canvasClient.isInConsole&&canvasClient.isInConsole()},getSfdcURL:function(e,t,a,i){var n,o="",r=window.location.hostname.split(".");if(5==r.length){n=r[1];var s=r[0].lastIndexOf("--");s>-1&&(o=r[0].substring(0,s+2))}else n=3==r.length?r[0]:r[1];var l=[];Object.each(a,function(e,t){e&&t&&l.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),e=e.replace("_","-");var d=o+e?o+e:"c";return String.format("{0}//{1}.{2}.visual.force.com/{5}/{3}?{4}",location.protocol,d,n,t,l.join("&"),i)},getStaticResourceURL:function(e,t,a){return this.getSfdcURL(e,t,a,"resource")},getVFPageURL:function(e,t,a){return this.getSfdcURL(e,t,a,"apex")},postToVFPage:function(e,t,a,i,n,o){var r=this.getVFPageURL(e,t,a),s=document.createElement("form");s.method="post",s.action=r,s.setAttribute("target",o?o:"_top"),Object.each(i,function(e,t){var a=document.createElement("input");a.type="hidden","object"==typeof e&&void 0!==e.name&&void 0!==e.value?(a.name=e.name,a.value=e.value):(a.name=t,a.value=e),s.appendChild(a)}),n&&s.setAttribute("target",t),document.body.appendChild(s),s.submit()},navigateToPage:function(e,t,a,i,n){var o=[];Object.each(t,function(e,t){o.push(encodeURIComponent(t)+"="+encodeURIComponent(e))});var r=String.format("/{0}{1}{2}",e,o.length>0?"?"+o.join("&"):"",n?n:"");if(a)this.popupWindow(r);else{var s=window.open(r,i?i:"_top");s.focus()}},getSObjectDescribe:function(e){return this.initSforce(),this.describeCache[e]||(this.describeCache[e]=sforce.connection.describeSObject(e)),this.describeCache[e]},getDescribeGlobal:function(e){this.initSforce();var t;if(this.describeGlobal)t=this.describeGlobal,"function"==typeof e&&e(t);else{var a=this;"function"==typeof e?sforce.connection.describeGlobal(function(t){a.describeGlobal=t,e(t)}):(t=sforce.connection.describeGlobal(),this.describeGlobal=t)}return t},getDescribeLayout:function(e){this.initSforce();var t;return this.describeLayoutCache[e]?t=this.describeLayoutCache[e]:(t=sforce.connection.describeLayout(e),this.describeLayoutCache[e]=t),t},getDescribeLayoutByRecordType:function(e,t,a){this.initSforce();var i=this;this.describeLayoutRecordTypeCache[t]?"function"==typeof a&&a(this.describeLayoutRecordTypeCache[t]):sforce.connection.describeLayout(e,null,[t],function(e){i.describeLayoutRecordTypeCache[t]=e,"function"==typeof a&&a(e)})},getPicklistsForRecordTypes:function(e){this.initSforce();var t={};return e.getBoolean?t.selectorRequired=e.getBoolean("recordTypeSelectorRequired"):e.recordTypeSelectorRequired&&e.recordTypeSelectorRequired.length>0&&(t.selectorRequired=e.recordTypeSelectorRequired[0]),e.recordTypeMappings&&(e.recordTypeMappings instanceof Array||(e.recordTypeMappings=[e.recordTypeMappings]),Object.each(e.recordTypeMappings,function(e){t[e.recordTypeId]={_name:e.name,_isAvailable:e.available,_isDefault:e.defaultRecordTypeMapping};var a=[].concat(e.picklistsForRecordType);Object.each(a,function(a){t[e.recordTypeId][a.picklistName]=a.picklistValues}),t[e.recordTypeId]._isDefault&&(t.defaultRecordTypeId=e.recordTypeId)})),t},getAvailableObjects:function(e,t){var a=["Note","Task","Profile","Event","CampaignMember","CaseContactRole","OrderItem","OpportunityLineItem","QuoteLineItem","OpportunityTeamMember","OpportunityContactRole","PricebookEntry","Pricebook2"],i=this.getDescribeGlobal(),n=i.getArray("sobjects"),o=[];return Object.each(n,function(i){if(a.indexOf(i.name)>-1||!i.getBoolean("deprecatedAndHidden")&&i.getBoolean("queryable")&&i.getBoolean("retrieveable")&&i.getBoolean("searchable")&&i.getBoolean("layoutable")){var n={};Object.each(i,function(e,t){n[t]=e}),e&&t(i.name)===!1||o.push(n)}}),o=Array.orderBy(o,function(e){return e.label.toLowerCase()})},getSavedViews:function(a,i,n){var o=[];try{var r=String.format("select Id, Name, {0}JSON__c, {0}Privacy__c, OwnerId, {0}Description__c, {0}IsDefault__c, {0}Context__c from {0}GridView__c where {0}ObjectName__c like '{1}' and isDeleted = false and ({0}Context__c {2} '{3}' or {0}Context__c = null) order by {0}Privacy__c, Name",this.getNamespace(!0),a,i?"=":"!=",e.viewContext.pageLayout);"function"==typeof n?t.query(r,n,function(e){console.log(JSON.stringify(e))}):o=this.query(r)}catch(e){}return o},getSObjectNameField:function(e){var t=Object.first(e.fields,function(e){return e.getBoolean("nameField")});return t?t.name:void 0},query:function(e){arguments.length>1&&(e=String.format.apply(String,arguments)),window.isDebug&&console.log(e);try{this.initSforce();var t=sforce.connection.queryAll(e);return t.getArray("records")}catch(e){throw console.log(e.faultstring),e}},queryAsync:function(e,t,a){var i=[];this.initSforce();var n=function(e){var o=!0;i=i.concat(e.getArray("records")),e.getBoolean("done")?(o=!1,t(i)):sforce.connection.queryMore(e.queryLocator,{onSuccess:n,onFailure:a})};sforce.connection.query(e,{onSuccess:n,onFailure:a})},batchQueryIn:function(e,t,a,i){var n=[],o="select {0} from {1} where {2} in ({3})";t instanceof Array&&(t=t.join());var r=85,s=Math.ceil(i.length/r);s<1&&(s=1);for(var l=0;l<s;l++){var d=i.slice(l*r,(l+1)*r),c=this.query(o,t,e,a,d.join());n=n.concat(c)}return n},errorHandlerObject:function(e,t,a){return{onSuccess:function(i){var n,o,r=i[0],s=!0;a?(Object.each(i,function(e){e.getBoolean("success")||(s=!1)}),i.length>1?(n=i,o=i):(n=r.errors||r.faultstring||r,o=r)):(s=r.getBoolean("success"),r.errors&&(r.errors=[].concat(r.errors),n=r.errors[0].message),o=r),s?e(o):"function"==typeof t&&t(n)},onFailure:function(e){"function"==typeof t&&t(a?e:e.message||e.faultstring||e)}}},update:function(e,t,a,i){this.initSforce(),sforce.connection.update([e],this.errorHandlerObject(t,a,i))},upsert:function(e,t,a,i){this.initSforce(),sforce.connection.upsert(e,[t],this.errorHandlerObject(a,i,!0))},insert:function(e,t,a,i){this.initSforce(),e instanceof Array||(e=[e]),sforce.connection.create(e,this.errorHandlerObject(t,a,i))},batchUpdate:function(e,t){this.initSforce(),e instanceof Array||(e=[e]);var a,i=200,n=[],o=e.length/200,r=0,s=function(e){n=n.concat(e),r++,r>=o&&"function"==typeof t&&t(n)};for(a=0;a<e.length;a+=i)sforce.connection.update(e.slice(a,a+i),{onSuccess:s,onFailure:s})},batchInsert:function(e,t){this.initSforce(),e instanceof Array||(e=[e]);var a,i=200,n=[],o=function(a){n=n.concat(a),n.length==e.length&&"function"==typeof t&&t(n)};for(a=0;a<e.length;a+=i)sforce.connection.create(e.slice(a,a+i),{onSuccess:o,onFailure:o})},batchDelete:function(e,t){this.initSforce(),e instanceof Array||(e=[e]);for(var a=200,i=[],n=function(a){a&&a.length&&$.merge(i,a),i.length==e.length&&"function"==typeof t&&t(i)},o=0;o<e.length;o+=a)sforce.connection.deleteIds(e.slice(o,o+a),{onSuccess:n,onFailure:n})},getUserInfo:function(e){if(!this.userInfo)if(window.isDebug)this.userInfo={organizationId:"00Do0000000KXVqEAO",userLocale:"en_US",userTimeZone:"America/Denver",currencySymbol:"$",userId:"",orgHasPersonAccounts:!1};else try{if(this.initSforce(),"function"==typeof e)var t=function(t){this.userInfo=t,e(t)};this.userInfo=sforce.connection.getUserInfo(t)}catch(e){console.log(e)}return this.userInfo},setCulture:function(e,t){var a=document.getElementsByTagName("HEAD").item(0),i=this;if(a){var n=document.createElement("script");n.type="text/javascript",a.appendChild(n),n.src=t,n.onerror=function(e){console.log(arguments)},n.onload=function(){kendo.culture(e);var t=kendo.culture();if(t&&t.numberFormat&&t.numberFormat.currency){var a=i.getUserInfo(),n=a.currencySymbol||"";t.numberFormat.currency.symbol=n}}}},getProfileTimezoneOffset:function(){var e=new Date,t=this.convertToUserDateTime(e),a=t.valueOf(),i=e.valueOf(),n=Math.round((i-a)/1e3/60);return n},getDateWithOffset:function(e,t){var a=e.valueOf();return new Date(a+60*t*1e3)},convertToUserDateTime:function(e){var t=this.getUserInfo();try{var a={timeZone:void 0!==t.userTimeZone?t.userTimeZone:"UTC"};"string"!=typeof e&&"number"!=typeof e||(e=new Date(e));var i=e.toLocaleString("en-US",a);i.indexOf(" at")>-1&&(i=i.replace(" at",""));var n=new Date(i);"Invalid Date"!=n&&(e=n)}catch(e){}return e},convertDateFilters:function(e,t){var a=this;e&&e.filters&&e.filters.length&&e.filters.map(function(e){if(e&&e.value&&e.value instanceof Date){var i=Object.first(t,function(t){return t.name==e.field});i&&i.type&&("DATE"!=i.type.toUpperCase()&&(e.value=a.getDateWithOffset(e.value,a.getProfileTimezoneOffset())),e.value=e.value.toISOString())}a.convertDateFilters(e,t)})},convertFKFilters:function(e,t){var a=this;e&&e.filters&&e.filters.length&&e.filters.map(function(e){if(e&&e.value&&("isnull"==e.operator||"isnotnull"==e.operator)){var i=Object.first(t,function(t){return t.name==e.field});i&&i.parentMeta&&"REFERENCE"==i.parentMeta.type&&(e.field=i.parentMeta.name)}a.convertDateFilters(e,t)})},getNamespace:function(t){return void 0===this.namespace&&(this.namespace=e.namespace),t&&this.namespace.length>0?this.namespace+"__":this.namespace},getRemoteAction:function(e,t){var a=this.getNamespace(!1),i=a?a+".":"";return i+e+"."+t},isSalesforceId:function(e){return/[a-zA-Z0-9]{15}|[a-zA-Z0-9]{18}/.test(e)},getIdFieldFromRelationshipName:function(e){var t=/__(p?)r$/,a=e+"Id";return e.match(t)&&(a=e.replace(t,"__$1c")),a},getDependentPicklistValues:function(e,t,a){for(var i,n,o=0,r=0;r<e.fields.length;r++){var s=e.fields[r];if(s.name==t?(i=s,o++):s.name==a&&(n=s,o++),2==o)break}var l={},d=new sforce.Base64Binary(""),c=function(e,t){var a=Math.floor(t/8),i=7-t%8;return(Math.pow(2,i)&e.charCodeAt(a))>>i==1},u=n.picklistValues;if("boolean"==i.type.toLowerCase()){l.getControllerLabel=function(e){return e?"enabled":"disabled"},l.enabled=[],l.disabled=[];for(var r=0;r<u.length;r++){var p=u[r];"QAAA"==p.validFor?l.enabled.push(p.label):"gAAA"==p.validFor&&l.disabled.push(p.label)}}else{l.getControllerLabel=function(e){for(var t=e,a=0;a<f.length;a++)if(f[a].value==e){t=f[a].label;break}return t};for(var f=i.picklistValues,r=0;r<f.length;r++)l[f[r].label]=[];for(var r=0;r<u.length;r++)for(var m=u[r],h=d.decode(m.validFor),g=0;g<f.length;g++)c(h,g)&&l[f[g].label].push(m.label)}return l},isLightningExperienceOrSalesforce1:function(){var e=this.parseAsObject();return"undefined"!=typeof sforce&&sforce&&!!sforce.one||e&&void 0!==e.sf1},getLicensedPackages:function(e,t){return void 0===crmc.licensedPackageCache?this.executeRemoteAction("getLicensedPackages",[e],function(e,a){crmc.licensedPackageCache=e,t(e,a)}):void t(crmc.licensedPackageCache,{status:!0})},getPicklistValueFactory:function(e){var t,a=this,i=e.fieldName,n=e.picklistValues,o=e.objectName,r=e.recordTypeInfos||[],s=e.fields||[],l="CampaignMember"==o&&"Status"==i,d=function(e,t,i){if(r.length>0&&!l){if(!(t.model.RecordTypeId||t.model.RecordType&&t.model.RecordType.Id)){var n;if(t.model.Id&&(n=a.query("SELECT RecordTypeId FROM {0} WHERE Id = '{1}'",o,t.model.Id)[0].RecordTypeId),!n){var s=Object.first(r,function(e){return e&&"true"===e.defaultRecordTypeMapping});n=n||(s&&s.recordTypeId?s.recordTypeId:n)}t.model.RecordTypeId=n,t.model.RecordType={Id:n}}var d=t.model.RecordTypeId||t.model.RecordType.Id,c=[];a.getDescribeLayoutByRecordType(o,d,function(n){var o=a.getPicklistsForRecordTypes(n),r=o[d][t.field];!r||r instanceof Array||(r=[r]),r&&r.length>0&&(Object.each(r,function(t){var a=Object.first(e,function(e){return t.label===(e.label||e.text)});t.getBoolean("active")&&a&&c.push({text:t.label,value:t.value})}),e=c),"function"==typeof i&&i(e)})}else"function"==typeof i&&i(e)},c=function(e){var t,i=[];if(e.hasOwnProperty("CampaignId"))t=e.CampaignId;else if(e.Id){var n=sforce.connection.retrieve("CampaignId","CampaignMember",[e.Id]);t=n[0].CampaignId}if(t){var o=a.query("SELECT Label FROM CampaignMemberStatus WHERE CampaignId = '"+t+"'");Object.each(o,function(e){i.push({text:e.Label,value:e.Label})})}return i},u=[],p={transport:{read:function(e){d(u,t,function(a){t.isMultiPicklist&&(a=a.map(function(e){return e.value})),e.success(a)})}}},f=Object.first(s,function(e){return e.name==i});return f&&f.dependentPicklist?function(e){u=[],t=e;var r=a.getDependentPicklistValues({fields:s},f.controllerName,i);l&&(n=c(e.model));var d;if(e.model.hasOwnProperty(f.controllerName))d=e.model[f.controllerName];else if(e.model.Id){var m=sforce.connection.retrieve(f.controllerName,o,[e.model.Id]);d=m[0][f.controllerName]}return d=r.getControllerLabel(d),Object.each(n,function(e){var t=e.label||e.text||e.value||e;r[d]&&r[d].indexOf(t)>-1&&u.push({text:t,value:e.value||e})}),p}:function(e){return u=[],t=e,l?u=c(e.model):Object.each(n,function(e){var t=e.label||e.text||e.value||e;u.push({text:t,value:e.value||e})}),p}}}}),crmc.define("CustomSettings",["sfdc","SFRest","extensions"],function(e,t){var a={settings:void 0,userInfo:void 0,sfdcSettings:void 0,initAsync:function(a){if(void 0===this.userInfo&&(this.userInfo=e.getUserInfo()),void 0===this.settings){var i=e.getNamespace(!0),n=String.format("SELECT Id, Name, {2}JSON__c, {2}Owner__c , {2}Owner_Type__c, {2}Setting_Name__c, {2}Table_Name__c, {2}Setting_Type__c FROM {2}Grid_Setting__c WHERE isDeleted = false and (({2}Owner__c = '{0}' and {2}Owner_Type__c = 'user') or ({2}Owner__c = '{1}' and {2}Owner_Type__c = 'profile') or {2}Owner_Type__c = 'global') ORDER BY {2}Owner_Type__c ",this.userInfo.userId,this.userInfo.profileId,i),o=this,r=function(e){o.settings={},Object.each(e,function(e){var t,a=e[i+"Table_Name__c"],n=e[i+"Setting_Type__c"]?e[i+"Setting_Type__c"]:"action",r=e[i+"Setting_Name__c"],s=e[i+"Owner_Type__c"];e[i+"Owner__c"];if(o.settings[n]||(o.settings[n]={}),o.settings[n][a]&&o.settings[n][a][r])switch(o.settings[n][a][r].ownerType){case"global":"profile"==s&&(t=o.convertSetting(e));case"profile":"user"==s&&(t=o.convertSetting(e))}else o.settings[n][a]||(o.settings[n][a]={}),t=o.convertSetting(e);t&&void 0!==t.setting&&(o.settings[n][a][r]=t)}),"function"==typeof a&&a()};t.query(n,r,function(e){console.log(JSON.stringify(e))})}else"function"==typeof a&&a()},init:function(){if(void 0===this.userInfo&&(this.userInfo=e.getUserInfo()),void 0===this.settings){var t=e.getNamespace(!0);this.sfdcSettings=e.query("SELECT Id, Name, {2}JSON__c, {2}Owner__c , {2}Owner_Type__c, {2}Setting_Name__c, {2}Table_Name__c, {2}Setting_Type__c FROM {2}Grid_Setting__c WHERE isDeleted = false and (({2}Owner__c = '{0}' and {2}Owner_Type__c = 'user') or ({2}Owner__c = '{1}' and {2}Owner_Type__c = 'profile') or {2}Owner_Type__c = 'global') ORDER BY {2}Owner_Type__c ",this.userInfo.userId,this.userInfo.profileId,t),this.settings={};var a=this;Object.each(this.sfdcSettings,function(e){var i,n=e[t+"Table_Name__c"],o=e[t+"Setting_Type__c"]?e[t+"Setting_Type__c"]:"action",r=e[t+"Setting_Name__c"],s=e[t+"Owner_Type__c"];e[t+"Owner__c"];if(a.settings[o]||(a.settings[o]={}),a.settings[o][n]&&a.settings[o][n][r])switch(a.settings[o][n][r].ownerType){case"global":"profile"==s&&(i=a.convertSetting(e));case"profile":"user"==s&&(i=a.convertSetting(e))}else a.settings[o][n]||(a.settings[o][n]={}),i=a.convertSetting(e);i&&void 0!==i.setting&&(a.settings[o][n][r]=i)})}},convertSetting:function(t){var a=e.getNamespace(!0),i={id:t.Id,name:t.Name,owner:t[a+"Owner__c"],ownerType:t[a+"Owner_Type__c"],tableName:t[a+"Table_Name__c"],settingType:t[a+"Setting_Type__c"],settingName:t[a+"Setting_Name__c"]};if(t[a+"JSON__c"]&&"undefined"!==t[a+"JSON__c"])try{i.setting=JSON.parse(unescape(t[a+"JSON__c"]))}catch(e){console.log("Malformed setting!"),console.log(e)}return i},getSetting:function(e,t,a){var i;try{this.init(),a||(a="action"),this.settings[a]&&(this.settings[a][e]&&this.settings[a][e][t]?i=this.settings[a][e][t].setting:this.settings[a].global&&this.settings[a].global[t]&&(i=this.settings[a].global[t].setting)),void 0===i&&"action"===a&&this.settings.globalDefault&&this.settings.globalDefault.global.globalFeature?this.settings.globalDefault.global.globalFeature.setting||(i=!1):void 0===i&&"explorer"===a&&this.settings.globalDefault&&this.settings.globalDefault.global.globalObject&&(i=this.settings.globalDefault.global.globalObject.setting)}catch(e){console.log(e)}return i},getTableSettings:function(t,a,i,n){var o={};try{var r=e.getNamespace(!0);void 0===this.userInfo&&(this.userInfo=e.getUserInfo());var s="SELECT Id, Name, {1}JSON__c, {1}Owner__c ,{1}Owner_Type__c, {1}Setting_Name__c, {1}Table_Name__c, {1}Setting_Type__c FROM {1}Grid_Setting__c WHERE {1}Table_Name__c = '{0}' and isDeleted = false ";a&&(s+=" AND {1}Owner__c = '"+a+"'"),i&&(s+=" AND {1}Owner_Type__c = '"+i+"'"),n&&(s+=" AND {1}Setting_Type__c = '"+n+"'");var l=e.query(s,t,r),d=this;Object.each(l,function(e){o[e[r+"Setting_Name__c"]]=d.convertSetting(e)})}catch(e){console.log(e)}return o},setSetting:function(a,i,n){try{var o=e.getNamespace(!0);if(!a||!a.settingName)return;var r=new sforce.SObject(o+"Grid_Setting__c"),s=function(t){r.Id=t;var s=((new Date).getTime()+Math.floor(100*Math.random())+a.settingName+"_"+a.settingType).slice(0,38);r.Name=a.name?a.name:s,r[o+"Table_Name__c"]=a.tableName,r[o+"Setting_Name__c"]=a.settingName,r[o+"Setting_Type__c"]=a.settingType,r[o+"Owner_Label__c"]=a.ownerLabel,r[o+"Owner_Type__c"]=a.ownerType,r[o+"Owner__c"]=a.owner,r[o+"JSON__c"]=escape(JSON.stringify(a.setting)),r.type=o+"Grid_Setting__c";var l=function(e){"function"==typeof i&&i(e)},d=function(e){"function"==typeof n&&n(e)};e.upsert("Id",r,l,function(t){t instanceof Array&&(t=t[0]),"FIELD_INTEGRITY_EXCEPTION"==t.statusCode?(r.Name=s,e.upsert("Id",r,l,d)):d(t)})};if(a.id)s(a.id);else{var l=String.format("SELECT Id FROM {0}Grid_Setting__c WHERE isDeleted = false and {0}Owner__c = {1} and {0}Owner_Type__c = '{2}' and {0}Setting_Name__c = '{3}' and {0}Setting_Type__c = '{4}' and {0}Table_Name__c = {5} and {0}Owner_Label__c = {6}  ORDER BY {0}Owner_Type__c ",o,a.owner?"'"+a.owner+"'":"null",a.ownerType,a.settingName,a.settingType,a.tableName?"'"+a.tableName+"'":"null",a.ownerLabel?"'"+a.ownerLabel+"'":"null");t.query(l,function(e){var t;e.length>0&&(t=e[0].Id),s(t)},function(e){console.log(JSON.stringify(e))})}}catch(e){return{}}}};return a}),crmc.define("ObjectList",["sfdc","CustomSettings"],function(e,t){var a={settings:{},kendoListView:void 0,kendoDataSource:void 0,init:function(a){this.settings=a;var i=$(a.elementId);i.empty();var n=$("<span>");n.appendTo(i),n.css({"margin-bottom":"5px",width:"100%"}),n.addClass("k-textbox k-space-right");var o=$("<input id='objectList_SearchBox' type='search'/>");o.css({margin:"3px"}),o.appendTo(n);var r=$("<a>");if(r.appendTo(n),r.addClass("k-icon k-i-search"),a.delegate&&a.delegate.dataSource)this.kendoDataSource=a.delegate.dataSource;else{var s=[{label:"Contact"},{label:"Opportunity"},{label:"Lead"},{label:"Order"},{label:"Account"}];this.kendoDataSource=new kendo.data.DataSource({data:window.isDebug?s:void 0,transport:{read:function(i){var n=function(e){return t.getSetting("global",e,a.permissionName)};results=e.getAvailableObjects(a.permissionName,n),a.includeGlobal&&results.unshift({label:"— Global Defaults —",name:"global"}),i.success(results)}}})}var l=this,d="label",c="name";if(a.filterField&&(d=a.filterField,c="Id"),o.on("keyup search input paste",function(){l.kendoDataSource.filter({field:d,operator:"contains",value:o.val()})}),a.header){var u=$("<div>");u.html(a.header),u.appendTo(i)}var p=$("<div>");p.appendTo(i),p.addClass("k-block"),p.css({"max-height":"500px",overflow:"scroll"});var f=$("<div>");a.listViewTemplate&&(template=a.listViewTemplate),f.appendTo(p),f.kendoListView({dataSource:this.kendoDataSource,template:function(e){return kendo.format("<div id='{0}' style='padding:0.5em;'>{1}</div>","objectList_"+e[c],e[d])},selectable:!0,change:function(){l.onSelectedChanged()}}),this.kendoListView=f.data("kendoListView")},onSelectedChanged:function(){var e=this.kendoListView.select(),t=this.kendoListView.dataSource.view()[e.index()];this.settings.delegate&&"function"==typeof this.settings.delegate.onSelectedChanged&&this.settings.delegate.onSelectedChanged(e.text(),t)}};return function(e){var t=Object.create(a);return t.init(e),t}}),crmc.define("KendoPopup",["GridConstants"],function(e){var t={popup:function(e,t,a,i,n,o){this.popupWithButtons(e,t,[{label:n||"Dismiss"},{label:a,click:i}],o)},popupWithButtons:function(t,a,i,n){var o=e.UNIQUE_ID++,r=kendo.template("<div id='KendoPopupBox#=uniqueid#' style='display:none; height:100%'>#= val #<p/><div style='float:right; clear:left; max-height: 50px;'># buttons.map(function(item) { if(item.label) {#<span id='#=item.label.replace(/\\s+/g, '')##=uniqueid#' class='k-button'>#=item.label#</span>&nbsp;# }}) #</div></div>"),s={val:a,uniqueid:o,buttons:i},l=r(s);$("body").append(l);var d=$("#KendoPopupBox"+o);i&&i.length>0&&i.map(function(e){if(e.label){var t=$("#"+e.label.replace(/\s+/g,"")+o);t.bind("click",function(){"function"==typeof e.click?e.click()!==!1&&d.data("kendoWindow").close():d.data("kendoWindow").close()})}}),d.data("kendoWindow")||d.kendoWindow({width:n&&n.width?n.width:void 0,height:n&&n.height?n.height:void 0,draggable:!0,modal:!0,resizable:!(!n||!n.resizable),actions:["Close"],title:t,maxHeight:n&&n.maxHeight?n.maxHeight:$(window).height()-100,maxWidth:$(window).width()-100,minHeight:n&&n.minHeight?n.minHeight:void 0,close:function(e){if(d.data("kendoWindow").destroy(),n&&n.grid&&n.grid.setKeyboardFocus(),n&&n.hasOwnProperty("close")){var t=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},a=n.close;t(a)?a.call(this,e):a.hasOwnProperty("handler")&&a.hasOwnProperty("scope")&&t(a.handler)&&a.handler.call(a.scope,arguments)}}}),d.data("kendoWindow").center().open()}};return t}),crmc.define("ajax",[],function(){var e={REQ_TIMEOUT_MS:3e4,createRequest:function(t,a,i){var n={};n.handleEvent=function(e,t){"function"==typeof e&&e(t)};var o=new XMLHttpRequest;o.onreadystatechange=function(){switch(o.readyState){case 1:break;case 2:break;case 3:break;case 4:clearInterval(n.timeout),200===o.status?n.handleEvent(n.onsuccess,o):n.handleEvent(n.onfail,o),n.handleEvent(n.oncomplete,o)}},n.request=o;var r=function(){o.abort(),clearInterval(n.timeout),n.handleEvent(n.onfail,"Request timed out.")};return n.request.onprogress=function(t){clearInterval(n.timeout),n.timeout=setInterval(r,e.REQ_TIMEOUT_MS)},n.get=function(){o.open("GET",t,!0,a,i),
n.onopen(o),n.timeout=setInterval(r,e.REQ_TIMEOUT_MS),o.send()},n.post=function(s,l,d){"string"==typeof s?(o.open("POST",t,!0,a,i),"string"==typeof l&&o.setRequestHeader("Content-Type",l),n.onopen(o),n.timeout=setInterval(r,e.REQ_TIMEOUT_MS),o.send(s)):n.get()},n}};return e}),crmc.define("soap",["ajax","extensions"],function(e){var t={createRequest:function(t,a,i,n){var o=e.createRequest(t,i,n),r=function(e){e.setRequestHeader("SoapAction",a)};o.onopen=r;var s=o.handleEvent;return o.handleEvent=function(e,t){if(4===t.readyState&&200===t.status&&"function"==typeof e)if(void 0!==t.responseXML&&t.responseXML.length>0)e(t.responseXML);else{var a=new DOMParser,i=a.parseFromString(t.responseText,"text/xml");e(i)}else s(e,t)},o.execute=function(e){o.post(e,"text/xml")},o},objectFromXml:function(e){var a={};if(e.childNodes&&e.childNodes.length>0)for(var i=0;i<e.childNodes.length;i++)if("#text"===e.childNodes[i].nodeName){if(e.childNodes[i].nodeValue.match(/^\s*$/))continue;a=t.objectFromXml(e.childNodes[i])}else{var n=e.childNodes[i].nodeName;a[n]?("function"!=typeof a[n].push&&(a[n]=[a[n]]),a[n].push(t.objectFromXml(e.childNodes[i]))):a[n]=t.objectFromXml(e.childNodes[i])}else void 0!==e&&null!==e.nodeValue&&(a=e.nodeValue);if(e.attributes&&e.attributes.length>0)for(var o=0;o<e.attributes.length;o++)a[e.attributes[o].name]=e.attributes[o].value;return a},objectToXml:function(e,a){var i="";return"object"==typeof e?Object.each(e,function(a,n){var o=n;"string"==typeof e.xmlns&&(o+=' xmlns="'+e.xmlns+'"'),"string"==typeof a["xsi:type"]&&(o+=' xsi:type="'+a["xsi:type"]+'"'),"xmlns"!==n&&"xsi:type"!==n&&(a instanceof Array?Object.each(a,function(e){i+="<"+o+">"+t.objectToXml(e)+"</"+n+">\n"}):i+="<"+o+">"+t.objectToXml(a)+"</"+n+">\n")}):i=t.htmlSpecialChars(e.toString()),i},htmlSpecialChars:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}};return t}),crmc.define("metadata",["soap"],function(e,t){var a={soapHeader:'<?xml version="1.0" encoding="UTF-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cmd="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><soap:Header>',soapHeaderEnd:"</soap:Header><soap:Body>",soapFooter:"</soap:Body></soap:Envelope>"},i={delegate:{onError:function(){}},sessionId:"",endpoint:"/services/Soap/m/37.0/",apiVersion:37,xmlns:"http://soap.sforce.com/2006/04/metadata",makeRequestObject:function(e,t){var a={xmlns:this.xmlns};return a[e]=t,a},login:function(e,t,a){var i={username:e,password:t},n=this;this.xmlns="urn:enterprise.soap.sforce.com",this.beginMetadataRequest("login",i,"result",function(e){n.sessionId=e.sessionId,n.endpoint=e.metadataServerUrl,n.xmlns="http://soap.sforce.com/2006/04/metadata",a(e)})},listMetadata:function(e,t,a,i){var n={queries:{folder:e,type:t},asOfVersion:this.apiVersion};this.beginMetadataRequest("listMetadata",n,"listMetadataResponse",a,i)},describeMetadata:function(e,t){var a={asOfVersion:this.apiVersion};this.beginMetadataRequest("describeMetadata",a,"result",e,t)},updateMetadata:function(e,t,a,i,n){var o={metadata:a};this.beginMetadataRequest("updateMetadata",o,"result",i,n)},createMetadata:function(e,t,a,i,n){var o={metadata:a};this.beginMetadataRequest("createMetadata",o,"result",i,n)},deleteMetadata:function(e,t,a,i){var n={metadataType:e,fullNames:t};this.beginMetadataRequest("deleteMetadata",n,"result",a,i)},readMetadata:function(e,t,a,i){var n={type:e,fullNames:t};this.beginMetadataRequest("readMetadata",n,"result",a,i)},beginMetadataRequest:function(t,i,n,o,r){var s=e.createRequest(this.endpoint,t);s.onsuccess=function(t){t=t.getElementsByTagName(n)[0],o(e.objectFromXml(t))},s.onfail=function(e){console.log(e.responseText),this.delegate&&"function"==typeof this.delegate.onError&&this.delegate.onError(e.responseText,e),"function"==typeof r&&r(e.responseText,e)};var l=this.makeRequestObject(t,i),d=e.objectToXml(l),c=a.soapHeader+(this.sessionId.length>0?"<cmd:SessionHeader><cmd:sessionId>"+this.sessionId+"</cmd:sessionId></cmd:SessionHeader>":"")+"<cmd:CallOptions><client>CRMCulture/ActionGrid/</client></cmd:CallOptions>"+a.soapHeaderEnd,u=c+d+a.soapFooter;s.execute(u)},createButton:function(e,t,a,i,n,o){var r={"xsi:type":"WebLink",fullName:e+"."+t,availability:"online",displayType:"massActionButton",linkType:"javascript",masterLabel:a,openType:"onClickJavaScript",requireRowSelection:!0,url:i};this.createMetadata("webLink",e+"."+t,r,function(e){"function"==typeof n&&n(e)},o)},getCustomObject:function(e,t,a,i,n){var o={hasButton:!1,hasSearchResults:!1,hasListView:!1,custObj:null};this.readMetadata("CustomObject",e,function(e){o.custObj=e.records;var n=o.custObj.webLinks;if(void 0!=n){void 0==n.length&&(n=[n]);for(var r in n)if(n[r].fullName==t||n[r].fullName==a+t){o.hasButton=!0;break}}if(void 0!=o.custObj.searchLayouts){var s=o.custObj.searchLayouts.searchResultsCustomButtons,l=o.custObj.searchLayouts.listViewButtons;if(void 0!=s){"string"==typeof s&&(s=[s]);for(var r in s)if(s[r]==t||s[r]==a+t){o.hasSearchResults=!0;break}}if(void 0!=l){"string"==typeof l&&(l=[l]);for(var r in l)if(l[r]==t||l[r]==a+t){o.hasListView=!0;break}}}"function"==typeof i&&i(o)},n)},addToSearchLayouts:function(e,t,a,i,n){var o=this;this.readMetadata("CustomObject",e,function(e){var r=e.records;if(!r.searchLayouts)return void i({errors:{message:r.fullName+" does not support search layouts"}});void 0==r.searchLayouts[a]?r.searchLayouts[a]=[]:"string"==typeof r.searchLayouts[a]&&(r.searchLayouts[a]=[r.searchLayouts[a]]);var s="";if(r.webLinks instanceof Array)Object.each(r.webLinks,function(e){e.fullName.indexOf(t)>0&&(s=e.fullName.split("__")[0]+"__")});else{if(!r.webLinks)return void i({errors:{statusCode:"INVALID_CROSS_REFERENCE_KEY"}});r.webLinks.fullName.indexOf(t)>0&&(s=r.webLinks.fullName.split("__")[0]+"__")}r.searchLayouts[a].push(s+t);var l={fullName:r.fullName,"xsi:type":r["xsi:type"],searchLayouts:r.searchLayouts};if(void 0!=r.pluralLabel)for(var d in r)"webLinks"!=d&&"fields"!=d&&"listViews"!=d&&(l[d]=r[d]);o.updateMetadata("customObject",r.fullName,l,function(e){"function"==typeof i&&i(e)},n)})}};return i}),crmc.define("tooling",["KendoPopup","RestService"],function(e,t){var a=Object.create(t);return a.endpoint="/services/data/v37.0/tooling/",a.cacheKey="toolingCache",a.query=function(e,t,a){var i=[],n=this,o=function(e){var r=!0;i=i.concat(e.records),e.done?(r=!1,t(i)):n.getRequest(e.nextRecordsUrl,o,a,!0)};this.getRequest(this.endpoint+"query/?q="+encodeURIComponent(e),o,a,!0)},a.queryFirstId=function(e,t,a){this.query(e,function(e){t(e[0].Id)},a)},a.getCustomObjectId=function(e,t,a){var i=kendo.format("select DurableId from EntityDefinition where QualifiedAPIName='{0}'",e),n=function(e){var a=e&&e.length>0&&e[0].DurableId;t(a)};this.query(i,n,a)},a.getCustomFieldId=function(e,t,a,i){var n=function(e){var t=e.length>0?e[0].DurableId:"";t.indexOf(".")>-1&&(t=t.split(".")[1]),a(t)};this.query(kendo.format("select DurableId from FieldDefinition where EntityDefinition.QualifiedAPIName = '{0}' and QualifiedAPIName = '{1}'",e,t),n,i)},a.getFieldDefinition=function(e,t,a,i){this.query(kendo.format("select Metadata from FieldDefinition where EntityDefinition.QualifiedAPIName = '{0}' and QualifiedAPIName = '{1}'",e,t),a,i)},a.getVisualForcePages=function(e,t){var a="SELECT ApiVersion,ControllerKey,ControllerType,CreatedById,CreatedDate,Description,Id,IsAvailableInTouch,IsConfirmationTokenRequired,LastModifiedById,LastModifiedDate,Markup,MasterLabel,Name,NamespacePrefix,SystemModstamp FROM ApexPage WHERE NamespacePrefix = ''";this.query(a,e,t)},a.getCustomTab=function(e,t,a){this.query("SELECT Id, Metadata, FullName, Type, MasterLabel, DeveloperName, Description, MotifName, Url, EncodingKey, ContentId, HasSidebar, ManageableState, NamespacePrefix, CreatedDate, CreatedById, LastModifiedDate, LastModifiedById FROM CustomTab WHERE Id = '"+e+"'",t,a)},a.getCustomTabByName=function(e,t,a){this.query("SELECT Id, Metadata, FullName, Type, MasterLabel, DeveloperName, Description, MotifName, Url, EncodingKey, ContentId, HasSidebar, ManageableState, NamespacePrefix, CreatedDate, CreatedById, LastModifiedDate, LastModifiedById FROM CustomTab WHERE DeveloperName = '"+e+"'",t,a)},a.createCustomTab=function(e,t,a){this.postRequest(this.endpoint+"sobjects/CustomTab/",e,t,a)},a.addCustomTabToSet=function(e,t,a){this.postRequest(this.endpoint+"sobjects/PermissionSetTabSetting/",e,t,a)},a}),crmc.define("ReadOnlyObjects",["SFRest"],function(e){var t={Id:"Id",AccountId:"AccountId",WhoId:"WhoId",WhatId:"WhatId",Subject:"Subject",IsTask:void 0,ActivityDate:"ActivityDate",OwnerId:"OwnerId",Status:"Status",Priority:"Priority",IsHighPriority:"IsHighPriority",ActivityType:"Type",IsClosed:"IsClosed",IsAllDayEvent:void 0,DurationInMinutes:void 0,Location:void 0,Description:"Description",CurrencyIsoCode:"CurrencyIsoCode",IsDeleted:"IsDeleted",CreatedDate:"CreatedDate",CreatedById:"CreatedById",LastModifiedDate:"LastModifiedDate",LastModifiedById:"LastModifiedById",SystemModstamp:"SystemModstamp",CallDurationInSeconds:"CallDurationInSeconds",CallType:"CallType",CallDisposition:"CallDisposition",CallObject:"CallObject",ReminderDateTime:"ReminderDateTime",IsReminderSet:"IsReminderSet",EndDateTime:void 0,StartDateTime:void 0},a={Id:"Id",AccountId:"AccountId",WhoId:"WhoId",WhatId:"WhatId",Subject:"Subject",IsTask:void 0,ActivityDate:"ActivityDate",OwnerId:"OwnerId",Status:void 0,Priority:void 0,IsHighPriority:void 0,ActivityType:"Type",IsClosed:void 0,IsAllDayEvent:"IsAllDayEvent",DurationInMinutes:"DurationInMinutes",Location:"Location",Description:"Description",CurrencyIsoCode:"CurrencyIsoCode",IsDeleted:"IsDeleted",CreatedDate:"CreatedDate",CreatedById:"CreatedById",LastModifiedDate:"LastModifiedDate",LastModifiedById:"LastModifiedById",SystemModstamp:"SystemModstamp",CallDurationInSeconds:void 0,CallType:void 0,CallDisposition:void 0,CallObject:void 0,ReminderDateTime:"ReminderDateTime",IsReminderSet:"IsReminderSet",EndDateTime:"EndDateTime",StartDateTime:"StartDateTime"},i=function(){return!0},n=function(e){},o={ActivityHistory:{Types:{Task:t,Event:a},IsEditable:i,TypeForRow:n},OpenActivity:{Types:{Task:t,Event:a},IsEditable:i,TypeForRow:n}};return o}),crmc.define("FormulaHelpers",[],function(){var e={getFormulaFieldName:function(e){return"formula_"+e.id.replace(/[\W]*/g,"")},isNumber:function(e){return!("Date"==e.type||"DateTime"==e.type||"Time"==e.type)},formatFormula:function(e,t){var a=this.evaluateFormula(e,t);if(e.format&&e.format.length>0){if(e.format)switch(e.format){case"d":case"g":case"hh:mm tt":if("Invalid Date"==a){var i=Object.first(e.dependentFields,function(e){return t[e]});return i?a:a=""}a=new Date(a);break;case"c":case"n":case"n0":a=+a.replace(/[^\d\.e\+\-]*/g,"")}a=kendo.format("{0:"+e.format+"}",a)}return a},parseFormula:function(e,t){var a=this.formatFormula(e,t);return e.format&&(a=this.isNumber(e)?kendo.parseFloat(a):kendo.parseDate(a)),a},evaluateFormula:function(e,t){var a="#= "+e.expression+"#",i="";if(e.expression&&e.expression.length>0)try{i=kendo.template(a)(t)}catch(t){var n=t.message;t instanceof ReferenceError&&(n='Message from Formula named "'+e.id+'": '+n+". This message is expected when Formula references a field with empty value."),console.log(n)}return i}};return e}),crmc.define("mixpanel",["sfdc"],function(e){var t="06d471d8bbba711cca0e208f3eb31429";!function(e,t){if(!t.__SV){var a,i,n,o;window.mixpanel=t,t._i=[],t.init=function(e,a,i){function r(e,t){var a=t.split(".");2==a.length&&(e=e[a[0]],t=a[1]),e[t]=function(){e.push([t].concat(Array.prototype.slice.call(arguments,0)))}}var s=t;for("undefined"!=typeof i?s=t[i]=[]:i="mixpanel",s.people=s.people||[],s.toString=function(e){var t="mixpanel";return"mixpanel"!==i&&(t+="."+i),e||(t+=" (stub)"),t},s.people.toString=function(){return s.toString(1)+".people (stub)"},n="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" "),o=0;o<n.length;o++)r(s,n[o]);t._i.push([e,a,i])},t.__SV=1.2,a=e.createElement("script"),a.type="text/javascript",a.async=!0,a.src="undefined"!=typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js",i=e.getElementsByTagName("script")[0],i.parentNode.insertBefore(a,i)}}(document,window.mixpanel||[]),mixpanel.init(t);var a,i={init:function(){if(void 0==a){var t=e.getUserInfo();e.getNamespace();a={orgId:t.organizationId,orgHasPersonAccounts:t.orgHasPersonAccounts,isLightning:e.isLightningExperienceOrSalesforce1(),isSandbox:e.isSandbox()},window.mixpanel.identify(t.organizationId+t.userId),window.mixpanel.register(a),window.mixpanel.people.set({userId:t.userId,userLocale:t.userLocale,userTimeZone:t.userTimeZone,orgId:t.organizationId,orgName:t.organizationName})}},track:function(e,t){try{this.init(),window.mixpanel.track(e,t)}catch(e){console.log(e)}},trackException:function(e){var t=e.stack;if("string"==typeof e&&(t=e),!t){var a=new Error;t=a.stack}this.track("Exception",{message:e&&e.toString(),stack:t})}};return i}),crmc.define("GridDataProvider",["KendoPopup","sfdc","GridConstants","ReadOnlyObjects","SFRest","FormulaHelpers","mixpanel","extensions"],function(t,a,i,n,o,r,s){var l={dataSource:void 0,pageInfo:{},delegate:{allowParentalEditing:function(){},getUpdateOperations:function(){},onDataSourceReady:function(e){},onReadFieldMetadata:function(e,t){},onRowSuccess:function(e){},onRowFailure:function(e){},onSync:function(e){}},init:function(e){e=e||{};var t=Object.create(this);return t.pageInfo=e.pageInfo,t.settings=e,t},create:function(e,t){e=e||{};var a=this.init(e);a.delegate=t||{};var i=function(e){a.fieldMeta=e,a.dataSource=a.createDataSource(),"function"==typeof a.delegate.onDataSourceReady&&a.delegate.onDataSourceReady(a.dataSource,a.fieldMeta)};e.pageInfo.columns&&e.pageInfo.columns.length>0?a.getFieldMetadata(e.pageInfo.objectName,e.pageInfo.columns,i):(a.dataSource=a.createDataSource(),"function"==typeof a.delegate.onDataSourceReady&&a.delegate.onDataSourceReady(a.dataSource,a.fieldMeta))},getFieldMetadata:function(e,i,n){a.executeRemoteAction("getFieldMetaForObjectColumns",[e,i],function(e,a){a.status?"function"==typeof n&&n(e):t.popup("Metadata Error",a.message)},{escape:!1})},saveRecord:function(e,t,i){var n=this,o=10;this.numSavesPending=this.numSavesPending||0,this.deferredSaves=this.deferredSaves||[],this.numSavesPending++;var r=function(a,o){n.numSavesPending--;var r=void 0!=i?n.dataSource.getByUid(i):n.dataSource.get(e.Id);a&&(r.id=a),o.status?(r.dirty=!1,delete r.dirtyFields,"function"==typeof n.delegate.onRowSuccess&&n.delegate.onRowSuccess(r.uid),t()):"function"==typeof n.delegate.onRowFailure&&n.delegate.onRowFailure(r.uid,o),n.deferredSaves&&n.deferredSaves.length>0&&n.deferredSaves.shift()()};this.numSavesPending<=o?a.executeRemoteAction("saveObject",[e],r):this.deferredSaves.push(function(){a.executeRemoteAction("saveObject",[e],r)})},parseRecord:function(e,t,i,n){e[i]=t[i];var o=void 0;if(n&&(o=n.type.toLowerCase()),null!=t[i]||"date"!=o&&"datetime"!=o&&"time"!=o||(e[i]=Date.UTC(1700,0,1)),void 0!==t[i]&&""!==t[i]||(e[i]=null),"subject_input"==i.toLowerCase()||i.indexOf(".")>0)delete e[i];else if(e[i]instanceof Date)if(n&&"date"!=n.type.toLowerCase()){var r=a.getDateWithOffset(t[i],a.getProfileTimezoneOffset());e[i]=r.valueOf()}else{var s=e[i];s=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())),e[i]=s.valueOf()}t[i]instanceof Array&&(t[i].length>0?e[i]=t[i].join(";"):e[i]=null)},validation:function(e){var t=this,a=[];Object.each(t.dataSource.options.schema.model.fields,function(t,i){t.validation&&t.validation.required&&!e.data[i]&&a.push("["+i+"]")});var i=a.length>0;if(i){var n="Field"+(a.length>1?"s":"")+" required: "+a.join(", ");e.error(e.data.UID,n),t.delegate.onRowFailure(e.data.UID,n)}return i},createDataSource:function(){var i=this,l=this.createSchema(this.fieldMeta),d=new kendo.data.DataSource({serverPaging:!window.isDebug,serverSorting:!window.isDebug,serverFiltering:!window.isDebug,pageSize:this.pageInfo.takeCount?this.pageInfo.takeCount:100,sort:this.pageInfo.sorts?this.pageInfo.sorts:[],filter:this.pageInfo.filter?this.pageInfo.filter:[],error:function(e){e.status&&"string"==typeof e.status.message&&(t.popup("Data Error",e.status.message),e=e.status.message),s.trackException(e)},transport:{update:function(t){var r=i.validation(t);if(!r){var s={};s.Id=t.data.Id,Object.each(t.data.dirtyFields,function(e,a){var n=void 0;$.each(i.fieldMeta,function(e,t){if(t.name.toLowerCase()==a.toLowerCase())return n=t,!1}),i.parseRecord(s,t.data,a,n)});var l=void 0!=n[i.settings.pageInfo.objectName];if(l)o.getCachedDescribeById(s.Id,function(e){var a=n[i.settings.pageInfo.objectName].Types[e.name],o={};Object.each(a,function(e,t){s[t]&&(o[e]=s[t])}),i.saveRecord(o,function(){t.success()})},function(t){var a=i.dataSource.get(s.Id);"function"==typeof i.delegate.onRowFailure&&i.delegate.onRowFailure(a.uid,e)});else{var d=i.delegate.getUpdateOperations();if(d&&Object.keys(d).length>0){var c=0,u=0;Object.each(d,function(e,n){var o=[];Object.each(e,function(e,t){var a=new sforce.SObject(n);a.Id=t,Object.each(e,function(e,t){a[t]=e}),o.push(a)}),c++;var r=function(e){u++,u==c&&i.saveRecord(s,function(){t.success()})};a.batchUpdate(o,r)})}else i.saveRecord(s,function(){t.success()})}}},read:function(e){if(i.pageInfo.takeCount=e.data.take,i.pageInfo.skipCount=e.data.skip,i.pageInfo.sorts=e.data.sort,i.pageInfo.groups=e.data.group,i.pageInfo.filter=e.data.filter,a.convertDateFilters(i.pageInfo.filter,i.fieldMeta),a.convertFKFilters(i.pageInfo.filter,i.fieldMeta),void 0!==i.settings.baseFilter){if(void 0===i.pageInfo.filter&&(i.pageInfo.filter={logic:"and"}),i.pageInfo.filter||(i.pageInfo.filter={}),void 0===i.pageInfo.filter.filters&&(i.pageInfo.filter.filters=[]),i.pageInfo.filter.logic&&"and"!=i.pageInfo.filter.logic.toLowerCase()){var t=i.pageInfo.filter;i.pageInfo.filter={logic:"and",filters:[t]}}i.pageInfo.filter.filters.push(i.settings.baseFilter)}delete i.pageInfo.displayColumns,delete i.pageInfo.selectedRecordsPassed;var n=jQuery.extend(!0,{},i.pageInfo.childGridSettings);delete i.pageInfo.childGridSettings,i.settings.fkRelationship&&(i.pageInfo.fkId=i.settings.fkValue,i.pageInfo.fkRelationship=i.settings.fkRelationship);var o=function(t){var n=i.getModelPrototype();if(void 0!==t.results)for(var o=0;o<t.results.length;o++)if(t.results[o].__proto__=n,i.settings.formulaFields){var l=t.results[o];Object.each(i.fieldMeta,function(e){var t=e.type&&e.type.toLowerCase();"date"!=t&&"time"!=t&&"datetime"!=t||l[e.name]&&(l[e.name]=a.parseDate(l[e.name],t))}),Object.each(i.settings.formulaFields,function(e){var a=r.getFormulaFieldName(e);t.results[o][a]=r.parseFormula(e,l)})}try{e.success(t)}catch(e){console.log(e),s.trackException(e)}};if(i.pageInfo.filterId||i.pageInfo.fkRelationship)a.executeRemoteAction("getPage",[i.pageInfo],function(t,a){a.status?o(t):e.error(t,a)},{escape:!1,buffer:!1});else{var l=1e6;a.promiseRemoteAction("getResultSOQL",[i.pageInfo],{escape:!1,buffer:!1}).then(function(t){return Promise.all([a.promiseRemoteAction("runQuery",[t.resultSOQL,e.data.take,e.data.skip,t.suffix,i.pageInfo.fkRelationship||""],{escape:!1,buffer:!1}),a.promiseRemoteAction("countQuery",[t.countSOQL+" limit "+l+t.suffix],{buffer:!1})])}).then(function(e){e[0].totalResults=e[1],o(e[0])}).catch(function(t){e.error(null,t)})}i.pageInfo.childGridSettings=n},create:function(e){var t=i.validation(e);if(!t){var a=["uid","id","isdeleted","dirtyfields"];Object.each(i.settings.formulaFields,function(e){a.push(r.getFormulaFieldName(e).toLowerCase())});var n={sobjectType:i.pageInfo.objectName};Object.each(e.data,function(t,o){var r=Object.first(i.fieldMeta,function(e){return e.name==o});return"Task"==i.pageInfo.objectName&&"AccountId"==o?void(n.WhatId=e.data.AccountId):("RecordTypeId"==o&&"012000000000000AAA"==e.data.RecordTypeId&&(e.data.RecordTypeId=null),void(a.indexOf(o.toLowerCase())>-1||o.indexOf(".")>=0||r&&("child"==r.type.toLowerCase()||!r.isCreateable)||"subject_input"===o.toLowerCase()||(i.parseRecord(n,e.data,o,r),n[o]instanceof Object&&delete n[o])))}),i.saveRecord(n,function(t){try{e.success()}catch(e){console.log(e),s.trackException(e)}},e.data.UID)}}},sync:function(e){"function"==typeof i.delegate.onSync&&i.delegate.onSync(this,e)},schema:l});return d},getModelPrototype:function(){var e={};if(void 0!==this.pageInfo.columns)for(var t=0;t<this.pageInfo.columns.length;t++){var a=this.pageInfo.columns[t].split(".");2==a.length&&(e[a[0]]={})}return e},createSchema:function(e){var t=this,o={DAY_IN_MONTH:function(e){return e?e.getUTCDate():""},CALENDAR_MONTH:function(e){return kendo.toString(e,"MM MMMM")},CALENDAR_YEAR:function(e){return e?e.getUTCFullYear():""},CALENDAR_QUARTER:function(e){return e?Math.ceil((e.getUTCMonth()+1)/3):""}},s={data:"results",total:"totalResults",model:{id:"Id",fields:{}},parse:function(t){return void 0!==e&&$.each(t.results,function(t,i){$.each(e,function(e,t){var n,r=t.name.split(".");if(null==i[t.name]&&r.length>1){n=i;for(var s=0;s<r.length-1;s++)r[s]in n||(n[r[s]]={}),n=n[r[s]]}if("datepart"==t.type.toLowerCase()||"datetimepart"==t.type.toLowerCase())if(n){var l=n[r[s].split("__datepart__")[0]],d=o[r[s].split("__datepart__")[1]];n[r[s]]=d(a.parseDate(l,t.type.toLowerCase().split("part")[0]))}else{var l=i[t.name.split("__datepart__")[0]],d=o[t.name.split("__datepart__")[1]];i[t.name]=d(a.parseDate(l,t.type.toLowerCase().split("part")[0]))}switch(t.type.toLowerCase()){case"date":case"datetime":case"time":for(var c=i,s=0;s<r.length;s++)s==r.length-1?c[r[s]]=a.parseDate(c[r[s]],t.type):c=c[r[s]]}})}),t}},l=function(e){var a=void 0!=n[t.pageInfo.objectName],o=e.name&&1==e.name.split(".").length&&!e.isNillable&&!e.isReadonly&&i.ignoreRequiredFields.indexOf(e.name)<0||e.validation&&e.validation.required;e.type&&"boolean"==e.type.toLowerCase()?o=!1:"OwnerId"!=e.name||e.validation&&e.validation.required||(o=!1);var r=o,s=o||!(e.isReadonly||e.isHtmlFormatted)||e.isCreateable;a&&(s=!0);var l={editable:s,nullable:e.isNillable&&void 0==e.defaultValue,isROV:a,sfRequired:r,validation:{required:o},defaultValue:e.defaultValue};return l};if(this.settings.formulaFields&&Object.each(this.settings.formulaFields,function(e){var t=l({isReadonly:!0,isNillable:!1,isCreateable:!1}),a=r.getFormulaFieldName(e);s.model.fields[a]=t}),void 0!==e){var t=this;Object.each(this.pageInfo.columns,function(i){var n=Object.first(e,function(e){return e.name===i});if(void 0!==n){var o=l(n);switch(n.type.toLowerCase()){case"currency":case"integer":case"double":case"percent":o.type="number";break;case"boolean":o.type="boolean",delete o.validation;break;case"datetime":case"time":case"date":if(o.defaultValue)if("date"==n.type.toLowerCase()){var r=new Date(o.defaultValue);o.defaultValue=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate())}else o.defaultValue=a.parseDate(o.defaultValue,n.type);o.type="date",o.parse=function(e){return a.parseDate(e,n.type)};break;case"datepart":case"datetimepart":o.type="date",o.parse=function(e){return e};break;case"picklist":o.type="string";var d=Object.first(n.picklistValues,function(e){return e&&e.active&&e.defaultValue});d&&(o.nullable=!1,o.defaultValue=d.value);break;case"multipicklist":o.type="multipicklist";break;case"child":o.type="Object",o.editable=!1,delete o.validation;break;case"string":default:o.type="string"}if(t.settings.restoreColumns){var c=Object.first(t.settings.restoreColumns,function(e){return e.field==n.name});c&&(void 0!==c.defaultValue&&(o.defaultValue=c.defaultValue,o.nullable=!1),void 0!==c.defaultId&&(o.defaultId=c.defaultId),c.required&&(o.validation.required=!0),c.readOnly&&(o.editable=!1))}var u=n.name.split(".");if(u.length>=2){var p=2;t.delegate.allowParentalEditing()&&(p=3),(u.length>p+1&&!n.isNameField||u.length>p)&&(o.editable=!1);for(var d={},i=u.length;i>1;i--){var f={};2==i&&(f=s.model.fields[u[0]]&&s.model.fields[u[0]].defaultValue||{}),f[u[i-1]]=d,d=f}s.model.fields[u[0]]={type:"Object",defaultValue:d}}if(n.isNameField&&u.length>1){var m=u.slice(0,u.length-1).join("."),h=a.getIdFieldFromRelationshipName(m),g=Object.first(e,function(e){return e.name===h});if(g&&(o&&o.validation&&(g.validation=o.validation),n.parentMeta=g,2==u.length||t.delegate.allowParentalEditing()&&3==u.length)){var v=l(g);o.editable=v.editable,o.nullable=v.nullable,o.validation=v.validation;var b=v.defaultValue,y=void 0;if(g.name==t.settings.fkField?(b=t.settings.fkValue,y=t.settings.fkDisplayName):c&&c.defaultValue&&c.defaultId&&(y=c.defaultValue,b=c.defaultId),b&&a.isSalesforceId(b)){var k=u.length-1;if(!y)try{var w=sforce.connection.retrieve(u[k],g.relObjectName,[b]);y=w&&w.length>0&&w[0]?w[0][u[k]]:""}catch(e){}o.nullable=!1,o.defaultValue=y;var x=s.model.fields[h]||{};x.defaultValue=b,s.model.fields[h]=x;var I=s.model.fields[u[0]]&&s.model.fields[u[0]].defaultValue||{};I.Id=b,I[u[k]]=y,s.model.fields[u[0]]={type:"Object",defaultValue:I}}}if(n.name.indexOf("RecordType.Name")>-1)if(2==u.length){var S=Object.first(t.settings.metadata.recordTypeInfos,function(e){return e&&"true"===e.defaultRecordTypeMapping});o.nullable=!1;var C=s.model.fields[u[0]].defaultValue;S&&C&&!C.Id&&(C.Name=S.name,C.Id=S.recordTypeId,o.defaultValue=S.name,s.model.fields[h]={defaultValue:S.recordTypeId})}else o.nullable=!0,o.editable=!1}else u.length>1&&(o.isParentField=!0);s.model.fields[n.name]=o,"function"==typeof t.delegate.onReadFieldMetadata&&t.delegate.onReadFieldMetadata(n,e,o)}if(t.settings.fkField&&t.settings.fkValue&&"Id"!=t.settings.fkField){var v=s.model.fields[t.settings.fkField]||{};v.nullable=!1,v.defaultValue=t.settings.fkValue,s.model.fields[t.settings.fkField]=v}})}return s}};return l}),crmc.define("ExpressionTree",[],function(){function e(){this.value=null,this.left=null,this.right=null,this.toString=function(){return this.value}}function t(e){function t(t){var a,i=0;for(a=0;a<e.length;a++){var n=e.substring(0,a).lastIndexOf(t);if(i<1&&n>0&&a==n+t.length)break;")"==e[a]?i--:"("==e[a]&&i++}return a==e.length&&(a=-1),a-t.length}var a=-1,n={};return Object.each(i,function(e){a<0&&(a=t(e),n={index:a,length:e.length})}),n}function a(i){for(i=i.replace(/\s+/g,"");0==i.indexOf("(");){var n,o=1;for(n=1;n<i.length&&0!=o;n++)")"==i[n]?o--:"("==i[n]&&o++;if(n!=i.length||0!=o)break;i=i.substring(1,i.length-1)}var r=t(i),s=new e;return r.index>0?(s.value=i.substring(r.index,r.length+r.index),s.left=a(i.substring(0,r.index)),s.right=a(i.substring(r.index+r.length))):s.value=i,s}var i=[];return{parseBooleanExpression:function(e){return i=["AND","OR"],a(e)}}}),crmc.define("ForeignKeyControl",["GridDataProvider","sfdc","tooling","SFRest","ExpressionTree","mixpanel"],function(e,t,a,i,n,o){var r=[{field:"IsActive",operator:"eq",value:"true"}],s={},l={isPolymorphic:!1,isFiltered:!1,enableSpyGlass:!0,makeControl:function(e,t,a,i){this.controlFactory({referenceTo:t},a)(e,void 0,void 0,void 0,void 0,i)},createSpyglass:function(e){var i=this.isPolymorphic,n=this.isFiltered,o=e.keyPrefix,r=e.parentObject,s=this.fieldMeta,l=e.model,d=e.inputName,c=e.field,u=this.input,p=e.objectName,f=e.objectPicker,m=this.pageInfo,h=this.setFunction,g=$("<div>");g.kendoButton({spriteCssClass:"k-icon k-i-search",click:function(){var e=function(){var e=i?f.data("kendoDropDownList").value():p,m=t.getSObjectDescribe(e),h="";window.UserContext&&UserContext.siteUrlPrefix&&(h=UserContext.siteUrlPrefix);var g=h+"/_ui/common/data/LookupPage?lkfm=editPage&lknm={0}&lktp={1}&lkent={3}&lkfield={5}&dplp=%5B{2}%5D&lksrch={4}",v=s&&s.name.indexOf("__c")>-1,b=l&&l.Id?'"'+l.Id+'"':"null",y=u.data("kendoComboBox").text();n&&v?a.getCustomFieldId(r,s.name,function(e){openLookup(kendo.format(g,s.name,m.keyPrefix,b,o,y,e),670,"assigned_mod","&lksrch="+escapeUTF(c),"maxw")},function(){openLookup(kendo.format(g,s.name,m.keyPrefix,b,o,y),670,"assigned_mod","&lksrch="+escapeUTF(c),"maxw")}):openLookup(kendo.format(g,d,m.keyPrefix,b,o,y),670,"assigned_mod","&lksrch="+escapeUTF(d),"maxw"),void 0==window.Sfdc&&t.importScript(kendo.format("/jslibrary/{0}/ui-sfdc-javascript-impl/SfdcCore.js",(new Date).valueOf()))};"function"==typeof openLookup?e():t.importScript("/js/functions.js",function(){e()})}}),g.appendTo(u.parent());var v=$('<span style="position:absolute; z-index:-1;"/>');v.appendTo(u.parent());var b=$('<input type="text" onchange="void(0);" style="width:0px;" />');b.attr("name",d),b.appendTo(v);var y=$('<input type="hidden"/>');y.attr("name",d+"_lkid"),y.appendTo(v);var k=$('<input type="hidden"/>');k.attr("name",d+"_lkold"),k.appendTo(v),v.delegate("input","change",function(){var e={};e[m.columns[0]]=b.val(),e[m.columns[1]]=y.val(),$.isFunction(h)&&h(e,m.columns);var t=u.data("kendoComboBox");t.input.val(b.val())})},createPolymorphicMenu:function(a){var n=this.input,o=this.fieldMeta,s=a.objectName,l=this.pageInfo,d=this.template,c=l.filter,u=$('<input style="width:40px;"/>');return u.prependTo(n.parent()),u.kendoDropDownList({dataSource:{transport:{read:function(e){i.getGlobalDescribes(function(t){var a=Object.where(t.sobjects,function(e){return o.referenceTo.indexOf(e.name)>-1});a=Array.orderBy(a,function(e){return e.label&&e.label.toLowerCase()}),e.success(a)})}}},dataTextField:"label",dataValueField:"name",value:s,valueTemplate:'<span class="k-icon k-i-custom"></span>',open:function(e){$(e.sender.list).width(150)},cascade:function(a){var i=this.value(),o=n.data("kendoComboBox");if(o&&i&&i.length>0){var s=t.getSObjectDescribe(i),u=t.getSObjectNameField(s);"User"==i?l.filter=r:l.filter=c,l.objectName=i,l.sorts=[{field:u,dir:"asc"}],l.columns=[u,"Id"];var p=e.init({pageInfo:l}).createDataSource();o.setDataSource(p),o.setOptions({dataTextField:u,valueTemplate:d||'<span title="#: data.'+l.columns[0]+' #">#: data.'+l.columns[0]+" #</span>",template:d||'<span title="#: data.'+l.columns[0]+' #">#: data.'+l.columns[0]+" #</span>"}),o.text(""),o.value(void 0)}}}),u},kendoOperatorForLookupOperation:function(e){var t;switch(e){case"equals":t="eq";break;case"notEqual":t="neq";break;case"lessThan":t="lt";break;case"greaterThan":t="gt";break;case"lessOrEqual":t="lte";break;case"greaterOrEqual":t="gte";break;case"contains":t="contains";break;case"notContain":t="doesnotcontain";break;case"startsWith":t="startswith";break;default:case"includes":case"excludes":case"within":}return t},filterValueForLookup:function(e,a,n,r){var s,l,d=e.split(".");if(d.length>1)switch(d[0]){case"$User":var c=t.getUserInfo();c&&c.userId&&(s=kendo.format("select {0} from User where Id = '{1}'",d[1],c.userId));break;case"$Source":a&&a[d[1]]?l=a[d[1]]:a&&a.Id&&(s=kendo.format("select {0} from {1} where Id = '{2}'",d[1],n,a.Id));break;default:var u="Unsupported filtered lookup valueField: "+e;console.log(u),o.trackException(u)}s?i.query(s,function(e){e&&e.length>0&&r(e[0][d[1]])},function(t){console.log(kendo.format("Failure retrieving lookup filter value {0}: {1} ",e,t)),o.trackException(t)}):r(l)},preevaluateFilter:function(e){var t=!1,a=this;if(e.filters&&e.filters.length>0)Object.each(e.filters,function(i){t="or"==e.logic.toLowerCase()?t||a.preevaluateFilter(i):t&&a.preevaluateFilter(i)});else switch(e.operator){case"neq":t=e.value!=e.field;break;case"lt":t=e.field<e.value;break;case"gt":t=e.field>e.value;break;case"lte":t=e.field<=e.value;break;case"gte":t=e.field>=e.value;break;case"contains":t=e.field.indexOf(e.value)<-1;break;case"notContain":t=e.field.indexOf(e.value)>-1;break;case"startsWith":t=0==e.field.indexOf(e.value);break;case"eq":default:t=e.value==e.field}return t},evaluateBooleanFilterLogic:function(e,t){Object.each(t,function(e,t){"isnotnull"==e.operator||"isnull"==e.operator||void 0!==e.value&&null!==e.value||void 0===e.field||(e.operator="neq"==e.operator?"isnotnull":"isnull");
});var a={filters:t,logic:"and"};if(e){var i=parseInt(e.value)-1,n=e.value.toLowerCase();if("and"==n||"or"==n){var o=[];e.left&&o.push(l.evaluateBooleanFilterLogic(e.left,t)),e.right&&o.push(l.evaluateBooleanFilterLogic(e.right,t));var r=Object.where(o,function(e){return e.preEvaluate});if(r&&r.length>0)for(var s=0;s<r.length;s++){var d=r[s],c=this.preevaluateFilter(d);!c&&"and"==n||c&&"or"==n?o=[]:o.splice(o.indexOf(d),1)}a={filters:o,logic:n}}else t[i]&&(a=t[i])}return a},adjustFilterByType:function(e,a,i){var n=t.getSObjectDescribe(e),o=Object.first(n.fields,function(e){return e.name==a});if(o)if("picklist"==o.type)switch(i.operator){case"eq":case"contains":case"startswith":i.operator="includes";break;case"neq":case"doesnotcontain":i.operator="excludes"}else if("RecordTypeId"==o.name&&i.value){var r=i.value.split(","),s={filters:[],logic:"or"};Object.each(r,function(a,n){var o=t.query(kendo.format("select Id from RecordType where Name = '{0}' and SobjectType = '{1}'",a.trim(),e));1==o.length&&s.filters.push({field:i.field,operator:i.operator,value:o[0].Id}),r.length==parseInt(n)+1&&(delete i.value,delete i.field,delete i.operator,i.logic=s.logic,i.filters=s.filters)})}},createLookupFilter:function(e,i,r,d){var c=[],u=[],p=void 0,f=this,m=function(){var a=c.pop();if(a){var i={},n=a.field,o=a.value||a.valueField,s=n&&(n.indexOf("$User")>-1||n.indexOf("$Source")>-1),h=o&&(o.indexOf("$User")>-1||o.indexOf("$Source")>-1);if(a.valueField&&s){n=a.valueField,o=a.field;var g=s;s=h,h=g}var v=n.split(".");i.field=v.length>1?n.substr(n.indexOf(".")+1):n;var b=e,y=v.length>1?v[v.length-1]:n;if(b.indexOf("$User")>-1)b="User";else if(v.length>1&&"$Source"!=v[v.length-2]){var k=v[v.length-2],w=t.getIdFieldFromRelationshipName(k);if(v.length>2){var x=v[v.length-3],I=t.getSObjectDescribe(x),S=Object.first(I.fields,function(e){return e.name==w});b=S.referenceTo}else b=v[v.length-2]}i.operator=l.kendoOperatorForLookupOperation(a.operation),h?l.filterValueForLookup(o,r,e,function(t){i.value=t,f.adjustFilterByType(b,y,i),s?l.filterValueForLookup(a.field,r,e,function(e){f.adjustFilterByType(b,y,i),i.field=e,u.push(i),m()}):(u.push(i),m())}):s?l.filterValueForLookup(a.field,r,e,function(e){i.value=o,i.field=e,f.adjustFilterByType(b,y,i),i.preEvaluate=!0,u.push(i),m()}):(i.value=o,f.adjustFilterByType(b,y,i),u.push(i),m())}else u=l.evaluateBooleanFilterLogic(p,u),"function"==typeof d&&d(u)};s[e]&&s[e][i]?(c=s[e][i].filters.slice(0),p=s[e][i].booleanFilter,m()):a.getFieldDefinition(e,i,function(t){var a=t&&t.length>0&&t[0].Metadata&&t[0].Metadata.lookupFilter?t[0].Metadata.lookupFilter:{};a&&a.filterItems&&(c=a.filterItems),a&&a.booleanFilter&&(p=n.parseBooleanExpression(a.booleanFilter)),s[e]||(s[e]={}),s[e][i]={filters:c.slice(0),booleanFilter:p},m()},function(e){console.log(e),"function"==typeof d&&d(),o.trackException(e)})},createDataSourceFilter:function(e,a){var i=e.fkField,n=e.fkValue,o=this.fieldMeta,s=this.pageInfo,l=e.parentObject,d=e.model,c=!1;if(o)switch(o.referenceTo){case"RecordType":s.filter=[{field:"IsActive",operator:"eq",value:"true"},{field:"SobjectType",operator:"eq",value:l}];break;case"User":s.filter=r;break;case"PricebookEntry":this.enableSpyGlass=!1;var u=void 0,p=["Pricebook2Id"];if(n){i=i.toLowerCase();var f=t.getUserInfo();switch("true"==f.organizationMultiCurrency&&p.push("CurrencyIsoCode"),l){case"opportunitylineitem":"opportunityid"===i&&(u="select {1} from Opportunity where Id = '{0}'");break;case"orderitem":"orderid"===i&&(u="select {1} from order where id = '{0}'");break;case"quotelineitem":"quoteid"===i&&(u="select {1} from quote where id = '{0}'")}}if(u){var m=t.query(u,n,p);m.length>0&&(s.filter=[],m[0].Pricebook2Id&&(s.filter=[{field:"Pricebook2Id",operator:"eq",value:m[0].Pricebook2Id}]),m[0].CurrencyIsoCode&&s.filter.push({field:"CurrencyIsoCode",operator:"eq",value:m[0].CurrencyIsoCode}))}s.filter instanceof Array||(s.filter=[]),s.filter.push({field:"IsActive",operator:"eq",value:"true"}),s.columns=["Name","Id","Pricebook2.Name","UnitPrice"],this.template='<span title="#: data.Name # (#: data.Pricebook2.Name #)">#: data.Name # (#: data.Pricebook2.Name #)</span>';break;default:this.isFiltered&&(c=!0,this.createLookupFilter(l,o.name,d,function(e){s.filter=e,a()}))}c||a()},createDataSource:function(t){var a=this.pageInfo,i=this.fieldMeta,n=(this.template,this.setFunction,this.enableSpyGlass,a.filter),o=a.sorts;return n?n instanceof Array||(n=[n]):n=[],o?o instanceof Array||(o=[o]):o=[],a.sorts=o,a.filter=n,a.takeCount=25,a.objectName||(a.objectName=i.relObjectName),a.columns||(a.columns=["Name","Id"]),e.init({pageInfo:a}).createDataSource()},setSelect:function(e){var t=this.pageInfo,a=this.setFunction;if(void 0!==e){var i=e[t.columns[0]];$.isFunction(a)&&a(e,t.columns,i)}else{var n={};n[t.columns[0]]="",n[t.columns[1]]=null,$.isFunction(a)&&a(n,t.columns)}},createComboBox:function(e){var t=this.input,a=e.displayText,i=e.dataSource,n=e.autoBind,o=this.isPolymorphic,r=this.enableSpyGlass,s=this.pageInfo,l=(this.pageInfo.filter,this.template),d=this,c=t.kendoComboBox({dataTextField:s.columns[0],dataValueField:s.columns[1],dataSource:i,text:a?a:"",filter:"contains",autoBind:void 0===n||n,valueTemplate:l||'<span title="#: data.'+s.columns[0]+' #">#: data.'+s.columns[0]+" #</span>",template:l||'<span title="#: data.'+s.columns[0]+' #">#: data.'+s.columns[0]+" #</span>",change:function(e){var t=this.dataItem(this.select());(t||0==this.value().length)&&d.setSelect(t)}}).data("kendoComboBox");c.input.blur(function(e){var t=c.dataItems();if(1===t.length){var a=t[0];c.select(0),c.input.val(a[s.columns[0]]),d.setSelect(a)}else null!=c.dataItem()&&d.setSelect(c.dataItem())}),c.input.on("paste",function(){c.input.trigger("keydown")}),a&&c.one("dataBound",function(){c.input.select()}),t.on("resize",function(e,a){var i=t.parent().css("width"),n=i.indexOf("%")>-1?-3:parseInt(i),s=75,l=a||n;r&&(l-=30),o&&(l-=40),n<=0?l=kendo.format("calc(100% - {0}px)",Math.abs(l)):l<s&&(l=s),$(c.wrapper).width(l)}),t.trigger("resize")},create:function(e){var t=Object.create(l);e.parentObject&&""!=e.parentObject||(t.enableSpyGlass=!1),t.fieldMeta=e.fieldMeta,t.input=e.input,t.isFiltered=t.fieldMeta&&t.fieldMeta.filteredLookupInfo,t.isPolymorphic=t.fieldMeta&&t.fieldMeta.referenceTo instanceof Array,t.pageInfo=e.pageInfo,t.template=e.template,t.setFunction=e.setFunction;var a,i=t.fieldMeta?t.fieldMeta.name:e.field;return t.createDataSourceFilter({fkField:e.fkField,fkValue:e.fkValue,parentObject:e.parentObject,model:e.model},function(){var n=t.createDataSource();t.isPolymorphic&&(a=t.createPolymorphicMenu({objectName:e.pageInfo.objectName})),t.enableSpyGlass&&t.createSpyglass({objectName:e.pageInfo.objectName,keyPrefix:e.keyPrefix,parentObject:e.parentObject,model:e.model,inputName:i,field:e.field,objectPicker:a}),t.createComboBox({displayText:e.displayText,dataSource:n,autoBind:e.autoBind})}),t},controlFactory:function(e,t,a,i,n){try{e&&e.filteredLookupInfo&&l.createLookupFilter(a,e.name)}catch(e){}return function(o,r,s,d,c,u,p){var f=l.create({input:o,field:r,model:s,displayText:d,keyPrefix:c,setFunction:u,autoBind:p,fieldMeta:e,pageInfo:t.pageInfo,parentObject:a,fkField:i,fkValue:n});return f}},editor:function(e,t,a,i){var n=this;return function(o,r){var s=$("<input/>");s.attr("name",r.field),s.appendTo(o),n.makeControl(s,e,t,function(e,t){var n=a.split(".");r.model[a]=e[n[n.length-1]];for(var o,s=r.model,l=0;l<n.length-1;l++)o=s,s=s[n[l]];Object.each(t,function(t){s[t]=e[t]}),i?(r.model[i]=e.Id,void 0!==r.model.dirty&&(r.model.dirtyFields||(r.model.dirtyFields={}),r.model.dirtyFields[i]=e.Id)):o[n[n.length-2]+"Id"]=e.Id})}}};return l}),crmc.define("Notification",["sfdc"],function(e){var t={singleNotification:void 0,showProgress:function(t,a){if(this.singleNotification){var i=this.singleNotification.getNotifications();i.each(function(){$(this).parent().remove()})}else this.singleNotification=$("<div>").kendoNotification({position:{pinned:!0,bottom:30,right:30},height:80,width:300,autoHideAfter:0,stacking:"down",templates:[{type:"info",template:'<div class="k-loading-image" style="position:static; width:48px; height:48px; float: left; margin: 15px;"></div><h3 style="font-size:1em; padding: 15px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>'},{type:"error",template:kendo.format('<div style="background-image:url(\'/resource/{0}kendoui/styles/Silver/error-icon.png\'); background-position:50% 50%; background-repeat:no-repeat; position:static; width:48px; height:48px; float:left; margin:15px;"></div><h3 style="font-size:1em; padding: 22px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>',e.getNamespace(!0))},{type:"success",template:kendo.format('<div style="background-image:url(\'/resource/{0}kendoui/styles/Silver/success-icon.png\'); background-position:50% 50%; background-repeat:no-repeat; position:static; width:48px; height:48px; float:left; margin:15px;"></div><h3 style="font-size:1em; padding: 22px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>',e.getNamespace(!0))}]}).data("kendoNotification");this.singleNotification.show(t,a)},showMessage:function(t,a){var i=$("<div>").kendoNotification({position:{pinned:!0,bottom:30,right:30},height:80,width:300,autoHideAfter:4e3,stacking:"down",templates:[{type:"info",template:kendo.format('<div class="k-loading-image" style="background-image:url(\'/resource/{0}kendoui/styles/Silver/success-icon.png\'); background-position:50% 50%; background-repeat:no-repeat; position:static; width:48px; height:48px; float:left; margin:15px;"></div><h3 style="font-size:1em; padding: 22px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>',e.getNamespace(!0))},{type:"error",template:kendo.format('<div style="background-image:url(\'/resource/{0}kendoui/styles/Silver/error-icon.png\'); background-position:50% 50%; background-repeat:no-repeat; position:static; width:48px; height:48px; float:left; margin:15px;"></div><h3 style="font-size:1em; padding: 22px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>',e.getNamespace(!0))},{type:"success",template:kendo.format('<div style="background-image:url(\'/resource/{0}kendoui/styles/Silver/success-icon.png\'); background-position:50% 50%; background-repeat:no-repeat; position:static; width:48px; height:48px; float:left; margin:15px;"></div><h3 style="font-size:1em; padding: 22px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>',e.getNamespace(!0))}]}).data("kendoNotification");i.show(t,a)},showOverlay:function(t,a,i){var n=$("<div>").kendoNotification({position:{pinned:!0,bottom:30,right:window.innerWidth/2-150},height:230,width:720,hideOnClick:i,autoHideAfter:i?0:5e3,stacking:"down",templates:[{type:"keyboard",template:kendo.format('<h3 id="ag-overlay-message" style="font-size:1em; padding: 22px 10px 5px; display:block;">#= title #</h3><p style="margin:0px;">#= message #</p>',e.getNamespace(!0))}]}).data("kendoNotification");n.show(t,a);var o=$("#ag-overlay-message").parent();o.css("background-color","rgba(255, 255, 255, 0.9)"),o.append('<a id="ag-overlay-message-exit" style=" position: absolute; top: 0; right: 0; padding-right: 5px; padding-top: 5px; " role="button" href="#" class="k-window-action k-link"><span role="presentation" class="k-icon k-i-close">Close</span></a>')}};return t}),crmc.define("admin",["metadata","soap","KendoPopup","CustomSettings","tooling","sfdc","ForeignKeyControl","Notification"],function(e,t,a,i,n,o,r,s){var l={buttonName:"crmc_Grid",listName:"Show_In_Grid",featureSecurityItems:[{name:"batchAddEmma",label:"Add Contacts To Emma Group"},{name:"batchAddTask",label:"Batch Add - Task"},{name:"batchAddNote",label:"Batch Add - Note"},{name:"batchAddChatter",label:"Batch Add - Chatter"},{name:"batchAddProductLineItem",label:"Batch Add - Product"},{name:"batchAddUserPackageLicense",label:"Batch Add - AG License"},{name:"batchAddPermissionSetAssignment",label:"Batch Add - Permission Sets"},{name:"batchAddcampaignMember",label:"Batch Add - Campaign Members"},{name:"batchEmail",label:"Batch Email"},{name:"batchDelete",label:"Batch Delete"},{name:"batchClone",label:"Batch Clone"},{name:"findReplace",label:"Find/Replace"},{name:"campaignMemberLoader",label:"Campaign Member Loader (Legacy app)"},{name:"drillUp",label:"Drill Up"},{name:"drillDown",label:"Drill Down"},{name:"exportToExcel",label:"Export To Excel"},{name:"followRecords",label:"Follow Records"},{name:"massUpdate",label:"Secure Mass Update (Legacy app)"},{name:"massUpdateInline",label:"Mass Update Single Page"},{name:"massUpdateBatch",label:"Mass Update Large Batch (disabled by default)"},{name:"merge",label:"Merge"},{name:"viewInNewWindow",label:"View In New Window"},{name:"newButton",label:"Add Record (New Window)"},{name:"inlineNew",label:"Add Record (Inline)"},{name:"editButton",label:"Edit Mode"},{name:"saveView",label:"Save Views"},{name:"manageView",label:"Manage Views"},{name:"fieldChooser",label:"Configure"},{name:"toolBar",label:"Toolbar"},{name:"conditionalFormatting",label:"Conditional Formatting"},{name:"formulaFields",label:"Formula Fields"},{name:"formulaMassUpdate",label:"Formula Mass Update"},{name:"autoFill",label:"Fill Down"},{name:"taf_listbrowse",label:"ListBrowse"},{name:"geopointe",label:"Geopointe"},{name:"readingPane",label:"Reading Pane"},{name:"filterLogic",label:"Filter Logic"},{name:"fullScreenMode",label:"Fullscreen Mode"},{name:"summarizeColumn",label:"Summarize Column"},{name:"sma",label:"MapAnything"},{name:"actionColumn",label:"Action Column"},{name:"checkboxColumn",label:"Checkbox Column"},{name:"lookupHoverDetail",label:"Hover Detail Tips (Lookup)",objectName:"global"},{name:"Loop",label:"DrawLoop"},{name:"renameColumn",label:"Rename Columns"},{name:"columnSettings",label:"Column Settings"},{name:"pasteInsert",label:"Paste to Batch Insert"},{name:"pasteUpdate",label:"Paste to Batch Update (disabled by default)"},{name:"lightningUI",label:"Lightning UI Beta (disabled by default)",objectName:"global"},{name:"detailGrid",label:"Detail Grid"},{name:"chart",label:"Quick Graph"},{name:"editParents",label:"Editable Parental Fields"}],customItems:[],congaItems:[],publicSharingRule:{fullName:o.getNamespace(!0)+"GridView__c.Public",sharedTo:{allInternalUsers:{}},criteriaItems:{field:o.getNamespace(!0)+"Privacy__c",operation:"equals",value:"Public"},accessLevel:"Edit",description:"Public ActionGrid View Sharing",label:"Public","xsi:type":"SharingCriteriaRule"},readOnlySharingRule:{fullName:o.getNamespace(!0)+"GridView__c.Public_Read_Only",sharedTo:{allInternalUsers:{}},criteriaItems:{field:o.getNamespace(!0)+"Privacy__c",operation:"equals",value:"Public Read-Only"},accessLevel:"Read",description:"Read-Only ActionGrid View Sharing",label:"Public Read-Only","xsi:type":"SharingCriteriaRule"},createRule:function(t,a){e.createMetadata(t["xsi:type"],t.fullName,t,function(e){e.success="true"==e.success,a(e)},function(e){a(e)})},createViewSharingRules:function(){var t=!1,a="setupSharingRules",i=this;o.getUserInfo(function(n){n&&n.organizationId&&(a+=n.organizationId);var o=function(e){console.log(JSON.stringify(e)),s.showProgress({title:"Error Creating View Sharing Rules",message:"Refer to ActionGrid documentation to setup Sharing Rules manually."},"error"),localStorage.setItem(a,!0)};if(localStorage&&localStorage.getItem(a)&&(t=!0),!t){var r=[i.readOnlySharingRule,i.publicSharingRule],l=[],d=[];Object.each(r,function(e){l.push(e.fullName)}),e.readMetadata(r[0]["xsi:type"],l,function(e){if(e&&e.records){e.records=[].concat(e.records),Object.each(r,function(t){var a=Object.first(e.records,function(e){return e.fullName==t.fullName});a||d.push(t)});var t=function(e){var n="Creating View Sharing Rules";s.showProgress({title:n,message:e.description+"..."}),i.createRule(e,function(i){i.success?d.length>0?(s.showProgress({title:n,message:"Waiting on Rule to be applied..."}),setTimeout(function(){t(d.pop())},2e3)):(s.showProgress({title:n,message:"Done!"},"success"),localStorage.setItem(a,!0)):i.errors&&"sharing operation already in progress"==i.errors.message?(s.showProgress({title:n,message:"Still waiting for Rule to be applied..."}),setTimeout(function(){t(e)},2e3)):o(i)})};d.length>0?t(d.pop()):localStorage.setItem(a,!0)}},o)}})},getFeatureSecurityItems:function(e,t){var a=this.featureSecurityItems.slice(0);a=a.filter(function(e){return!e.objectName||e.objectName==t}),e&&(this.customItems=[],this.congaItems=[]),this.customItems.length<1&&(this.customItems=o.query("select Name, Id from StaticResource where ContentType in ('ActionGrid/javascript', 'ActionGridRP/javascript')")),Object.each(this.customItems,function(e){a.push({name:e.Name,label:e.Name,Id:e.Id})});var i=o.getNamespace(!0);return this.congaItems.length<1&&(this.congaItems=o.query("SELECT Id, Name, {0}JSON__c, {0}Setting_Name__c, {0}Table_Name__c, {0}Setting_Type__c FROM {0}Grid_Setting__c WHERE isDeleted = false "+(t?"AND {0}Table_Name__c = '{1}' ":"")+"AND ({0}Setting_Type__c = 'congaConductor' OR {0}Setting_Type__c = 'congaComposer')",i,t)),Object.each(this.congaItems,function(e){var t=e[i+"Table_Name__c"];try{t=JSON.parse(unescape(e[i+"JSON__c"]))}catch(e){}a.push({name:"conga__"+e[i+"Setting_Name__c"],label:"Conga: "+t,Id:e.Id,type:e[i+"Setting_Type__c"]})}),a},init:function(t){e.sessionId=t,e.delegate={onError:function(e){a.popup("Metadata API Error",e)}},n.sessionId=t,o.sessionId=t,this.createViewSharingRules()},getCustomObject:function(t,a,i){e.getCustomObject(t,l.buttonName,o.getNamespace(!0),a,i)},createButtonFunction:function(e,t,a){var i=document.getElementsByTagName("HEAD").item(0),n=document.createElement("script");n.type="text/javascript",i.appendChild(n),n.onload=function(){GridButton.showInGrid(e,t)},n.src="/resource/"+a+"gridbutton?ts="+(new Date).getTime()},createButton:function(t,a,i){var n=String.format('({0}("{1}", {!GETRECORDIDS( $ObjectType.{1})}, "{2}"));',this.createButtonFunction.toString(),t,o.getNamespace(!0));e.createButton(t,"crmc_Grid","ActionGrid",n,a,function(e){"function"==typeof i&&i(e,n)})},addToSearchResult:function(t,a,i){e.addToSearchLayouts(t,"crmc_Grid","searchResultsCustomButtons",a,i)},addToListViewButtons:function(t,a,i){e.addToSearchLayouts(t,"crmc_Grid","listViewButtons",a,i)},createStaticResource:function(t,a,i,n,o){var r={fullName:t,content:btoa(i),contentType:a,"xsi:type":"StaticResource"};e.createMetadata("StaticResource",t,r,function(e){"function"==typeof n&&n(e)},o)},updateStaticResource:function(t,a,i,n,o){var r={fullName:t,content:btoa(i),contentType:a,"xsi:type":"StaticResource"};e.updateMetadata("StaticResource",t,r,function(e){"function"==typeof n&&n(e)},o)},updatePageLayout:function(t,a,i,n){e.updateMetadata("Layout",t,a,function(e){"function"==typeof i&&i(e)},n)},readPageLayout:function(t,a){return e.readMetadata("Layout",t,a)},createVFPage:function(t,a,i,n,r){var s,l;a.componentPrefix=o.getNamespace(),""===a.componentPrefix&&(a.componentPrefix="c");var d=kendo.template("<apex:page "+(a.standardController?'standardController="#= standardController #" showHeader="false" ':'sidebar="#=sideBar #" showHeader="#=showHeader #" ')+'docType="html-4.01-strict">\n<#= componentPrefix #:Grid '+(i?'ObjectName="#= objectName #" FKName="#= FKName #" FKValue="{!#= standardController #.Id}" ':'ObjectName="#= objectName #"')+(a.relationshipName?'FKRelationship="#= relationshipName#"':"")+' DelayLoad="false"  ViewID="#= viewID #" \n EnableNewButton="#= enableNewButton #"  EnableNewInline="#= enableNewInline #"  EnableEdit="#= enableEdit #"  EnableActions="#= enableActions #"  EnableFieldChooser="#= enableFieldChooser #" \n EnableStickyViews="#= enableStickyViews #"  EnableToolbar="#= enableToolbar #"  EnableViews="#= enableViews #"  EnableFormatting="#= enableFormatting #"  EnableReadingPane="#= enableReadingPane #" />\n<#= componentPrefix #:DrillUp />\n</apex:page>');l=d(a),s={apiVersion:"34.0",availableInTouch:"true",confirmationTokenRequired:"false",content:btoa(l),fullName:t,label:a.pageLabel,description:"AG_"+a.objectName,"xsi:type":"ApexPage"},e.createMetadata("ApexPage",t,s,function(e){"function"==typeof n&&n(e)},function(e){"function"==typeof r&&r(e,l)})},createMultiTabVFPage:function(t,a,i,n,r){var s,l;t.componentPrefix=o.getNamespace(),""===t.componentPrefix&&(t.componentPrefix="c");var d=[],c=[],u=[],p=!1;Object.each(a,function(e){u.indexOf(e.objectName)<0&&u.push(e.objectName);var a="<li>"+e.pageLabel+"</li>\n";p||e.isCommented||(a='<li class="k-state-active">'+e.pageLabel+"</li>\n",p=!0),e.isCommented&&(a="<!-- "+a+"-->\n"),d.push(a);var n=kendo.template("<!-- #= pageLabel # -->\n"+(e.isCommented?"<!--\n":"")+'<div style="overflow:hidden;"> \n<'+t.componentPrefix+":Grid "+(i?'ObjectName="#= objectName #" FKName="#= FKName #" FKValue="{!'+t.standardController+'.Id}" ':'ObjectName="#= objectName #"')+(e.relationshipName?'FKRelationship="#= relationshipName#"':"")+' DelayLoad="#= delayLoad #"  ViewID="#= viewID #" \n EnableNewButton="#= enableNewButton #"  EnableNewInline="#= enableNewInline #"  EnableEdit="#= enableEdit #"  EnableActions="#= enableActions #"  EnableFieldChooser="#= enableFieldChooser #" \n EnableStickyViews="#= enableStickyViews #"  EnableToolbar="#= enableToolbar #"  EnableViews="#= enableViews #"  EnableFormatting="#= enableFormatting #"  EnableReadingPane="#= enableReadingPane #" />\n <'+t.componentPrefix+":DrillUp /> \n </div>"+(e.isCommented?"\n-->":"")+"\n\n");c.push(n(e))});var f=kendo.template("<apex:page "+(t.standardController?'standardController="#= standardController #" showHeader="true" ':'sidebar="#=sideBar #" showHeader="#=showHeader #" ')+'docType="html-4.01-strict">\n<div id="tabstrip" style="display:none;"> <ul> \n'+d.join("")+"</ul>\n"+c.join("")+'</div>\n<script>\n$(document).ready(function() {\n    $("\\\\#tabstrip").kendoTabStrip({\n      activate: function(e){\n        setTimeout(function(){          $(window).resize();        });\n      }\n    });\n    $("\\\\#tabstrip").css("display", "block");\n});\n </script>\n</apex:page>');l=f(t),s={apiVersion:"34.0",availableInTouch:"true",confirmationTokenRequired:"false",content:btoa(l),fullName:t.pageName,label:t.pageLabel,description:(u.length>0?"AG_"+u.join(";AG_")+"\n":"")+t.description,"xsi:type":"ApexPage"},e.createMetadata("ApexPage",t.pageName,s,function(e){"function"==typeof n&&n(e)},function(e){"function"==typeof r&&r(e,l)})},getCustomSettings:function(e,t,a,n){return i.getTableSettings(e,t,a,n)},setCustomSetting:function(e,t){i.setSetting(e,t,t)},getCustomObjectId:function(e,t){n.getCustomObjectId(e,t)},getVisualForcePages:function(e){n.getVisualForcePages(e)},getLayoutNames:function(e,t){n.query("SELECT Id, Name FROM Layout WHERE ID in ('"+e.join("','")+"')",t)},getProfiles:function(e){return o.query("SELECT id,Description,Name FROM Profile")},getUsers:function(e){return o.query("SELECT Name, UserName, Id from User WHERE IsActive = true AND UserType = 'Standard'")},listCustomApplications:function(t){return e.listMetadata("","CustomApplication",t)},getCustomApplication:function(t,a){return e.readMetadata("CustomApplication",t,a)},createCustomApplication:function(t,a,i,n){a.fullName=t,a["xsi:type"]="CustomApplication",e.createMetadata("CustomApplication",t,a,function(e){"function"==typeof i&&i(e)},n)},addTabToCustomApplication:function(t,a,i,n){e.readMetadata("CustomApplication",t,function(o){o.records&&o.records.tab?o.records.tab.indexOf(a)<0?(o.records.tab.push(a),e.updateMetadata("CustomApplication",t,o.records,function(e){"function"==typeof i&&i(e)},n)):"function"==typeof i&&i(o):n("app not found")},n)},listCustomTabs:function(t){return e.listMetadata("","CustomTab",t)},getCustomTab:function(t,a){return e.readMetadata("CustomTab",t,a)},getCustomTabFull:function(e,t){return n.getCustomTab(e,t)},createCustomTab:function(e,t){var a=function(a){a instanceof Array||(a=[a]),a.length>0&&a[0].Id?t({success:!0,id:a[0].Id,notCreated:!0}):n.createCustomTab(e,t,t)};return n.getCustomTabByName(e.FullName,a,a)},addCustomTabToSet:function(e,t,a,i){var o={ParentId:t,Visibility:a?"DefaultOn":"DefaultOff",Name:e};return n.addCustomTabToSet(o,i,i)},listReports:function(t,a){return e.listMetadata(t,"Report",a)},getReport:function(t,a){return e.readMetadata("Report",t,a)},getReportType:function(t,a){return e.readMetadata("ReportType",t,a)},listFolders:function(t,a){return e.listMetadata("",t+"Folder",a)},getFolder:function(t,a,i){return e.readMetadata(a+"Folder",t,i)},deleteMetadata:function(t,a,i){return e.deleteMetadata(t,a,i,i)}};return l}),crmc.define("JSOperators",["extensions"],function(){var e="…",t="🌀",a={Date:{"Add X Days":"(new Date(…)).addDays(…)","Add X Hours":"(new Date(…)).addHours(…)","Add X Minutes":"(new Date(…)).addMinutes(…)","Add X Months":"(new Date(…)).addMonths(…)","Add X Weeks":"(new Date(…)).addWeeks(…)","Add X Years":"(new Date(…)).addYears(…)","Day of Month (1-31)":"….getDate()","Day of Week (0-6)":"….getDay()","Hour of Day (0-23)":"….getHours()","Is After":"….isAfter(…)","Is Before":"….isBefore(…)","Is Between":"….between(…,…)","Is In Next X":'….inNext(…numberOf…,"…DaysWeeksMonthsOrYears…")',"Is In Previous X":'….inLast(…numberOf…,"…DaysWeeksMonthsOrYears…")',"Is Weekday":"….isWeekday()","Minutes (0-59)":"….getMinutes()","Month (0-11)":"….getMonth()",Now:"(new Date())",Today:"(Date.today())",Value:"(new Date(…year…,…month…,…day…,…hour…,…minutes…))",Year:"….getFullYear()","Is Blank":"… == null","Is Not Blank":"… != null","Is Equal To":"… === …","Is Not Equal To":"… !== …"},Format:{"As Currency":'kendo.format("{0:c}", …)',"As Date":'kendo.format("{0:d}", …)',"As DateTime":'kendo.format("{0:g}", …)',"As Decimal":'kendo.format("{0:n}", …)',"As Number":'kendo.format("{0:n0}", …)',"As Time":'kendo.format("{0:hh:mm tt}", …)'},Advanced:{"Function (Required)":"function(){\n  // Snarky Comments\n  return …;\n}()",Variable:"var …x… = …y…;",If:"if (…test…) {\n  …then…\n}\nelse {\n  …else…\n}","For Each":"Object.each(…list…, function(item){\n  // Use item\n});","Regular Expression":"/…regex…/.test(…string…)"},Logic:{And:"… && …","Group Selected":"(…)",If:"(…if…) ? (…then…) : (…else…)","Is Blank":"… == null","Is Not Blank":"… != null","Is Less Than":"… < …","Is Greater Than":"… > …","Is Equal To":"… === …","Is Not Equal To":"… !== …",Not:"!(…)",Or:"… || …"},Number:{"Absolute Value":"Math.abs(…)","+ Add":"… + …","Round Up":"Math.ceil(…)","/ Divide":"… / …","Round Down":"Math.floor(…)",Max:"Math.max(…1…,…2…,…)",Min:"Math.min(…1…,…2…,…)","* Multiply":"… * …","xʸ Exponent":"Math.pow(…base…,…exp…)","Random (0-1)":"Math.random()",Round:"Math.round(…)","- Subtract":"… - …","√ Sqaure Root":"Math.sqrt(…)","Is Blank":"… == null","Is Not Blank":"… != null","Is Less Than":"… < …","Is Greater Than":"… > …","Is Equal To":"… === …","Is Not Equal To":"… !== …"},Text:{Append:"… + …",Contains:"(….indexOf(…) > 0)","Index Of":"….indexOf(…substring…)",Replace:"….replace(…find…,…replace…)",Substring:"….substr(…startIndex…,…length…)",Value:'"…"',"Is Blank":"… == null","Is Not Blank":"… != null","Is Equal To":"… === …","Is Not Equal To":"… !== …"}},i={},n=function(e,t){var a=[];return Object.each(e,function(e,o){var r="crmcOperator"+Math.random().toString(16),s={text:o,cssClass:r,value:e,parent:t,encoded:!1};i[r]=s;var l="object"==typeof e?n(e):[];l&&l.length>0&&(s.items=l),a.push(s)}),a=Array.orderBy(a,function(e){return e.text})},o=kendo.format("\\u{0}\\u{1}",t.charCodeAt(0).toString(16),t.charCodeAt(1).toString(16)),r=new RegExp(kendo.format("[{0}{1}](\\w+[{0}{1}])?",o,e)),s={dataSource:n(a),itemDictionary:i,initMenu:function(e,t,i){var o=[];i.map(function(e){var t={};switch(t[e.displayName]=e.name,t=n(t)[0],t.text=kendo.format('<input type="checkbox" disabled data-bind="checked: dependentFields" title="Used by Formula" value="{0}" /> {1}',t.value,t.text),t.isField=!0,e.type.toLowerCase()){case"currency":case"integer":case"double":case"percent":t.items=n(a.Number,t);break;case"boolean":break;case"date":case"datetime":case"time":case"datepart":case"datetimepart":t.items=n(a.Date,t);break;case"picklist":case"multipicklist":case"child":case"string":default:t.items=n(a.Text,t)}o.push(t)}),i=o;var s=$('<ul style="position:fixed; z-index:10001;">'),l=this;s.on("mousedown",function(e){e.preventDefault()});var d=function(e,a,i){var n=t.get(0),o=n.selectionStart||0,l=n.selectionEnd||o,d=t.val();i&&i.value&&(e=e.replace(r,i.value)),l>o&&e&&e.search&&e.search(r)>-1&&(e=e.replace(r,d.substr(o,l-o))),d=d.substr(0,o)+e+d.substr(l,d.length),a.set("expression",d);var c=d.match(r);c&&c.length>0?(n.selectionStart=d.indexOf(c[0]),n.selectionEnd=n.selectionStart+c[0].length):(n.selectionStart=o,n.selectionEnd=l+e.length),s.data("kendoMenu").close()},c=function(e){var a,i=t.get(0),n=i.selectionStart||0,o=i.selectionEnd||n,s=t.val();if(n==o)for(var l=new RegExp(r.source,"g");null!==(a=l.exec(s));){var d=a[0]&&a[0].length;if(n>=a.index&&n<=d+a.index){i.selectionStart=a.index,i.selectionEnd=d+a.index;break}}};t.on("click",c),e.append(s),e.append('<div style="height:30px;"></div>'),s.kendoMenu({dataSource:[{text:"Fields",items:i},{text:"Functions",items:this.dataSource}],openOnClick:!0,open:function(e){var t=$(e.item).find("input[type=checkbox]");t.each(function(e,t){var a=$(t).prop("checked");a?($(t).removeProp("disabled"),$(t).css("pointer-events","")):($(t).prop("disabled","true"),$(t).css("pointer-events","none"))}),t.off("click"),t.on("click",function(e){var t=$(this).prop("checked");t||($(this).prop("disabled","true"),e.stopPropagation())})},select:function(e){e.item.classList||(e.item.classList=e.item.className.split(" "));var a=Object.first(e.item.classList,function(e){return e&&e.indexOf&&0==e.indexOf("crmcOperator")}),i={};if($(t)[0].kendoBindingTarget&&$(t)[0].kendoBindingTarget.source&&(i=$(t)[0].kendoBindingTarget.source),void 0!==l.itemDictionary[a]){var n=l.itemDictionary[a];if(n&&n.value&&n.value.search){d(n.value,i,n.parent);var o=n.parent?$(e.item).parents("li:first"):$(e.item),r=(n.parent?n.parent.value:n.value,o.find("input"));if(r&&r.length>0){var s=$(r).prop("checked");s||(r.prop("checked","true"),r.removeProp("disabled"),r.trigger("change"))}}}}})}};return s}),crmc.define("ColumnFactory",["CustomSettings","sfdc","tooling","GridConstants","ForeignKeyControl","SFRest","ReadOnlyObjects","FormulaHelpers"],function(e,t,a,i,n,o,r,s){var l={pageLayoutURLTemplate:function(e,a,i,n){return function(e){var n=e;if(i&&i.length>0)for(var o=0;o<i.length-1;o++)n&&n[i[o]]&&(n=n[i[o]]);var r="";if(e[a]){var s=e[a];""!=s&&void 0!==s||(s="(empty)");var l=e[a]?e[a]:"",d=(Math.floor(1e5*Math.random()+1)+"_",t.getRecordURL(n.Id)),c=0==d.indexOf("javascript:");r=kendo.format('<a href="{2}" data-id="{0}" class="agHoverHelp" {3}>{1}</a>',n.Id,kendo.htmlEncode(l),d,c?"":'target="_blank"')}return r}},createFormulaColumn:function(e){var t={};return t.title=e.id,t.width=100,t.attributes={class:"readOnly"},t.sortable=!1,t.filterable=!1,t.field=s.getFormulaFieldName(e),t.headerAttributes={class:"k-with-icon"},t.formula=e,t.aggregates=[],s.isNumber(e)&&t.aggregates.push("sum"),t.groupFooterTemplate=function(e){var a=e[t.field]||e,i="";if(a&&a.sum&&"number"==typeof a.sum){var n=t.formula&&t.formula.format;i=void 0!==n?kendo.format('<div class="number">{0:'+n+"}</div>",a.sum):a.sum}return i},t.footerTemplate=t.groupFooterTemplate,t.headerTemplate=kendo.format('<a class="k-grid-filter" href="#"><span class="k-icon k-i-funnel-clear" title="{1}"/></a><a class="k-link" href="#" title="{1}"><span class="k-icon k-i-sum" style="vertical-align:top;" />{0}</a>',t.title,"This column is not filterable or sortable because it is a formula field"),t.template=function(a){var i=a[t.field]||"";return t.formula&&t.formula.format&&(i=s.formatFormula(t.formula,a),s.isNumber(e)&&(i="<div class='number'>"+i+"</div>")),i},t},getParentalMeta:function(e,a){var i=e.name.split(".");if(i.length>1)for(var n=[],o=1;o<i.length;o++){var r=i.slice(0,o).join("."),s=t.getIdFieldFromRelationshipName(r),l=$.grep(a,function(e){
return e.name==s});l.length>0&&n.push(l[0])}return n},getHeaderTitle:function(e,t){var a,n=e.name.split(".");if(n.length>1){var o=l.getParentalMeta(e,t).map(function(e){return e.displayName});a=e.isNameField===!0?o.join(" "):kendo.format("{0} ({1})",o.join(" "),e.displayName)}else a=e.displayName;return"datetimepart"!=e.type.toLowerCase()&&"datepart"!=e.type.toLowerCase()||(a+=" ("+i.dateParts[e.name.split("__datepart__")[1]]+")"),a},initFactory:function(e){var a={config:e,createTemplate:function(e){var a=Object.first(this.config.fieldMeta,function(t){return t.name==e});if(a){var i=this.config.settings;if(a.type=a.type.toLowerCase(),"RecordType.Name"==e)return function(t){return t[e]?'<span title="'+t[e]+'">'+t[e]+"</span>":""};if(a.isNameField){var n=e.split(".");return l.pageLayoutURLTemplate(i.objectName,e,n,i.enableHover)}if("email"==a.type)return function(t){var a=t[e];return a?kendo.format('<a href="mailto:{0}">{0}</a>',a):""};if("phone"==a.type)return function(t){var a=t[e]||"";if(void 0===a&&(a=""),window.sendCTIMessage)if(""==a);else if(window.clickToDialEnabled){var n=t.Name||(t.FirstName&&t.LastName?t.FirstName+" "+t.LastName:t.FirstName);a="<a href='javascript:void(0);' onclick=\"disableClicked(this, 'Click to dial disabled');sendCTIMessage('/CLICK_TO_DIAL?DN='+encodeURIComponent('"+a+"')+'&amp;ID="+t.id+"&amp;ENTITY_NAME="+i.pageInfo.objectName+"&amp;OBJECT_NAME='+encodeURIComponent('"+n+"')+'&amp;DISPLAY_NAME='+encodeURIComponent('"+i.pageInfo.objectName+"'));return false;\">"+a+'<img src="/img/btn_dial_inline.gif" alt="Click to dial" width="16" height="10" title="Click to dial" style="display: inline;"></a>'}else a="<span>"+a+'<img src="/img/btn_nodial_inline.gif" alt="Click to dial disabled" width="16" height="10" title="Click to dial disabled"></span>';return a};if("url"==a.type)return function(t){var a=t[e];return a&&a.indexOf("://")<0&&(a="http://"+a),a?kendo.format('<a href="{0}" target="_blank">{1}</a>',a,t[e]):""};if("string"==a.type)return function(t){return t[e]?t[e]:""};if("encryptedstring"==a.type){var o=Object.first(i.metadata.fields,function(t){return t.name==e});return function(t){var a="";if(t[e]){var i="",n=4;switch(o.maskType){case"ssn":i="XXX-XX-";break;case"creditCard":i="XXXX-XXXX-XXXX-";break;case"nino":i="XX XX XX XX X",n=0;break;case"sin":i="XXX-XXX-",n=3;break;case"all":default:n=0;case"lastFour":for(;i.length<t[e].length-n;)i+="X"}"X"!=o.mask&&(i=i.replace(/[X]/g,o.mask));var r=t[e].length-n;a=i+t[e].substr(r>=0?r:0,n)}return a}}if("textarea"==a.type)return function(t){return t[e]?'<div class="longtext">'+t[e]+"</div>":""};if(["combobox","picklist"].indexOf(a.type)>-1)return function(t){return t[e]?'<span title="'+t[e]+'">'+t[e]+"</span>":""};if("multipicklist"==a.type)return function(t){return t&&t[e]?t[e].join?t[e].join(";"):t[e]:""};if(["datepart","datetimepart"].indexOf(a.type)>-1)return function(t){var a="";return void 0!=t[e]&&(a=t[e]),a};if("date"==a.type){var r=function(e,i){return e=t.parseDate(e,a.type),i=i||"{0:d}",kendo.format(i,e)};return function(t){var a="";if(void 0!==t[e]&&t[e]instanceof Date){var i=t[e];a=r(i)}return a}}return["time","datetime"].indexOf(a.type)>-1?function(t){var a="";return void 0!==t[e]&&t[e]instanceof Date&&(a=kendo.format("{0:g}",t[e])),a}:["currency","double","percent"].indexOf(a.type)>-1?function(t){var i="{0:n"+a.precision+"}";"currency"==a.type?i="{0:c"+a.precision+"}":"percent"==a.type&&(i="{0:n"+a.precision+"}%");var n="";return"number"==typeof t[e]&&(n=kendo.format(i,t[e])),n}:"boolean"==a.type?function(t){return kendo.format('<input type="checkbox" style="pointer-events:none;" disabled {0}/>',t[e]===!0?"checked":"")}:"base64"==a.type?function(e){var a='<a target="_blank" href="'+t.getRecordURL(e.Id)+'" />View</a>';return"Attachment"==i.metadata.name?a='<a target="_blank" href="/servlet/servlet.FileDownload?file='+e.Id+'" />View</a>':"StaticResource"==i.metadata.name&&(a='<a target="_blank" href="/resource/'+e.Name+'" />View</a>',e.NamespacePrefix&&(a='<a target="_blank" href="/resource/'+e.NamespacePrefix+"__"+e.Name+'" />View</a>')),a}:e.indexOf(".")>-1?function(t){var i="";return t[e]&&(i=t[e],a.format&&(i=kendo.format(a.format,i))),i}:void 0}},createEditor:function(e,a){a||(a={validation:{required:!1}});var i=this,o=Object.first(this.config.fieldMeta,function(t){return t.name==e});if(o){if(e.indexOf(".")>-1){var r=e.split("."),s=t.getIdFieldFromRelationshipName(r[0]);o.idMeta=Object.first(this.config.fieldMeta,function(e){return e.name===s})}var l=this.config.settings,d=this.config.getRecordTypes,c=this.config.picklistValuesFactory;if(o.type=o.type.toLowerCase(),"RecordType.Name"==e)o.picklistValues=[],o.editor=function(e,t){var i=$("<input/>"),n="RecordTypeId";i.attr("name",n),i.appendTo(e),a.validation.required&&(i.attr("required","required"),$('<span class="k-invalid-msg" data-for="'+n+'"></span>').appendTo(e));var r=i.kendoComboBox({dataSource:{transport:{read:function(e){o.picklistValues.length>0?e.success(o.picklistValues):d(function(t){Object.each(t,function(e,t){e._isAvailable&&"Master"!=e._name&&o.picklistValues.push({text:e._name,value:t})}),e.success(o.picklistValues)})}}},valueTemplate:'<span title="#: data.text #">#: data.text #</span>',template:'<span title="#: data.text #">#: data.text #</span>',dataTextField:"text",dataValueField:"value",change:function(e){var a=t.model;a.RecordType={Id:this.value(),Name:this.text()},a.RecordTypeId=this.value(),a["RecordType.Name"]=this.text()}}).data("kendoComboBox");return r};else if(e.indexOf(".")>-1&&o.isNameField){var r=e.split("."),u={pageInfo:{objectName:o.parentMeta.relObjectName},remoteActions:l.remoteActions},p=r.length-1;u.pageInfo.sorts=[{field:r[p],dir:"asc"}],u.pageInfo.columns=[r[p],"Id"];var f=Object.first(l.metadata.fields,function(e){return e.name==o.parentMeta.name}),m=n.controlFactory(f,u,l.pageInfo.objectName.toLowerCase(),l.fkField,l.fkValue,!0);o.editor=function(t,i){i.model[r[0]][r[p]+"_input"]=i.model[e];var n=$('<input type="hidden" />');return n.appendTo(t),n.attr("name",i.field),a.validation.required&&(n.attr("required","required"),$('<span class="k-invalid-msg" data-for="'+i.field+'"></span>').appendTo(t)),m(n,i.field,i.model,i.model[i.field],l.metadata.keyPrefix,function(t,a,n){var r=e.split("."),s=t[r[r.length-1]]||n;i.model[e]=s;for(var l,d=i.model,c=0;c<r.length-1;c++)l=d,d=d[r[c]];Object.each(a,function(e){d[e]=t[e]}),d[r[r.length-1]+"_input"]=s,o.parentMeta.name?i.model[o.parentMeta.name]!=t.Id&&(i.model[o.parentMeta.name]=t.Id,void 0!==i.model.dirty&&i.model.set(i.field,t.Id)):l[r[r.length-2]+"Id"]=t.Id,"PricebookEntry"==o.parentMeta.relObjectName&&(i.model.UnitPrice=t.UnitPrice,i.model.Quantity=1)}),n.data("kendoComboBox")}}else if(["currency","double","percent","integer"].indexOf(o.type)>-1)o.editor=function(e,t){var i="n"+o.precision;"currency"==o.type&&(i="c"+o.precision);var n=$("<input/>");return n.attr("name",t.field),n.appendTo(e),a.validation.required&&(n.attr("required","required"),$('<span class="k-invalid-msg" data-for="'+t.field+'"></span>').appendTo(e)),n.kendoNumericTextBox({decimals:o.precision,format:o.formatStr}),n.data("kendoNumericTextBox")};else if(["phone"].indexOf(o.type)>-1)o.editor=function(e,i){var n=$("<input class='k-input k-textbox'/>");n.attr("name",i.field);var o=t.getUserInfo(),r=["en_us","fr_ca","en_ca"];return o&&r.indexOf(o.userLocale.toLowerCase())>-1&&n.on("change",function(){n.one("blur",function(){var e=this.value,a=t.formatPhone(e);a&&i.model.set(i.field,a)})}),a.validation.required&&n.attr("required","required"),n.appendTo(e),n.data("kendoMaskedTextBox")};else if("textarea"==o.type)o.editor=function(e,t){t.model[t.field]=$("<div/>").html(t.model[t.field]).text();var i=$('<textarea data-bind="value: '+t.field+'" class="k-input k-textbox"></textarea>');return i.attr("name",t.field),i.on("keydown",function(e){switch(e.keyCode){case kendo.keys.TAB:(void 0!=t.model[t.field]||i.val())&&t.model.set(t.field,i.val());break;case kendo.keys.UP:case kendo.keys.DOWN:case kendo.keys.ENTER:e.stopPropagation()}}),a.validation.required&&i.attr("required","required"),i.appendTo(e),i};else if("encryptedstring"==o.type)o.editor=function(t,n){var o=$('<input type="text" class="k-input k-textbox" />');o.attr("dirty","false"),o.attr("name",n.field);var r=i.createTemplate(e);return o.val(r(n.model)),o.on("keydown",function(e){"false"==o.attr("dirty")&&(o.attr("dirty","true"),o.val(""))}),o.on("input paste",function(e){n.model.set(n.field,o.val())}),a.validation.required&&o.attr("required","required"),o.appendTo(t),o};else if(["combobox","picklist"].indexOf(o.type)>-1){if(void 0!==o.picklistValues){var h="kendoDropDownList";"combobox"==o.type&&(h="kendoComboBox");var g=o.picklistValues.filter(function(e){return e.active}).map(function(e){return{text:e.label,value:e.value}})}var v=c(e,g);o.editor=function(e,t){var i=$("<input/>");i.attr("name",t.field),i.appendTo(e),a.validation.required&&(i.attr("required","required"),$('<span class="k-invalid-msg" data-for="'+t.field+'"></span>').appendTo(e));i[h]({valuePrimitive:!0,optionLabel:" ",dataSource:v(t),valueTemplate:'<span title="#: data.text #">#: data.text #</span>',template:'<span title="#: data.text #">#: data.text #</span>',dataTextField:"text",dataValueField:"value"}).data(h);return i.data("kendoDropDownList")}}else if("multipicklist"==o.type){var g=[];void 0!==o.picklistValues&&Object.each(o.picklistValues,function(e){e.active&&g.push(e.value)});var v=c(e,g);o.editor=function(e,t){var i=a.validation.required,n=$("<input />");n.attr("name",t.field),n.appendTo(e),i&&(n.attr("required","required"),$('<span class="k-invalid-msg" data-for="'+t.field+'"></span>').appendTo(e)),t.isMultiPicklist=!0;var r=n.kendoMultiSelect({optionLabel:o.isNillable?" ":void 0,dataSource:v(t),autoClose:!1,close:function(a){if(i&&a.sender.value().length>0){var o=t.model[t.field];t.model[t.field]=a.sender.value().join(";"),o!=t.model[t.field]&&e.addClass("k-dirty-cell"),n.removeAttr("required")}},change:function(e){t.model.dirtyFields||(t.model.dirtyFields={}),t.model.dirtyFields[t.field]=this.value()}}).data("kendoMultiSelect");return i&&r.open(),origValue=r.value,r.value=function(e){return"string"==typeof e&&(e=e.split(";")),origValue.call(this,e)},n.data("kendoMultiSelect")}}else["date","datetime","datetimepart"].indexOf(o.type)>-1?o.editor=function(e,t){var i="kendoDatePicker";"datetime"==o.type?i="kendoDateTimePicker":"time"==o.type&&(i="kendoTimePicker");var n=$('<input name="'+t.field+'" data-text-field="'+t.field+'" data-value-field="'+t.field+'" data-bind="value:'+t.field+'"/>');n.appendTo(e)[i]();return a.validation.required&&(n.attr("required","required"),$('<span class="k-invalid-msg" data-for="'+t.field+'"></span>').appendTo(e)),n.data(i)}:"boolean"==o.type&&(o.editor=function(e,t){var a=$('<input type="checkbox" data-text-field="'+t.field+'" data-value-field="'+t.field+'" data-bind="checked:'+t.field+'"/>');return a.appendTo(e),a});return o.idMeta&&o.idMeta.isReadonly&&o.idMeta.isCreateable?function(t,n){var r=""==n.model.id;if(r){if("function"==typeof o.editor)return o.editor(t,n);var s=$("<input/>");s.attr("name",n.field),a.validation.required&&s.attr("required","required"),s.appendTo(t),s.kendoMaskedTextBox()}else{$(t).addClass("readOnly");var l=i.createTemplate(e);"function"==typeof l?$(t).html(l(n.model)):$(t).text(n.model[n.field])}}:void 0!=o.editor?o.editor:o.editor=function(e,t){var i=$("<input/>");i.attr("name",t.field),i.addClass("k-textbox"),a.validation.required&&i.attr("required","required"),i.appendTo(e)}}}};return a},createNonFilterableHeaderTemplate:function(e){return kendo.format('<a class="k-grid-filter" href="#"><span class="k-icon k-i-funnel-clear" title="This column is not filterable due to Salesforce limitations"/></a><a class="k-link" href="#">{0}</a>',e)},createColumn:function(a,i,n){var o={};o.schema=n;var r=this.getElementId("col"+a.name).replace("#","");o.headerAttributes={id:r,scope:"col"},o.attributes={headers:r};var s=this;o.width=200,n.editable&&e.getSetting(this.settings.pageInfo.objectName,a.name,"fieldInlineEdit")===!1&&(n.editable=!1),this.settings.editable&&(o.attributes=void 0===o.attributes?{}:o.attributes,o.attributes.class="",n.editable?n.validation&&n.validation.required&&(o.attributes.class+=" requiredField",void 0===o.headerAttributes&&(o.headerAttributes={class:""}),o.headerAttributes.class+=" requiredField"):o.attributes.class+=" readOnly"),o.field=a.name,o.name=a.name,o.title=l.getHeaderTitle(a,i),o.sortable=a.isSortable,o.template=this.factory.createTemplate(o.field),o.aggregates=["count"];var d,c;if(o.field.indexOf(".")>-1){c=o.field.split(".");var u=t.getIdFieldFromRelationshipName(c[0]);d=Object.first(i,function(e){return e.name===u})}if("RecordType.Name"==o.field){o.exportFormat=!1,o.exportTemplate=function(){return function(e){return e[a.name]?e[a.name]:""}};o.editor=s.factory.createEditor(o.field,o.schema)}else if(o.field.indexOf(".")>-1&&a.isNameField){o.exportFormat=!1;var s=this;if(void 0!==d){o.template=l.pageLayoutURLTemplate(this.settings.pageInfo.objectName,o.field,c,this.settings.enableHover);({isNameField:a.isNameField,idMeta:d});o.editor=s.factory.createEditor(o.field,o.schema)}}else a.isNameField&&(o.exportFormat=!1);var p=function(e,t){return function(a){var i=0,n=a[o.field]||a,r='<div class="number warningFooter">{0}</div>';return void 0!==n&&void 0!==n[e]&&"number"==typeof n[e]&&(i=void 0!==t?kendo.format("{0:"+t+"}",n[e]):n[e]),s.gridDataSource.totalPages()>1&&(r='<div class="number warningFooter"><span class="k-icon k-i-info" style="margin-right:2px;" data-title="{1}"></span>{0}</div>'),String.format(r,i,o.field)}},f=function(e,i){return e=t.parseDate(e,a.type),i=i||"{0:d}",kendo.format(i,e)};o.groupHeaderTemplate=function(e){var t="",i=a.type.toLowerCase();void 0!==e.value&&null!==e.value&&(t="date"==i?f(e.value):"datetime"==i?f(e.value,"{0:g}"):e.value);var n="";return s.gridDataSource.view()[0].field==e.field&&(n=kendo.format('<input type="checkbox" style="vertical-align: bottom;" class="check-group_{0}" name="group|{1}|{2}" />',s.settings.id,e.field,void 0===e.value||null===e.value?"":e.value)),kendo.format("{0} <span>{1}: {2}{3}</span>",n,o.title,t,e.count?" ("+e.count+")":"")};var m=function(e){var t=$(e).closest(".k-filter-menu");if(t&&t.length){var i,n=" ",o=$(e).prev();switch(a.type.toLowerCase()){case"date":case"datepart":i=e.kendoDatePicker().data("kendoDatePicker"),n=new Date;break;case"datetime":case"datetimepart":i=e.kendoDateTimePicker().data("kendoDateTimePicker"),n=new Date;break;default:t.find("input[type=text]:not([class*=reldate])").addClass("k-textbox")}t.on("click","button[type=submit]",function(){var t=o.val();"isnull"!=t&&"isnotnull"!=t||($(e).val(n),i&&(i.value(n),i.trigger("change")),$(e).trigger("change"))})}};switch(a.type.toLowerCase()){case"date":case"datetime":case"datepart":case"datetimepart":case"time":case"currency":case"integer":case"double":case"percent":case"combobox":case"picklist":o.filterable={ui:function(e){m(e)},extra:!0};break;default:o.filterable={ui:function(e){m(e)}}}var h=this.settings.metadata.getBoolean("queryable");a.isFilterable?$.inArray(a.type.toLowerCase(),["string","picklist","url","email"])!=-1&&a.isGroupable&&h||$.inArray(a.type.toLowerCase(),["multipicklist"])!=-1?o.filterable={ui:function(e){var t=$(e).closest(".k-filter-menu");$.inArray(a.type.toLowerCase(),["date","datetime","datepart","datetimepart"])!=-1&&e.kendoDateTimePicker();var i=t.find(".tabstrip");if(m(e),!i.length){t.prepend($('<div class="tabstrip"><ul><li class="k-state-active">Smart Filter</li><li>Basic Filter</li></ul><div><div class="filter-div" /></div></div>')),i=t.find(".tabstrip");var n=t.find(".filter-div"),r=i.next();i.append(r),n.kendoMultiSelectGridFilter({field:o.field,fieldMeta:a,objectName:s.settings.pageInfo.objectName,gridDataSource:s.gridDataSource,gridId:s.settings.id+"_grid",baseFilter:s.settings.baseFilter,getPageAction:s.settings.remoteActions.getPageAction,getColumnAction:s.settings.remoteActions.getColumnAction}),t.find("[type=reset]").on("click",function(){n.data("kendoMultiSelectGridFilter").clearFilter()}),i.kendoTabStrip(),r.find("div,select,input").css("margin",".19em")}},extra:!0}:("child"==a.type.toLowerCase()&&a.isGroupable||$.inArray(a.type.toLowerCase(),["date","datetime","datepart","datetimepart"])!=-1)&&(o.filterable={ui:function(e){e.removeAttr("data-bind");var t=$(e).closest(".k-filter-menu");t.html('<div class="filter-div"></div>');var i=t.find(".filter-div");i.kendoMultiSelectGridFilter({field:o.field,fieldMeta:a,objectName:s.settings.pageInfo.objectName,gridDataSource:s.gridDataSource,gridId:s.settings.id+"_grid",baseFilter:s.settings.baseFilter,getPageAction:s.settings.remoteActions.getPageAction,getColumnAction:s.settings.remoteActions.getColumnAction})},extra:!1}):(o.filterable=!1,o.headerAttributes=o.headerAttributes||{},o.headerAttributes.class="k-with-icon",o.headerTemplate=s.columnFactory.createNonFilterableHeaderTemplate(o.title)),$.inArray(a.type.toLowerCase(),["percent","double","integer","currency"])!=-1&&(o.attributes||(o.attributes={}),o.attributes.class?o.attributes.class+=" number":o.attributes.class="number"),o.headerAttributes=o.headerAttributes||{};var g=a.parentMeta?Object.create(a.parentMeta):Object.create(a),v=g.name.split(".");v.length>1&&(g.name=v[v.length-1]),o.headerAttributes["ag-data-tooltip"]=escape(kendo.format(" <div style='word-break: break-all; max-width: 300px'> Label: {2}<br/>API Name: {1}<br/>{0}Type: {3}<br/>Help: {4}</div>",v.length>1?kendo.format("Relationship: …{0}<br/>",v[v.length-2]):"",g.name,g.displayName,g.type.toLowerCase().toTitleCase(),g.inlineHelpText?g.inlineHelpText:"Empty"));var b=this.settings.pageInfo.objectName,y=o.field;o.field.indexOf(".")>0&&(b=d.relObjectName,y=c[c.length-1]);var k={type:a.type.toLowerCase()};switch(a.type.toLowerCase()){case"id":return;case"email":case"url":o.exportFormat=!1;break;case"phone":o.exportFormat=!1;break;case"string":case"encryptedstring":o.encoded=!a.isHtmlFormatted;break;case"combobox":case"picklist":if(void 0!==a.picklistValues){var w="values__c",x="kendoDropDownList";"combobox"==a.type.toLowerCase()&&(w="crmc_values",x="kendoComboBox",this.settings.editable),o[w]=[],Object.each(a.picklistValues,function(e){e.active&&o[w].push({text:e.label,value:e.value})})}o.exportFormat=!1,o.exportTemplate=function(){return function(e){return e[a.name]?e[a.name]:""}};break;case"child":o.exportFormat=!1,o.exportTemplate=function(e,i){return function(n){var o=[],r="";return n[a.name]?($.each(n[a.name],function(i,n){if(10==i)return void(r=" ...");var l=[],d=a.childFieldName.split(",");$.each(d,function(i,o){var r,c,u=o.split(".");if(u.length>1){var p=n[u[0]];if(void 0==p)return!0;var f=p[u[1]];r=u.length>0&&p.Id?p.Id:n.Id,c=f;var m=s.settings.pageInfo.objectName;if("Contact"==m&&"Lead"==u[0]||"Lead"==m&&"Contact"==u[0]){if(d.length>1||l.length>0)return!0}else if("Campaign"==m&&"Lead"==u[0]&&n.Contact&&n.Contact.Id)return!0}else r=n.Id,c=n[a.childFieldName];void 0!=c&&""!=c||(c="(empty)"),l.push(kendo.format(e,r,c,t.getRecordURL(r)))}),o.push(l.join("/"))}),'<div class="longtext">'+o.join(i)+r+"</div>"):""}},e.getSetting(s.settings.pageInfo.objectName,"lookupHoverDetail")===!1||t.isLightningExperienceOrSalesforce1()?o.template=o.exportTemplate('<a href="{2}" target="_blank">{1}</a>',", "):o.template=o.exportTemplate('<a href="{2}" target="_blank" class="agHoverHelp" data-id="{0}">{1}</a>',", "),o.groupable=!1;break;case"multipicklist":void 0!==a.picklistValues&&(o.crmc_values=[],Object.each(a.picklistValues,function(e){e.active&&o.crmc_values.push(e.value)}));break;case"datepart":case"datetimepart":o.width=100,o.headerAttributes.title=o.title;break;case"date":o.width=100;break;case"datetime":case"time":"time"===a.type.toLowerCase()&&(o.filterable={ui:"timepicker"}),o.width=150;break;case"currency":var I=a.precision||2,S="c"+I;o.width=100,o.format="{0:"+S+"}",e.getSetting(b,y,"fieldSum")!==!0&&(o.aggregates.push("sum"),o.footerTemplate=p("sum",S),o.groupFooterTemplate=p("sum",S));break;case"integer":o.width=75,o.format="{0:n0}",e.getSetting(b,y,"fieldSum")!==!0&&(o.aggregates.push("sum"),o.footerTemplate=p("sum","n"),o.groupFooterTemplate=p("sum","n"));break;case"double":var I=a.precision||0,S="n"+I;o.width=75,o.format="{0:"+S+"}",e.getSetting(b,y,"fieldSum")!==!0&&(o.aggregates.push("sum"),o.footerTemplate=p("sum",S),o.groupFooterTemplate=p("sum",S));break;case"percent":k.precision=a.precision||0,k.formatStr="n"+I,o.width=75;break;case"boolean":o.width=75,o.exportFormat=!1}if(o.editor=s.factory.createEditor(o.field,o.schema),n.isROV&&l.decorateEditor(o,l.readOnlyObjectEditor.bind(o,s.settings.pageInfo.objectName)),o.name.indexOf(".")>-1&&!a.isNameField){var C=o.editor,N=a.idMeta.name,_=this.factory.config.decorateDirtyParents;o.editor=function(e,t){var i=a.idMeta.relObjectName;e.kendoTooltip({autoHide:!1,showOn:"click",position:"top",relative:!0,content:t.model[a.idMeta.relationshipName].Id?"<div>Editing field on <a target='_blank' href='/"+t.model[N]+"'>"+i+"</a> parent object.</div>":"<div>Cannot edit on blank "+i+"!</div>",show:function(){this.popup.element.addClass("parentalWarning")}}).data("kendoTooltip").show(),t.model[a.idMeta.relationshipName].Id&&(C(e,t),e.find("input,textarea").on("blur",function(e){_&&_(o.name,t.model[a.idMeta.relationshipName].Id,i)}))}}if(this.settings.conditionalRules&&this.settings.conditionalRules[o.field]){var T=this.settings.conditionalRules[o.field];l.decorateColumnConditionalFormatting(o,T)}return o},decorateColumnConditionalFormatting:function(e,t){var a=e.template;e.template=function(i){var n=a?a(i):i[e.field];e.format&&n&&(n=kendo.format(e.format,n));var o=[],r=0;if(Object.each(t,function(t,a){if(t.expression&&t.expression.length>0){var n="#= "+t.expression+"#",s=function(e){var t="false";try{t=kendo.template(n)(e)}catch(e){console.log(e)}return"true"===t};s(i)&&o.push("crmc_"+e.field.replace(/[^A-Z0-9a-z]*/g,"")+r),r++}}),o.length>0){var s='<span class="{1}">{0}</span>';n=void 0===n||null===n?"":n,n=kendo.format(s,n,o.join(" "))}return n||""}},decorateEditor:function(e,t){var a=[]||e.decorators;e.editor&&a.push(e.editor),a.push(t.bind(e)),e.editor=function(e,t){Object.each(a,function(a){a(e,t)})}},readOnlyObjectEditor:function(e,a,i){var n=""==i.model.id,s=this,l=i.field;if(l.indexOf(".")>-1){var d=l.split(".");l=t.getIdFieldFromRelationshipName(d[0])}if(n)$(a).addClass("readOnly"),"function"==typeof s.template?$(a).html(s.template(i.model)):$(a).text(i.model[i.field]);else{var c=function(t){var n=r[e].Types[t.name][l],o=void 0==n;if(void 0!=n){var d=Object.first(t.fields,function(e){return e.name.toLowerCase()==n.toLowerCase()});d.updateable||(o=!0)}o&&($(a).addClass("readOnly"),"function"==typeof s.template?$(a).html(s.template(i.model)):$(a).text(i.model[i.field]))},u=function(e){alert.popup("Error",e)};o.getCachedDescribeById(i.model.id,c,u)}}};return l}),crmc.define("Formula",["KendoPopup","sfdc","JSOperators","ColumnFactory"],function(e,t,a,i){var n,o,r,s,l,d,c,u=kendo.ui,p=u.Widget,f=function(e,t,a){var i=$('<div style="margin:4px;">'),n=$(kendo.format('<label style="display:inline-block; clear:left; width:7em;">{0}: </label>',e));i.append(n);var o=$("<span>");return a&&o.append($("<span style='display:inline-block; vertical-align:middle; background-color: #c00; width:3px; height:21px;'></span>")),o.append(t),i.append(o),i},m="Untitled Formula",h=p.extend({options:{name:"FormulaWindow"},init:function(e,t){$(e).kendoFormulaWidget({grid:t.grid,allowNew:!0}),$(e).kendoWindow({title:"Saved Formulas",width:"550px",minWidth:"400px",minHeight:"260px",resizable:!0,resize:function(){var t=$(e).height()-290;t<114&&(t=114),o.css("height",t);var a=$(e).height()-46;a<218&&(a=218),s.css("height",a)},modal:!0}).data("kendoWindow").center().open();var a=s.data("kendoListView");a.select(a.element.children().eq(0))}}),g=p.extend({init:function(e,t){var c=this;r=t,p.fn.init.call(c,e);var u=$('<div style="width:150px; float:left;">');if(t.allowNew){var m=$("<button>New</button>");u.append(m),m.on("click",function(){c.newRule()}),m.kendoButton(),u.append($("<span> </span>"));var h=$("<button>Delete</button>");u.append(h),h.on("click",function(){c.deleteRule()}),h.kendoButton()}s=$('<div style="width:150px; float:left; height:264px; margin-top:3px;" data-bind="source: items">'),s.kendoListView({template:"<div style='padding:0.5em;'>#:id#</div>",editTemplate:"<div style='padding:0.5em;'>*#:id#</div>",selectable:!0,change:function(){var t=c.selectedRule();t&&(c.setSelected(t),$(e).trigger("select",{formula:t}))}}),$(u).append(s),$(e).append(u),l=$('<div style="width:calc(100% - 170px); float:right;">'),$(e).append(l),n=$('<input type="search" data-bind="value: id" style="width:calc(100% - 110px);" required="required" />'),$(l).append(f("Formula Label",n,!0));var g=$("<span/>"),v=$('<input type="text" data-bind="value:format"/>'),b=$("<span/>");d=$('<input type="hidden" size="10" data-bind="value:format"/>'),d.on("change",function(){var e=new Date,t=v.data("kendoDropDownList"),a=t&&t.value(),i=c.selectedRule();i.format=d.val(),i.type=t.text(),"g"!=a&&"d"!=a&&"hh:mm tt"!=a&&(e=e.valueOf()),a?b.text(kendo.format("{0:"+d.val()+"}",e)):b.html("")}),g.append(v),g.append(d),$(l).append(f("Format As",g)),$(l).append(f("Preview",b)),v.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:[{text:"No Formatting",value:""},{text:"Currency",value:"c"},{text:"Date",value:"d"},{text:"DateTime",value:"g"},{text:"Decimal",value:"n"},{text:"Number",value:"n0"},{text:"Time",value:"hh:mm tt"}],change:function(){var e=this.value(),t=e;e?d.val(t):d.val(""),d.trigger("change")}});var y=$.extend([],t.grid.fieldMeta);y=Object.where(y,function(e){return"function"!=typeof e&&(e.displayName=i.getHeaderTitle(e,y),"reference"!==e.type.toLowerCase())}),y=Array.orderBy(y,function(e){return e.displayName}),l.append('<label style="display:inline-block; clear:left; margin:5px;">JavaScript:</label>');var k=$("<div/>");o=$('<textarea style="vertical-align:top; width:calc(100% - 5px); height: 120px;font-family:monospace; font-size:14px;" data-bind="value:expression">'),k.append(o),a.initMenu(l,o,y),$(l).append(k);var w=$('<div style="float:right; margin:3px;">'),x=t.tooltip?$('<button class="k-primary" style="margin:3px;">Select</button>'):$('<button style="margin:3px;">Apply</button>');w.append(x),x.on("click",function(){c.selectedRule();c.apply(),t&&t.tooltip&&t.tooltip.hide&&t.tooltip.hide()}),x.kendoButton(),$(l).append(w),this.refresh()},selectedRule:function(){var e=s.data("kendoListView"),t=e.dataItem(e.select());return t},deleteRule:function(){var e=s.data("kendoListView");if(this.selectedRule()){var t=e.select();e.remove(t),this.apply(),0==c.data().length?l.hide():e.select(e.element.children().eq(0))}},newRule:function(){var e=s.data("kendoListView");e.add(),e.select(e.element.children().first()),l.show()},refresh:function(){var e=s.data("kendoListView"),t=[];Object.each(r.grid.settings.formulaFields,function(e){var a=new kendo.data.ObservableObject(e);t.push(a)}),c=new kendo.data.DataSource({data:t,schema:{model:{id:"id",fields:{id:{nullable:!1,type:"string",validation:{required:!0},defaultValue:function(){var e=m,t=Object.where(c.data(),function(e){return e.id&&e.id.indexOf(m)>-1});return t&&t.length>0&&(e+=t.length),e}},expression:{type:"string"},format:{type:"string"},dependentFields:{type:"array",defaultValue:[]}}}}});var a=new kendo.observable({items:c}),i=e.select(),n=e.select().prevAll().length;kendo.bind(s,a),i.length>0?(e.select(e.element.children().eq(n)),l.show()):l.hide()},apply:function(){var t=c.data().slice(0);if(t.length>0){if(!n.val()||0==n.val().length)return void e.popup("Name Required","Rule Name is required");if(!o.val()||0==o.val().length)return void e.popup("Expression Required","A Formula Expression is required")}r.grid.settings.formulaFields={},Object.each(t,function(e){e.id&&e.expression&&(r.grid.settings.formulaFields[e.id]=e)}),r.grid.preserveSelectedRows(r.grid.settings.editable),this.refresh()},setSelected:function(e){kendo.bind(l,e),d.trigger("change"),l.show()},options:{name:"FormulaWidget"}});u.plugin(h),u.plugin(g)}),crmc.define("KendoEntry",["ForeignKeyControl","KendoPopup","sfdc","GridConstants","FormulaHelpers","extensions","Formula"],function(e,t,a,i,n){var o={isNumerical:function(e){var t=!1;if(e)switch(e.toLowerCase()){case"percent":case"integer":case"double":case"currency":t=!0}return t},buildEntryFields:function(e,t,a){var i=[],n=t.name;return Object.each(e,function(e){var o=Object.first(t.fields,function(t){return t.name===e});if(o&&o.getBoolean("createable")){var r={name:o.name,label:o.label,type:o.type,values:o.picklistValues,referenceTo:o.referenceTo,value:a[e]};"Task"==n&&"OwnerId"==e?r.validate=function(e){var t=Object.first(e,function(e){return"assignToRecordOwner__crmc"==e.name});return this.value||t.value?null:'Please select an "Assigned To ID" or check "Assign To Record Owner"'}:o.referenceTo instanceof Array&&o.referenceTo.length>1?"OwnerId"==e?r.referenceTo="User":r.referenceTo=o.referenceTo[0]:"false"==e.nillable&&(r.required=!0,r.validate=function(e){return null==this.value||""===this.value?this.label+" is a required field!":null}),i.push(r)}}),i}},r={fieldSetEntry:function(e,i,n,s,l){s=s||{};var d;try{d=a.getSObjectDescribe(i)}catch(e){}var c=function(t){var a=o.buildEntryFields(t,d,s);r.entry(e,a,{objectName:i},null,l)};n instanceof Array?c(n):a.executeRemoteAction("getFieldSetDescribe",[i,n],function(e,a){a.status&&d?c(e):t.popup(String.format("'{0}' FieldSet not found for Object '{1}'",n,i),a.message)})},entry:function(r,s,l,d,c){var u=i.UNIQUE_ID++,p='<table style="width:100%">',f=a.getUserInfo(),m=kendo.format("{0}_{1}_{2}_{3}",f.organizationId,l.objectName,r.replace(" ",""),"displayResults"),h=function(){var e={};return Object.each(s,function(t){var i={name:t.name,label:t.label,validate:t.validate,maxLength:t.maxLength,required:t.required,isFormula:t.isFormula,formula:t.formula},n=$("#"+t.name+"_"+u);if(i.rawValue=n.val(),"boolean"==t.type)i.value=n[0].checked;else if("date"==t.type){var r=n.data("kendoDatePicker").value();i.value=null,r&&(r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())),i.value=r.toISOString(),i.rawValue=r)}else if("datetime"==t.type){var r=n.data("kendoDateTimePicker").value();if(r){var s=a.getDateWithOffset(new Date(r),a.getProfileTimezoneOffset());i.value=s.toISOString(),i.rawValue=s}else i.value=""}else if(o.isNumerical(t.type)){var d=n.data("kendoNumericTextBox"),c=d.value();i.value=c}else"html"==t.type||("reference"==t.type?i.value=$("#"+t.name+"_hidden_"+u).val():"multipicklist"==t.type?i.value=n.data("kendoMultiSelect").value().join(";"):"custom"==t.type?i.value=t.getValue():i.value=n[0].value);l&&l.includeCheckboxes&&(i.isChecked=$("#"+t.name+"_checkbox_"+u)[0].checked),e[i.name]=i}),e},g=function(){if(l&&l.hasDependency){var e={};Object.each(h(),function(t,a){e[a]=t.value}),Object.each(s,function(t){if(t.dependentPicklist){var a=t.dependentPicklist({field:t.name,model:e},t.values),i=$("#"+t.name+"_"+u);i.data("kendoDropDownList")?i.data("kendoDropDownList").setDataSource(a):i.data("kendoMultiSelect")&&i.data("kendoMultiSelect").setDataSource(a)}})}};Object.each(s,function(e){var t=' style="width:1px; white-space:nowrap;"';"textarea"==e.type&&(t=" style='vertical-align: top; padding-top: 5px'");var a='<span class="k-icon k-i-info helpIcon_'+u+'"margin-right:2px;" title="'+e.help+'" />';p+="<tr><th"+t+">"+(e.label?"<label for='"+e.name+"_"+u+"' >"+e.label+":</label>"+(e.help?a:""):"")+"</th>",l&&l.includeCheckboxes&&(p+=String.format("<td style='text-align:left; width:15px'><input type='checkbox' id='{0}'/></td>",e.name+"_checkbox_"+u)),p+="<td style='text-align:left;'>";var i=" visibility: hidden;";e.required&&"boolean"!=e.type&&(i=""),p+="<div style='background-color: #c00; position: relative; width: 3px;  top: 1px;  height: 21px; float: left;"+i+"'></div>";
var n=e.name+"_"+u;if("textarea"==e.type){var o=e.height?e.height:"inherit";p+=String.format("<textarea id='{0}' name='{0}' style='width:97%; height:{2};' rows='4' class='k-textbox'>{1}</textarea></td>",n,e.value?e.value:"",o)}else if("html"==e.type)p+=e.html;else if("javascript"==e.type){var o=e.height?e.height:"inherit";p+=String.format("<div id='{0}' style='display:none; height:{1};' />",e.name+"__editor_"+u,o),p+=String.format("<textarea id='{0}' name='{0}' style='width:97%; height:{1}; font-size:13px; font-family:monospace' rows='4' class='k-textbox'></textarea></td>",n,o)}else if("custom"==e.type)p+=String.format("<div id='{0}' />",n),e.id=e.name+"_"+u;else{e.value;e.value&&e.value.replace&&(e.value=e.value.replace('"',"&#34;"));var r=255;e.maxLength&&(r=e.maxLength);var s="";e.attributes&&(s=e.attributes),p+=String.format("<input style='width:97%;' id='{0}' value=\"{1}\" maxlength=\"{2}\" {3} /></td>",n,e.value?e.value:"",r,s),"reference"==e.type&&(p+=String.format('<input type="hidden" id="{0}" />',e.name+"_hidden_"+u))}l&&l.allowFormulas&&l.grid&&(p+=kendo.format('<td><div class="k-button k-button-icon ag-formula" id="{0}" title="Use Formula"><span class="k-sprite k-icon k-i-sum"/></div></td>',n+"_formula")),p+="</tr>"}),p+="</table>",displayResultsValue=localStorage.getItem(m);var v="<div id='KendoPopupBox"+u+"' style='display:none; text-align:center;'><p>#= val #</p>",b=l.displayResults?kendo.format("Display Results <input id='{0}' type='checkbox' {1}/> &nbsp; &nbsp;","checkboxResults"+u,displayResultsValue?"":"checked='checked'"):"";b+="<span id='OKWindow"+u+"' class='k-button'>OK</span>&nbsp; &nbsp;<span id='closeWindow"+u+"' class='k-button'>Cancel</span>",l&&l.buttons&&(b="",Object.each(l.buttons,function(e){b+=kendo.format("<span id='{0}' class='k-button'>{1}</span>&nbsp; &nbsp;",e.name+u,e.label)})),v+=b+"</div>",v=kendo.template(v);var y={val:p},k=v(y);$("body").append(k),Object.each(s,function(t){var i=$("#"+t.name+"_"+u);if(l&&l.autoSizeFields&&i.css({"max-width":"230px",width:"calc(100% - 3px)"}),"date"==t.type||"datetime"==t.type){var n="kendoDatePicker";l&&l.autoSizeFields&&i.css({"max-width":"",width:""}),"datetime"==t.type&&(n="kendoDateTimePicker"),i.after("<div id='"+t.name+"_"+u+"_clr' style='width:15px; cursor: pointer; height: 19px;' class='k-icon k-i-close' >&nbsp;</div>");var r=new Date(i.attr("value"));isNaN(r)&&(r=new Date),i[n]({value:r,change:function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u)}});var s=$("#"+t.name+"_"+u+"_clr");s.bind("click",function(){i.data(n).value("")}),i.parents(".k-widget").first().css({"max-width":"165px",width:"calc(100% - 20px)"})}else if("combobox"==t.type)$("#"+t.name+"_"+u).kendoComboBox({dataTextField:"label",dataValueField:"value",dataSource:t.values,filter:"contains",suggest:!0,change:function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u)}});else if("picklist"==t.type){var d,c=l&&l.hasDependency&&t.dependentPicklist;d=t.value?t.value:Object.first(t.values,function(e){return"true"==e.defaultValue});var p=$("#"+t.name+"_"+u),f=p.kendoDropDownList({optionLabel:" ",dataTextField:c?"text":"label",dataValueField:"value",dataSource:t.values,value:d?d.value:"",change:function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u),g()}}),m=f.data("kendoDropDownList").popup.element,h=m.css("visibility","hidden").show().outerWidth(),v=f.closest("div"),b=v.show().find("tr").find("th").width();v.hide(),m.hide().css("visibility","visible"),b+h>l.width&&(f.closest(".k-widget").width(h),l.width=null)}else if("multipicklist"==t.type){var d,c=l&&l.hasDependency&&t.dependentPicklist;d=t.value?t.value:Object.first(t.values,function(e){return"true"==e.defaultValue}),$("#"+t.name+"_"+u).width("97%"),$("#"+t.name+"_"+u).kendoMultiSelect({dataTextField:c?"text":"label",dataValueField:"value",dataSource:t.values,value:d?d.value:"",change:function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u),g()}})}else if("boolean"==t.type){var y="#"+t.name+"_"+u;$(y)[0].type="checkbox",t.value&&$(y).prop("checked",!0),$(y).width("auto").css({"margin-top":"4px","margin-left":"0px"}),l&&l.includeCheckboxes&&$(y).on("change",function(e){$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u)})}else if("reference"==t.type){var k={pageInfo:{objectName:t.referenceTo}};if(t.filter&&(k.pageInfo.filter=t.filter),t.sorts)k.pageInfo.sorts=t.sorts;else{var w=a.getSObjectNameField(a.getSObjectDescribe(t.referenceTo));w&&(k.pageInfo.sorts=[{field:w,dir:"asc"}],k.pageInfo.columns=[w,"Id"])}var x=function(e){$("#"+t.name+"_hidden_"+u).val(e.Id),l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u),g()};i.on("change",x);var I=l&&l.objectName?l.objectName:void 0,S=l&&l.keyPrefix?l.keyPrefix:void 0;if(!t.fullMeta&&I){var C=a.getSObjectDescribe(I);C&&(t.fullMeta=Object.first(C.fields,function(e){return e.name==t.name}),S=C.keyPrefix)}e.create({input:i,field:t.name,model:void 0,displayText:void 0,keyPrefix:S,setFunction:x,autoBind:!1,fieldMeta:t.fullMeta,pageInfo:k.pageInfo,parentObject:I,fkField:l&&l.fkField?l.fkField:void 0,fkValue:l&&l.fkValue?l.fkValue:void 0})}else if("textarea"==t.type||"html"==t.type)$("#"+t.name+"_"+u).bind("propertychange keyup input paste",function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u)});else if("javascript"==t.type){$("#"+t.name+"_"+u).val(t.value);var N=function(){var e=$("#"+t.name+"_"+u),a=ace.edit(t.name+"__editor_"+u);a.setTheme("ace/theme/chrome"),a.session.setMode("ace/mode/javascript"),a.session.setTabSize(2),a.session.setUseSoftTabs(!0),a.session.on("change",function(){e.val(a.getValue())}),a.setValue(t.value,-1),setTimeout(function(){$("#"+t.name+"__editor_"+u).css({display:"block"}),e.css("display","none")},500)};try{if("undefined"!=typeof ace&&ace.edit)N();else{a.importScript("https://cdn.jsdelivr.net/ace/1.2.1/min/ace.js",function(){N()})}}catch(e){console.log(e)}}else if(o.isNumerical(t.type)){var _=t.precision;void 0==_&&(_=2),$("#"+t.name+"_"+u).kendoNumericTextBox({format:"n"+_,decimals:_,min:t.min,max:t.max}).bind("propertychange keyup input paste change",function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u)})}else"custom"==t.type?t.init.call(t,$("#"+t.name+"_"+u),u):$("#"+t.name+"_"+u).kendoMaskedTextBox().bind("propertychange keyup input paste",function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),"function"==typeof t.change&&t.change(e,u)});"reference"!=t.type&&"function"==typeof t.change&&$("#"+t.name+"_"+u).on("change",function(e){l&&l.includeCheckboxes&&$("#"+t.name+"_checkbox_"+u).prop("checked",!0),t.change(e,u)})}),$(".helpIcon_"+u).kendoTooltip({showAfter:1e3}).data("kendoTooltip"),$(".helpIcon_"+u).on("click",function(){$(this).data("kendoTooltip").show($(this))}),g();var w=$("#closeWindow"+u),x=$("#OKWindow"+u),I=$("#KendoPopupBox"+u);if(w.bind("click",function(){I.data("kendoWindow").close().destroy()}),l&&l.buttons&&Object.each(l.buttons,function(e){$("#"+e.name+u).bind("click",function(){I.data("kendoWindow").close(),"function"==typeof e.click&&e.click(h())})}),x.bind("click",function(){var e=h(),a=[];if(l.displayResults){var i=$("#checkboxResults"+u).prop("checked");i?localStorage.removeItem(m):localStorage.setItem(m,!1)}return Object.each(e,function(t){if("function"==typeof t.validate){var i=t.validate(e);i&&a.push(i)}}),a.length>0?void t.popup("Validation Errors!","Please correct all validation errors \n<br /><ul><li>"+a.join("\n</li><li>")+"</li></ul>"):(I.data("kendoWindow").close().destroy(),void c(e))}),!I.data("kendoWindow")){I.kendoWindow({width:void 0!=l?l.width:null,height:void 0!=l?l.height:null,draggable:!0,modal:!0,resizable:!(!l||!l.resizable),actions:["Close"],title:r,maxHeight:$(window).height()-100,minHeight:l?l.minHeight:void 0,maxWidth:$(window).width()-100,minWidth:l&&l.minWidth?l.minWidth:"400px",activate:function(){if(!l||!l.includeCheckboxes){var e=Object.first(s,function(e){return"html"!=e.type});e&&$(String.format("#{0}_{1}",e.name,u)).focus()}},close:function(e){l&&l.grid&&l.grid.setKeyboardFocus()}})}$(".k-button.ag-formula").click(function(){var e=this,t="k-primary",a="ag-formula",i=$(e).attr("id"),n="#"+i.replace("_formula",""),o=$(n),r=$(n.replace("_"+u,"_checkbox_"+u)),l=Object.first(s,function(e){return e.name==n.replace("#","").replace("_"+u,"")}),d=Object.first(o.data(),function(e,t){return t.indexOf("kendo")>-1});d&&d.input&&(o=d.input),o.data("field",l);var c=$(e).hasClass(t);if(c)$(e).removeClass(t),$(o).removeClass(a),$(o).removeAttr("readonly"),$(o).val(""),$(r).removeProp("checked"),l&&(l.isFormula=!1);else{if($(e).addClass(t),$(o).addClass(a),"none"!=o.css("display"))$(o).focus();else{var p=o.parent();p.data("input",o),$(I).data("kendoTooltip").show(p)}$(o).attr("readonly","true"),$(r).prop("checked","true"),l&&(l.isFormula=!0)}}),$(I).kendoTooltip({filter:"input.ag-formula, textarea.ag-formula",content:function(e){e.sender.popup.element.removeClass("k-widget");var a="entryformula",i=$("#ag-"+a);0!=i.length&&(kendo.destroy(i),i.empty(),i.remove()),i=$(kendo.format('<div id="{0}">',"ag-"+a)),i.kendoFormulaWidget({grid:l.grid,tooltip:e.sender}),i.on("select",function(a,i){var o=i&&i.formula;if(o&&o.id){var r=$(e.target);r.data("input")&&(r=r.data("input")),r.val(o.id);var s=r.data("field"),l=!1;if(s)switch(s.formula=o,s.type.toLowerCase()){case"currency":case"integer":case"double":case"percent":o.format&&n.isNumber(o)||(l=!0);break;case"date":case"datetime":case"time":o.format&&!n.isNumber(o)||(l=!0);break;default:o.format&&(l=!0)}if(l){e.sender.hide();var d=o.type;d&&"No Formatting"!=d||(d="unformatted"),t.popup("Data Type Warning",kendo.format("Warning you've selected a {0} Formula but you are attempting to update a {1} field.<br/> Proceeding could have unexpected results. Continue at your own risk!",d,s.type.toTitleCase()),"Cancel",function(){r.val(""),s.formula=void 0},"Continue")}}});var o=$("<div>"),r=$('<div style="padding:5px;"><h3>Select an existing Formula to use for Mass Update. <a href="https://support.getconga.com/Conga_ActionGrid/Getting_Started_with_ActionGrid/ActionGrid_Basics/11Add_Formula_Fields" target="_blank">Help Me Create a Formula.</a></h3></div>');return o.append(r),o.append(i),$(o).css({"max-height":"320px",width:"500px","min-height":"260px",height:"auto"})},showOn:"focus",autoHide:!1,position:"bottom"}),l&&l.saveShortcut&&I.on("keyup",function(e){if(e.keyCode=="S".charCodeAt(0)&&e.ctrlKey)return e.preventDefault(),x.trigger("click"),!1}),I.data("kendoWindow").center().open()},requiredValidation:function(e){return null==this.value||""===this.value?this.label+" is a required field!":this.maxLength&&this.value.length>this.maxLength?this.label+" must be less than "+this.maxLength+" characters!":null}};return r}),crmc.define("FieldChooserDataProvider",["CustomSettings","sfdc","GridConstants","SFRest","extensions"],function(e,t,a,i){return{create:function(n){var o=n.objectName,r=n.objectLabel,s=n.overrideSecurity,l=n.hideRootNodes,d=n.expandFK,c=Object.create(this),u=new kendo.data.TreeListDataSource({transport:{read:function(c){if(c.data&&c.data.id||l===!0){var p=null;c.data.id&&(p=c.data.id);var f=u.get(p),m=!0,h=!1,g=o;if(f){if(f.relObjectName)g=f.relObjectName,h=!0;else{if("toolbarnode"==f.type){var v=[],b=n.delegate&&n.delegate.toolbar;return Object.each(b.getAvailableGroups(),function(e){var t=e.name,a={parentId:p,parentModel:f,hasChildren:!1,nodeName:t,help:"Show or Hide the Toolbar group",type:"toolbargroupnode"};v.push(a)}),void c.success(v)}if("readingpanenode"==f.type){var y=[{parentId:p,parentModel:f,displayName:" ",nodeName:"Chatter Tab",type:"chatternode",hasChildren:!1,tabName:"quickView",help:"Display Chatter tab in Reading Pane"},{parentId:p,parentModel:f,displayName:" ",nodeName:"Reading Pane Tab",type:"rptabnode",hasChildren:!1,tabName:"readingPane",help:"Display Long Text fields from selected records in Reading Pane"}];return s||e.getSetting(g,"detailGrid")===!1||y.push({parentId:p,parentModel:f,displayName:" ",nodeName:"Detail Grid Tab",type:"detailgridnode",hasChildren:!0,tabName:"detailGrid",help:"Display Detail Grid in Reading Pane"}),s||e.getSetting(g,"chart")===!1||y.push({parentId:p,parentModel:f,displayName:" ",nodeName:"Quick Graph Tab",type:"chartnode",hasChildren:!0,tabName:"chart",help:"Display Quick Graph in Reading Pane"}),void i.getSObjectDescribe("ApexPage",function(){y.push({parentId:p,parentModel:f,displayName:"Visualforce Pages",nodeName:"Visualforce Pages",type:"pagesnode",hasChildren:!0,showCheckbox:!1,help:"Display a custom Visualforce Page in Reading Pane related to the selected data"}),c.success(y)},function(){c.success(y)})}if("pagesnode"==f.type)return void i.query(kendo.format("select Name, MasterLabel, NamespacePrefix, Description from ApexPage where ControllerType = '1' and ControllerKey = '{0}' order by MasterLabel",o),function(e){var t=[];Object.each(e,function(e){t.push({nodeName:e.MasterLabel,name:e.NamespacePrefix&&e.NamespacePrefix.length>0?e.NamespacePrefix+"__"+e.Name:"c__"+e.Name,help:kendo.format(" <div style='word-break: break-all;'>Name: {0}<br>Label: {1}<br>Description: {2}</div>",e.Name,e.MasterLabel,e.Description?e.Description:"Empty"),parentId:p,parentModel:f,type:"pagenode"})}),c.success(t)});void 0!==f.type&&("objectnode"==f.type?m=!0:"childrelnode"==f.type?m=!1:"childgridnode"==f.type&&(m=!1))}if("DATE"==f.type||"DATETIME"==f.type){var k=[],w="";if(f.isChild)for(var x=f.parentModel;x.parentModel;)w=x.relationshipName+"."+w,x=x.parentModel;return Object.each(a.dateParts,function(e,t){var a=(f.isChild?".":"")+w+f.name+"__datepart__"+t,i=f.displayName+"__datepart__"+e;k.push({displayName:i,isCreateable:!0,isFilterable:!0,isGroupable:!0,isHtmlFormatted:!1,isNameField:!1,isNillable:!0,isReadonly:!1,isSortable:!1,name:a,parentId:f.id,parentModel:f,type:f.type+"PART"})}),void c.success(k)}}t.executeRemoteAction("getFieldMetaForObject",[g,m],function(t,a){if(a.status){var i=[];Object.each(t,function(t){return t.parentId=p,t.parentModel=f,f&&"chartnode"==f.type&&["integer","double","currency"].indexOf(t.type.toLowerCase())<0?void i.push(t):(l&&!d||("reference"==t.type.toLowerCase()||"child"==t.type.toLowerCase()&&"childgridnode"==f.type||"date"==t.type.toLowerCase()||"datetime"==t.type.toLowerCase())&&(t.hasChildren=!0),h&&(t.isChild=!0),void(m?s||e.getSetting(g,t.name,"field")!==!1||i.push(t):e.getSetting("global",t.relObjectName,"explorer")===!1&&i.push(t)))}),Object.each(i,function(e){t.remove(e)}),c.success(t),u.trigger("expandNode")}else c.error(t)},{escape:!1})}else c.success([{parentId:null,displayName:" ",nodeName:r+" Fields",type:"objectnode",hasChildren:!0,showCheckbox:!1,help:"Add columns from the Primary or Parent Objects"},{parentId:null,displayName:"  ",nodeName:"Related List",type:"childgridnode",hasChildren:!0,showCheckbox:!1,help:"Add an ActionGrid of related data as a tab"},{parentId:null,displayName:"  ",nodeName:"Related Column",type:"childrelnode",hasChildren:!0,showCheckbox:!1,help:"Add related data as a column of comma separated values"},{parentId:null,displayName:"  ",nodeName:"Reading Pane",type:"readingpanenode",hasChildren:!0,showCheckbox:!1,help:"Control what appears in the Reading Pane area of ActionGrid"},{parentId:null,displayName:"  ",nodeName:"Toolbar",type:"toolbarnode",hasChildren:!0,showCheckbox:!1,help:"Display or hide Toolbar groups"}])}},sort:{field:"displayName",dir:"asc"},schema:{model:{id:"uid",fields:{displayName:{type:"string"},visible:{type:"Boolean",defaultValue:!1,nullable:!1},type:{type:"string"}}}}});return c.dataSource=u,c}}}),crmc.define("FieldChooser",["FieldChooserDataProvider","CustomSettings"],function(e,t){var a={fieldDataProvider:void 0,fieldTreeView:void 0,delegate:{getColumns:function(e){}},init:function(a){var i=this;this.settings=a||{};var n=function(e){var n=e.inlineHelpText?"<span style='font-weight:bold'>Help Text: </span>"+e.inlineHelpText:e.help;e.name&&(e.type&&e.type.toTitleCase&&(n="<span style='font-weight:bold'>Type: </span>"+e.type.toLowerCase().toTitleCase()+(n?"<br />"+n:"")),n="<span style='font-weight:bold'>API Name: </span>"+e.name+(n?"<br />"+n:""));var o=e.displayName;e.type&&("child"===e.type.toLowerCase()&&(n="<span style='font-weight:bold'>Name: </span>"+e.relationshipName+"<br /><span style='font-weight:bold'>Label: </span>"+e.childFKFieldLabel),e.type.indexOf("node")>-1&&(o=e.nodeName,n=e.help),"datetimepart"!=e.type.toLowerCase()&&"datepart"!=e.type.toLowerCase()||(o=e.displayName.split("__datepart__")[1]));var r=e.type;"CHILD"==e.type&&(r=e.relationshipName);var s="$(this).parents('tr').first().find('input').click();";return"toolbargroupnode"==e.type&&"Views"==e.nodeName&&t.getSetting(a.objectName,"saveView")!==!1&&(o+=kendo.format(' (<a href="#" onclick="$(\'{0}\').data(\'kendoTreeList\').parent.delegate.saveNamedView();">Save View</a>) <span class="k-icon k-i-info"></span>',a.elementId),n="Hide/Show View Toolbar Group. Ctrl-Shift-S to save a view with the view group hidden.",s=""),"toolbargroupnode"==e.type&&"Edit"==e.nodeName&&t.getSetting(a.objectName,"editButton")!==!1&&i.delegate.settings.metadata&&i.delegate.settings.metadata.updateable&&"true"==i.delegate.settings.metadata.updateable&&(o+=kendo.format(' (<a href="#" onclick="$(\'{0}\').data(\'kendoTreeList\').parent.delegate.toggleEditMode();">{1}</a>) <span class="k-icon k-i-info"></span>',a.elementId,i.delegate.settings.editable?"Disable Edit":"Enable Edit"),n="Enable/Disable Edit Mode. Ctrl-E",s=""),kendo.format('<label title="{0}" onclick="{3}" data-node-name="{2}">{1}</label>',n.replace(/"/g,"&quot;"),o,r,s)};i.delegate&&"function"==typeof i.delegate.template&&(n=i.delegate.template);var o=[{expandable:!0,field:"displayName",title:"Field",template:n,headerTemplate:String.format('<input id="{0}filter" type="search" class="k-textbox" style="width:100%" placeholder="Search Fields"/>',a.elementId.replace("#",""))},{field:"type",title:"Type",width:"64px",filterable:!1,template:function(e){var t="";if(e.type&&e.type.indexOf("node")<0)switch(e.type.toLowerCase()){case"currency":t="$";break;case"integer":case"double":case"percent":t="<span class='k-icon k-i-123'></span>";break;case"boolean":t="<span class='k-icon k-i-tick'></span>";break;case"date":case"datetime":case"datepart":case"datetimepart":t="<span class='k-icon k-i-calendar'></span>";break;case"time":t="<span class='k-icon k-i-clock'></span>";break;case"multipicklist":case"combobox":case"picklist":t="<div class='k-button-group'><span class='k-icon k-insertOrderedList'></span></div>";break;case"email":t='<span class="k-icon k-i-email"></span>';break;case"url":t='<span class="k-icon k-i-link"></span>';break;case"phone":t='<span class="k-icon k-i-call"></span>';break;case"string":case"textarea":t="<span class='k-icon k-i-abc'></span>";break;case"child":break;case"reference":case"id":t='<span class="k-icon k-i-keys"></span>';break;case"base64":t='<span class="k-icon k-i-attach"></span>';break;default:t=e.type}return t}}];i.fieldDataProvider=e.create(a),i.delegate=a.delegate;var r=a.elementId;this.delegate&&"function"==typeof this.delegate.getColumns&&(o=this.delegate.getColumns(o));var s=!0;if(this.fieldTreeView=$(r).kendoTreeList({columns:o,sortable:!0,expand:function(e){if(i.clearSearch()){var t=e.model.uid,a=$(String.format("{0} tbody>tr[data-uid={1}]",i.settings.elementId,t));i.fieldTreeView.element.find(".k-grid-content").animate({scrollTop:a.get(0).offsetTop},200)}},dataBound:function(e){if(s){s=!1;var t=$(r+"filter");t&&(t.on("click",function(e){e.stopPropagation()}),t.on("keyup search input paste",function(e){var a=!1;Object.each(i.fieldDataProvider.dataSource.rootNodes(),function(e){a|=e.expanded}),a||i.expandPrimaryFields(),i.fieldDataProvider.dataSource.filter({field:"displayName",operator:"contains",value:t.val()})}),t.parent().attr({draggable:"false"}))}i.delegate&&"function"==typeof i.delegate.dataBound?i.delegate.dataBound.call(this,e):a.delegate&&a.delegate.settings&&a.delegate.settings.pageInfo.columns&&a.delegate.settings.pageInfo.columns.length>0&&$.each(a.delegate.settings.pageInfo.columns,function(t,i){var n=0==i.lastIndexOf(".",0),o=i.split("."),r=o.length-1;if(n){var s=o[1],l=e.sender.element.find(' [data-field-name=".'+s+'"]').first();l&&(l.prop("checked",!0),l.prop("indeterminate",!0)),r-=2}var d=!n&&o.length>=2||n&&o.length>=4;if(d)for(var c=0;c<r;c++){o.splice(-1,1);var u=o.join(".")+".Name",p=e.sender.element.find(' [data-field-name="'+u+'"]').first();a.delegate.settings.pageInfo.columns.indexOf(u)==-1&&p.prop("indeterminate",!0)}})}}).data("kendoTreeList"),a.enableAutoUpdate){var l=$('<label style="margin-left: 15px;">Auto Update</label>'),d=$('<input type="checkbox" checked/>');d.on("click",function(){i.delegate&&"function"==typeof i.delegate.autoUpdateChecked&&i.delegate.autoUpdateChecked(d.prop("checked"))});var c=$('<div class="k-pager-wrap" style="padding:5px; height:32px;">');c.append(d),c.append(l),$(r).append(c)}this.fieldTreeView.parent=this,$(r).kendoTooltip({showAfter:1e3,filter:"label",width:200,position:"top"}).data("kendoTooltip")},clearSearch:function(){var e=$(this.settings.elementId+"filter"),t=!1;return e&&e.val()&&(e.val(""),e.trigger("search"),t=!0),t},expandRelatedListNode:function(){this.fieldTreeView.collapse($(String.format("{0} tbody>tr:eq(0)",this.settings.elementId)));var e=$(String.format("{0} tbody>tr label[data-node-name=childgridnode]",this.settings.elementId)).parent().parent();return this.fieldTreeView.expand(e),e},collapseRootNodes:function(){try{var e=$(String.format("{0} tbody>tr[aria-expanded=true]",this.settings.elementId)),t=this;Object.each(e,function(e){t.fieldTreeView.collapse(e)})}catch(e){}},showChildRelationshipHelp:function(){var e=this.expandRelatedListNode();this.fieldTreeView.element.find(".k-grid-content").animate({scrollTop:e.get(0).offsetTop},200,function(){setTimeout(function(){var t=$("<div>").kendoTooltip({width:225,position:"left",autoHide:!1,content:"<div>Add a tab of related records by choosing fields from a child object.</div>"}).data("kendoTooltip");t.show(e)},100)})},expandPrimaryFields:function(){try{this.fieldTreeView.expand($(String.format("{0} tbody>tr:eq(0)",this.settings.elementId)))}catch(e){}},expandChildFields:function(e){var t=this,a=function(){var i=$(String.format("{0} tbody>tr label[data-node-name={1}]",t.settings.elementId,e)).parent().parent(),n=i&&i.length>0;if(n&&i.is(":visible"))void 0!=i.attr("aria-expanded")?t.fieldTreeView.element.find(".k-grid-content").animate({scrollTop:i.get(0).offsetTop},200):t.fieldDataProvider.dataSource.one("expandNode",function(){t.fieldTreeView.element.find(".k-grid-content").animate({scrollTop:i.get(0).offsetTop},200)}),t.fieldTreeView.expand(i);else{t.expandRelatedListNode();n?a():t.fieldDataProvider.dataSource.one("expandNode",a)}};a()},refresh:function(){this.fieldTreeView.setDataSource(this.fieldDataProvider.dataSource)},_handleRefresh:function(){this.delegate.isReadingPaneShowing()?this.delegate.initReadingPane():this.delegate.refresh()},onItemChecked:function(e){if(this.delegate&&"function"==typeof this.delegate.onItemChecked)return this.delegate.onItemChecked(e)},onRPTabFieldChecked:function(e,t){this.delegate&&"function"==typeof this.delegate.onRPTabFieldChecked&&(this.delegate.onRPTabFieldChecked(e,t,!this.delegate.onRPTabFieldChecked(e,t)),this.refresh(),this._handleRefresh())},onRPTabChecked:function(e){this.delegate&&"function"==typeof this.delegate.isReadingPaneTabEnabled&&(this.delegate.isReadingPaneTabEnabled(e,!this.delegate.isReadingPaneTabEnabled(e)),this._handleRefresh())},onToolbarItemChecked:function(e){this.delegate&&"function"==typeof this.delegate.onToolbarItemChecked&&this.delegate.onToolbarItemChecked(e)},onVFPageChecked:function(e){this.delegate&&"function"==typeof this.delegate.onVFPageChecked&&(this.delegate.onVFPageChecked(e),this._handleRefresh())},onChildGridNodeChecked:function(e,t){this.delegate&&"function"==typeof this.delegate.onChildGridNodeChecked&&this.delegate.onChildGridNodeChecked(e,t)}};return a}),crmc.define("ActionItem",["CustomSettings"],function(e){var t={itemID:"actionName",featureSecurity:e,getAppNamespace:function(){},getLabel:function(e){return"Hello World!"},createSubmenuItems:function(e){return[]},click:function(e){console.log("Hello World!")},toJSON:function(){return'crmc.addCustomAction({\n  itemID: "actionName",\n  isAvailable: function(context) {\n    // This function is called before the action item is displayed and returns a boolean if the item should be displayed\n    // By default determine availability based on Feature Security for this action\n    return this.featureSecurity.getSetting(context.objectDescribe.name, this.itemID) !== false;\n  },\n  isHeaderAvailable: function(context) {\n    // This function determines if this item can be displayed from the column header menu\n    return false;\n  },\n  isToolbarAvailable: function(context) {\n    // This function determines if this item can be displayed in the Toolbar as a button\n    return false;\n  },\n  getLabel: function(context) {\n    // This function returns the display label of the action item and is called before the item is shown\n    return "Hello World!";\n  },\n  createSubmenuItems: function(context) {\n    // If this function returns additional action item objects, they will appear as submenu items\n    return [];\n  },\n  click: function(context) {\n    // This function is what is executed when the action item is clicked\n    // Context object has this format:\n    /* {\n        objectDescribe: metadata for current object\n        selectedRows: rows selected in AG\n        loadedRows: all rows loaded in AG\n        isHeader: true if header column initiated action\n        selectedColumn: if header Action, info about the column which was clicked\n        kendoGrid: kendoGrid object\n    } */\n    alert("Hello World!");\n  }\n});'}};return t}),crmc.define("FileSaver",[],function(){var e=window;if("undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator))return function(e,t){return navigator.msSaveBlob(e,t)};if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,a=function(){return e.URL||e.webkitURL||e},i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in i,o=function(a){var i=t.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(i)},r=e.webkitRequestFileSystem,s=e.requestFileSystem||r||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},d="application/octet-stream",c=0,u=10,p=function(t){var i=function(){"string"==typeof t?a().revokeObjectURL(t):t.remove()};e.chrome?i():setTimeout(i,u)},f=function(e,t,a){t=[].concat(t);for(var i=t.length;i--;){var n=e["on"+t[i]];if("function"==typeof n)try{n.call(e,a||e)}catch(e){l(e)}}},m=function(t,l){var u,m,h,g=this,v=t.type,b=!1,y=function(){f(g,"writestart progress write writeend".split(" "))},k=function(){if(!b&&u||(u=a().createObjectURL(t)),m)m.location.href=u;else{var i=e.open(u,"_blank");void 0==i&&"undefined"!=typeof safari&&(e.location.href=u)}g.readyState=g.DONE,y(),p(u)},w=function(e){return function(){if(g.readyState!==g.DONE)return e.apply(this,arguments)}},x={create:!0,exclusive:!1};return g.readyState=g.INIT,l||(l="download"),n?(u=a().createObjectURL(t),i.href=u,i.download=l,o(i),g.readyState=g.DONE,y(),void p(u)):(e.chrome&&v&&v!==d&&(h=t.slice||t.webkitSlice,t=h.call(t,0,t.size,d),b=!0),r&&"download"!==l&&(l+=".download"),(v===d||r)&&(m=e),s?(c+=t.size,void s(e.TEMPORARY,c,w(function(e){e.root.getDirectory("saved",x,w(function(e){var a=function(){e.getFile(l,x,w(function(e){e.createWriter(w(function(a){a.onwriteend=function(t){m.location.href=e.toURL(),g.readyState=g.DONE,f(g,"writeend",t),p(e)},a.onerror=function(){var e=a.error;e.code!==e.ABORT_ERR&&k()},"writestart progress write abort".split(" ").forEach(function(e){a["on"+e]=g["on"+e]}),a.write(t),g.abort=function(){a.abort(),g.readyState=g.DONE},g.readyState=g.WRITING}),k)}),k)};e.getFile(l,{create:!1},w(function(e){e.remove(),a()}),w(function(e){e.code===e.NOT_FOUND_ERR?a():k()}))}),k)}),k)):void k())},h=m.prototype,g=function(e,t){return new m(e,t)};return h.abort=function(){var e=this;e.readyState=e.DONE,f(e,"abort")},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,g}}),crmc.define("marketing",["KendoPopup","sfdc"],function(e,t){var a="App Not Installed!",i='This feature is not installed. This is a free application from the Salesforce AppExchange. Please install this application by <a href="{0}" target="new">clicking here.</a><p/><a href="{0}" target="new"><img src="{1}" style="display:block; margin-left:auto; margin-right:auto;"/></a>',n='This feature is not installed. This is a paid application from the Salesforce AppExchange but you can install a free trial.  Please install this application by <a href="{0}" target="new">clicking here</a>.<p/><a href="{0}" target="new"><img src="{1}" style="display:block; margin-left:auto; margin-right:auto;"/></a>',o=kendo.format("/resource/{0}GridResources/styles/images/",t.getNamespace(!0)),r={awduplicate2:{title:a,label:"Duplicate Check for Salesforce 2.0",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N300000058vzKEAQ",imageURL:o+"DuplicateCheck_Logo_320x100.png",content:i},dupcheck:{title:a,label:"Duplicate Check for Salesforce 3.0",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N300000058vzKEAQ",imageURL:o+"DuplicateCheck_Logo_320x100.png",content:i},emma:{title:a,label:"Emma Email Marketing for Salesforce",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N30000005uzUnEAI",imageURL:o+"Emma_Logo_320x100.png",content:i},geopointe:{title:a,label:"Geopointe, unlock the where in your data",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N300000016ZHeEAM",imageURL:o+"geopointe_logo_320x100.png",content:n},taf_listbrowse:{title:a,label:"List Browse, natural data browsing",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N3000000B3fiZEAR",imageURL:o+"listbrowse_320x100.png",content:i},sma:{title:a,label:"MapAnything: Maps, Mapping and GeoAnalytics Made Easy!",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N3000000586bhEAA",imageURL:o+"mapanything_320x100.png",content:n},crmc_pp:{title:"Upgrade Required!",label:"Please upgrade to the newest version of ActionGrid",appURL:"https://appexchange.salesforce.com/listingDetail?listingId=a0N3000000B5ilaEAB",imageURL:o+"ActnGrd_vidbumper_275x176.jpg",content:'The feature you\'re trying to use is not available in this version of ActionGrid. Please upgrade by <a href="{0}" target="new">clicking here.</a><p/><a href="{0}" target="new"><img src="{1}" style="display:block; margin-left:auto; margin-right:auto;"/></a>'}};return{missingApp:function(t){var a=r[t],i=kendo.format(a.content,a.appURL,a.imageURL),n=kendo.format('<div style="max-width: 400px;">{0}</div>',i);e.popup(a.title,n)}}}),crmc.define("ExportMenuItem",["CustomSettings","KendoPopup","FileSaver"],function(e,t,a){var i=function(e,i,n){var o,r,s,l,d,c,u,p,f,m=(this.gridDataSource.pageSize(),"");"csv"===e?(o=r=s=l='"',d=",",c="",u="\n",p="\n",f=""):"xls"===e&&(m="<table>",o="<th filter=all>",r="</th>",s="<td>",l="</td>",d="",c="<tr>",u="<br style='mso-data-placement:same-cell;' />",p="</tr>\n",f="</table>");i=i||"download."+e;var h=this.getSelectedItems();
if(h.length<1)return void t.popup("No Rows Selected!","Please select rows to Export!",void 0,void 0,void 0,{grid:this});var g=[];m+=c,n&&(m+=o+"Id"+r+d);for(var v=0;v<this.kendoGrid.columns.length;v++){var b=this.kendoGrid.columns[v].field,y=this.kendoGrid.columns[v].title||b,k={fieldName:this.kendoGrid.columns[v].field,template:this.kendoGrid.columns[v].template,format:this.kendoGrid.columns[v].format,exportFormat:this.kendoGrid.columns[v].exportFormat,exportTemplate:this.kendoGrid.columns[v].exportTemplate};if(b){if(y=y.replace(/"/g,'""'),m+=o+y+r,b.indexOf(".")>=0){var w=b.split("."),x=Object.first(this.fieldMeta,function(e){return e.name==b});k.isNameField=x.isNameField,2==w.length&&x.isNameField&&n&&(m+=d,y=w[0]+"Id",m+=o+y+r)}v<this.kendoGrid.columns.length-1&&(m+=d)}g.push(k)}m+=p;for(var I=0;I<h.length;I++){m+=c,n&&(m+=s+h[I].id+l+d);for(var v=0;v<this.kendoGrid.columns.length;v++){var k=g[v],w=void 0;if(k.fieldName){var S="";if(k.fieldName.indexOf(".")>=0){w=k.fieldName.split(".");for(var S=h[I]||"",C=0;C<w.length;C++){var N=w[C];S=S[N]||""}}else S=h[I][k.fieldName]||"";if(S&&k.template&&k.exportFormat!==!1?S=$.isFunction(k.template)?k.template(h[I]):kendo.template(k.template)(h[I]):S&&k.format&&k.exportFormat!==!1?S=kendo.format(k.format,h[I][k.fieldName]):k.exportTemplate&&(S=k.exportTemplate("{1}",u)(h[I])),S=S.toString().replace(/"/g,'""'),m+=s+S+l,k.isNameField&&n){try{S=h[I][w[0]].Id,S=S.toString().replace(/"/g,'""')}catch(e){S=""}m+=d+s+S+l}v<this.kendoGrid.columns.length-1&&(m+=d)}}m+=p}m+=f;var _=new Blob(["\ufeff",m],{type:"text/"+e+";charset=utf-8"});a(_,i)},n={isAvailable:function(t){return window.isDebug||e.getSetting(t.objectDescribe.name,"exportToExcel")!==!1},getLabel:function(e){return"Export To..."},createSubmenuItems:function(e){var a=[{getLabel:function(e){return"CSV"},click:function(e){i.apply(e.actionGrid,["csv"])}},{getLabel:function(e){return"CSV (with Record IDs)"},click:function(e){i.apply(e.actionGrid,["csv",void 0,!0])}},{getLabel:function(e){return"Excel"},doExport:function(e,a){var i={filterable:!0,fileName:"ActionGrid.xlsx",allPages:a},n=document.getElementsByTagName("HEAD").item(0),o=document.createElement("script");o.type="text/javascript",n.appendChild(o),o.src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.4.0/jszip.js",o.onerror=function(){t.popup("Export Failed","Export failed, contact support@getactiongrid.com",void 0,void 0,void 0,{grid:e.actionGrid})},o.onload=function(){if(e.kendoGrid.options.excel=i,!a&&e.selectedRows.length>0){var t=e.kendoGrid.dataSource.filter(),n=null,o={field:"Id",operator:"includes",value:"'"+e.selectedRows.map(function(e){return e.Id}).join("','")+"'"};t?(n=$.extend(!0,{},t),t.filters.push(o)):t={filters:[o]},e.kendoGrid.dataSource.filter(t),e.kendoGrid.saveAsExcel(),e.kendoGrid.dataSource.filter(n)}else e.kendoGrid.saveAsExcel()}},click:function(e){if(!e.actionGrid.checkForDirtyRows()){var a=this;e.actionGrid.gridDataSource&&e.actionGrid.gridDataSource.totalPages()>1&&(0==e.selectedRows.length||e.selectedRows.length==e.actionGrid.gridDataSource.pageSize())?t.popupWithButtons("Excel Export","Would you like to export all results matching the current filter </br>or only the first page of results?",[{label:"All Results",click:function(){a.doExport(e,!0)}},{label:"First Page",click:function(){a.doExport(e,!1)}},{label:"Cancel"}],e.actionGrid):a.doExport(e,!1)}}},{getLabel:function(e){return"Excel (with Record IDs)"},click:function(e){i.apply(e.actionGrid,["xls",void 0,!0])}}];return a},click:function(e){}};return n}),crmc.define("ViewMenuItem",["KendoPopup","CustomSettings"],function(e,t){var a={isAvailable:function(e){return t.getSetting(e.objectDescribe.name,"viewInNewWindow")!==!1},getLabel:function(e){return"New Window"},createSubmenuItems:function(e){},click:function(t){isTab=!1;var a=t.selectedRows;a.length>10?e.popup("Too Many Records!","Only 10 records can be opened at a time!"):a.length>0?Object.each(a,function(e){if(isTab)window.open("/"+e.Id,"page_"+e.Id),window.focus();else{var t=window.innerWidth-400,a=window.innerHeight-50,i=window.screenX+400,n=window.screenY+50;window.open("/"+e.Id,"_blank","toolbar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes,height="+a+", width="+t+", left="+i+", top="+n)}}):e.popup("Please select records","Select at least one record to view.")}},i={submenus:[a],getLabel:function(e){return"View Records..."},isAvailable:function(e){var t=!1;return Object.each(this.submenus,function(a){a.isAvailable(e)&&(t=!0)}),t},createSubmenuItems:function(e){return this.submenus}};return i}),crmc.define("BatchAddCampaignMemberMenuItem",["sfdc","marketing","KendoPopup","CustomSettings","GridConstants"],function(e,t,a,i,n){var o={appName:"CRMC_BatchAddCM",maxRows:500,getAppNamespace:function(){return this.appName},getLabel:function(e){return"Campaign Member"},isAvailable:function(e){return("Contact"===e.objectDescribe.name||"Lead"===e.objectDescribe.name)&&i.getSetting(e.objectDescribe.name,"campaignMemberLoader")!==!1},click:function(t){var i=document.getElementsByTagName("HEAD").item(0),r=document.createElement("script");r.type="text/javascript",i.appendChild(r);var s=this,l={ts:(new Date).getTime()};r.src=e.getStaticResourceURL(s.getAppNamespace(),"CRMC_BatchAddCM__BatchAddCampaignMembers",l);var d=function(){if(t.selectedRows.length>o.maxRows)a.popup("Batch Add Limit!","Currently, we don't allow more than "+o.maxRows+" contacts per batch!");else if(t.selectedRows.length>0){var i=[];Object.each(t.selectedRows,function(e){i.push({name:"ids",value:e.Id})});var r={passIds:"true",retURL:"/apex/"+n.namespace+"__"+n.VF_PAGE_NAME+"?object=CampaignMember"};"Lead"===t.objectDescribe.name?e.postToVFPage(s.getAppNamespace(),"BatchAddLeads",r,i,!1,"_BLANK"):e.postToVFPage(s.getAppNamespace(),"ContactButton_BatchAddToCampaignVF",r,i,!1,"_BLANK")}else a.popup("Please select records","Select at least one record to add to a campaign.")};r.onerror=function(){d()},r.onload=function(){d()}},init:function(e,t,a,i){}};return o}),crmc.define("FollowMenuItem",["sfdc","KendoPopup","CustomSettings","Notification"],function(e,t,a,i){return{getLabel:function(e){return"Follow Records"},isAvailable:function(e){return a.getSetting(e.objectDescribe.name,"followRecords")!==!1},click:function(t){if(t.selectedRows.length>0){var a=[];Object.each(t.selectedRows,function(t){var i=new sforce.SObject("EntitySubscription");i.ParentId=t.Id,i.SubscriberId=e.getUserInfo().userId,a.push(i)});var n=function(e){var t=0,a=0;e instanceof Array||(e=[e]),Object.each(e,function(e){"true"==e.success?t++:"DUPLICATE_VALUE"==e.statusCode&&a++});var n="";t>0&&(n="Successfully following "+t+" record"+(1==t?"":"s")+"!"),a>0&&(n.length>0&&(n+="\n"),n+=a+" record"+(1==a?" is":"s are")+" already being followed!"),i.showMessage({title:"Follow Results",message:n},"success")};e.insert(a,n,n,!0)}else i.showMessage({title:"Please select records",message:"Select at least one record to follow."},"error")}}}),crmc.define("actions/BatchAdd_PriceBook_LineItems",["KendoEntry","KendoPopup","sfdc","CustomSettings"],function(e,t,a,i){function n(e){switch(e.objectDescribe.name.toLowerCase()){case"opportunity":return!0;case"order":return!0;case"quote":return!0;default:return!1}}var o="There was an error: ",r="Added {0} {1}, would you like to ActionGrid the results?",s="Batch Add Results",l="Yes",d="No";return{isAvailable:function(e){return!!(e.selectedRows&&e.selectedRows.length>0&&n(e))&&i.getSetting(e.objectDescribe.name,"batchAddProductLineItem")!==!1},getLabel:function(e){return e.objectDescribe.name+" Products"},createSubmenuItems:function(e){return[]},click:function(i){function n(e,t){e instanceof Array||(e=[e]);var a,i=200,n=[],o=function(a){n=n.concat(a),n.length==e.length&&"function"==typeof t&&t(n)};for(a=0;a<e.length;a+=i)sforce.connection.update(e.slice(a,a+i),{onSuccess:o,onFailure:o})}function c(e,t,a){for(var i=function(e){b()},o=[],r=0;r<e.length;r++){var s=new sforce.SObject(a);s.id=e[r],s.Pricebook2Id=t,o.push(s)}n(o,i)}function u(e,n,c){var u=a.query("SELECT Id, UnitPrice FROM PricebookEntry WHERE Id = '"+e+"'");i.selectedRows.map(function(t){var a=new sforce.SObject(v.current.createObject);v.current.parent(a,t.Id),a.PricebookEntryId=e,a.Quantity=n,a.UnitPrice=u[0].UnitPrice,a.Description=c,f.push(a)}),sforce.connection.create(f,{onSuccess:function(e){function a(){t.popupWithButtons("Errors",p.join(""),[{label:"Ok"}],{width:900}),i.actionGrid.refresh()}function n(e,t){for(var a=0;a<e.length;a++)if(e[a]==t)return!0;return!1}for(var o=[],c=0,u=0,p=["<ul>"],f=0;f<e.length;f++)if(e[f].success&&"true"==e[f].success)c++,o.push(e[f].id);else if(u++,void 0!=e[f].errors&&void 0!=e[f].errors.message){var m="<li>"+e[f].errors.message+"</li>";n(p,m)||p.push(m)}else if(void 0!=e[f].errors&&e[f].errors instanceof Array)for(var h=e[f].errors,g=0;g<h.length;g++){var m="<li>"+h[g].message+"</li>";n(p,m)||p.push(m)}else p.push("<li>"+e[f]+"</li>");if(p.push("</ul>"),o.length>0){var b=kendo.format(r,c),y=[{label:l,click:function(){window.open(kendo.format("/apex/CRMC_PP__crmc_grid?object={0}&Ids={1}",v.current.createObject,o.join())),u>0?a():i.actionGrid.refresh()}},{label:d,click:function(){u>0?a():i.actionGrid.refresh()}}];t.popupWithButtons(s,b,y)}else a()},onFailure:function(){alert(o+error.toString())}})}var p=[];Object.each(i.selectedRows,function(e){p.push("'"+e.Id+"'")});var f=[],m=a.getUserInfo(),h="true"==m.organizationMultiCurrency,g=function(e){return null==this.value||""===this.value?this.label+" is a required field!":this.maxLength&&this.value.length>this.maxLength?this.label+" must be less than "+this.maxLength+" characters!":null},v={set:function(){for(var e=0;e<this.objects.length;e++)if(i.objectDescribe.name===this.objects[e].context)return this.current=this.objects[e],!0;return!1},current:void 0,objects:[{context:"Opportunity",createObject:"OpportunityLineItem",parent:function(e,t){e.OpportunityId=t},filterId:void 0,VerifyPriceBooks:function(e){for(var i=void 0,n=!1,o=0;o<e.length;o++)null!=e[o].Pricebook2Id&&(void 0===i&&null!=e[o].Pricebook2Id&&(i=e[o].Pricebook2Id),i!=e[o].Pricebook2Id&&(n=!0));n?t.popup("WARNING","Select rows with a Price Book must contain the same Price Book"):void 0!=i?(this.filterId=i,b()):(this.filterId=a.query("SELECT Id FROM Pricebook2 WHERE IsStandard = true")[0].Id,b())}},{context:"Order",pluralName:"Orders",createObject:"OrderItem",parent:function(e,t){e.OrderId=t},filterId:void 0,VerifyPriceBooks:function(e){v.VerifyParentPricebook(e)}},{context:"Quote",pluralName:"Quotes",createObject:"QuoteLineItem",parent:function(e,t){e.QuoteId=t},filterId:void 0,VerifyPriceBooks:function(e){v.VerifyParentPricebook(e)}}],VerifyParentPricebook:function(i){for(var n=void 0,o=[],r=[],s=[{label:"Yes",click:function(){c(o,v.current.filterId,v.current.context)}},{label:"No Thanks"}],l=[{label:"Use Standard",click:function(){v.current.filterId=a.query("SELECT Id FROM Pricebook2 WHERE IsStandard = true")[0].Id,c(o,v.current.filterId,v.current.context)}},{label:"Choose Pricebook",click:function(){e.entry("Select Pricebook",[{referenceTo:"Pricebook2",name:"Pricebook2",label:"Pricebook",type:"reference",required:!0,validate:g}],{width:375,objectName:"Pricebook2"},null,function(e){v.current.filterId=e.Pricebook2.value,c(o,v.current.filterId,v.current.context)})}},{label:"No Thanks"}],d="Copy the Pricebook from your other selected records and batch update the "+v.current.pluralName+" missing a pricebook?",u="Batch update selected records with a Pricebook?",p="Selected rows with a Price Book must contain the same Price Book",f=!1,m=0;m<i.length;m++)if(null!=i[m].Pricebook2Id){if(r.push(i[m].Id),void 0===n&&null!=i[m].Pricebook2Id&&(n=i[m].Pricebook2Id),n!=i[m].Pricebook2Id){f=!0;break}}else o.push(i[m].Id);f?t.popup("WARNING",p):void 0!=n&&0===o.length?(v.current.filterId=n,b()):void 0!=n&&o.length>0?(v.current.filterId=n,t.popupWithButtons("Error: "+v.current.context+" records must contain a Pricebook",d,s,{width:350})):t.popupWithButtons("Error: "+v.current.context+" records must contain a Pricebook",u,l,{width:350})}},b=function(){var t=[{field:"Pricebook2Id",operator:"eq",value:v.current.filterId},h?{field:"CurrencyIsoCode",operator:"eq",value:v.current.currencyCode}:{}];e.entry("Batch Add Products",[{prefix:"01u",referenceTo:"PricebookEntry",name:"PricebookEntry",label:"Product",type:"reference",filter:t,required:!0,validate:g},{name:"Quantity",label:"Quantity",type:"double",value:1,min:1,precision:0,required:!0,validate:g},{name:"Description",label:"Description",type:"textarea",required:!1}],{width:375},null,function(e){var t=e.PricebookEntry.value,a=e.Quantity.value,i=e.Description.value;u(t,a,i)})};v.set();var y=h?"select Id, Pricebook2Id, CurrencyIsoCode from "+v.current.context+" where Id in ({0})":"select Id, Pricebook2Id from "+v.current.context+" where Id in ({0})",k=a.query(y,p.join());if(k.length>0){var w=k[0].Pricebook2Id,x=k[0].CurrencyIsoCode,I=(Object.first(k,function(e){return e.Pricebook2Id!=w}),!1);h&&(I=Object.first(k,function(e){return e.CurrencyIsoCode!=x}),v.current.currencyCode=x),I?t.popup("Error","Cannot Batch Add to Opportunities with mixed currencies."):v.current.VerifyPriceBooks(k)}}}}),crmc.define("BatchAddCampaignMemberInline",["KendoEntry","KendoPopup","sfdc","CustomSettings"],function(e,t,a,i){return{context:void 0,isValidObject:function(e){switch(e.objectDescribe.name.toLowerCase()){case"lead":return!0;case"contact":return!0;default:return!1}},isAvailable:function(e){var t=!1;return e.selectedRows&&e.selectedRows.length>0&&this.isValidObject(e)&&0!=i.getSetting(e.objectDescribe.name,"batchAddcampaignMember")&&(t=!0),t},getLabel:function(e){return"Campaign Member"+(e.selectedRows.length>1?"s":"")},createSubmenuItems:function(e){return[]},campaignMemberForm:function(){var e=this;$("#kendoCampaignMembers").data("kendoWindow")&&($("#kendoCampaignMembers").data("kendoWindow").destroy(),$("#kendoCampaignMembers").empty());var t="<div id='kendoCampaignMembers' style='display:none; display: inline-block; padding: 0px; padding-bottom:0.6em; text-align:center;'><div style='max-width: 485px; overflow-y:auto; padding:0.6em;'><div id='kendoCMGrid' /></div><span id='cmCreateButton' class='k-button'>Create Campaign Members</span> &nbsp; &nbsp;<span id='cmCloseButton' class='k-button'>Cancel</span></div>",i=t,n={},o=[],r=function(){var e=$("input.cmChk:checked");Object.each(e,function(e){var t=e.id;if(t){t=t.split("_")[1];var a=o.filter(function(e){return e.Id==t});1==a.length&&(n[t]=a[0],n[t].selectedStatus=$("#cmSel_"+t).val().split("=")[0])}})},s=function(){return r(),n};$("body").append(i),$("#kendoCampaignMembers").kendoWindow({draggable:!0,modal:!0,actions:["Close"],title:"Batch Add Campaign Members",height:347,width:500,resizable:!1,close:function(t){e.context.actionGrid.setKeyboardFocus()}}),$("#cmCloseButton").bind("click",function(){$("#kendoCampaignMembers").data("kendoWindow").close().destroy()}),$("#cmCreateButton").bind("click",function(){e.buildRecords(s()),$("#kendoCampaignMembers").data("kendoWindow").close().destroy()});var l=[{title:"",template:'<input class="cmChk" id="cmChk_#= Id #" type="checkbox" #=data.isChecked?"checked":""# >',width:"35px"},{field:"Name",title:"",template:"#= Name #",headerTemplate:'<input id="cmTxtCampaignSearch" type="search" class="k-textbox" placeholder="Search Campaign"/>',attributes:{style:"text-align: left;"}},{field:"Status",title:"Member Status",template:'<select class="cmSel" style="width: 110px" id="cmSel_#= Id #"> # for (var i = 0; i < statuses.length; i++) { # <option value=#= statuses[i].Id #=data.selectedStatus == statuses[i].Id?"selected":""# #>#= statuses[i].Label #</option> # } #</select>',width:"125px"}],d=new kendo.data.DataSource({transport:{read:function(e){r();var t=$("#cmTxtCampaignSearch").val();o=a.query("SELECT Id, Name, Type, StartDate FROM Campaign WHERE IsActive = true "+(t.length>2?" and Name like '%"+t.replace(/'/g,"''")+"%'":"")+"ORDER BY Name LIMIT 100");var i=a.query("SELECT CampaignId, Id, Label FROM CampaignMemberStatus WHERE CampaignId in ('{0}') ORDER BY CampaignId DESC",o.map(function(e){return e.Id}).join("','")),s={};Object.each(i,function(e){s[e.CampaignId]||(s[e.CampaignId]=[]),s[e.CampaignId].push(e)}),Object.each(o,function(e){e.statuses=s[e.Id],e.isChecked=void 0!=n[e.Id],e.selectedStatus=e.isChecked?n[e.Id].selectedStatus:void 0}),e.success(o)}}});$("#kendoCMGrid").data("kendoGrid")&&($("#kendoCMGrid").data("kendoGrid").destroy(),$("#kendoCMGrid").empty()),$("#kendoCMGrid").kendoGrid({dataSource:d,sortable:!0,height:300,columns:l,resizable:!0}),$("#cmTxtCampaignSearch").bind("propertychange keyup input paste",function(){($("#cmTxtCampaignSearch").val().length>2||0==$("#cmTxtCampaignSearch").val().length)&&(clearTimeout($(this).data("timeout")),$(this).data("timeout",setTimeout(function(){$("#kendoCMGrid").data("kendoGrid").dataSource.read()},500)))}),$("#kendoCampaignMembers").data("kendoWindow").center().open(),$(document).on("click","#kendoCMGrid > div.k-grid-content > table > tbody > tr > td:nth-child(2)",function(){var e=$(this.parentElement.children).find('input[type="checkbox"]');e.prop("checked",!e.prop("checked"))}),$("#cmTxtCampaignSearch").on("click",function(e){e.stopPropagation()})},buildRecords:function(e){for(var t=this.context.selectedRows,a=[],i=function(e,t){for(var a=0;a<t.length;a++)if(t[a].Id==e)return t[a].Label},n=0;n<t.length;n++){var o=this;Object.each(e,function(e){var r=new sforce.SObject("CampaignMember");r.CampaignId=e.Id,r[o.context.objectDescribe.name+"Id"]=t[n].Id,r.Status=i(e.selectedStatus,e.statuses),a.push(r)})}this.create(a)},create:function(e){var i=function(e){for(var a=[],i=["<ul> Success: "],n=0,o=0,r=["<ul> Errors:","</br>"],s=0;s<e.length;s++){var l=e[s];if("true"==l.success)n++,a.push(l.id);else if(l.errors){var d=l.errors;d.statusCode&&"DUPLICATE_VALUE"==d.statusCode?o++:void 0!=d&&void 0!=d.message&&r.push(d.message+"</br>")}else r.push("<li>"+l+"</li>")}i[0]=i[0]+n,i.push("</ul>"),i.push("<ul> Duplicates: "+o+"</ul>"),r.length>2?(i=i.concat(r),i.push("</ul>")):i.push(r[0]+" 0</ul>"),console.log(i);var c=[{label:"View Records",click:function(){window.open(kendo.format("/apex/CRMC_PP__crmc_grid?object={0}&Ids={1}","CampaignMember",a.join()))}},{label:"Close"}];t.popupWithButtons("Results",i.join(""),c)};a.batchInsert(e,i)},click:function(e){this.context=e,this.campaignMemberForm()}}}),crmc.define("actions/BatchAdd_UserPackageLicense",["KendoEntry","KendoPopup","sfdc","CustomSettings"],function(e,t,a,i){return{isAvailable:function(e){return!!(e.selectedRows&&e.selectedRows.length>0&&"User"==e.objectDescribe.name)&&i.getSetting(e.objectDescribe.name,"batchAddUserPackageLicense")!==!1},getLabel:function(e){return"AG License"},createSubmenuItems:function(e){return[]},click:function(e){var i=[];e.selectedRows.map(function(e){i.push(e.Id)});var n=a.query("SELECT Id, AllowedLicenses,UsedLicenses,NamespacePrefix,Status FROM PackageLicense WHERE NamespacePrefix = 'CRMC_PP'");if(n&&n[0]){n=n[0];var o=parseInt(n.AllowedLicenses),r=parseInt(n.UsedLicenses);if(o>r){var s=a.query(kendo.format("SELECT Id, UserId FROM UserPackageLicense WHERE PackageLicenseId = '{0}' AND UserId IN('"+i.join("','")+"')",n.Id)),l=o-r,d=i.length-s.length;if(d>0&&d<=l){for(var c=[],u=function(e){for(var t=0;t<s.length;t++)if(s[t].UserId==e)return!0;return!1},p=0;p<i.length;p++)if(!u(i[p])){var f=new sforce.SObject("UserPackageLicense");f.UserId=i[p],f.PackageLicenseId=n.Id,c.push(f)}var m=function(e){for(var a=[],i=["<ul> Success: "],n=0,o=["<ul> Errors:","</br>"],r=0;r<e.length;r++){var l=e[r];"true"==l.success?(n++,a.push(l.id)):l.errors&&void 0!==l.errors.message?o.push(l.errors.message+"</br>"):o.push("<li>"+l+"</li>")}i[0]=i[0]+n,i.push("</ul>"),i.push("<ul> Already Converted: "+s.length+"</ul>"),o.length>2?(i=i.concat(o),i.push("</ul>")):i.push(o[0]+" 0</ul>"),console.log(i);var d=[{label:"View Records",click:function(){window.open(kendo.format("/apex/CRMC_PP__crmc_grid?object={0}&Ids={1}","UserPackageLicense",a.join()))}},{label:"Close"}];t.popupWithButtons("Results",i.join(""),d)};a.batchInsert(c,m)}else{var h="";h=0===d?"All Selected users have a license.":"Selected users without a license exceeds the availability of unssigned licenses.",t.popupWithButtons("Available: "+n.AllowedLicenses+", Selected w/out License: "+d,h,[{label:"Ok"}],{width:400})}}else t.popupWithButtons("Warning: Out of Licenses","Please get more licenses or remove some users.",[{label:"Ok"}])}else t.popupWithButtons("Error Querying Data",n.toString(),[{label:"Ok"}])}}}),crmc.define("actions/BatchAdd_PermissionSetAssignment",["KendoEntry","KendoPopup","sfdc","CustomSettings"],function(e,t,a,i){return{isAvailable:function(e){return!!(e.selectedRows&&e.selectedRows.length>0&&"User"==e.objectDescribe.name)&&i.getSetting(e.objectDescribe.name,"batchAddPermissionSetAssignment")!==!1},getLabel:function(e){return"Permission Set"},createSubmenuItems:function(e){return[]},click:function(i){var n=[];i.selectedRows.map(function(e){n.push(e.Id)});var o=function(e){for(var i=[],o=0;o<n.length;o++){var r=new sforce.SObject("PermissionSetAssignment");r.AssigneeId=n[o],r.PermissionSetId=e,i.push(r)}var s=function(e){for(var a=[],i=["<ul> Success: "],n=0,o=0,r=["<ul> Errors:","</br>"],s=0;s<e.length;s++){var l=e[s];"true"==l.success?(n++,a.push(l.id)):l.errors&&l.errors.statusCode&&"DUPLICATE_VALUE"==l.errors.statusCode?o++:l.errors&&void 0!==l.errors.message?r.push(l.errors.message+"</br>"):r.push("<li>"+l+"</li>")}i[0]=i[0]+n,i.push("</ul>"),i.push("<ul> Already in Set: "+o+"</ul>"),r.length>2?(i=i.concat(r),i.push("</ul>")):i.push(r[0]+" 0</ul>");var d=[{label:"View Records",click:function(){window.open(kendo.format("/apex/CRMC_PP__crmc_grid?object={0}&Ids={1}","UserPackageLicense",a.join()))}},{label:"Close"}];t.popupWithButtons("Results",i.join(""),d)};a.batchInsert(i,s)};try{var r=a.query("SELECT Id,Label,Name,NamespacePrefix FROM PermissionSet")}catch(e){t.popup("Error","User does not have access to Permission Sets")}if(r.length>0){var s=function(){for(var e,t=[],a=0;a<r.length;a++){var i=r[a],n="ActionGrid_Users"==i.Name&&"CRMC_PP"==i.NamespacePrefix;e=i.Name.length>20?i.Name.substring(0,14)+"...":i.Name;var o=i.Label+" ("+e+")";i.Name!="X"+i.Label&&t.push({active:"true",defaultValue:n,label:o,value:i.Id})}return t};e.entry("BatchAdd Permission Set",[{name:"PermissionSet",label:"Permission Set",type:"picklist",values:s(),required:!1}],{width:350},null,function(e){o(e.PermissionSet.value)})}else t.popupWithButtons("WARNING","There are no available PermissionSet objects",[{label:"Close"}])}}}),crmc.define("BatchAddNew",["sfdc","KendoPopup","KendoEntry","BatchAddCampaignMemberMenuItem","CustomSettings","GridConstants","FollowMenuItem","actions/BatchAdd_PriceBook_LineItems","BatchAddCampaignMemberInline","actions/BatchAdd_UserPackageLicense","actions/BatchAdd_PermissionSetAssignment","Notification"],function(e,t,a,i,n,o,r,s,l,d,c,u){var p={init:function(e){var t=this;Object.each(e,function(e,a){t[a]=e})},getLabel:function(e){return this.label},isAvailable:function(e){return e.objectDescribe.name!==this.name},getEntryFields:function(t,a){var i;try{i=e.getSObjectDescribe(this.name),this.meta=i}catch(e){}if(i){var n=[],o=[];return o=!t||t.length<1?this.entryFields:t,"Task"==this.name&&n.push({name:"assignToRecordOwner__crmc",label:"Assign To Record Owner",type:"boolean"}),Object.each(o,function(e){Object.each(i.fields,function(t){if(t.name==e){var a={name:t.name,label:t.label,type:t.type,values:t.picklistValues,referenceTo:t.referenceTo};"Task"==i.name&&"OwnerId"==t.name?(a.validate=function(e){var t=Object.first(e,function(e){return"assignToRecordOwner__crmc"==e.name});return this.value||t.value?null:'Please select an "Assigned To ID" or check "Assign To Record Owner"'},a.filter=[{field:"IsActive",operator:"eq",value:"true"},{field:"UserType",operator:"eq",value:"Standard"}]):"false"==t.nillable&&(a.required=!0,a.validate=function(e){return null==this.value||""===this.value?this.label+" is a required field!":null}),n.push(a)}})}),n}},click:function(i){var n=this;e.executeRemoteAction("getFieldSetDescribe",[this.name,this.fieldSet||""],function(r,s){if(s.status)if(i.selectedRows.length>0){var l="Batch ";n.label&&(l+=n.label);var d=n.getEntryFields(r,s);a.entry(l,d,{grid:i.actionGrid,objectName:n.name,displayResults:!0},i.actionGrid.settings,function(a){var r=[],s=[];if(Object.each(i.selectedRows,function(e){var t=new sforce.SObject(n.name);Object.each(n.mappedFields,function(a){t[a.name]=e[a.mappedName]}),Object.each(a,function(a){if("assignToRecordOwner__crmc"==a.name)a.value&&(e.OwnerId?t.OwnerId=e.OwnerId:s.push(e.Id));else{if("OwnerId"==a.name&&(t[a.name]||""==a.value))return;t[a.name]=a.value}}),r.push(t)}),s.length>0){var d=e.query("Select OwnerId, Id FROM "+i.actionGrid.settings.pageInfo.objectName+" WHERE Id in ('"+s.join("','")+"')");Object.each(d,function(e){Object.each(r,function(t){e.Id==(t.WhoId||t.WhatId)&&(t.OwnerId=e.OwnerId)})})}var c=function(a){for(var r,s=0,d=0,c=[],p=[],f=0;f<a.length;f++){var m=a[f];"true"==m.success?(s++,p.push(m.id)):(d++,void 0!=m.errors&&void 0!=m.errors.message&&(r||(r=e.getSObjectNameField(e.getSObjectDescribe(i.actionGrid.settings.pageInfo.objectName))),c.push('<a href="'+e.getRecordURL(i.selectedRows[f].Id)+'" target="_blank">'+i.selectedRows[f][r]+"</a> | "+m.errors.message)))}var h="Successfully created "+s+" record"+(1==s?"":"s")+"!",g=function(){var t={object:n.name,viewTitle:encodeURIComponent("Batch Add Results")},a=o.namespace;if(p.length>200){var i={Ids:p.join()};e.postToVFPage(a,o.VF_PAGE_NAME,t,i,!1,"_BLANK")}else t.Ids=p.join(),e.navigateToVFPage(a,o.VF_PAGE_NAME,t,!1,"_BLANK")},v=e.getUserInfo(),b=localStorage.getItem(kendo.format("{0}_{1}_{2}_{3}",v.organizationId,n.name,l.replace(" ",""),"displayResults"));if(0==d)u.showMessage({title:"Success",message:h},"success"),b||g();else{var y=[];0==s?(h="Batch Add Unsuccessful!",y.push({label:"Ok"})):y.push({label:"Yes",click:function(){g()}},{label:"No"}),d>0&&(h+="\n The following errors occurred: <br /><ul><li>"+c.join("\n</li><li>")+'</li></ul><br /> Contact <a href="mailto:support@getactiongrid.com">support@getactiongrid.com</a>'),p.length>0&&(h+="\n <br /> Would you like to ActionGrid the results?"),t.popupWithButtons("Batch Add Results",h,y)}};e.batchInsert(r,c)})}else t.popup("Please select records","Select at least one record to Batch Add to.");else t.popup("Error Retrieving FieldSet",s.message)})}},f=Object.create(p);f.init({label:"Task",name:"Task",entryFields:["OwnerId","Subject","ActivityDate","Status","Priority","Description"],fieldSet:"crmc_Batch_Add"}),f.isAvailable=function(e){var t=!1;if(n.getSetting(e.objectDescribe.name,"batchAddTask")!==!1){var a=(e.objectDescribe.name,"WhatId");Object.each(e.objectDescribe.childRelationships,function(i){"Task"==i.childSObject&&("WhatId"==i.field||"WhoId"==i.field&&"Account"!=e.objectDescribe.name)&&(t=!0,a=i.field)}),this.mappedFields=[{name:a,mappedName:"id"}]}return t};var m=Object.create(p);m.init({label:"Note",name:"Note",entryFields:["IsPrivate","Title","Body"],fieldSet:"crmc_Batch_Add",mappedFields:[{name:"ParentId",mappedName:"id"}]}),m.isAvailable=function(e){var t=!1,a=this,i=Object.first(e.objectDescribe.childRelationships,function(e){return e.childSObject==a.name});return i&&(t=n.getSetting(e.objectDescribe.name,"batchAddNote")!==!1),t};var h=Object.create(p);h.init({label:"Chatter",name:"FeedItem",entryFields:["Body"],fieldSet:"crmc_Batch_Add",mappedFields:[{name:"ParentId",mappedName:"id"}]}),h.isAvailable=function(e){var t=!1,a=this,i=Object.first(e.objectDescribe.childRelationships,function(e){return e.childSObject==a.name});return i&&(t=n.getSetting(e.objectDescribe.name,"batchAddChatter")!==!1),t};var g={submenus:[h,r,m,f,s,l,d,c],isAvailable:function(e){var t=!1;return Object.each(this.submenus,function(a){a.isAvailable(e)&&(t=!0)}),t},getLabel:function(e){return"Batch Add..."},createSubmenuItems:function(e){return this.submenus},click:function(){}};return g}),crmc.define("MassUpdateMenuItem",["sfdc","KendoPopup","marketing","CustomSettings"],function(e,t,a,i){return{appName:"CRMC_MassUpdate",pageName:"crmcMassUpdate",getAppNamespace:function(){return this.appName},getLabel:function(e){return"Mass Update - Secure"},isAvailable:function(e){return i.getSetting(e.objectDescribe.name,"massUpdate")!==!1},click:function(a){var i=document.getElementsByTagName("HEAD").item(0),n=document.createElement("script");n.type="text/javascript",i.appendChild(n);var o={ts:(new Date).getTime()};n.src=e.getStaticResourceURL(this.getAppNamespace(),"CRMC_MassUpdate__MassUpdate",o);var r=this,s=function(){if(a.selectedRows.length>0){var i=[];Object.each(a.selectedRows,function(e){i.push(e.Id)});var n={retURL:a.actionGrid.settings.pageURL},o={Ids:i.join()};e.postToVFPage(r.getAppNamespace(),r.pageName,n,o,!1)}else t.popup("Please select records","Select at least one record to update.")};n.onerror=function(e){console.log(e),s()},n.onload=function(){s()}},init:function(e,t){}}}),crmc.define("AWMergeMenuItem",["sfdc","KendoPopup","marketing","CustomSettings"],function(e,t,a,i){return{appName:["dupcheck","awduplicate2"],getAppNamespace:function(){return this.appName},getLabel:function(e){return"Merge"},isAvailable:function(e){return i.getSetting(e.objectDescribe.name,"merge")!==!1},click:function(a){if(a.selectedRows.length>1){var i=[];Object.each(a.selectedRows,function(e){i.push(e.Id)});var n={object:a.objectDescribe.name,ids:i.join(),retURL:a.actionGrid.settings.pageURL},o="awduplicate2"===this.appName,r=o?"awduplicatemerge":"dc3Merge";e.navigateToVFPage(this.appName,r,n,!0)}else t.popup("Please select records","Select at least two records merge.")},init:function(e,t){}}}),crmc.define("KendoPromptBox",["GridConstants"],function(e){return{promptBox:function(t,a,i,n,o,r){var s=e.UNIQUE_ID++,l=kendo.template("<div id='KendoPopupBox#=uniqueid#' style='display:none;'><p>#= val # : &nbsp;&nbsp; <input type='text' id='txtSaveValue#=uniqueid#' style='width: 200px;' value='#= defaultValue #'/></p><div style='float:right;'><span id='closeWindow#=uniqueid#' class='k-button'>Dismiss</span>&nbsp;#if (confirmText) {#<span id='confirmWindow#=uniqueid#' class='k-button'>#=confirmText#</span># } #</div></div>"),d={val:a,uniqueid:s,confirmText:i,defaultValue:r},c=l(d);$("body").append(c);var u=$("#closeWindow"+s),p=$("#KendoPopupBox"+s);if(u.bind("click",function(){p.data("kendoWindow").close()}),i){var f=$("#confirmWindow"+s);f.bind("click",function(){n($("#txtSaveValue"+s).val(),o),p.data("kendoWindow").close()})}p.data("kendoWindow")||p.kendoWindow({draggable:!0,modal:!0,resizable:!1,actions:["Close"],title:t}),p.data("kendoWindow").center().open()}}}),crmc.define("BatchAddToEmmaGroup",["sfdc","marketing","KendoPopup","KendoEntry","KendoPromptBox","CustomSettings"],function(e,t,a,i,n,o){var r={appName:"emma",getAppNamespace:function(){return this.appName},isAvailable:function(e){return("Contact"==e.objectDescribe.name||"Lead"==e.objectDescribe.name)&&o.getSetting(e.objectDescribe.name,"batchAddEmma")},getLabel:function(e){return"Emma Group"},createSubmenuItems:function(e){},click:function(t){if(t.selectedRows.length>0){var o="Add To Emma Group ";i.entry(o,[{name:"emmaGroup",label:"Select Emma Group (Leave blank for new)",referenceTo:"emma__Emma_Group__c",type:"reference"}],null,t.actionGrid.settings,function(i){var o=i.emmaGroup.value,r=function(t,a){if(void 0!==t&&""!=t){var i=new sforce.SObject("emma__Emma_Group__c");i.Name=t,e.insert(i,s,s)}},s=function(i){if(void 0!==i){if("true"!=i.success)return void a.popup("Error Creating Emma Group",i.errors.message);o=i.id}var n=[];Object.each(t.selectedRows,function(e){var a=new sforce.SObject("emma__Emma_Group_Member__c");"Contact"==t.objectDescribe.name?a.emma__Contact__c=e.Id:"Lead"==t.objectDescribe.name&&(a.emma__Lead__c=e.Id),a.emma__Emma_Group__c=o,n.push(a)});var r=function(e){
var t=0,i=0,n=0,o=[];e instanceof Array||(e=[e]),Object.each(e,function(e){"true"==e.success?t++:void 0!=e.errors&&"DUPLICATE_VALUE"==e.errors.statusCode?n++:void 0!=e.errors&&void 0!=e.errors.message&&(i++,o.push(e.errors.message))});var r="Successfully added "+t+" Emma Group Member"+(1==t?"":"s")+"!";0==t&&(r="Add To Emma Group Unsuccessful!"),n>0&&(r+="\n <br />"+n+" duplicate"+(1==n?"":"s")+" were skipped."),i>0&&(r+="\n The following errors occurred: <br /><ul><li>"+o.join("\n</li><li>")+'</li></ul><br /> Contact <a href="mailto:support@getactiongrid.com">support@getactiongrid.com</a>'),a.popup("Add To Emma Group Results",r)};e.insert(n,r,r,!0)};void 0===o||""===o?n.promptBox("New Emma Group","Emma Group Name","Save",r,t.actionGrid,""):s()})}else a.popup("Please select records","Select at least one record to add to an Emma group.")}};return r}),crmc.define("Geopointe",["sfdc","marketing","KendoPopup","CustomSettings"],function(e,t,a,i){var n={appName:"geopointe",maxRows:750,getAppNamespace:function(){return this.appName},getLabel:function(e){return"Geopointe"},isAvailable:function(e){return i.getSetting(e.objectDescribe.name,"geopointe","action")!==!1},click:function(t){var i=document.getElementsByTagName("HEAD").item(0),o=document.createElement("script");o.type="text/javascript",i.appendChild(o);var r={ts:(new Date).getTime()};o.src=e.getStaticResourceURL(n.appName,n.appName+"__GeopointeJS_mq",r);var s=function(){if(t.selectedRows.length>n.maxRows)a.popup("Max Records Limit!","Currently, we don't allow more than "+n.maxRows+" records to be mapped!");else if(t.selectedRows.length>0){var i=[];Object.each(t.selectedRows,function(e){i.push(e.Id)}),e.postToVFPage(n.appName,"Map",void 0,{idArray:i},!0)}else a.popup("Please select records","Select at least one record to view in Geopointe")};o.onerror=function(){s()},o.onload=function(){s()}}};return n}),crmc.define("BatchDelete",["KendoPopup","CustomSettings","sfdc","Notification"],function(e,t,a,i){var n={isAvailable:function(e){return e.selectedRows.length>0&&"true"===e.objectDescribe.deletable&&1==t.getSetting(e.objectDescribe.name,"batchDelete")},getLabel:function(e){return"Delete Records"},createSubmenuItems:function(e){},click:function(t){var n=t.selectedRows,o=t.actionGrid.kendoGrid.dataItems();n.length>0&&void 0!=o[0].Id&&""==o[0].Id?e.popupWithButtons("Warning","Unsaved rows selected, Save before continuing.",[{label:"Ok"}],{width:260}):e.popupWithButtons("Confirm Deletion",kendo.format('<span style="font-size:150%;font-weight:bold;color:red;">ATTENTION!!!</span><p>You\'ve selected <b><u>{0} record{1}</u></b> for deletion.</p><p>The selected record{1} and <u><b>all related child records</b></u> will be deleted.</p><p>Depending on your organization\'s storage limits and length of time in<br/>the Recycle Bin, it is not always possible to recover deleted records.</p><p style="font-size:125%;font-weight:bold">Are you sure you want to proceed?</p>',n.length,n.length>1?"s":""),[{label:"Yes",click:function(){kendo.ui.progress($("#"+t.actionGrid.settings.id),!0);var o=[],r=$.map(n,function(e){return[e.Id]});a.batchDelete(r,function(a){for(var n=0,r=0,s=0;s<a.length;s++){var l=a[s];if(l&&"true"==l.success)r++;else{var d=l.getArray("errors");d.length>0&&o.push(d[0].message.replace(/\r\n/g,"<br/>").replace(/[\r\n]/g,"<br/>")),n++}}var c;n>0?(c="Succeeded: "+r+"<br/>Failed: "+n+"<br/> Due to:<br/><br/>"+o.join("<br/>"),e.popup("Deletion Results",c)):(c="Number of records deleted: "+r,i.showMessage({title:"Record"+(1===r?"":"s")+" Deleted",message:c},"success")),kendo.ui.progress($("#"+t.actionGrid.settings.id),!1),t.actionGrid.gridDataSource.read(),t.actionGrid.getElement("check-all").attr("checked",!1)})}},{label:"Cancel",click:function(){}}])}};return n}),crmc.define("ListBrowse",["sfdc","marketing","KendoPopup","CustomSettings"],function(e,t,a,i){var n={appName:"taf_listbrowse",maxRows:1e3,getAppNamespace:function(){return this.appName},getLabel:function(e){return"List Browse"},isAvailable:function(e){return i.getSetting(e.objectDescribe.name,"taf_listbrowse","action")!==!1},click:function(t){var i=$('<iframe style="display:none;"/>').appendTo($("body"));$(i).attr("src","/apex/taf_listbrowse__ListBrowse?"),i[0].onload=function(){if(t.selectedRows.length>n.maxRows)a.popup("Max Records Limit!","Currently, we don't allow more than "+n.maxRows+" records to be mapped!");else if(t.selectedRows.length>0){var o=[];Object.each(t.selectedRows,function(e){o.push(e.Id)}),e.postToVFPage(n.appName,"ListBrowse",void 0,{rids:o.join("$")},!0)}else a.popup("Please select records","Select at least one record to browse");$(i).remove()}}};return n}),crmc.define("MapAnything",["sfdc","marketing","KendoPopup","CustomSettings","KendoEntry"],function(e,t,a,i,n){var o={appName:"sma",maxRows:1e3,getAppNamespace:function(){return this.appName},getLabel:function(e){return"MapAnything"},isAvailable:function(e){return i.getSetting(e.objectDescribe.name,"sma","action")!==!1},click:function(i){var r=document.getElementsByTagName("HEAD").item(0),s=document.createElement("script");s.type="text/javascript",r.appendChild(s);var l=window.location.hostname.split(".");3==l.length?instance=l[0]:instance=l[1],s.src=String.format("https://{0}.{1}.visual.force.com/resource/{0}__MADemographicsJS?ts={2}",o.appName,instance,(new Date).getTime()),s.onerror=function(){t.missingApp(o.appName)},s.onload=function(){if(i.selectedRows.length>o.maxRows)a.popup("Max Records Limit!","Currently, we don't allow more than "+o.maxRows+" records to be mapped!");else{var t=[];Object.each(i.selectedRows,function(e){t.push(e.Id)});var r=function(n){var r=Object.copy(i.actionGrid.settings.pageInfo);if(!(r.filterId||r.sorts&&0!==r.sorts.length)){var s=e.getSObjectNameField(i.objectDescribe);s&&(r.sorts=[{field:s,dir:"asc"}])}r.filter&&r.filter.filters&&r.filter.filters.length&&r.filter.filters.map(function(t){if(t&&t.value&&t.value instanceof Date){var a=e.getDateWithOffset(t.value,e.getProfileTimezoneOffset());t.value=a.toISOString()}}),void 0!==i.actionGrid.settings.baseFilter&&(void 0===r.filter&&(r.filter={logic:"and"}),r.filter||(r.filter={}),void 0===r.filter.filters&&(r.filter.filters=[]),r.filter.filters.push(i.actionGrid.settings.baseFilter)),delete r.displayColumns,delete r.childGridSettings,t.length>0&&(r.selectedRecordIds=t);e.getNamespace(!1);e.executeRemoteAction("getResultSOQL",[r],function(t,r){if(r.status){var s,l=e.query("SELECT Name, sma__User__c,  Id FROM sma__MASavedQry__c WHERE Name = 'ActionGrid "+i.objectDescribe.name+"' AND sma__User__c = '"+e.getUserInfo().userId+"' AND IsDeleted = false");s=l.length<1?new sforce.SObject("sma__MASavedQry__c"):l[0],s.Name="ActionGrid "+i.objectDescribe.name,s.sma__User__c=e.getUserInfo().userId,s.sma__ActivityFilter__c='{"operator":"AND","task":"all","event":"all"}',s.sma__AdvancedOptions__c='{"selectType" : "MILES","enableProxLimit" : "false","enableLimit" : "false","address" : "","distance" : ""}',s.sma__BaseObject__c=n,s.sma__ColorAssignmentType__c="Static",s.sma__ProximityOptions__c='{ "hideMarkers" : "false", "selectType" : "circle", "radius" : "", "measurementType" : "MILES", "affectVisibility" : "true", "enabled" : "false" }',s.sma__OwnerFilterId__c="All",s.sma__IconColor__c="#00FF00:Marker",s.sma__Tooltip1__c=e.getSObjectNameField(i.objectDescribe)||"";var d=t.resultSOQL.split(" from ");s.sma__Query__c="FROM "+d[d.length-1].split(" order by ")[0],s.sma__Query__c.indexOf(" where ")<0&&(s.sma__Query__c+=" where Id != ''");var c=function(t){t.getBoolean("success")?e.navigateToVFPage(o.appName,"MapAnything",{layerid:t.id},!1,"_blank"):a.popup("Metadata Error",t.message)};e.upsert("Id",s,c,c)}else a.popup("Metadata Error",r.message)},{escape:!1,buffer:!1})},s=e.query("SELECT Id,Name FROM sma__MABaseObject__c WHERE Name = '"+i.objectDescribe.name+"'");if(1==s.length)r(s[0].Id);else{n.entry("MapAnything Base Object",[{name:"baseObject",label:"Select Base Object",referenceTo:"sma__MABaseObject__c",type:"reference",filter:[{field:"Name",operator:"eq",value:i.objectDescribe.name}]}],null,i.actionGrid.settings,function(e){var t=e.baseObject;r(t)})}}}}};return o}),crmc.define("CongaConductor",["sfdc","marketing","KendoPopup","KendoEntry","CustomSettings"],function(e,t,a,i,n){var o=function(t,i,o,r){return{appName:["APXTConga4","Conga_SE"],objectName:t,fieldName:i,label:o,type:r,getAppNamespace:function(){return this.appName},isAvailable:function(e){var t="congaConductor"==this.type&&e.selectedRows.length>1||"congaComposer"==this.type&&1==e.selectedRows.length;return t&&e.objectDescribe.name==this.objectName&&0!=n.getSetting(this.objectName,"conga__"+this.fieldName)},getLabel:function(e){return this.label},createSubmenuItems:function(e){},createButtonUrl:function(e,t){var a=window.location.hostname;return a="https://"+a+"/servlet/servlet.Integration?lid="+t,e&&(a+="&eid="+e),a+"&ic=1"},click:function(t){if(!(t.selectedRows.length>0))return void a.popup("Please select records","Select at least one record to send to Conga.");var i="";Object.each(t.selectedRows,function(e){i.length>0&&(i+=","),i+=e.Id});var n;if("congaComposer"==this.type){if(1==t.selectedRows.length)if(this.fieldName.indexOf("buttonId__")>-1)n=this.createButtonUrl(t.selectedRows[0].Id,this.fieldName.split("buttonId__")[1]);else if(n=t.selectedRows[0][this.fieldName],!n){var o=e.query("Select "+this.fieldName+", Id FROM "+this.objectName+" WHERE Id ='"+t.selectedRows[0].Id+"'");1==o.length&&(n=o[0][this.fieldName])}}else{if(this.fieldName.indexOf("buttonId__")>-1){n=this.createButtonUrl(void 0,this.fieldName.split("buttonId__")[1]);var r=document.createElement("form");return r.method="post",r.action=n,r.setAttribute("target","_blank"),Object.each(t.selectedRows,function(e){var t=document.createElement("input");t.type="hidden",t.name="ids",t.value=e.Id,r.appendChild(t)}),document.body.appendChild(r),void r.submit()}n="https://conductor.congamerge.com?MOID="+i+"&SessionId="+sforce.connection.sessionId+"&ServerUrl="+t.actionGrid.settings.Partner_Server_URL_290+"&UrlFieldName="+this.fieldName}n.toLowerCase().indexOf("https://")<0&&(n="https://composer.congamerge.com?SessionId="+sforce.connection.sessionId+"&ServerURL="+t.actionGrid.settings.Partner_Server_URL_290+"&"+n),window.open(n,"Conga","width=700,height=450,menubar=0")}}},r={subMenus:void 0,appName:["APXTConga4","Conga_SE"],getAppNamespace:function(){return this.appName},isAvailable:function(e){var t=!1;return this.createSubmenuItems(e),Object.each(this.subMenus,function(a){a.isAvailable(e)&&(t=!0)}),t},getLabel:function(e){return"Conga"},createSubmenuItems:function(t){if(!this.subMenus){this.subMenus=[];var a=this,i=e.getNamespace(!0),n=e.query("SELECT Id, Name, {0}JSON__c, {0}Setting_Name__c, {0}Table_Name__c, {0}Setting_Type__c FROM {0}Grid_Setting__c WHERE isDeleted = false AND ({0}Setting_Type__c = 'congaConductor' OR {0}Setting_Type__c = 'congaComposer')",i);Object.each(n,function(e){var t=e[i+"Table_Name__c"];try{t=JSON.parse(unescape(e[i+"JSON__c"]))}catch(e){}a.subMenus.push(o(e[i+"Table_Name__c"],e[i+"Setting_Name__c"],t,e[i+"Setting_Type__c"]))})}return this.subMenus},click:function(e){}};return r}),crmc.define("SummarizeAction",["CustomSettings","ColumnFactory","KendoPopup"],function(e,t,a){var i={getLabel:function(e){return this.metadata.title},click:function(e){var t=this.metadata.formula,i=function(i,n){if(e.actionGrid.gridDataSource&&e.selectedRows.length==e.actionGrid.gridDataSource.pageSize()){var o=t?"Warning":"Summarize Column",r=t?"Summarize column cannot summarize formula fields beyond the current page":"Would you like to summarize all results matching the current filter </br>or only the selected results?",s=[{label:"Selected Results",click:function(){e.actionGrid.summarizeColumn(i,n,t)}},{label:"Cancel"}];t||s.unshift({label:"All Results",click:function(){e.actionGrid.summarizeColumn(i)}}),a.popupWithButtons(o,r,s)}else t?e.actionGrid.summarizeColumn(i,n,!0):e.actionGrid.summarizeColumn(i,n)},n=[];Object.each(e.selectedRows,function(e){n.push(e.Id)}),i(t?this.metadata.field:this.metadata.name,n)}},n={itemID:"summarizeColumn",featureSecurity:e,isAvailable:function(e){var t=this.createSubmenuItems(e);return t&&t.length>0&&e.selectedRows&&e.selectedRows.length>1&&this.featureSecurity.getSetting(e.objectDescribe.name,this.itemID)!==!1},isHeaderAvailable:function(e){return e.selectedColumn&&e.selectedColumn.aggregates.length>1&&this.featureSecurity.getSetting(e.objectDescribe.name,this.itemID)!==!1},getLabel:function(e){return"Summarize Column"},createSubmenuItems:function(e){if(void 0==e.selectedColumn){var t=Object.where(e.actionGrid.columns,function(e){var t=function(e){switch(e){case"integer":case"currency":case"double":case"number":case"int":case"decimal":return!0;default:return!1}};return e.schema?t(e.schema.type.toLowerCase()):e.formula?t(e.formula.type.toLowerCase()):void 0}),a=[];return Object.each(t,function(e){var t=Object.create(i);t.metadata=e,a.push(t)}),a}},click:function(e){void 0!=e.selectedColumn&&e.selectedColumn&&e.selectedColumn.aggregates.length>0&&(e.selectedRows.length>0?summarize(e,e.selectedColumn.name,e.selectedRows.map(function(e){return e.Id})):e.actionGrid.summarizeColumn(e.selectedColumn.name))}};return n}),crmc.define("BatchClone",["KendoEntry","KendoPopup","sfdc","CustomSettings","ColumnFactory","ForeignKeyControl","Notification"],function(e,t,a,i,n,o,r){return{actions:[],context:void 0,isAvailable:function(e){return!!(e.selectedRows.length>0&&e.objectDescribe&&["true",!0].indexOf(e.objectDescribe.createable)>-1&&e.objectDescribe&&["true",!0].indexOf(e.objectDescribe.updateable)>-1)&&i.getSetting(e.objectDescribe.name,"batchClone")!==!1},getLabel:function(e){return"Clone"},createSubmenuItems:function(e){return this.actions},inLineEditMode:function(){return this.context.selectedRows.length>0&&void 0!=this.context.selectedRows[0].Id&&""==this.context.selectedRows[0].Id},saveGridMessage:function(){t.popupWithButtons("Warning","Unsaved rows selected, Save before continuing.",[{label:"Ok"}],{width:260})},getRowIds:function(e){var t=[];return e.map(function(e){t.push(e.Id)}),t},getFields:function(e){for(var t=this,a=[],i=[],o={name:"",label:"",type:void 0,required:!1,createable:!0,updateable:!0},r=t.context.objectDescribe.name,s=t.context.actionGrid,l=0;l<e.length;l++){var d=e[l];if("urn:address"!=d.soapType){var c=function(e){var t=Object.create(o);t.name=d.name;var r=Object.first(s.columns,function(e){return e.name==d.name});t.label=r&&r.title||n.getHeaderTitle(d,s.fieldMeta)||d.label,t.type=d.type,d.getBoolean("createable")||(t.createable=!1),d.getBoolean("updateable")||(t.updateable=!1),e?t.required=!0:t.required=!d.getBoolean("nillable"),t.reparentable=t.createable&&"reference"==t.type&&!t.updateable,t.createable&&!t.updateable&&"reference"==t.type?a.push(t):i.push(t)};if("OpportunityLineItem"==r||"OrderItem"==r||"QuoteLineItem"==r)switch(d.name){case"UnitPrice":c(!0);break;case"TotalPrice":break;default:c()}else c()}}t._reparentable=a.length>0;var u=function(e,t){var a=e.label.toLowerCase(),i=t.label.toLowerCase();return a<i?-1:a>i?1:0};return i=i.sort(u),a=a.sort(u),a.concat(i)},clone:function(e,i,n){function o(){return[{label:"Ok"}]}var s=this,l=parseInt(i),d=[],c={};if(Object.each(e,function(e){var t=!1;e.createable||(t=!0),t||d.push(e.name),"reference"==e.type&&e.Id&&(c[e.name]=e.Id)}),l*s.context.selectedRows.length<=200){s.context.kendoGrid._progress&&s.context.kendoGrid._progress(!0);for(var u=s.getRowIds(s.context.selectedRows),p=a.query(kendo.format("SELECT {0} FROM "+s.context.objectDescribe.name+" WHERE Id IN('"+u.join("','")+"')",d.join(", "))),f=[],m=0;m<p.length;m++){for(var h=new sforce.SObject(s.context.objectDescribe.name),g=0;g<d.length;g++)null!=p[m][d[g]]&&(h[d[g]]=c[d[g]]?c[d[g]]:p[m][d[g]]);for(var g=0;g<l;g++)f.push(h)}var v=function(e){try{return"<li> Status Code: "+e.statusCode+", Message: "+e.message+"</li>"}catch(e){alert("Error: "+e)}},b=function(e){function a(e){return s.context.kendoGrid._progress&&s.context.kendoGrid._progress(!1),[{label:"Send To Console",click:function(){$.each(e,function(e,t){t.errors&&console.log(t.errors)})}},{label:"Ok"}]}var i=[],o=["<style>div.overflow{overflow: auto; max-height: 600px;}</style><div><div class='overflow'><ul>"];if($.each(e,function(e,t){return t.errors?void o.push(v(t.errors)):void i.push(t.id)}),e.length==i.length){if(s.context.kendoGrid._progress&&s.context.kendoGrid._progress(!1),n)window.open(kendo.format("/apex/CRMC_PP__crmc_grid?object={0}&Ids={1}",s.context.objectDescribe.name,i.join()));else{var d=kendo.format("{0} Selected record"+(1===u.length?"":"s")+" cloned, "+l+" time"+(l>1?"s each":u.length>1?" each.":"."),u.length);r.showMessage({title:"Record"+(1===u.length?"":"s")+" Cloned",message:d},"success")}s.context.actionGrid.refresh()}else o.push("</ul></div></div>"),t.popupWithButtons("Batch Clone Errors",o.join(""),a(e),{width:700})};sforce.connection.create(f,{onSuccess:b,onFailure:b})}else{var y=["<ul>","<li> Total created records cannot exceed 200.</li>",,"<li> Example: 10 Rows cloned 5 times is 50 new records - Ok</li>","<li> Example: 10 Rows cloned 25 times is 250 new records - Limit exceeded</li>","</ul>"].join("");t.popupWithButtons("Limit Exceeded",y,o(),{width:480})}},ui:function(){var e=this,t=e.context.actionGrid.settings.id,i="clone_window",n=e.context.actionGrid.getElementId(i),r="clone_window_grid",s=t+"_"+r,l=s+"_fKControl",d=s+"_checkboxResults",c=s+"_cloneButtonApply",u=s+"_cloneButtonCancel",p=s+"_cloneChk",f=s+"_txtFieldSearch",m=s+"_cloneAmount",h=window.innerHeight<=580?window.innerHeight-60:538,g=function(e){return"#"+e};$(n).data("kendoWindow")&&($(n).data("kendoWindow").destroy(),$(n).empty());var v=localStorage[r];e._localStorage=v?JSON.parse(v):{displayResults:!0},$("body").append(kendo.format('<div id="{0}_{1}" style="display:none; text-align:center;">{2}{3}</div>',t,i,kendo.format('<div style="width:100%; padding:0.3em;"><div id="{0}"></div></div>',s),"<div style='padding-top:0.3em;'>"+kendo.format("Display Results <input id='{0}' type='checkbox' {1}/> &nbsp; &nbsp;",d,e._localStorage.displayResults?"checked='checked'":"")+kendo.format("<span id='{0}' class='k-button'> Create Clones </span> &nbsp; &nbsp;",c)+kendo.format("<span id='{0}' class='k-button'> Cancel </span><",u)+"/div>")),n=$(n).kendoWindow({title:"Clone Options",actions:["Close"],height:h,maxHeight:h,minHeight:h,width:615,visible:!1,animation:{open:{effects:"fade:in"}},close:function(t){e.context.actionGrid.setKeyboardFocus()}}),n.data("kendoWindow").center().open();var b=e.context.actionGrid.getElementId(r);$(b).data("kendoGrid")&&($(b).data("kendoGrid").destroy(),$(b).empty()),e._fields=e.getFields(e.context.objectDescribe.fields);var y={data:e._fields};e._reparentable&&(y.group={field:"reparentable",dir:"desc"}),e._dataSource=new kendo.data.DataSource(y),$(b).kendoGrid({selectable:!1,height:""+h-65+"px",columns:[{field:"reparentable",hidden:!0,groupHeaderTemplate:function(e){return e.value?"Non-Reparentable Fields (cannot be changed after cloning)":"Normal Fields"}},{template:function(e){return void 0==e.checked&&(e.checked=!0),kendo.format('<input class="cloneChk" id="cloneChk={0}" {1} type="checkbox" {2}>',e.name,e.required?'disabled="true"':"",e.checked?'checked="checked"':"")},headerTemplate:kendo.format('<input id="{0}" type="checkbox" checked="checked"/>',p),width:"33px"},{field:"label",template:function(e){var t="API Name: "+e.name+(e.required?" ,Required: true":"");return kendo.format('<div title="{0}">{1}</div>',t,e.label)},headerTemplate:kendo.format('<input id="{0}" type="search" class="k-textbox" placeholder="Search field"/>',f),attributes:{style:"text-align: left;"}},{template:function(e){return e.reparentable?kendo.format('<input class="{0}" type="text" style="width:99%;"/>',l):""},headerTemplate:kendo.format('Number of clones: <input id="{0}" style="width:6em;"/>',m),attributes:{style:"text-align: left;"}}],dataSource:e._dataSource}),$(b+">div.k-grid-content").css({"max-height":""+h-87+"px"});var k=function(){$(".k-grouping-row").prop("align","left")};e._dataSource.filter({logic:"and",filters:[{field:"createable",operator:"eq",value:!0}]}),k(),$(g(m)).kendoNumericTextBox({value:1,step:1,min:1,format:"n0"});var w=function(){$("."+l).each(function(){var t=e,i=$(this),n=i.parent().parent().attr("data-uid"),r=t._dataSource.getByUid(n),s=Object.first(e.context.actionGrid.settings.metadata.fields,function(e){return e.name==r.name}),l=a.getSObjectDescribe(s.referenceTo),d=a.getSObjectNameField(l),c={objectName:s.referenceTo,columns:[d]};o.create({input:i,field:r.name,model:void 0,displayText:"Use existing value",keyPrefix:l.keyPrefix,setFunction:function(e){r.Id=e.Id},autoBind:!1,fieldMeta:s,pageInfo:c,parentObject:s.referenceTo,fkField:void 0,fkValue:void 0})})};w();var x,I=function(t){Object.each(t,function(t){var a=t.id;if(a){a=a.split("=")[1];var i=Object.first(e._dataSource.data(),function(e){return e.name==a});i&&(i.checked=t.checked)}})},S=$(g(f));S.on("keyup search input paste",function(t){clearTimeout(x),x=setTimeout(function(){I($("input.cloneChk")),e._dataSource.filter({logic:"and",filters:[{field:"createable",operator:"eq",value:!0},{field:"label",operator:"contains",value:S.val()}]}),w(),k()},300)}),$(g(p)).bind("click",function(){var e=$("input.cloneChk").filter(function(){return!$(this).attr("disabled")});e.prop("checked",this.checked)}),$(g(c)).bind("click",function(){var t=$("input.cloneChk:checked"),a=$(g(m)).data("kendoNumericTextBox").value();e._localStorage.displayResults=$(g(d)).is(":checked"),localStorage[r]=JSON.stringify(e._localStorage);var i=[];Object.each(t,function(t){var a=t.id;if(a){a=a.split("=")[1];var n=Object.first(e._dataSource.data(),function(e){return e.name==a});n&&i.push(n)}}),e.clone(i,a,e._localStorage.displayResults),$(n).data("kendoWindow").close().destroy()}),$(g(u)).bind("click",function(){$(n).data("kendoWindow").close().destroy()})},click:function(e){this.context=e,this.ui()}}}),crmc.define("BatchEmail",["KendoEntry","KendoPopup","sfdc","CustomSettings","Notification"],function(e,t,a,i,n){var o=function(){var e=a.getUserInfo(),t="true"==e.orgHasPersonAccounts;return t},r=function(e){for(var t=[],a=(e.objectDescribe.name.toLowerCase(),0);a<e.objectDescribe.fields.length;a++)field=e.objectDescribe.fields[a],field&&field.type&&"email"==field.type.toLowerCase()&&t.push({label:field.label,value:field.name});for(var i=e.actionGrid.fieldMeta,a=i.length-1;a>=0;a--){var n=i[a];"email"==n.type&&n.idMeta&&t.push({label:Object.first(e.actionGrid.columns,function(e){return e.name==n.name}).title,value:n.name,parent:!0})}return t},s=function(e,t,i){var n,o,r=Array.isArray(t)?t:[t],s=[],l=[],d=[],p=[];if(e.selectedRows.map(function(e){l.push(e.Id)}),Object.each(r,function(t){var a=Object.first(e.actionGrid.fieldMeta,function(e){return e.name&&e.name==t});a?p.push(t):d.push(t)}),"CampaignMember"==i&&(d.push("CampaignId"),o=function(){Object.each(s,function(e){"CampaignMember"==e.ObjectName&&(e.Id=e.CampaignId)})}),p.length>0&&Object.each(e.selectedRows,function(t){var a={},i=function(i){t[i]&&(a.Id=t.Id,a[i]=t[i],a.Type=c(e),a.ObjectName=e.objectDescribe.name)};Object.each(p,function(a){var n=a.split(".");if(1==n.length)i(a);else{var o=(n.pop(n.length),t);Object.each(n,function(e){o=o[e]});var r=Object.first(e.actionGrid.fieldMeta,function(e){return e.name&&e.name==a});if(r&&r.idMeta&&r.idMeta.relObjectName&&t[a]&&u(r.idMeta.relObjectName)){var l={Id:o.Id,Type:c(r.idMeta.relObjectName),ObjectName:r.idMeta.relObjectName};l[a]=t[a],s.push(l)}else i(a)}}),s.push(a)}),d.length>0){var f=p.length>0;n=a.query("SELECT Id, "+d.join(", ")+" FROM "+i+" WHERE Id IN('"+l.join("','")+"')"),f?Object.each(n,function(e){var t=Object.first(s,function(t){return t.Id==e.Id});t&&Object.each(d,function(a){t[a]=e[a]})}):s=n,"function"==typeof o&&o()}return{results:s,fields:r}},l=function(e,i,n,o,r){for(var s=[],l=function(a){var n=["<style>div.overflow{overflow: auto; max-height: 600px;}</style><div><div class='overflow'><ul>"];$.each(a,function(e,t){if(t.errors){var a="<li> Status Code: "+t.errors.statusCode+", Message: "+t.errors.message+"</li>";n.indexOf(a)===-1&&n.push(a)}else i.push(t.id)}),n.length>1?(n.push("</ul></div></div>"),t.popupWithButtons("Error creating activities",n.join(""),[{label:"Ok",click:function(){r&&r()}}],{grid:e.actionGrid,width:700})):r&&r()},d=a.getUserInfo().userId,c=0;c<i.length;c++){var u=new sforce.SObject("Task");"whoid"==o.toLowerCase()?u.WhoId=i[c]:u.WhatId=i[c],u.OwnerId=d,u.Subject=n.subject,u.TaskSubtype="Email",u.Status="Completed",u.Description=n.description?n.description:"To: "+n.toAddresses.join("; ")+"\nCC: \nBCC: \nAttachment: \nSubject: "+n.subject+"\nBody: "+n.htmlBody,s.push(u)}a.batchInsert(s,l)},d=function(e){if(null!=e&&void 0!=e)if("true"===e[0].success)n.showMessage({title:"Success",message:"Email batch has been successfully processed!"},"success");else{var a="Batch Failed...",i=["<ul>","<li> Emails were not sent.","<ul>","<li> Message: "+e[0].errors.message+"</li>","<li> Status Code: "+e[0].errors.statusCode+"</li>","<li> Target Object: "+e[0].errors.targetObjectId+"</li>","<li> Please check the console for more information.</li>","</ul>","</li>","</ul>","<ul>","<li> API Daily Outbound Single and Batch email limits.","<ul>","<li> 1,000 for all orgs </li>","<li> 10 for developer editions </li>","<li> Target Object: "+e[0].errors.targetObjectId+"</li>","</ul>","</li>","</ul>","<ul>","<li> API External Address Limit per Mass Email.","<ul>","<li> Personal: N/A </li>","<li> Contact Manager: N/A </li>","<li> Group: N/A </li>","<li> Professional: 250 </li>","<li> Enterprise: 500 </li>","<li> Unlimited: 1,000 </li>","<li> Performance: 1,000 </li>","<li> <a href='https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_gov_limits.htm#email_limits_section' target='_blank' >Salesforce documentation</a> </li>","</ul>","</li>","</ul>"].join("");t.popupWithButtons(a,i,[{label:"OK"}],{width:400})}else t.popup("Batch Error",e),console.log(e)},c=function(e){var t="string"==typeof e?e:e.objectDescribe.name;switch(t.toLowerCase()){case"contact":case"lead":case"user":return"WhoId";default:return"WhatId"}},u=function(e){var t;if(t="string"==typeof e?a.getSObjectDescribe(e):e.objectDescribe,"Task"!=t.name)for(var i=0;i<t.childRelationships.length;i++)if("Task"==t.childRelationships[i].childSObject)return!0;return!1},p={isAvailable:function(e){var t=e.objectDescribe.name.toLowerCase();if(t.contains("__c"))return u(e);switch(t){case"contact":case"lead":case"case":case"account":case"campaign":case"contract":case"opportunity":case"order":case"product":case"quote":case"solution":return!0;default:return!1}},getLabel:function(e){return"From Template"},createSubmenuItems:function(e){return[]},click:function(e){function i(){var t,i=[];if(t=e.actionGrid.settings.fkValue&&window.top!=window?"/"+e.actionGrid.settings.fkValue:window.location.href,e.selectedRows.map(function(e){i.push(e.Id)}),"WhoId"===c(e))for(var n=0;n<i.length;n++)window.open("/_ui/core/email/author/EmailAuthor?p2_lkid="+i[n]+"&retURL="+t);else{var o;try{o=a.query("SELECT Id, ContactId FROM "+e.objectDescribe.name+" WHERE Id IN('"+i.join("','")+"')")}catch(e){}if(void 0!=o)for(var n=0;n<o.length;n++)window.open("/_ui/core/email/author/EmailAuthor?p2_lkid="+o[n].ContactId+"&p3_lkid="+o[n].Id+"&retURL="+t);else for(var n=0;n<i.length;n++)window.open("/_ui/core/email/author/EmailAuthor?p2_lkid=&p3_lkid="+i[n]+"&retURL="+t)}}if(e.selectedRows.length>5){var n=[{label:"Yes",click:function(){i()}},{label:"No"}];t.popupWithButtons("WARNING","5 records are recommended because each item will show in a new tab. Do you want to continue?",n)}else i()}},f={isAvailable:function(e){return!0},getLabel:function(e){return"Compose (Default Client)"},createSubmenuItems:function(e){return[]},pushToEmailClient:function(e,t){for(var a=[],i=[],n=0;n<e.length;n++){var o=e[n][t];o&&(i.push(e[n].Id),a.indexOf(o)==-1&&a.push(o))}return url=["mailto:"+a.join(";")],a.length>0&&(window.location.href=url.join("")),{emails:a,sentIds:i}},ui:function(a,i){var n,o=this,d=r(a);if(d.length>0){var u=function(i){var n=s(a,i,a.objectDescribe.name),r=o.pushToEmailClient(n.results,i);r.emails.length>0?e.entry("Log Activity History",[{name:"subject",label:"Subject",type:"text",required:!0},{name:"description",label:"Description",type:"textarea",value:"To: "+r.emails.join("; ")+"\n"}],{},null,function(e){var t=e.subject.value,i=e.description.value,n=c(o.context);if(t||i){var s={subject:t?t:"",toAddresses:r.emails,description:i?i:""};l(a,r.sentIds,s,n)}}):t.popupWithButtons("Empty Email Addresses Data Set","Please add email data to the selected rows.",[{label:"Ok"}],{grid:o.context.actionGrid,width:250})};d.length>1?e.entry("Select Email Address",[{name:"Field",label:"Email Field",type:"picklist",values:d}],{width:350},null,function(e){for(var t=e.Field.value,a=0;a<d.length;a++){var i=d[a];if(i.value==t&&i.lookup){t=i.lookup.name+"."+i.lookup.field;break}if(i.value==t&&i.parent){n=!0,t=i.value;break}}u(t)}):u(d[0].value)}else t.popupWithButtons("No email fields available","Create and/or add email field to the grid",[{label:"Ok"}],{grid:o.context.actionGrid,width:240})},click:function(e){var t=this;t.context=e,t.ui(e,t.selectedRowIds)}},m={context:void 0,selectedRowIds:[],_localStorage:{},isAvailable:function(e){return!0},getLabel:function(e){return"Compose"},createSubmenuItems:function(e){return[]},singleEmailMessage:function(e,t,a,i,n,o,r){var s=new sforce.SingleEmailMessage;return o&&(r?s.targetObjectId=o:s.whatId=o),s.replyTo=e,s.toAddresses=t,s.subject=a,n?s.htmlBody=i:s.plainTextBody=i,s},sendEmail:function(e){this.context.kendoGrid._progress&&this.context.kendoGrid._progress(!0);for(var t=[],a=Math.ceil(e.length/10),i=0;i<a;i++){var n=e.splice(e.length-10,10),o=sforce.connection.sendEmail(n);t=t.concat(o)}return this.context.kendoGrid._progress&&this.context.kendoGrid._progress(!1),t},createEmailMessages:function(e,t,a){for(var i=e,n=[],o=[],r=[],s=0;s<t.results.length;s++){var l=t.results[s];a||(o=[]);for(var d=!1,c=0;c<t.fields.length;c++){var u=t.fields[c],p=l[u];p&&(o.indexOf(p)===-1&&o.push(p),d=!0)}a||n.push(this.singleEmailMessage(i.replyTo,o,i.subject,i.body,!0,l.Id,"WhoId"===l.Type)),d&&r.push(l.Id)}return a&&n.push(this.singleEmailMessage(i.replyTo,o,i.subject,i.body,!0)),{singleEmailMessages:n,activityHistoryIds:r}},ui:function(){var e=this,t=e.context.actionGrid.settings.id,i="compose_email_window",n=e.context.actionGrid.getElementId(i),o=i+"_replyToText",c=i+"_subjectText",u=i+"_emailComboBox",p=i+"_kendoEditor",f=t+"_"+p,m=i+"_chkIndividualEmails",h=i+"_chkIndividualEmailsHelpIcon",g=i+"_multiSelectHelpIcon",v=i+"_buttonApply",b=i+"_buttonCancel",y=function(e){return"#"+e},k=!1,w=!1,x=!1,I=window.innerHeight<=643?window.innerHeight-60:615,S=function(){var e=$(y(v)).data("kendoButton");k&&w&&x?e.enable(!0):e.enable(!1)};$(n).data("kendoWindow")&&($(n).data("kendoWindow").destroy(),$(n).empty());var C=localStorage[i];e._localStorage=C?JSON.parse(C):{individualEmails:!0},$("body").append(kendo.format('<div id="{0}_{1}" style="display:none; text-align:center;">{2}</div>',t,i,"<div class='k-content' style='padding-top:0.3em; padding-left: 0.25em; text-align:left; overflow:hidden;'>"+kendo.format('<div style="padding:0.1em;"> <input style="width:300px" class="ag-email-textbox" placeholder="ReplyTo" autocomplete="off" maxlength="255" id="{0}" value="{1}" /></div>',o,a.getUserInfo().userEmail)+kendo.format('<div style="padding:0.1em;"> <input style="width:300px" class="ag-email-textbox" placeholder="Subject" autocomplete="off" maxlength="255" id="{0}" /></div>',c)+"</div>"+kendo.format('<div style="width:100%; height:{0}px; max-height:{0}px; padding:0.3em; overflow:hidden">',I-110)+"<div><div>"+kendo.format('<textarea id="{0}" rows="10" cols="30" style="height:{1}px"/>',f,I-110)+"</div></div></div><div style='padding-top:0.3em; overflow:hidden'>"+kendo.format("Send as individual emails <span class='k-icon k-i-info {2}'></span> <input id='{0}' type='checkbox' {1}/> &nbsp; &nbsp;",m,e._localStorage.individualEmails?"checked='checked'":"",h)+kendo.format("<span id='{0}' class='k-button'> Send </span> &nbsp; &nbsp;",v)+kendo.format("<span id='{0}' class='k-button'> Cancel </span>",b)+"</div>"));
"<div class='k-content' style='padding-top:0.3em;'>"+kendo.format('<div style="padding:0.1em;"> <input id="{0}" placeholder="Select email..." style="width: 300px" /></div>',u)+"</div>";n=$(n).kendoWindow({title:"New Email",height:I,maxHeight:I,minHeight:I,width:845,minWidth:780,visible:!1,modal:!0,animation:{open:{effects:"fade:in"}}}),$(y(f)).kendoEditor({resizable:!1,content:!0,toolbar:!0,tools:[{name:"Address",template:kendo.format('<input id="{0}" style="width: 200px" disabled="true" /> <span class="k-icon k-i-note {1}"></span>',u,g)},"formatting","bold","italic","underline","justifyLeft","justifyCenter","justifyRight","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink","insertImage","createTable","addColumnLeft","addColumnRight","addRowAbove","addRowBelow","deleteRow","deleteColumn"],keyup:function(e){w=this.value().length>0,S()},change:function(){w=this.value().length>0,S()}}),$("."+h).off("click"),$("."+h).on("click",function(){var e=$("<div>").kendoTooltip({filter:"label",width:225,position:"right",autoHide:!1,content:"<b>Checked</b>: Every selected row will get a seperate email. <br><b>Unchecked</b>: One email with all addresses, from every selected row, on the same email."}).data("kendoTooltip");e.show($(this))});var N=r(e.context),_=$(y(u));N&&N.length>0?($("."+g).hide(),_.attr("disabled",!1),_.kendoMultiSelect({dataTextField:"label",dataValueField:"value",placeholder:"Required - Select email…",dataSource:N,enable:!0,change:function(e){this.value();x=this.value().length>0,S()}})):(_.val("Email fields not available…"),_.addClass("k-textbox"),$("."+g).off("click"),$("."+g).on("click",function(){var e=$("<div>").kendoTooltip({filter:"label",width:225,position:"right",autoHide:!1,content:"<b>Email Address Fields</b><br>Options include standard Salesforce and custom email address fields for this object.<br> Parental email fields also get populated when on the grid."}).data("kendoTooltip");e.show($(this))})),$(y(v)).kendoButton({enable:!1,click:function(t){e._localStorage.individualEmails=$(y(m)).is(":checked"),localStorage[i]=JSON.stringify(e._localStorage);var a={replyTo:$(y(o)).val(),subject:$(y(c)).val(),emailFields:$(y(u)).data("kendoMultiSelect").value(),body:$(y(f)).data("kendoEditor").value()},r=s(e.context,a.emailFields,e.context.objectDescribe.name),p=e.createEmailMessages(a,r,!e._localStorage.individualEmails),h=e.sendEmail(p.singleEmailMessages);if(!e._localStorage.individualEmails&&h&&h[0]&&h[0].success&&"true"==h[0].success){var g=function(){d(h),$(n).data("kendoWindow").close().destroy()};l(e.context,p.activityHistoryIds,p.singleEmailMessages[0],objectType,g)}else d(h),$(n).data("kendoWindow").close().destroy()}}),$(y(b)).kendoButton({click:function(t){e._localStorage.individualEmails=$(y(m)).is(":checked"),localStorage[i]=JSON.stringify(e._localStorage),$(n).data("kendoWindow").close().destroy()}}),$(y(c)).bind("change",function(){k=$(this).val().length>0,S()}),n.data("kendoWindow").center().open()},click:function(e){var t=this;t.context=e,t.ui()}},h={isAvailable:function(e){switch(e.objectDescribe.name.toLowerCase()){case"contact":case"lead":return!0;case"account":return o();default:return!1}},getLabel:function(e){return"Batch"},createSubmenuItems:function(e){return[]},massEmailMessage:function(e,t,a,i){var n=new sforce.MassEmailMessage;return n.targetObjectIds=e,n.replyTo=a,n.templateId=t,""!=i&&void 0!=i&&(n.description=i),sendMailRes=sforce.connection.sendEmail([n])},click:function(t){var i=this;if(t.selectedRows.length>0){var n=[];t.selectedRows.map(function(e){n.push(e.Id)}),e.entry("Batch Send Email",[{referenceTo:"EmailTemplate",name:"Id",label:"Template",type:"reference",required:!0},{name:"ReplyTo",label:"Reply To",type:"text",value:a.getUserInfo().userEmail,required:!0},{name:"Name",label:"Mass Email Name",type:"text",value:"",required:!1}],{width:350,objectName:"EmailTemplate"},null,function(e){var r=e.Id.value,s=e.ReplyTo.value,l=e.Name.value;if("Account"===t.objectDescribe.name&&o()){for(var c=a.query("SELECT Id, PersonContactId FROM Account WHERE Id IN('"+n.join("','")+"')"),u=[],p=0;p<c.length;p++)u.push(c[p].PersonContactId);d(i.massEmailMessage(u,r,s,l))}else d(i.massEmailMessage(n,r,s,l))})}}},g={orgHasPersonAccounts:o,objectType:c,hasActivities:u,getEmailFields:r,queryEmailData:s,createActivityHistory:l,onFinish:d,emailToForm:p,singleEmail:m,batchEmail:h,actions:[p,h,m,f],isAvailable:function(e){if(e.selectedRows.length>0&&i.getSetting(e.objectDescribe.name,"batchEmail")!==!1){var t=!1;return Object.each(this.actions,function(a){a.isAvailable(e)&&(t=!0)}),t}return!1},getLabel:function(e){return"Send Email..."},createSubmenuItems:function(e){return this.actions},click:function(e){}};return g}),crmc.define("DrawLoop",["sfdc","marketing","KendoPopup","CustomSettings"],function(e,t,a,i){var n={appName:"Loop",maxRows:1e3,getAppNamespace:function(){return this.appName},getLabel:function(e){return"DrawLoop"},isAvailable:function(e){return i.getSetting(e.objectDescribe.name,"Loop","action")!==!1},click:function(t){var i=$('<iframe style="display:none;"/>').appendTo($("body"));$(i).attr("src","/apex/Loop__loop?"),i[0].onload=function(){if(t.selectedRows.length>n.maxRows)a.popup("Max Records Limit!","Currently, we don't allow more than "+n.maxRows+" records to be mapped!");else if(t.selectedRows.length>0){var o=[];Object.each(t.selectedRows,function(e){o.push(e.Id)});var r="masslooplus?";r+="&recordIds="+o.join(","),e.navigateToVFPage(n.appName,r,void 0,!0)}else a.popup("Please select records","Select at least one record to send to DrawLoop");$(i).remove()}}};return n}),crmc.define("FindReplace",["KendoEntry","KendoPopup","sfdc","CustomSettings","GridConstants"],function(e,t,a,i,n){return{isBatchEditItem:!0,getLabel:function(e){return"Find/Replace"},isAvailable:function(e){var t=e.objectDescribe&&["true",!0].indexOf(e.objectDescribe.updateable)>-1,a=i.getSetting(e.objectDescribe.name,"findReplace")!==!1,n=e.selectedRows.length>0;return a&&n&&t},click:function(i){function o(e){return[{label:"Send To Console",click:function(){$.each(e,function(e,t){t.errors&&console.log(t.errors)})}},{label:"Ok"}]}function r(){for(var e=[],t=0;t<u.length;t++)s(u[t].type)&&u[t].name.indexOf(".")===-1&&e.push({active:"true",defaultValue:"false",label:u[t].displayName,value:u[t].name});return e}function s(e){switch(e.toUpperCase()){case"STRING":return!0;case"TEXTAREA":return!0;case"PHONE":return!0;case"EMAIL":return!0;default:return!1}}function l(e,t){e instanceof Array||(e=[e]);var a,i=200,n=[],o=e.length/200,r=0,s=function(e){n=n.concat(e),r++,r>=o&&"function"==typeof t&&t(n)};for(a=0;a<e.length;a+=i)sforce.connection.update(e.slice(a,a+i),{onSuccess:s,onFailure:s})}function d(e){for(var a=[],n=0;n<p.length;n++){var o=new sforce.SObject(i.objectDescribe.name),r=p[n][e.apiValue];if(void 0===r&&""===e.oldValue)o.Id=p[n].Id,o[e.apiValue]=e.newValue,a.push(o);else if(void 0!=r&&""!=e.oldValue){var s=r.replace(e.oldValue,e.newValue);s||(s=null),s!=p[n][e.apiValue]&&(o.Id=p[n].Id,o[e.apiValue]=s,a.push(o))}}a.length>0?a.length>200?l(a,g):sforce.connection.update(a,{onSuccess:g,onFailure:h}):(i.kendoGrid._progress&&i.kendoGrid._progress(!1),t.popupWithButtons("Warning","No records to update",m,{grid:i.actionGrid,width:150}))}function c(e){function t(t){setTimeout(function(){var a=function(){for(var t=0;t<i.kendoGrid.columns.length;t++)if(i.kendoGrid.columns[t].field===e.apiValue)return t},n=p[t][e.apiValue],o=(i.kendoGrid.columns[t],$(kendo.format("{2} tr[data-uid={0}] td:not(.k-group-cell,.k-hierarchy-cell):eq({1})",p[t].uid,a(),i.actionGrid.getElementId("grid"))));if(void 0===n&&""===e.oldValue)i.kendoGrid.editCell(o),p[t].set(e.apiValue,e.newValue);else if(void 0!=n&&""!=e.oldValue){var r=n.replace(e.oldValue,e.newValue);r!=n&&(i.kendoGrid.editCell(o),p[t].set(e.apiValue,r))}t==i.selectedRows.length-1&&(i.kendoGrid.editCell(o),i.kendoGrid._progress&&i.kendoGrid._progress(!1))},100)}i.kendoGrid._progress&&i.kendoGrid._progress(!0);for(var a=0;a<p.length;a++)t(a)}var u=i.actionGrid.fieldMeta,p=i.selectedRows,f=[],m=[{label:"Ok"}],h=function(e){try{return"<li> Status Code: "+e.statusCode+", Message: "+e.message+"</li>"}catch(e){alert("Error: "+e)}},g=function(e){var r=["<style>div.overflow{overflow: auto; max-height: 600px;}</style><div><div class='overflow'><ul>"];if($.each(e,function(e,t){return t.errors?void r.push(h(t.errors)):void f.push(t.id)}),e.length==f.length){i.kendoGrid._progress&&i.kendoGrid._progress(!1);var s=kendo.format("{0} Record"+(1===f.length?"":"s")+" updated, would you like to ActionGrid the result"+(1===f.length?"":"s")+"?",f.length),l="Update Results",d=[{label:"Yes",click:function(){if(i.selectedRows.length>200){var e={retURL:i.actionGrid.settings.pageURL,object:i.objectDescribe.name},t={Ids:f.join()};a.postToVFPage(n.namespace,"crmc_grid",e,t,!0)}else window.open(kendo.format("/apex/CRMC_PP__crmc_grid?object={0}&Ids={1}",i.objectDescribe.name,f.join()))}},{label:"No"}];t.popupWithButtons(l,s,d,{grid:i.actionGrid}),i.actionGrid.refresh()}else i.kendoGrid._progress&&i.kendoGrid._progress(!1),r.push("</ul></div></div>"),t.popupWithButtons("Batch Update Errors",r.join(""),o(e),{grid:i.actionGrid,width:700})},v=function(e){var t="";if(e.Columns.value||(t+="Select a column."),!e.OldValue.value&&!e.NewValue.value){var a="Old Value or New Value must be filled out.";t+=t.length>0?"<li>"+a+"</li>":a}return t},b=r();b.length>0?e.entry("Replace With...",[{name:"Columns",label:"Column",type:"picklist",values:b,required:!0,validate:v},{name:"OldValue",label:"Old Value",type:"text",required:!0},{name:"NewValue",label:"New Value",type:"text",required:!0}],{grid:i.actionGrid,width:350},null,function(e){var a={apiValue:e.Columns.value,oldValue:e.OldValue.value,newValue:e.NewValue.value};if(""==a.oldValue&&""==a.newValue)t.popupWithButtons("Warning","No values were specified",m,{grid:i.actionGrid,width:150});else{var n=[{label:"EditMode",click:function(){i.actionGrid.settings.editable=!0,i.actionGrid.enterEditMode()}},{label:"Continue",click:function(){d(a)}},{label:"Cancel"}],o=["<ul>","<li> EditMode: Enables edit mode in the current ActionGrid to preview the changes.</li>","<li> Continue: Makes the changes, saves, reloads the current ActionGrid.</li>","<li> Cancel: Cancels the current operation.</li>","</ul>"].join("");i.actionGrid.settings.hasOwnProperty("editable")&&i.actionGrid.settings.editable?c(a):t.popupWithButtons("Continue or preview in edit mode?",o,n,{grid:i.actionGrid,width:450})}}):t.popupWithButtons("No Supported Fields","There are no supported fields in the view.",m,{grid:i.actionGrid,width:250})}}}),crmc.define("AutoFillMenuItem",["KendoPopup","CustomSettings"],function(e,t){var a={getLabel:function(e){return"Fill Down"},isAvailable:function(e){var a=!1;return e.actionGrid.settings.editable&&e.selectedRows.length>1&&e.actionGrid.gridDataSource.hasChanges()&&(a=e.actionGrid.settings.enableAutoFill&&t.getSetting(e.actionGrid.settings.pageInfo.objectName,"autoFill")!==!1),a},click:function(e){var t=e.actionGrid;t.fillDown()}};return a}),crmc.define("MassUpdateInline",["sfdc","KendoPopup","KendoEntry","CustomSettings","marketing","GridConstants","Notification","FormulaHelpers"],function(e,t,a,i,n,o,r,s){var l={label:"Mass Update",getLabel:function(e){return this.label},getPageInfo:function(t){var a=Object.copy(t.actionGrid.settings.pageInfo);if(!(a.filterId||a.sorts&&0!==a.sorts.length)){var i=e.getSObjectNameField(t.objectDescribe);i&&(a.sorts=[{field:i,dir:"asc"}])}return a.filter&&a.filter.filters&&a.filter.filters.length&&a.filter.filters.map(function(t){if(t&&t.value&&t.value instanceof Date){var a=e.getDateWithOffset(t.value,e.getProfileTimezoneOffset());t.value=a.toISOString()}}),void 0!==t.actionGrid.settings.baseFilter&&(void 0===a.filter&&(a.filter={logic:"and"}),a.filter||(a.filter={}),void 0===a.filter.filters&&(a.filter.filters=[]),a.filter.filters.push(t.actionGrid.settings.baseFilter)),delete a.displayColumns,delete a.childGridSettings,a},batchUpdateApex:function(a,i,n){var o=this,r=(e.getNamespace(!1),a.selectedRows[0].Id.substr(0,3)),s=e.query("SELECT Id,ParentJobId,Status,LastProcessed FROM AsyncApexJob WHERE LastProcessed LIKE '"+r+"%'AND Status = 'Processing'"),l=function(){e.executeRemoteAction("batchUpdate",[o.getPageInfo(a),i,n],function(e,a){a.status&&(t.popup("Mass Update Started","A Mass Update has been started.  You will receive an email when it is complete."),console.log(e))})};s.length>0?t.popup("Scheduled Apex Already Running!","An existing Scheduled Apex job is running on that object, you may have locked records.  Are you sure you want to continue?","OK",l):l()},warnRecordTypes:function(a,i,n){var o=a.selectedRows;if(i){var r=o.every(function(e){return!!(e.RecordTypeId==i||e.RecordType&&e.RecordType.Id==i)||(t.popup("Mixed Record Types","Selection contains more than one Record Type. It is possible to Mass Update fields to an invalid value for a Record Type if you continue.","Continue",n,"Cancel"),!1)});r&&n()}else{for(var s=0,l=750,d=o.map(function(e){return e.Id}),c=[];s<d.length;){var u=e.query("SELECT COUNT(Id) cnt, RecordTypeId FROM {0} WHERE Id in ('{1}') GROUP BY RecordTypeId",a.actionGrid.settings.pageInfo.objectName,d.slice(s,s+l).join("','"));if(Object.each(u,function(e){c.indexOf(e.RecordTypeId)<0&&c.push(e.RecordTypeId)}),c.length>1)break;s+=l}c.length>1?t.popup("Mixed Record Types","Selection contains more than one Record Type. It is possible to Mass Update fields to an invalid value for a Record Type if you continue.","Continue",n,"Cancel"):n()}},promptMassUpdate:function(e,t,n,o){var r=!1,s=[];Object.each(e.actionGrid.fieldMeta,function(a){var o=e.actionGrid.settings.pageInfo.columns.indexOf(a.name),l=Object.first(e.actionGrid.settings.hiddenColumns,function(e){return e==a.name}),d=a.name.indexOf(".")>-1,c=a.name;a.parentMeta&&(a=a.parentMeta,d=!1);var u=a.type.toLowerCase();if(!l&&!d&&o>-1&&"base64"!=u&&!a.isReadonly&&i.getSetting(e.objectDescribe.name,c,"fieldMassUpdate")!==!1){var p=Object.first(e.actionGrid.settings.metadata.fields,function(e){return e.name==a.name});if(p){var f={name:a.name,label:a.displayName,type:u,values:[].concat(a.picklistValues),referenceTo:a.relObjectName,colIndex:o};(p.dependentPicklist||t&&"picklist"==u||"CampaignMember"==e.objectDescribe.name&&"Status"==a.name)&&(f.dependentPicklist=function(i){return t&&!i.model.hasOwnProperty("RecordType")&&n.RecordType&&(i.model.recordType={Id:n.RecordTypeId||n.RecordType.Id}),i.model.Id=n.Id,e.actionGrid.getPicklistValues(a.name,a.picklistValues)(i)}),"double"==u?f.precision=a.precision:"reference"==u&&(f.fullMeta=p,r=!0),s.push(f)}}}),s=s.sort(function(e,t){return e.colIndex-t.colIndex});var l=!o;l=l&&i.getSetting(e.objectDescribe.name,"formulaMassUpdate")!==!1,l=l&&i.getSetting(e.objectDescribe.name,"formulaFields")!==!1;var d={includeCheckboxes:!0,hasDependency:!0,resizable:!1,autoSizeFields:!0,width:"25%",grid:e.actionGrid,allowFormulas:l};r&&(d.id=n.Id,d.keyPrefix=e.actionGrid.settings.metadata.keyPrefix,d.objectName=e.objectDescribe.name,d.fkField=e.actionGrid.settings.fkField,d.fkValue=e.actionGrid.settings.fkValue);a.entry("Mass Update",s,d,e.actionGrid.settings,this.entryFunctionFactory(e,o))},entryFunctionFactory:function(t,a){var i=this,n=t.selectedRows;return function(o){var l=Object.first(o,function(e){return e.isChecked});if(l)if(a){var d=[],c={sobjectType:t.objectDescribe.name};Object.each(o,function(e){e.isChecked&&(void 0!==e.value&&""!==e.value||(e.value=null),e.rawValue&&e.rawValue instanceof Date&&(e.value=e.rawValue.valueOf()),c[e.name]=e.value,d.push(e.name))}),i.batchUpdateApex(t,d,c)}else{var u=[];Object.each(n,function(e){var a=new sforce.SObject(t.objectDescribe.name);a.Id=e.Id,Object.each(o,function(t){if(t.isChecked&&(void 0!==t.value&&""!==t.value||(t.value=null),a[t.name]=t.value,t.isFormula)){var i=t.formula;i&&(a[t.name]=s.parseFormula(i,e))}}),u.push(a)}),e.batchUpdate(u,i.finishFunctionFactory(t))}else r.showMessage({title:"Mass Update",message:"No records updated"})}},finishFunctionFactory:function(a){var i=a.selectedRows;return function(n){for(var o,s=0,l=0,d=[],c=[],u=0;u<n.length;u++){var p=n[u];"true"==p.success?(s++,c.push(p.id)):(l++,void 0!=p.errors&&void 0!=p.errors.message?(o||(o=e.getSObjectNameField(a.objectDescribe)),d.push('<a href="'+e.getRecordURL(i[u].Id)+'" target="_blank">'+i[u][o]+"</a> | "+p.errors.message)):p.faultstring&&d.push(p.faultstring))}var f="Successfully updated "+s+" record"+(1==s?"":"s")+"!",m=[{label:"Ok"}];0==s&&(f="Mass Update Unsuccessful!"),l>0?(f+='\n The following errors occurred: <br /><div style="overflow:auto;max-height:300px;"><ul><li>'+d.join("\n</li><li>")+'</li></ul></div><br /> Contact <a href="mailto:support@getactiongrid.com">support@getactiongrid.com </a>',t.popupWithButtons("Mass Update Results",f,m)):r.showMessage({title:"Mass Update",message:"Successfully updated records."},"success"),a.actionGrid.refresh()}},isAvailable:function(e){return!!(e.selectedRows.length>0&&e.objectDescribe&&["true",!0].indexOf(e.objectDescribe.updateable)>-1)&&i.getSetting(e.objectDescribe.name,"massUpdateInline")!==!1},click:function(a){var r=this,s=a.selectedRows,l=s[0],d=i.getSetting(a.objectDescribe.name,"massUpdateBatch")===!0,c=function(e){var t=a.objectDescribe.recordTypeInfos&&a.objectDescribe.recordTypeInfos.length>0,i=function(){r.promptMassUpdate(a,t,l,e)};if(t){var n;(l.RecordTypeId||l.RecordType&&l.RecordType.Id)&&(n=l.RecordTypeId||l.RecordType.Id),r.warnRecordTypes(a,n,i)}else i()};if(s.length>0)if(d&&a.actionGrid.gridDataSource&&a.actionGrid.gridDataSource.totalPages()>1&&s.length==a.actionGrid.gridDataSource.pageSize()){useApex=!0;var u=a.actionGrid.gridDataSource.total();u=(u>=1e4?"more than 10,000":u)+" results!",t.popupWithButtons("Mass Update","Would you like to mass update all pages matching the current filter or only the first page? </br> <span style='color: #d30000'>WARNING:</span> All pages will update "+u,[{label:"All Pages",click:function(){var t=e.getNamespace(!1);t&&t.length>0&&(t+=".");var a=Visualforce.remoting.Manager.getController(t+o.VF_APEX_CONTROLLER);a&&a.batchUpdate?c(!0):n.missingApp("crmc_pp")}},{label:"This Page Only",click:function(){c(!1)}},{label:"Cancel"}])}else c(!1);else t.popup("Please select records","Select at least one record to Mass Update.")}};return l}),crmc.define("BatchEdit",["CustomSettings","FindReplace","AutoFillMenuItem","MassUpdateInline","MassUpdateMenuItem"],function(e,t,a,i,n){return{submenus:[a,t,i],isAvailable:function(e){var t=!1;return Object.each(this.submenus,function(a){a.isAvailable(e)&&(t=!0)}),t},getLabel:function(e){return"Batch Edit..."},createSubmenuItems:function(e){return this.submenus},click:function(e){}}}),crmc.define("SortAction",[],function(){var e=function(e,t){return{isHeaderAvailable:function(e){var a=e.actionGrid.gridDataSource,i=e.selectedColumn&&e.selectedColumn.field,n=e.selectedColumn&&e.selectedColumn.sortable,o=a.sort(),r=Object.first(o,function(e){return e&&e.field==i&&e.dir==t});return i&&n&&!r},getLabel:function(t){return e},click:function(e){var a=e.actionGrid.gridDataSource,i=a.sort(),n=i||[],o=e.selectedColumn&&e.selectedColumn.field,r=Object.first(i,function(e){return e&&e.field==o});r?r.dir=t:n.push({field:o,dir:t}),a.sort(n)}}};return e}),crmc.define("FreezeColumnAction",[],function(){var e={getLabel:function(e){var t=e.selectedColumn&&e.selectedColumn.locked;return t?"Unfreeze Column":"Freeze Column"},isHeaderAvailable:function(e){return void 0!=e.selectedColumn},click:function(e){var t=e.selectedColumn&&e.selectedColumn.locked;t?(e.kendoGrid.unlockColumn(e.selectedColumn.field),2==e.actionGrid.getLockedColumns().length&&(e.actionGrid.settings.lockedColumns=!1,e.actionGrid.preserveSelectedRows(e.actionGrid.settings.editable))):e.actionGrid.settings.lockedColumns?e.kendoGrid.lockColumn(e.selectedColumn.field):(e.actionGrid.settings.lockedColumns=!0,e.actionGrid.preserveSelectedRows(e.actionGrid.settings.editable,!1,!1,function(t){t.kendoGrid.lockColumn(e.selectedColumn.field)}))}};return e}),crmc.define("ColumnMenu",["KendoEntry","CustomSettings","ColumnFactory"],function(e,t,a){var i={customOrder:!0,getLabel:function(e){return"Column Settings…"},isHeaderAvailable:function(e){return void 0!=e.selectedColumn&&t.getSetting(e.objectDescribe.name,"columnSettings")!==!1},click:function(a){var i,n={},o=a.selectedColumn,r=Object.first(a.actionGrid.settings.metadata.fields,function(e){if(e.name==o.name)return!0;if("reference"==e.type){var t=o.name.split(".");return t[0]==e.relationshipName&&(n[t[0]]={},n[t[0]].Name="",n.id="",!0)}}),s=[{name:"readOnly",label:"Read Only",type:"boolean",value:a.selectedColumn.readOnly}],l={name:"required",label:"Required",type:"boolean",value:a.selectedColumn.required};o.schema.sfRequired&&(l.value=void 0,l.type="html",l.html='<input type="checkbox" disabled checked> <label>Column is required by Salesforce. <label>'),"boolean"!=o.schema.type.toLowerCase()&&s.push(l),a.selectedColumn.schema.editable&&(o.name.indexOf(".")<0||!o.schema.isParentField)&&(["text","string","email","url"].indexOf(r.type)==-1?s.unshift({name:"defaultValue",label:"Default Value",type:"custom",init:function(e){var t=o.editor(e,{field:o.name,model:n}),s=$("#"+this.id),l=a.selectedColumn.defaultValue;switch(r.type){case"reference":s.children(".k-combobox").css("width",s.children(".k-dropdown").length>0?"75%":"88%"),l&&t.value(l);break;case"picklist":case"combobox":case"currency":case"int":case"double":case"percent":case"date":case"datetime":case"datetimepart":case"time":s.children().css("width","97%"),l&&t.value(l);break;case"boolean":l&&t.prop("checked",l);break;case"multipicklist":s.children().css("width","97%"),l&&t.value(l.split(";"));break;default:s.children().css("width","97%"),l&&s.children().val(l)}this.getValue=function(){switch(r.type){case"reference":i=t.dataItem();case"picklist":case"combobox":case"currency":case"int":case"double":case"percent":case"date":case"datetime":case"datetimepart":case"time":return t.value();case"boolean":return t.prop("checked");case"multipicklist":return t.value().join(";");default:var e=$("#"+this.id).children();return e.val()}}}}):s.unshift({name:"defaultValue",label:"Default Value",type:"text",value:a.selectedColumn.defaultValue}));var d=t.getSetting(a.objectDescribe.name,"renameColumn")!==!1;d&&s.unshift({name:"label",label:"Label",type:"text",value:a.selectedColumn.title}),e.entry("Column Settings",s,{},a.actionGrid.settings,function(e){var t=e.defaultValue?e.defaultValue.value:"";"reference"==r.type?i?(a.selectedColumn.defaultValue=i.Name?i.Name:i.text,a.selectedColumn.defaultId=i.Id?i.Id:i.value):(a.selectedColumn.defaultValue=void 0,a.selectedColumn.defaultId=void 0):a.selectedColumn.defaultValue=t,d&&(a.selectedColumn.title=e.label.value),a.selectedColumn.readOnly=e.readOnly.value,a.selectedColumn.required=e.required&&e.required.value,a.actionGrid.refresh()})}};return i}),crmc.define("ActionGridDelegate",["sfdc","marketing","ActionItem","ExportMenuItem","ViewMenuItem","BatchAddNew","BatchAddCampaignMemberMenuItem","MassUpdateMenuItem","AWMergeMenuItem","BatchAddToEmmaGroup","Geopointe","BatchDelete","ListBrowse","MapAnything","CongaConductor","SummarizeAction","BatchClone","BatchEmail","DrawLoop","BatchEdit","SortAction","FreezeColumnAction","ColumnMenu","tooling","mixpanel","extensions"],function(e,t,a,i,n,o,r,s,l,d,c,u,p,f,m,h,g,v,b,y,k,w,x,I,S){var C=[s,l,d,p,m,c,f,b],N=[s,b],_={},T=[],D={getLabel:function(e){return"<hr/>"},isAvailable:function(e){return E(e)}},O={getLabel:function(e){return"Not Installed"},isAvailable:function(e){return E(e)},createSubmenuItems:function(e){return Array.orderBy(T,function(t){return t.getLabel(e)})}},R={submenus:[],getLabel:function(e){return"Map Records..."},isAvailable:function(e){var t=!1;return Object.each(this.submenus,function(a){a.isAvailable(e)&&(t=!0)}),t},createSubmenuItems:function(e){return this.submenus}},j=function(e,t){var a=document.createElement("script");t&&(a.onload=t),document.getElementsByTagName("HEAD").item(0).appendChild(a),a.src=e},P=[o,y,i,n,u,h,g,v,k("Add Ascending Sort","asc"),k("Add Descending Sort","desc"),w,x];crmc="undefined"==typeof crmc?{}:crmc,crmc.addCustomAction=function(e){Object.each(a,function(t,i){e[i]||(e[i]=a[i])}),e.isBatchAddItem?o.submenus.push(e):e.isBatchEditItem?y.submenus.push(e):P.push(e),e.isCustom=!0,$(document).trigger("addCustomAction",e)},crmc.addReadingPane=function(e){$(document).trigger("customRPLoad",[e.itemID,e])};var E=function(e){var t=!1;return Object.each(T,function(a){a.isAvailable(e)&&(t=!0)}),t},F=function(){var e=[];return Object.each(C,function(t){if(t.getAppNamespace&&"function"==typeof t.getAppNamespace){var a=t.getAppNamespace();a&&a.length>0&&("string"==typeof a?e.push(a):Object.each(a,function(t){e.push(t)}))}}),e},A=function(){var a=[],i={};Object.each(C,function(e){if(e.getAppNamespace&&"function"==typeof e.getAppNamespace){var t=e.getAppNamespace();t&&t.length>0&&("string"==typeof t?(a.push(t),i[t]=e):Object.each(t,function(t){a.push(t),i[t]=e}))}}),a.length>0&&e.getLicensedPackages(a,function(e,l){if(l.status){var u=this.customItems||[];C=[],Object.each(a,function(a){var n=Object.first(e,function(e){return e===a}),o=i[a],r=Object.first(T,function(e){return Object.getPrototypeOf(e)==o}),s=T.indexOf(r),l=C.indexOf(o),d=N.indexOf(o)<0;n?(o.appName=a,C.push(o),s>-1&&T.splice(s,1)):l==-1&&s==-1&&d&&(o=Object.create(o),o.click=function(){t.missingApp(a)},T.push(o))}),Object.each(C,function(e){e===r?o.submenus.indexOf(r)==-1&&o.submenus.push(r):e===d?o.submenus.indexOf(d)==-1&&o.submenus.push(d):e===p?n.submenus.indexOf(p)==-1&&n.submenus.push(p):e===c?(R.submenus.indexOf(c)==-1&&R.submenus.push(c),P.indexOf(R)==-1&&P.push(R)):e===f?(R.submenus.indexOf(f)==-1&&R.submenus.push(f),P.indexOf(R)==-1&&P.push(R)):e===s?y.submenus.indexOf(s)==-1&&y.submenus.push(e):P.indexOf(e)===-1&&P.push(e)}),!this.customItems&&e&&e.length>0&&(e.map(function(e){e.indexOf("CustomAction:")>-1&&u.push(e.split("CustomAction:")[1])}),this.customItems=u),Object.each(u,function(e){_[e]||(j(String.format("/resource/{0}/{1}",Date.now(),e)),_[e]=e)})}else T=C,C=[]})},L=function(e,t,i){Object.each(a,function(t,i){e[i]||(e[i]=a[i])});var n=[];return Object.each(e.createSubmenuItems(t),function(e){e.isAvailable&&!e.isAvailable(t)||n.push(L(e,t))}),{customOrder:i,label:e.getLabel(t),click:function(a){e.click(t)},isCustom:e.isCustom,items:n.length>0?n:void 0}},M={appNameSpaces:F(),getActionItems:function(e){var t=Object.where(P,function(t){var a=!1;try{a=e.isHeader?t.isHeaderAvailable&&t.isHeaderAvailable(e):e.isToolbar?t.isToolbarAvailable&&t.isToolbarAvailable(e):t.isAvailable&&t.isAvailable(e)}catch(e){console.log("Unhandled exception in Action item isAvailable function, offending item follows: "+e),console.log(t),S.trackException(e)}return a}),a=[];return Object.each(t,function(t){try{a.push(L(t,e,t.customOrder))}catch(e){console.log("Unhandled exception in Action item, offending item follows: "+e),console.log(t),S.trackException(e)}}),e.isHeader||e.isToolbar||!E(e)||(a.push(L(D,e,!0)),a.push(L(O,e,!0))),a},selectionChanged:function(){},rowDoubleClick:function(){},createColumn:function(){},createInNewWindow:function(){var t,a=this,i=a.settings.metadata.keyPrefix+"/e";if(a.settings.newButtonURL&&a.settings.newButtonURL.length>0)i=a.settings.newButtonURL;else if(a.settings.metadata&&a.settings.metadata.recordTypeInfos&&a.settings.metadata.recordTypeInfos.length>0){var n=Object.where(a.settings.metadata.recordTypeInfos,function(e){return"true"===e.available});if(n.length>1&&(t=t||{},t.ent=a.settings.pageInfo.objectName,t.save_new_url=i,i="setup/ui/recordtypeselect.jsp","true"===a.settings.metadata.custom))return void I.getCustomObjectId(a.settings.pageInfo.objectName,function(a){t.ent=a,e.navigateToPage(i,t,!0)},function(e){console.log("Error retrieving custom object id for object "+a.settings.pageInfo.objectName),console.log(JSON.stringify(e))})}e.navigateToPage(i,t,!0)},dataReady:function(t){if(!this.firstTime&&(A(t),this.firstTime=!0,"undefined"!=typeof CRMC_PP&&"undefined"!=typeof CRMC_PP.DrillUpController||"undefined"!=typeof DrillUpController)){var a={remoteActions:{getDrillUpItemsForObject:e.getRemoteAction("DrillUpController","getDrillUpItemsForObject"),getDrillDownItemsForObject:e.getRemoteAction("DrillUpController","getDrillDownItemsForObject")}};crmc.require(["DrillUpMenuItem"],function(e){e.init([t.actionGrid],a)})}}};return M}),crmc.define("MultiSelectGridFilter",["GridConstants","sfdc","mixpanel"],function(e,t,a){var i=kendo.ui,n=i.Widget,o=n.extend({init:function(i,o){var r=this;n.fn.init.call(r,i,o);var s,l,d,c,u,p,f,m,h,g=[],v=[],b=null,y=!1,k=0,w=!1,x=!1,I=r.options.fieldMeta.type.toLowerCase(),S="child"==I,C="multipicklist"==I,N=$.inArray(I,["datepart","datetimepart"])>-1,_=!1,T=50,D=r.options.fieldMeta.parentMeta&&r.options.fieldMeta.parentMeta.relObjectName&&"user"==r.options.fieldMeta.parentMeta.relObjectName.toLowerCase();N&&(I=I.split("part")[0]);var O=r.options.field;if(S){var R=r.options.fieldMeta.childFieldName.split(",");O=R[0]}var j=1==S?r.options.fieldMeta.name+"!"+O:O,P=1==S?r.options.fieldMeta.relObjectName:r.options.objectName,E=[O],F=O.split("."),A=F[F.length-1],L=$.map(E,function(e){return{field:e}}),M=function(){r.element.parent().css("top",0),0==C&&We.value("in"),""==We.value()&&(1==C?We.element.val("or"):We.element.val("in"));var e=null,a=null,i=q(r.options.fieldMeta.name);i.length>0&&$.each(i,function(t,i){"notexists"==i.operator||"exists"==i.operator?e=i.operator:"dynamic"==i.operator&&(a=i.value)});var n=function(e,a,i){var n=i.length>0,o="kendoDatePicker",s=Ve;"datetime"==e&&(o="kendoDateTimePicker",s=De);var l=r.element.find("input."+e+".logic-list").data("kendoDropDownList"),d=r.element.find("input."+e+".value.first").data(o),c=r.element.find("input."+e+".value.second").data(o),u=r.element.find("input."+e+".operator-list.first").data("kendoDropDownList"),p=r.element.find("input."+e+".operator-list.second").data("kendoDropDownList"),f=r.element.find("input.rel"+e+".N.first:not(.k-formatted-value)").data("kendoNumericTextBox"),m=r.element.find("input.rel"+e+".N.first.k-formatted-value"),h=r.element.find("input.rel"+e+".N.second:not(.k-formatted-value)").data("kendoNumericTextBox"),g=r.element.find("input.rel"+e+".N.second.k-formatted-value"),v=r.element.find("input.rel"+e+".value.first:not(.k-input)").data("kendoComboBox"),y=r.element.find("input.rel"+e+".value.second:not(.k-input)").data("kendoComboBox"),k=r.element.find(".rel"+e+".toggle.first .k-sprite.k-icon"),w=r.element.find(".rel"+e+".toggle.second .k-sprite.k-icon");v.dataSource.filter({}),y.dataSource.filter({}),a!=e&&a!=e||!n?(d.value(null),c.value(null),l.value("and"),v.value(null),y.value(null),f.value(null),h.value(null),y.value(null),u.value(s[0].value),p.value(s[0].value),r.element.find(".rel"+e+"-div").hide(),d.wrapper.show(),c.wrapper.show(),r.element.find(".rel"+e+"-div").hide(),f.wrapper.hide(),m.hide(),h.wrapper.hide(),g.hide(),k.removeClass("k-i-calendar"),k.addClass("k-i-custom"),w.removeClass("k-i-calendar"),w.addClass("k-i-custom")):(null==b?l.value("and"):l.value(b),$.each(i,function(a,n){try{if("string"==typeof n.value){var o=kendo.parseDate(n.value,"yyyy-MM-ddTHH:mm:ss.fffZ");"date"!=e&&(o=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes())),o=t.convertToUserDateTime(o)),o||0!=a?o||1!=a||y.value(n.value):v.value(n.value)}0==a?(d.value(o),u.value(n.operator),1==i.length&&(c.value(null),l.value("and"),p.value(s[0].value))):(c.value(o),p.value(n.operator))}catch(e){var r=n.value.split(":");0==a?(v.value(r[0]),u.value(n.operator),2==r.length&&f.value(r[1]),1==i.length&&(y.value(null),h.value(null),l.value("and"),p.value(s[0].value))):(y.value(r[0]),p.value(n.operator),2==r.length&&h.value(r[1]))}}),null!=v.value()&&""!=v.value()?(r.element.find(".rel"+e+"-div.first").show(),null!=f.value()&&""!=f.value()?(f.wrapper.show(),
m.show()):(f.wrapper.hide(),m.hide()),k.addClass("k-i-calendar"),k.removeClass("k-i-custom"),d.wrapper.hide()):(r.element.find(".rel"+e+"-div.first").hide(),f.wrapper.hide(),m.hide(),d.wrapper.show(),k.removeClass("k-i-calendar"),k.addClass("k-i-custom")),null!=y.value()&&""!=y.value()?(r.element.find(".rel"+e+"-div.second").show(),null!=h.value()&&""!=h.value()?(h.wrapper.show(),g.show()):(h.wrapper.hide(),g.hide()),w.addClass("k-i-calendar"),w.removeClass("k-i-custom"),c.wrapper.hide()):(r.element.find(".rel"+e+"-div.second").hide(),h.wrapper.hide(),g.hide(),c.wrapper.show(),w.removeClass("k-i-calendar"),w.addClass("k-i-custom")))};if(l.prop("disabled",!1),1!=S||$.inArray(m.dataItem().type.toLowerCase(),["integer","currency","double","percent","boolean","time","date","datetime"])==-1&&0!=m.dataItem().isGroupable||"multipicklist"==m.dataItem().type.toLowerCase())if($.inArray(I,["date","datetime"])!=-1)n(I,I,i),l.prop("disabled",!1);else{if(S&&D){var i=q(r.options.fieldMeta.name+"!"+m.value());$.each(i,function(e,t){if("dynamic"==t.operator)return a=t.value,!1})}"me"==a?p.prop("checked",!0):p.prop("checked",!1),g=[],d.val(""),x=!1,c.next().html("<b>(Select All)</b>"),c.prop("checked",!0),c.prop("indeterminate",!1),u.parent().hide(),u.prop("checked",!1),s.dataSource._filter=null,l.prop("disabled",!0),s.dataSource.read()}else{var i=q(r.options.fieldMeta.name+"!"+m.value()),o=i.length>0,f=m.dataItem().type.toLowerCase();"boolean"==f&&o?(K.value(i[0].value),Y.value(i[0].operator)):(K.value(null),Y.value("eq")),$.inArray(f,["integer","currency","double","percent"])!=-1&&o?(null==b?J.value("and"):J.value(b),$.each(i,function(e,t){0==e?(X.value(t.value),ae.value(t.operator)):(Z.value(t.value),ie.value(t.operator))}),1==i.length&&(J.value("and"),Z.value(null),ie.value(ee[0].value))):(X.value(null),Z.value(null),J.value("and"),ae.value(ee[0].value),ie.value(ee[0].value)),"string"==f&&o?(null==b?oe.value("and"):oe.value(b),$.each(i,function(e,t){0==e?(re.val(t.value),de.value(t.operator)):(se.val(t.value),ce.value(t.operator))}),1==i.length&&(se.val(""),oe.value("and"),ce.value(le[0].value))):(re.val(""),se.val(""),oe.value("and"),de.value(le[0].value),ce.value(le[0].value)),"time"==f&&o?(null==b?pe.value("and"):pe.value(b),$.each(i,function(e,t){0==e?(fe.value(t.value),ge.value(t.operator)):(me.value(t.value),ve.value(t.operator))}),1==i.length&&(me.value(null),pe.value("and"),ve.value(he[0].value))):(fe.value(null),me.value(null),pe.value("and"),ge.value(he[0].value),ve.value(he[0].value)),n("date",f,i),n("datetime",f,i)}ze(),_=!1},V=function(e,t,a,i){var n,o=r.options.gridDataSource.filter();return n=e===!0?o:o?jQuery.extend(!0,{},o):o,b=null,G(n,t,a,i),B(n,!0),n&&"undefined"!=n.filters&&0==n.filters.length&&(n=null),n},G=function(e,t,a,i){if("undefined"!=typeof e&&null!=e)if("undefined"!=typeof e.filters)b=e.logic,G(e.filters,t,a,i);else for(var n=e.length-1;n>=0;n--)if("undefined"!=typeof e[n].field)if(e[n].field==t){var o=t.split("!");e[n].field=o[o.length-1];var s=e.splice(n,1)[0];null!=i&&i instanceof Array&&i.unshift(s)}else 1==a&&1==S&&(t.indexOf("!")==-1&&e[n].field.indexOf(t+"!")!=-1||t.indexOf("!")!=-1&&e[n].field==r.options.fieldMeta.name)&&e.splice(n,1);else"undefined"!=typeof e[n].filters&&(b=e[n].logic,G(e[n].filters,t,a,i))},B=function(e,t){if(e)if(t){if("undefined"!=typeof e.filters&&e.filters.length>0)for(var a=e.filters.length-1;a>=0;a--)"undefined"!=typeof e.filters[a].filters&&(0==e.filters[a].filters.length?e.filters.splice(a,1):B(e.filters[a].filters,!1))}else for(var a=e.length-1;a>=0;a--)"undefined"!=typeof e[a].filters&&(0==e[a].filters.length?e.splice(a,1):B(e[a].filters,!1))},q=function(e){var t=r.options.gridDataSource.filter(),a=jQuery.extend(!0,{},t),i=[];return G(a,e,!1,i),i},U=r.element;if(1==S){h=new kendo.data.DataSource({transport:{read:function(e){t.executeRemoteAction("getFieldMetaForObject",[P,!0],function(t,a){a.status?(t=Array.orderBy(t,function(e){return e.displayName}),t=$.grep(t,function(e){return 1==e.isFilterable}),t.unshift({name:"",displayName:"(None)",type:""}),e.success(t)):e.error(t)})}}});var H=$("<div class='exist filter'></div>");H.append("<input type='radio' name='radExist' value='exists' checked='checked'/>Exists"),H.append("<input type='radio' name='radExist' value='notexists'/>Does not exist"),r.element.append(H);var W=$("<ul role='listbox' unselectable='on' class='k-reset' style='width:277px'/>");r.element.append(W),U=$("<div class='field filter'></div>"),r.element.append(U),U.append("<label>Select field:</label><br/>"),U.append("<input class='field-list' style='width: 99%' value='"+O+"' />");var z=$("<div class='bool filter filter-div' style='display:none'></div>");z.append("<label>Show items with value that:</label>"),z.append("<input class='bool operator-list' />"),z.append("<input class='bool value-list' />"),U.append(z);var K=r.element.find(".bool.value-list").kendoDropDownList({dataSource:[{value:null,text:"-Select value-"},{value:"false",text:"No"},{value:"true",text:"Yes"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),Y=r.element.find(".bool.operator-list").kendoDropDownList({dataSource:[{value:"eq",text:"Is equal to"},{value:"neq",text:"Is not equal to"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),Q=$("<div class='num filter filter-div' style='display:none'></div>");Q.append("<label>Show items with value that:</label>"),Q.append("<input class='num operator-list first' />"),Q.append("<input class='num value first' type='text' />"),Q.append("<input class='num logic-list' />"),Q.append("<input class='num operator-list second' />"),Q.append("<input class='num value second' type='text' />"),U.append(Q);var J=r.element.find(".num.logic-list").kendoDropDownList({dataSource:[{value:"and",text:"And"},{value:"or",text:"Or"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),X=r.element.find(".num.value.first").kendoNumericTextBox({}).data("kendoNumericTextBox"),Z=r.element.find(".num.value.second").kendoNumericTextBox({}).data("kendoNumericTextBox"),ee=[];for(var te in e.operators.number)ee.push({value:te,text:e.operators.number[te]});var ae=r.element.find(".num.operator-list.first").kendoDropDownList({dataSource:ee,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),ie=r.element.find(".num.operator-list.second").kendoDropDownList({dataSource:ee,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),ne=$("<div class='string filter filter-div' style='display:none'></div>");ne.append("<label>Show items with value that:</label>"),ne.append("<input class='string operator-list first' />"),ne.append("<input class='string value first k-textbox' type='text' />"),ne.append("<input class='string logic-list' />"),ne.append("<input class='string operator-list second' />"),ne.append("<input class='string value second k-textbox' type='text' />"),U.append(ne);var oe=r.element.find(".string.logic-list").kendoDropDownList({dataSource:[{value:"and",text:"And"},{value:"or",text:"Or"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),re=r.element.find(".string.value.first"),se=r.element.find(".string.value.second"),le=[];for(var te in e.operators.string)le.push({value:te,text:e.operators.string[te]});var de=r.element.find(".string.operator-list.first").kendoDropDownList({dataSource:le,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),ce=r.element.find(".string.operator-list.second").kendoDropDownList({dataSource:le,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),ue=$("<div class='time filter filter-div' style='display:none'></div>");ue.append("<label>Show items with value that:</label>"),ue.append("<input class='time operator-list first' />"),ue.append("<input class='time value first' type='text' />"),ue.append("<input class='time logic-list' />"),ue.append("<input class='time operator-list second' />"),ue.append("<input class='time value second' type='text' />"),U.append(ue);var pe=r.element.find(".time.logic-list").kendoDropDownList({dataSource:[{value:"and",text:"And"},{value:"or",text:"Or"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),fe=r.element.find(".time.value.first").kendoTimePicker({}).data("kendoTimePicker"),me=r.element.find(".time.value.second").kendoTimePicker({}).data("kendoTimePicker"),he=[];for(var te in e.operators.date)he.push({value:te,text:e.operators.date[te]});var ge=r.element.find(".time.operator-list.first").kendoDropDownList({dataSource:he,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),ve=r.element.find(".time.operator-list.second").kendoDropDownList({dataSource:he,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),be=function(){var e=W.find("li:eq(1)");if(1==e.length){var t=e.attr("data-field-name");$.each(m.dataSource.data(),function(e,a){if(a.name==t)return m.select(e),!1})}else{var a=q(r.options.fieldMeta.name);if(a.length>0)m.select(0),W.find("li:first").addClass("k-primary");else{var i=r.options.fieldMeta.childFieldName.split(",");$.each(m.dataSource.data(),function(e,t){if(t.name==i[0])return m.select(e),!1})}}},ye=function(e){O=m.value(),j=r.options.fieldMeta.name+"!"+O,E=[O],F=O.split("."),L=$.map(E,function(e){return{field:e}}),A=F[F.length-1];var t=e.sender.dataItem().type.toLowerCase();if(C="multipicklist"==t,D=null!=e.sender.dataItem().relObjectName&&"user"==e.sender.dataItem().relObjectName.toLowerCase(),Ze(!1,t),""==t)r.element.find(".filter-div").hide();else if("boolean"==t)z.show(),z.siblings(".filter-div").hide();else if($.inArray(t,["integer","percent","currency","double"])!=-1)Q.show(),Q.siblings(".filter-div").hide();else if("time"==t)ue.show(),ue.siblings(".filter-div").hide();else if("datetime"==t)we.show(),we.siblings(".filter-div").hide();else if("date"==t)je.show(),je.siblings(".filter-div").hide();else if(0!=e.sender.dataItem().isGroupable||C){Ze(!0),qe.show(),qe.siblings(".filter-div").hide(),1==C?We.setDataSource(Ue):We.setDataSource(He),r.element.find(".smart.logic-div").show();var a=s.options;a.columns=[{width:30,template:function(e){var t=e[A];return void 0==t&&(t=""),'<input type="checkbox" value="'+t+'"/>'}},{field:A,template:function(e){return void 0==e[A]?"(empty)":e[A]}}],s.destroy(),s=r.element.find(".list-view").empty().kendoGrid(a).data("kendoGrid"),s.setDataSource(Xe(e.sender.dataItem().picklistValues)),1==D?r.element.find(".dynamic.filter").parent().show():r.element.find(".dynamic.filter").parent().hide(),r.element.find(".list-view .k-grid-header").css("display","none"),r.element.find(".k-grid-content").css({"min-height":T+"px","overflow-y":"auto"})}else ne.show(),ne.siblings(".filter-div").hide();M()};m=r.element.find(".field-list").kendoDropDownList({dataTextField:"displayName",dataValueField:"name",dataSource:h,template:function(e){var t=e.displayName,a=q(r.options.fieldMeta.name+"!"+e.name);if(a.length>0){t+=" <span class='k-icon k-i-funnel' style='background-position-x: -32px !important'></span>";var i=$(kendo.format("<li class='k-button' unselectabale='on' data-field-name='{0}' style='margin-right:2px;width:initial' title='{1}'/>",e.name,e.displayName)),n=e.displayName.substring(0,18);e.displayName.length>18&&(n+="..."),i.append(kendo.format("<span unselectable='on'>{0}</span>",n)),i.append("<span unselectable='on' class='k-icon k-delete'>delete</span>"),W.append(i)}return t},valueTemplate:function(e){var t=e.displayName,a=q(r.options.fieldMeta.name+"!"+e.name),i=W.find("li[data-field-name='"+e.name+"']");return W.find("li").removeClass("k-primary"),a.length>0&&(t+=" <span class='k-icon k-i-funnel' style='background-position-x: -32px !important'></span>"),i.length>0&&i.addClass("k-primary"),t},dataBound:function(e){be(),ye(e)},cascade:function(e){ye(e)}}).data("kendoDropDownList"),W.delegate("li span","click",function(e){$(this).parent().siblings().removeClass("k-primary"),$(this).parent().addClass("k-primary");var t=this,a=$(this).parent().attr("data-field-name");$.each(m.dataSource.data(),function(e,i){if(i.name==a)return m.select(e),$(t).hasClass("k-delete")&&tt(!1),!1})})}var ke=function(e,t){var a=r.element.find("input.rel"+t+".value."+e+":not(.k-input)").data("kendoComboBox"),i="date"==t?"kendoDatePicker":"kendoDateTimePicker",n=r.element.find("input."+t+".value."+e).data(i);a.value(""),a.close(),n.value(null),r.element.find(".rel"+t+"-div."+e).toggle(),r.element.find(".rel"+t+".N."+e).hide(),n.wrapper.toggle(),r.element.find(".rel"+t+".toggle."+e+" .k-sprite.k-icon").toggleClass("k-i-custom"),r.element.find(".rel"+t+".toggle."+e+" .k-sprite.k-icon").toggleClass("k-i-calendar"),r.element.find(".rel"+t+"-div."+e).is(":visible")?r.element.find(".rel"+t+".toggle."+e).attr("title","Switch to static date"):r.element.find(".rel"+t+".toggle."+e).attr("title","Switch to relative date")},we=$("<div class='datetime filter filter-div' style='display:none'></div>");we.append("<label>Show items with value that:</label>"),we.append("<input class='datetime operator-list first'/>"),we.append("<em class='reldatetime toggle first' title='Switch to relative date'><span class='k-sprite'>Toggle Relative Date</span></em>"),we.append("<input class='datetime value first' type='text' />"),we.append("<div class='reldatetime-div first'><input class='reldatetime value first' type='text'/><input class='reldatetime N first' type='text' style='display:none'/></div>"),we.append("<input class='datetime logic-list' />"),we.append("<input class='datetime operator-list second' />"),we.append("<em class='reldatetime toggle second' title='Switch to relative date'><span class='k-sprite'>Toggle Relative Date</span></em>"),we.append("<input class='datetime value second' type='text' />"),we.append("<div class='reldatetime-div second'><input class='reldatetime value second' type='text'/><input class='reldatetime N second' type='text' style='display:none'/></div>"),U.append(we);var xe=r.element.find(".datetime.logic-list").kendoDropDownList({dataSource:[{value:"and",text:"And"},{value:"or",text:"Or"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList");r.element.find("input.datetime.value").kendoDateTimePicker();var Ie=r.element.find("input.datetime.value.first").data("kendoDateTimePicker"),Se=r.element.find("input.datetime.value.second").data("kendoDateTimePicker");r.element.find(".reldatetime.N").kendoNumericTextBox({min:1,step:1,format:"0.",change:function(){null!=this.value()&&""!=this.value()||this.value(1)}});var Ce=r.element.find("input.reldatetime.N.first:not(.k-formatted-value)").data("kendoNumericTextBox"),Ne=r.element.find("input.reldatetime.N.second:not(.k-formatted-value)").data("kendoNumericTextBox");r.element.find("input.reldatetime.value").kendoComboBox({dataSource:e.relativeDates,dataTextField:"displayName",dataValueField:"dateLiteral",template:function(e){return kendo.format(e.displayName,"n")},filter:"contains",change:function(e){if(this.value()&&this.selectedIndex==-1)this.value(""),this.text("");else{var t=this.wrapper.hasClass("first")?"first":"second",a=r.element.find("input.reldatetime.N."+t+":not(.k-formatted-value)").data("kendoNumericTextBox"),i=r.element.find("input.reldatetime.N."+t+".k-formatted-value");this.dataItem().requiresN?(a.wrapper.show(),a.value(1),i.show()):(a.wrapper.hide(),a.value(null),i.hide())}}});var _e=r.element.find("input.reldatetime.value.first:not(.k-input)").data("kendoComboBox"),Te=r.element.find("input.reldatetime.value.second:not(.k-input)").data("kendoComboBox");r.element.find("em.reldatetime.toggle").kendoButton({spriteCssClass:"k-icon k-i-custom"}).data("kendoButton"),r.element.find(".reldatetime-div").css("display","inline"),r.element.find(".reldatetime-div").hide(),r.element.find(".reldatetime.toggle").css({width:"24px","margin-right":"2px","margin-top":"1px",height:"24px"}),r.element.find(".datetime.value").closest(".k-widget").css({display:"inline-block",width:"158px"}),r.element.find(".reldatetime.value").closest(".k-widget").css({width:"140px","margin-right":"2px",display:"inline-block"}),r.element.find(".reldatetime.N").closest(".k-widget").css({width:"48px",display:"inline-block"}),r.element.find(".datetime.value").on("input",function(e){var t=$(this).val().match(/^[a-zA-Z]+$/);if(null!=t){var a=$(this).val(),i=$(this).hasClass("first")?"first":"second",n=r.element.find("input.reldatetime.value."+i+":not(.k-input)").data("kendoComboBox");ke(i,"datetime"),n.value(a),n.search(a),n.focus()}}),r.element.find(".reldatetime.value").closest(".k-widget").on("input",function(e){var t=$(this).hasClass("first")?"first":"second",a=r.element.find("input.reldatetime.value."+t+":not(.k-input)").data("kendoComboBox");if(""==a.text()){ke(t,"datetime");var i=r.element.find("input.datetime.value.k-input."+t);i.focus()}}),r.element.find(".reldatetime.toggle").on("click",function(){var e=$(this).hasClass("first")?"first":"second";ke(e,"datetime")});var De=[];for(var te in e.operators.date)De.push({value:te,text:e.operators.date[te]});var Oe=r.element.find(".datetime.operator-list.first").kendoDropDownList({dataSource:De,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),Re=r.element.find(".datetime.operator-list.second").kendoDropDownList({dataSource:De,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),je=$("<div class='date filter filter-div' style='display:none; width: 217px'></div>");je.append("<label>Show items with value that:</label>"),je.append("<input class='date operator-list first' />"),je.append("<em class='reldate toggle first' title='Switch to relative date'><span class='k-sprite'>Toggle Relative Date</span></em>"),je.append("<input class='date value first' type='text' />"),je.append("<div class='reldate-div first'><input class='reldate value first' type='text'/><input class='reldate N first' type='text' style='display:none'/></div>"),je.append("<input class='date logic-list' />"),je.append("<input class='date operator-list second' />"),je.append("<em class='reldate toggle second' title='Switch to relative date'><span class='k-sprite'>Toggle Relative Date</span></em>"),je.append("<input class='date value second' type='text' />"),je.append("<div class='reldate-div second'><input class='reldate value second' type='text'/><input class='reldate N second' type='text' style='display:none'/></div>"),U.append(je);var Pe=r.element.find(".date.logic-list").kendoDropDownList({dataSource:[{value:"and",text:"And"},{value:"or",text:"Or"}],dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList");r.element.find("input.date.value").kendoDatePicker();var Ee=r.element.find("input.date.value.first").data("kendoDatePicker"),Fe=r.element.find("input.date.value.second").data("kendoDatePicker");r.element.find(".reldate.N").kendoNumericTextBox({min:1,step:1,format:"0."});var Ae=r.element.find("input.reldate.N.first:not(.k-formatted-value)").data("kendoNumericTextBox"),Le=r.element.find("input.reldate.N.second:not(.k-formatted-value)").data("kendoNumericTextBox");r.element.find("input.reldate.value").kendoComboBox({dataSource:e.relativeDates,dataTextField:"displayName",dataValueField:"dateLiteral",template:function(e){return kendo.format(e.displayName,"n")},filter:"contains",change:function(e){if(this.value()&&this.selectedIndex==-1)this.value(""),this.text("");else{var t=this.wrapper.hasClass("first")?"first":"second",a=r.element.find("input.reldate.N."+t+":not(.k-formatted-value)").data("kendoNumericTextBox"),i=r.element.find("input.reldate.N."+t+".k-formatted-value");this.dataItem().requiresN?(a.wrapper.show(),a.value(1),i.show()):(a.wrapper.hide(),a.value(null),i.hide())}}});var Me=r.element.find("input.reldate.value.first:not(.k-input)").data("kendoComboBox"),$e=r.element.find("input.reldate.value.second:not(.k-input)").data("kendoComboBox");r.element.find("em.reldate.toggle").kendoButton({spriteCssClass:"k-icon k-i-custom"}).data("kendoButton"),r.element.find(".reldate-div").css("display","inline"),r.element.find(".reldate-div").hide(),r.element.find(".reldate.toggle").css({width:"24px","margin-right":"2px","margin-top":"1px",height:"24px"}),r.element.find(".date.value").closest(".k-widget").css({display:"inline-block",width:"120px"}),r.element.find(".reldate.value").closest(".k-widget").css({width:"140px","margin-right":"2px",display:"inline-block"}),r.element.find(".reldate.N").closest(".k-widget").css({width:"48px",display:"inline-block"}),r.element.find(".date.value").on("input",function(e){var t=$(this).val().match(/^[a-zA-Z]+$/);if(null!=t){var a=$(this).val(),i=$(this).hasClass("first")?"first":"second",n=r.element.find("input.reldate.value."+i+":not(.k-input)").data("kendoComboBox");ke(i,"date"),n.value(a),n.search(a),n.focus()}}),r.element.find(".reldate.value").closest(".k-widget").on("input",function(e){var t=$(this).hasClass("first")?"first":"second",a=r.element.find("input.reldate.value."+t+":not(.k-input)").data("kendoComboBox");if(""==a.text()){ke(t,"date");var i=r.element.find("input.date.value.k-input."+t);i.focus()}}),r.element.find(".reldate.toggle").on("click",function(){var e=$(this).hasClass("first")?"first":"second";ke(e,"date")});var Ve=[];for(var te in e.operators.date)Ve.push({value:te,text:e.operators.date[te]});var Ge=r.element.find(".date.operator-list.first").kendoDropDownList({dataSource:Ve,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList"),Be=r.element.find(".date.operator-list.second").kendoDropDownList({dataSource:Ve,dataTextField:"text",dataValueField:"value"}).data("kendoDropDownList");r.element.find(".logic-list").css("margin",".5em 0 .5em"),r.element.find(".filter").css("margin-top",".5em"),r.element.find(".filter-div, .operator-list, .logic-list, .value-list, .value:not(.date, .datetime, .reldate, .reldatetime)").css("width","100%"),r.element.find(".k-widget.date.value, .k-widget.datetime.value").css("width","calc(100% - 26px)"),r.element.find(".k-widget.reldate.value, .k-widget.reldatetime.value").css("width","calc(100% - 76px)"),0==S&&r.element.find(".datetime.filter-div, .date.filter-div").css("width","217px");var qe=$('<div class="smart filter filter-div" style="display:none;" ><div>');qe.append("<input class='smart operator-list' style='height:23px;margin-right:4px;display:none'/>"),d=$("<input type='search' class='k-textbox' style='margin-top:.5em;width:100%' placeholder='Search'/>"),qe.append(d),qe.append('<div style="margin-bottom:4px;margin-top:.5em;display:none"><input type="checkbox" class="dynamic my filter" style="margin-left:10px;margin-right:12px;vertical-align:middle;position:relative;bottom:1px"/>&nbsp;<b>My</b></div>'),qe.append('<div style="margin-bottom:4px;margin-top:4px"><input type="checkbox" class="select-all-checkbox" checked="checked" style="margin-left:10px;margin-right:12px;vertical-align:middle;position:relative;bottom:1px"/>&nbsp;<b>(Select All)</b></div>'),qe.append('<div style="margin-bottom:4px;margin-top:4px;display:none"><input type="checkbox" class="add-selection-to-filter" style="margin-left:10px;margin-right:12px;vertical-align:middle;position:relative;bottom:1px"/>&nbsp;<b>Add current selection to filter</b></div>'),qe.append('<div class="list-view" style="width:275px;"></div>'),qe.append('<div class="smart logic-div" style="display:none;margin-top:.5em">Show items that: <input class="smart logic-list" style="width:auto"/></div>'),U.append(qe);var Ue=[{text:"Include any selected values",value:"or"},{text:"Include all selected values",value:"and"},{text:"Include only selected values",value:"eq"}],He=[{text:"Include selected values",value:"in"},{text:"Exclude selected values",value:"not in"}],We=r.element.find(".smart.logic-list").kendoDropDownList({dataSource:1==C?Ue:He,dataTextField:"text",dataValueField:"value",change:function(e){_=!0}}).data("kendoDropDownList");1==D&&r.element.find(".dynamic.filter").parent().show(),r.element.append('<div style="width:150px;margin:.5em 0 .5em"><button class="k-button k-primary filter-button" style="width:40%">Filter</button> <button class="k-button clear-button" style="width:50%">Clear'+(1==S?" All":"")+"</button></div>"),c=r.element.find(".select-all-checkbox"),u=r.element.find(".add-selection-to-filter"),p=r.element.find(".my.dynamic.filter"),p.on("click",function(e){var t=p.prop("checked");t&&c.prop("checked",!1)}),f=r.element.find(".myteam.dynamic.filter"),l=r.element.find(".filter-button"),r.element.find(".dynamic.filter").bind("click",function(e){Qe()});var ze=function(){var e=215;if(S){e=300;var t=W.height();t>0&&(e+=t-15)}C&&(e+=45),D&&(e+=18),u.is(":visible")&&(e+=18);var a=(r.element.parent(),$("#"+r.options.gridId+" .k-grid-content")),i=$("#"+r.options.gridId+" .k-grid-footer"),n=$("#"+r.options.gridId+" .k-grid-pager"),o=(a?a.height():0)+(i?i.height():0)+(n?n.height():0),s=o-e;s<T&&(s=T),r.element.find(".k-grid-content").css("max-height",s)},Ke=[{value:"contains",text:"Contains"},{value:"doesnotcontain",text:"Does not contain"},{value:"startswith",text:"Starts with"},{value:"endswith",text:"Ends with"},{value:"eq",text:"Is equal to"},{value:"neq",text:"Is not equal to"}],Ye=r.element.find(".smart.operator-list").kendoDropDownList({dataSource:Ke,dataTextField:"text",dataValueField:"value",change:function(){""!=d.val()&&d.trigger("input")}}).data("kendoDropDownList");r.element.find(".k-dropdown.smart.operator-list").css("display","none");var Qe=function(){""==d.val()&&p.is(":visible")&&!p.is(":checked")&&(0==s.dataSource.total()||0==c.prop("checked")&&0==c.prop("indeterminate"))?l.prop("disabled",!0):l.prop("disabled",!1)},Je=function(){var e=k;$.each(g,function(t,a){a.checked?e++:e--}),e==s.dataSource.total()?(c.prop("checked",!0),c.prop("indeterminate",!1),r.element.find(".list-view input").prop("checked",!0)):0==e?(c.prop("checked",!1),c.prop("indeterminate",!1),r.element.find(".list-view input").prop("checked",!1)):(c.prop("checked",!1),c.prop("indeterminate",!0))},Xe=function(e){var i;if(1==C){var n=[],o={};o[A]=null,n.push(o),$.each(e,function(e,t){if(1==t.active){var a={};a[A]=t.label,n.push(a)}}),i=new kendo.data.DataSource({data:n,pageSize:10,page:1,change:function(){if(v=[],V(!1,j,!0,v),0==v.length)k=n.length;else{k=0;var e=[];"neq"!=v[0].operator&&"excludes"!=v[0].operator||$.each(s.dataSource.data(),function(t,a){var i=a[A];null==i&&(i=""),e.push(i)}),$.each(v,function(t,a){var i=[];i="eq"==a.operator||"neq"==a.operator?a.value.split(";"):JSON.parse(a.value),$.each(i,function(t,i){$.each(s.dataSource.data(),function(t,n){var o=n[A];if(null==o&&(o=""),("eq"==a.operator||"includes"==a.operator)&&o==i)return e.indexOf(o)==-1&&e.push(o),!1;if(("neq"==a.operator||"excludes"==a.operator)&&o==i){var r=e.indexOf(o);return r!=-1&&e.splice(r,1),!1}})})}),k=e.length}}})}else i=new kendo.data.DataSource({transport:{read:function(e){v=[];var i=V(!1,j,!0,v);1==S?i=null:r.options.baseFilter&&(i?i.filters?i.filters.push(r.options.baseFilter):i.filters=[r.options.baseFilter]:i=jQuery.extend(!0,{},r.options.baseFilter)),e.data.filter&&(v=[],i?i.filters?i.filters.push(e.data.filter):i.filters=[e.data.filter]:i=e.data.filter);var n=0;s&&s.dataSource&&(n=s.dataSource.total()),e.data.sort=[{field:O,dir:"asc"}];var o={takeCount:e.data.take,skipCount:e.data.skip,sorts:e.data.sort,groups:L,filter:i,objectName:P,columns:E};return O&&""!=O?void t.executeRemoteAction("getPage",[o],function(r,s){if(s.status)if(y=r.totalResults!=n,v.length>0){var l={logic:"and",filters:[]};0==S&&null!=i&&(l={logic:"and",filters:[i]});var d={logic:"and",filters:[]},c={logic:"or",filters:[]},u={logic:"or",filters:[]},p=!0;if($.each(v,function(e,t){if("dynamic"==t.operator)return!0;p=!1;var a={field:O,operator:t.operator,value:t.value};"neq"==t.operator||"doesnotcontain"==t.operator?d.filters.push(a):"eq"==t.operator?c.filters.push(a):u.filters.push(a)}),1==p)return k=0,e.success(r),!0;u.filters.length>0&&d.filters.push(u),d.filters.length>0&&c.filters.push(d),c.filters.length>0&&l.filters.push(c),o.filter=l,t.executeRemoteAction("getPage",[o],function(t,a){a.status?(k=t.totalResults,e.success(r)):e.error(t,a)})}else k=r.totalResults,e.success(r);else console.log("error",r),e.error(r,s),a.trackException(s)},{escape:!1}):void e.success({results:[]})}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,schema:{data:"results",total:"totalResults",parse:function(e){return $.each(e.results,function(e,t){O in t||(t[O]=t[A])}),e}},error:function(e){console.log("error",e),a.trackException(e)}});return i},Ze=function(e,t){var a=r.element.closest(".k-animation-container"),i=275,n=$("#"+r.options.gridId+' th[data-field="'+(1==S?r.options.fieldMeta.relationshipName:O)+'"] .k-grid-filter').get(0),o=n.getBoundingClientRect().left,s=20;o+s+i>$(window).width()?a.css("left",$(window).width()-i-s):a.css("left",o+1)},et=function(){var e=null,t=q(r.options.fieldMeta.name);if(t.length>0&&$.each(t,function(t,a){"notexists"!=a.operator&&"exists"!=a.operator||(e=a.operator)}),null!=e){var a="exists"==e?"Exists":"Does not exist",i=$(kendo.format("<li class='k-button' unselectabale='on' data-field-name='' style='margin-right:2px;width:initial' title='{1}'/>",a));i.append(kendo.format("<span unselectable='on'>{0}</span>",a)),W.append(i)}else e="exists";H.find("input[name=radExist][value='"+e+"']").prop("checked",!0)};$("#"+r.options.gridId+' th[data-field="'+(1==S?r.options.fieldMeta.relationshipName:O)+'"] .k-grid-filter').bind("click",function(e){e.preventDefault(),1==S&&(W.empty(),et()),1==S&&U.is(":visible")&&m.refresh(),M()}),r.element.delegate(".list-view input","click",function(){var e=g.length,t=this;g=$.grep(g,function(e){return e.value!=t.value}),g.length==e&&g.push({value:this.value,checked:$(this).is(":checked")}),Je(),Qe()}),s=r.element.find(".list-view").kendoGrid({dataSource:Xe(r.options.fieldMeta.picklistValues),autoBind:!1,pageable:{info:!0,numeric:!1,previousNext:!0},columns:[{width:30,template:function(e){var t=e[A];return void 0==t&&(t=""),'<input type="checkbox" value="'+t.replace(/"/g,"&quot;")+'"/>'}},{field:A,template:function(e){return void 0==e[A]?"(empty)":e[A]}}],dataBound:function(e){if(""!=d.val()&&1==c.prop("checked")&&c.prop("indeterminate",!1))r.element.find(".list-view input").prop("checked",!0);else if(0==x&&v.length>0){if(1==C){var t=0,a="neq"==v[0].operator||"excludes"==v[0].operator;if(r.element.find(".list-view input").prop("checked",a),$.each(v,function(e,i){var n=[];"eq"==i.operator||"neq"==i.operator?n=i.value.split(";"):(n=JSON.parse(i.value),t++),r.element.find(".list-view input").filter(function(){return n.indexOf(this.value)!=-1}).prop("checked",!a)}),0==_){var i=v[0].operator;t>1?We.value("and"):"eq"==i||"neq"==i?We.value("eq"):We.value("or")}}else{r.element.find(".list-view input").prop("checked",!1),$.each(v,function(e,t){r.element.find(".list-view input").filter(function(){var e=this.value.toLowerCase(),a=t.value.toLowerCase();return"contains"==t.operator?e.indexOf(a)!=-1:"startswith"==t.operator?0===e.lastIndexOf(a,0):"endswith"==t.operator?e.indexOf(a,e.length-a.length)===e.length-a.length:void 0}).prop("checked",!0)}),$.each(v,function(e,t){r.element.find(".list-view input").filter(function(){var e=this.value.toLowerCase(),a=t.value.toLowerCase();if("eq"==t.operator)return e==a}).prop("checked",!0)});var n=Object.first(v,function(e){return"neq"==e.operator||"doesnotcontain"==e.operator});n&&0==r.element.find(".list-view input:checked").length&&r.element.find(".list-view input").prop("checked",!0),$.each(v,function(e,t){r.element.find(".list-view input").filter(function(){var e=this.value.toLowerCase(),a=t.value.toLowerCase();if("doesnotcontain"==t.operator)return e.indexOf(a)!=-1}).prop("checked",!1)}),$.each(v,function(e,t){r.element.find(".list-view input").filter(function(){var e=this.value.toLowerCase(),a=t.value.toLowerCase();if("neq"==t.operator)return e==a}).prop("checked",!1)})}Je()}else{var o=c.prop("checked");1==c.prop("indeterminate")&&g.length>0&&(o=!g[0].checked),r.element.find(".list-view input").prop("checked",o);
}$.each(g,function(e,t){r.element.find('.list-view input[value="'+t.value+'"]').prop("checked",t.checked)}),Qe()}}).data("kendoGrid"),r.element.find(".list-view .k-grid-header").css("display","none"),r.element.find(".k-grid-content").css({"min-height":T+"px","overflow-y":"auto"}),0==S?(M(),l.prop("disabled",!1),"date"==I?je.show():"datetime"==I?we.show():(l.prop("disabled",!0),qe.show(),r.element.find(".smart.logic-div").show(),ze())):et(),d.bind("propertychange keyup input paste",function(e){window.event&&"propertychange"==event.type&&"value"!=event.propertyName||(clearTimeout($(this).data("timeout")),$(this).data("timeout",setTimeout(function(){g=[],w=!1,c.prop("checked",!0),c.prop("indeterminate",!1),u.prop("checked",!1);var e=d.val();e?(c.next().html("<b>(Select All Search Results)</b>"),u.parent().show(),""==Ye.value()&&Ye.element.val("contains"),s.dataSource.filter({field:O,operator:Ye.value(),value:e})):(c.next().html("<b>(Select All)</b>"),u.parent().hide(),s.dataSource.filter({})),ze()},500)))}),c.bind("click",function(){var e=$(this).is(":checked");r.element.find(".list-view input").each(function(){this.checked=e}),Qe(),g=[],k=1==e?s.dataSource.total():0,0==e&&""!=d.val()&&(w=!0),x=!0});var tt=function(e){var t={},a=!1,i=[];1==e&&1==S?(W.find("li").each(function(){i.push(r.options.fieldMeta.name+"!"+$(this).attr("data-field-name"))}),i.push(r.options.fieldMeta.name)):(i.push(j),1==S&&1==W.find("li[data-field-name='"+j.split("!")[1]+"']").length&&1==W.find("li").length&&i.push(r.options.fieldMeta.name)),$.each(i,function(e,i){v=[],t=V(!0,i,!1,v),v.length>0&&(t||(t={}),a=!0)}),a&&r.options.gridDataSource.filter(t),r.element.closest(".k-animation-container").hide()};this.clearFilter=tt,r.element.find(".clear-button").click(function(e){e.preventDefault(),tt(S)});var at=function(e,t,a,i,n,o,r,s,l){var d=!1,c=function(e){return"isnull"===e||"isnotnull"===e},u="and"==l?i:n;return o(a)&&!c(t)||(u.push({field:e,operator:t,value:a}),d=!0),o(s)&&!c(r)||(u.push({field:e,operator:r,value:s}),d=!0),d};r.element.find(".filter-button").click(function(e){e.preventDefault(),v=[],V(!1,j,!0,v);var t={logic:"and",filters:[]},a={logic:"or",filters:[]},i={logic:"or",filters:[]},n=!1,o=function(e){var t=e;return t&&t.indexOf(":")>-1&&(t=t.split(":")[0]),t};if(z&&z.is(":visible"))n=at(j,Y.value(),K.value(),t.filters,a.filters,function(e){return null==e||0==e.length});else if(Q&&Q.is(":visible"))n=at(j,ae.value(),X.value(),t.filters,a.filters,function(e){return null==e},ie.value(),Z.value(),J.value());else if(ne&&ne.is(":visible"))n=at(j,de.value(),re.val(),t.filters,a.filters,function(e){return 0==e.length},ce.value(),se.val(),oe.value());else if(ue&&ue.is(":visible"))n=at(j,ge.value(),fe.value(),t.filters,a.filters,function(e){return null==e},ve.value(),me.value(),pe.value());else if(we&&we.is(":visible")){var l=Ie.value();_e.wrapper.is(":visible")&&(l=o(_e.value()),Ce.wrapper.is(":visible")&&(l+=":"+Ce.value()));var f=Se.value();Te.wrapper.is(":visible")&&(f=o(Te.value()),Ne.wrapper.is(":visible")&&(f+=":"+Ne.value())),n=at(j,Oe.value(),l,t.filters,a.filters,function(e){return null==e||0==e.length},Re.value(),f,xe.value())}else if(je&&je.is(":visible")){var l=Ee.value();Me.wrapper.is(":visible")&&(l=o(Me.value()),Ae.wrapper.is(":visible")&&(l+=":"+Ae.value()));var f=Fe.value();$e.wrapper.is(":visible")&&(f=o($e.value()),Le.wrapper.is(":visible")&&(f+=":"+Le.value())),l instanceof Date&&(l=new Date(Date.UTC(l.getFullYear(),l.getMonth(),l.getDate()))),f instanceof Date&&(f=new Date(Date.UTC(f.getFullYear(),f.getMonth(),f.getDate()))),n=at(j,Ge.value(),l,t.filters,a.filters,function(e){return null==e||0==e.length},Be.value(),f,Pe.value())}else if(qe.is(":visible")){var m=d.val(),h=u.is(":visible")&&u.is(":checked");if(1==c.prop("checked")&&0==c.prop("indeterminate")&&0==h)if(""==m)n=!0;else if(1==C){var b=[];$.each(s.dataSource.data(),function(e,t){t[A]&&t[A].toLowerCase().indexOf(m.toLowerCase())!=-1&&b.push(t[A])}),b.length<s.dataSource.data().length&&("eq"==We.value()?t.filters.push({field:j,operator:"eq",value:b.join(";")}):"or"==We.value()?t.filters.push({field:j,operator:"includes",value:JSON.stringify(b)}):"and"==We.value()&&$.each(b,function(e,a){t.filters.push({field:j,operator:"includes",value:JSON.stringify([a])})}),n=!0)}else{var y="contains",k=i;"not in"==We.value()&&(y="doesnotcontain",k=t),k.filters.push({field:j,operator:y,value:m}),c.prop("indeterminate",!0),n=!0}else if(0==c.prop("checked")&&0==c.prop("indeterminate")&&0==h)if(""==m)n=!1;else if(1==C){var b=[];$.each(s.dataSource.data(),function(e,t){t[A]&&t[A].toLowerCase().indexOf(m.toLowerCase())!=-1&&b.push(t[A])}),"eq"==We.value()?t.filters.push({field:j,operator:"neq",value:b.join(";")}):"or"==We.value()?t.filters.push({field:j,operator:"excludes",value:JSON.stringify(b)}):"and"==We.value()&&$.each(b,function(e,t){a.filters.push({field:j,operator:"excludes",value:JSON.stringify([t])})}),n=!0}else n=!1;else{""==m&&!x||0!=h||(v=[]);var b=[];if((1==C&&v.length>0&&("neq"==v[0].operator||"excludes"==v[0].operator)||1==c.prop("indeterminate")&&g.length>0&&0==g[0].checked)&&$.each(s.dataSource.data(),function(e,t){var a=t[A];null==a&&(a=""),b.push(a)}),$.each(v,function(e,n){if("exists"==n.operator||"notexists"==n.operator)return!0;if(1==C){var o=[];return o="eq"==n.operator||"neq"==n.operator?n.value.split(";"):JSON.parse(n.value),$.each(o,function(e,t){$.each(s.dataSource.data(),function(e,a){var i=a[A];if(null==i&&(i=""),("eq"==n.operator||"includes"==n.operator)&&i==t)return b.indexOf(i)==-1&&b.push(i),!1;if(("neq"==n.operator||"excludes"==n.operator)&&i==t){var o=b.indexOf(i);return o!=-1&&b.splice(o,1),!1}})}),!0}if("eq"==n.operator||"neq"==n.operator){var r=!1,l="neq"==n.operator;if($.each(g,function(e,t){if(t.value==n.value&&t.checked==l)return r=!0,!1}),1==r)return g=$.grep(g,function(e){return!(e.value==n.value&&e.checked==l)}),!0;if(1==h){var d=n.value.toLowerCase().indexOf(m.toLowerCase())!=-1;if("neq"==n.operator&&"in"==We.value()&&d)return!0;if("eq"==n.operator&&"not in"==We.value()&&d)return!0}}else if("dynamic"==n.operator)return!0;var c=n.operator;"not in"==We.value()&&0==h&&("contains"==n.operator?c="doesnotcontain":"doesnotcontain"==n.operator?c="contains":"eq"==n.operator?c="neq":"neq"==n.operator&&(c="eq"));var u={field:j,operator:c,value:n.value};"neq"==c||"doesnotcontain"==n.operator?t.filters.push(u):"eq"==n.operator?a.filters.push(u):i.filters.push(u)}),1==C)""!=m&&$.each(s.dataSource.data(),function(e,t){var a=t[A];if(null==a&&(a=""),0==c.prop("checked")&&0==c.prop("indeterminate")||1==c.prop("indeterminate")&&g.length>0&&g[0].checked){if(a.toLowerCase().indexOf(m.toLowerCase())!=-1){var i=b.indexOf(a);i!=-1&&b.splice(i,1)}}else a.toLowerCase().indexOf(m.toLowerCase())!=-1&&b.indexOf(a)==-1&&b.push(a)}),$.each(g,function(e,t){if(1==t.checked)$.inArray(b,t.value)==-1&&b.push(t.value);else{var a=b.indexOf(t.value);a!=-1&&b.splice(a,1)}}),"eq"==We.value()?t.filters.push({field:j,operator:"eq",value:b.join(";")}):"or"==We.value()?t.filters.push({field:j,operator:"includes",value:JSON.stringify(b)}):"and"==We.value()&&$.each(b,function(e,a){t.filters.push({field:j,operator:"includes",value:JSON.stringify([a])})});else{if(""!=m&&0==w){var y="contains",k=i;"not in"==We.value()&&(y="doesnotcontain",k=t),k.filters.push({field:j,operator:y,value:m})}$.each(g,function(e,i){1==i.checked&&"in"==We.value()||0==i.checked&&"not in"==We.value()?a.filters.push({field:j,operator:"eq",value:i.value}):t.filters.push({field:j,operator:"neq",value:i.value})})}n=!0}}if(H&&H.is(":visible")&&(t.filters.push({field:r.options.fieldMeta.name,operator:H.find("input[name=radExist]:checked").val(),value:""}),n=!0),!p.is(":visible")||!p.is(":checked")||c.is(":checked")&&""==m||(a.filters.push({field:j,operator:"dynamic",value:"me"}),n=!0),n){V(!0,j,!0,v);var I=r.options.gridDataSource.filter();I||(I={logic:"and",filters:[]}),I.filters||(I.filters=[]),i.filters.length>0&&t.filters.push(i),t.filters.length>0&&a.filters.push(t),a.filters.length>0&&I.filters.push(a),r.options.gridDataSource.filter(I)}r.element.closest(".k-animation-container").hide()})},options:{name:"MultiSelectGridFilter"}});i.plugin(o)}),crmc.define("FilterLogic",["sfdc","ExpressionTree","ForeignKeyControl","GridConstants","KendoPopup","ColumnFactory"],function(e,t,a,i,n,o){var r={hasFilter:function(e){var t=jQuery.extend(!0,{},e.gridDataSource.filter());this.removeEmptyFilterArrays(t,!0);var a=[this.getFilterTreeViewData(t,null,[],null,void 0,e)];return a&&a[0]||e.settings.pageInfo.filterId||e.settings.pageInfo.selectedRecordIds&&e.settings.pageInfo.selectedRecordIds.length>0},removeEmptyFilterArrays:function(e,t){var a=this;if(e)if(t){if("undefined"!=typeof e.filters&&e.filters.length>0)for(var i=e.filters.length-1;i>=0;i--)"undefined"!=typeof e.filters[i].filters&&(0==e.filters[i].filters.length?e.filters.splice(i,1):a.removeEmptyFilterArrays(e.filters[i].filters,!1))}else for(var i=e.length-1;i>=0;i--)"undefined"!=typeof e[i].filters&&(0==e[i].filters.length?e.splice(i,1):a.removeEmptyFilterArrays(e[i].filters,!1))},getFilterTreeViewData:function(t,a,n,r,s,l){var d=this;if(void 0===s&&(s={i:1}),void 0!=t.field){var c=t.value,u=t.field,p=t.field.split("!"),f=t.operator,m=t.field,h=m.split("!");h.length>1&&(m=h[0]);var g=null;if($.each(l.fieldMeta,function(a,n){var r=n.type.toLowerCase();if(n.name==m){var s=Object.first(l.kendoGrid.columns,function(e){return e.name==n.name});if(u=s&&s.title||o.getHeaderTitle(n,l.fieldMeta)||n.displayName,"string"==r||"picklist"==r)c=null==t.value||""==t.value?"(empty)":'"'+c+'"';else if("date"==r||"datetime"==r){if("string"==typeof c){var d=c.split(":");if(d.length>=1)var p=Object.first(i.relativeDates,function(e){return e.dateLiteral==d[0]})}if(p){var f=p.formatText;c=f&&d.length>=1?kendo.format(f,d[1]):p.displayName}else{var h=new Date(c),g=!("Invalid Date"===h||isNaN(h));if(g){var v=e.convertToUserDateTime(c);c="date"==r?kendo.format("{0:d}",v):kendo.format("{0:g}",v)}else c=kendo.format("{0:g}",v)}}}}),"includes"!=t.operator.toLowerCase()){var v=!1;for(var b in i.operators){for(var y in i.operators[b])if(y==t.operator){f=i.operators[b][y],v=!0;break}if(v)break}}if(null!=g){if("exists"==t.operator||"notexists"==t.operator){if(null==r)return{text:kendo.format("<b>{0} record exists in {1}</b>","exists"==t.operator?"A":"No",g.childRelDisplayName),items:[],rootNode:!1,logic:"AND",childRelName:g.childRelName,isChildField:!1,nodeIndex:s.i++};return}return r==g.childRelName?($.each(g.childFieldMeta,function(e,t){if(t.name.toLowerCase()==h[1].toLowerCase())return u=t.displayName,!1}),{text:kendo.format("<b>{0}</b> {1} <b>{2}</b>",u,f,c),logic:a,rootNode:!1,items:void 0,childRelName:g.childRelName,isChildField:!0,nodeIndex:s.i++}):void 0}var k=kendo.format("<b>{0}</b> {1} <b>{2}</b>",u,1==p.length?f:" Exists where "+p[1]+" "+f.toLowerCase(),c);return"isnull"!=t.operator&&"isnotnull"!=t.operator||(k=kendo.format("<b>{0}</b> {1}",u,f)),{text:k,logic:a,rootNode:!1,items:void 0,nodeIndex:s.i++}}if(t instanceof Array&&t.length>0){var w=[],x=[];if($.each(t,function(e,t){var i=d.getFilterTreeViewData(t,t.logic?t.logic.toUpperCase():a,n,r,s,l);if(void 0!=i&&(r==i.childRelName&&1==i.isChildField||null==r)){var o=t&&t.operator?t.operator.toLowerCase():"";i.logic=a,"exists"!=o&&"notexists"!=o?w.push(i):x.push(i)}}),0==w.length&&(w=x),w.length>1){w[0].text="("+w[0].text;var I=w.splice(0,1)[0];w[0].logic=a;var S=[];void 0!=I.items&&$.merge(S,I.items),$.merge(S,w);for(var C=S[S.length-1];;){if(!(void 0!=C.items&&C.items.length>0))break;C=C.items[C.items.length-1]}return C.text+=")",{text:I.text,logic:a,items:S,rootNode:!1,childRelName:I.childRelName,isChildField:null!=r,nodeIndex:I.nodeIndex}}if(1==w.length)return{text:w[0].text,logic:a,items:w[0].items,rootNode:!1,childRelName:w[0].childRelName,isChildField:null!=r,nodeIndex:w[0].nodeIndex}}else if(void 0!=t.filters)return this.getFilterTreeViewData(t.filters,t.logic.toUpperCase(),n,r,s,l)},getBooleanFilterString:function(e,t){var a=this;void 0===t&&(t={i:1});var i=e.logic||"and",n=[];return e.field&&(n.push(t.i),t.i++),e.filters&&Object.each(e.filters,function(e){"object"==typeof e&&n.push(a.getBooleanFilterString(e,t))}),kendo.format(n.length>1?"({0})":"{0}",n.join(" "+i+" "))},flattenFilter:function(e){var t=[],a=this;return e.field&&t.push({field:e.field,operator:e.operator,value:e.value}),e.filters&&e.filters.length>0&&Object.each(e.filters,function(e){"object"==typeof e&&(t=t.concat(a.flattenFilter(e)))}),t},parseBooleanFilterString:function(e,i,n){if(e=e.toUpperCase()){var o=t.parseBooleanExpression(e),r=this.flattenFilter(i),s=a.evaluateBooleanFilterLogic(o,r);n.getElement("grid").one("beforeQuery",function(e,t){t.filter=s});var l=this;n.refresh(function(){l.showFilter(n)})}else n.clearFilters()},showWindow:function(e,t,a,i,o){var r=this,s="Filter Logic";n.popupWithButtons(s,(a?"<label style='width:15ex;'>Boolean Logic: </label>"+kendo.format("<input style='width:calc(100% - 15ex);' id='{0}_booleanLogic' type='text'/> <p/>",e.settings.id)+"<div style='height: calc(100% - 125px); border-style: groove; border-width: 1px 1px 1px 1px;' ><div style='overflow: auto; height: 100%'>"+kendo.format("{1}<div id='{0}_filterTreeView'/>",e.settings.id,i?i:"")+"</div></div>":i?i:"Grid has no filtered columns.")+"<p/><label style='width:15ex;'>Scope: </label>"+kendo.format("<input style='width:calc(100% - 7ex);' id='{0}_filterScope' type='text'/>",e.settings.id),[{label:"Clear Filters",click:function(){e.clearFilters()}},{label:"Close"},{label:"Apply Logic",click:function(){e.settings.pageInfo.scope=e.getElement("filterScope").val();var t="";a&&(t=e.getElement("booleanLogic").val()),r.parseBooleanFilterString(t,o,e)}}],{resizable:!0,height:t}),e.getElement("filterScope").kendoDropDownList({dataTextField:"label",dataValueField:"name",dataSource:e.settings.metadata.supportedScopes,value:e.settings.pageInfo.scope,change:function(e){}})},showFilter:function(e){var t="Filter Logic";if(e.settings.pageInfo.filterId)return void n.popup(t,"Grid is filtered by a List View.");var a;e.settings.pageInfo.selectedRecordIds&&e.settings.pageInfo.selectedRecordIds.length>0&&(a="Grid is filtered to "+e.settings.pageInfo.selectedRecordIds.length+" record"+(1==e.settings.pageInfo.selectedRecordIds.length?"":"s"));var i=jQuery.extend(!0,{},e.gridDataSource.filter());this.removeEmptyFilterArrays(i,!0);var o=[],r=[this.getFilterTreeViewData(i,null,o,null,void 0,e)];if(void 0==r[0]){var s=window.innerHeight<=300?window.innerHeight-50:125;return void this.showWindow(e,s,!1,a)}if(r[0].rootNode=!0,void 0!=r[0].items&&r[0].items.length>0){r[0].text=r[0].text.substring(1);for(var l=r[0].items[r[0].items.length-1];;){if(!(void 0!=l.items&&l.items.length>0))break;l=l.items[l.items.length-1]}l.text=l.text.slice(0,-1)}var d=this;setTimeout(function(){$.each(o,function(t,a){var n=[d.getFilterTreeViewData(i,null,o,a.childRelName,void 0,e)];if(void 0==n[0])return!0;n[0].rootNode=!0;for(var s=null,l=r[0],c=0;;){if(void 0!=l.childRelName&&l.childRelName==a.childRelName&&void 0!=l.isChildField&&0==l.isChildField){s=l;break}if(void 0==r[0].items||r[0].items.length<=c)break;l=r[0].items[c],c++}s.text=kendo.format("{0}({1} where",0===s.text.lastIndexOf("AND",0)?"AND ":"",s.text);for(var u=n[0];;){if(!(void 0!=u.items&&u.items.length>0))break;u=u.items[u.items.length-1]}u.text+=")";var p=n;$.merge(p,s.items),s.items=p}),0!=e.getElement("filterTreeView").length&&(e.getElement("filterTreeView").data("kendoTreeView").destroy(),e.getElement("filterTreeView").remove());var t=window.innerHeight<=300?window.innerHeight-50:195;d.showWindow(e,t,!0,a,i);var n=d.getBooleanFilterString(i);e.getElement("booleanLogic").val(n.substring(1,n.length-1));var s=e.getElement("filterTreeView").kendoTreeView({dataSource:r,template:"(#=item.nodeIndex#) #if(item.rootNode === false){# #=item.logic# #}# #=item.text# "}).data("kendoTreeView");s.expand(".k-item"),s.element.find("span.k-icon").hide()},500)}};return r}),crmc.define("FieldChooserTour",[],function(){var e=[{content:"Check here to add a column to the grid",position:function(e){return $(kendo.format("{0} tbody>tr input",e.getElementId("fieldTreeView"))).first()},direction:"left"},{content:"Start typing a part of a field name here to search for a specific field",position:function(e){return $(kendo.format("{0} thead>tr input",e.getElementId("fieldTreeView")))}},{content:"Click here to sort by data type",position:function(e){return $(kendo.format("{0} thead>tr th[data-title=Type]",e.getElementId("fieldTreeView")))},direction:"left"},{content:"Click here to expand the fields of this parent relationship and add a field",position:function(e){return $(kendo.format("{0} tbody>tr span.k-i-expand:eq(0)",e.getElementId("fieldTreeView")))},action:function(e){var t=$(kendo.format("{0} tbody>tr span.k-i-expand:eq(0)",e.getElementId("fieldTreeView")));if(t&&t.length){var a=t.position();e.getElement("fieldTreeView").find(".k-grid-content").animate({scrollTop:a.top},0)}},direction:"left"}];return e}),crmc.define("GuidedTour",["FieldChooserTour"],function(e){var t={toolbar:function(e){return $(e.getElementId("grid"))},fieldChooserButton:function(e){return $(e.getElementId("configButton"))},actionsButton:function(e){return $(e.getElementId("actionMenu"))},filterIcon:function(e){return $("span.k-filter").first().parent()},footer:function(e){return $("tr.k-footer-template").first()}},a=[],i=[{content:"Welcome to ActionGrid, a better way to interact with your Salesforce data! To get started take a quick tour...",position:function(e){return e.getElement("grid")},direction:"center"},{content:"The Field Chooser can be used to add columns to ActionGrid.",position:t.fieldChooserButton,action:function(e){e.showFieldChooser(!0)},tips:e},{content:"Double click on a row to navigate the record's page layout",position:function(e){return $(kendo.format("{0} table>tbody tr.k-master-row:eq(0)",e.getElementId("grid")))},action:function(e){e.kendoGrid.select(kendo.format("{0} table>tbody tr.k-master-row:eq(0)",e.getElementId("grid"))),e.fieldSplitter.collapse(".k-pane:last")}},{content:"Click here to sort by this column",position:function(e){return $(kendo.format("{0} table>thead th[data-role=columnsorter]:eq(0)",e.getElementId("grid")))},action:function(e){e.kendoGrid.clearSelection()}},{content:"Click here to filter on this column",position:t.filterIcon,direction:"right"},{content:"Drag column here to group results by distinct values",position:function(e){return $(kendo.format("{0} div.k-grouping-header",e.getElementId("grid")))}},{content:"Click here to enable Inline Edit Mode of the grid",position:function(e){return $(e.getElementId("editButton"))}},{content:"Click here to create new records (drop down to see option to add in place or in new window)",position:function(e){return $(e.getElementId("newButton")).next("a.k-split-button-arrow")},direction:"right",action:function(e){try{var t=$(e.getElementId("newButton")).next("a.k-split-button-arrow");t.length&&(t.trigger("mousedown"),t.trigger("mouseup"))}catch(e){}}},{content:"Click here to change the number of records loaded per page",position:function(e){return $(kendo.format("{0} div.k-grid-pager span.k-pager-sizes span.k-dropdown",e.getElementId("grid")))},direction:"top",action:function(e){try{var t=$(e.getElementId("newButton")).next("a.k-split-button-arrow");t.length&&(t.trigger("mousedown"),t.trigger("mouseup"))}catch(e){}}},{content:"Click here to view more pages of results",position:function(e){return $(kendo.format("{0} div.k-grid-pager span.k-i-arrow-e",e.getElementId("grid")))},direction:"top"},{content:"You can save the current state of the ActionGrid as a saved view",position:function(e){return $(e.getElementId("saveView"))}},{content:"Load saved views here, including views shared by other users",position:function(e){return $(kendo.format("{0} div.k-grid-toolbar span.k-dropdown",e.getElementId("grid")))}},{content:"Click here to reset the view to the system default or a saved default",position:function(e){return $(e.getElementId("resetAllViews"))},direction:"left",action:function(e){var t=$(e.getElementId("resetAllViews")).next("a.k-split-button-arrow");t&&(t.trigger("mousedown"),t.trigger("mouseup"))}},{content:"Click here to clear filtering but retain the view",position:function(e){return $(e.getElementId("clearFilters"))},direction:"left"},{content:"Click here to access the Actions Menu (Be sure to select records first!)",position:t.actionsButton,direction:"right",action:function(e){var t=$(e.getElementId("resetAllViews")).next("a.k-split-button-arrow");t&&(t.trigger("mousedown"),t.trigger("mouseup"))}}],n={start:function(e){a=e.tips||i.slice(0),this.options=e;var t=this;$(document.body).delegate("button.btnNext","click",function(){t.showNext()}),$(document.body).delegate("button.btnNo","click",function(){t.hide()}),this.showNext()},hide:function(){this.tooltip&&this.tooltip.hide()},showNext:function(){this.hide();var e=a.shift();if(e){var t='<div style="max-width:300px; padding-bottom:5px;">{0}</div>',i='<button class="btnNext" style="float:right;">Continue</button>',n=(!this.tooltip,kendo.format('<div style="margin-top:-7px;">{0}</div>',i));this.tooltip=$("<div>").kendoTooltip({position:e.direction||"bottom",autoHide:!1,showOn:"focus",content:function(){return kendo.format(t,e.content)+n},show:function(e){$(e.sender.content).find("button").kendoButton(),$(e.sender.popup.element).addClass("k-tooltip-help")}}).data("kendoTooltip");try{this.tooltip._initPopup(),this.tooltip.popup.options.modal=!0;var o=e.position(this.options.grid);if(!o||!o.length||!o.is(":visible"))throw"Unable to position tooltip";e.action&&"function"==typeof e.action&&e.action(this.options.grid),this.tooltip.show(o),e.tips&&e.tips.length>0&&(a=e.tips.concat(a))}catch(e){this.showNext()}}}};return n}),crmc.define("Toolbar",["CustomSettings","sfdc","FilterLogic","GuidedTour","ReadOnlyObjects","SFRest","Notification","tooling","mixpanel"],function(e,t,a,i,n,o,r,s,l){var d={dragHandle:{type:"separator",attributes:{class:"dragHandle",style:"cursor: move;"},overflow:"never"},newButton:{type:"button",label:"New",icon:"plus",id:"newButton",overflow:"never",init:function(t){var a=!1,i=!1;t.settings.metadata.getBoolean("createable")&&(t.settings.metadata.urlNew&&t.settings.metadata.urlNew.length>0&&e.getSetting(t.settings.pageInfo.objectName,"newButton")!==!1&&(a=t.settings.enableNewButton),e.getSetting(t.settings.pageInfo.objectName,"inlineNew")!==!1&&t.settings.enableEdit&&e.getSetting(t.settings.pageInfo.objectName,"editButton")!==!1&&(i=t.settings.enableNewInline));var n=t.createNewInline;i||a&&(n=t.createInNewWindow),a&&i?(this.menuButtons=[{id:t.settings.id+"createNewWindow",text:"In New Window",icon:"restore",click:function(){t.createInNewWindow()}},{id:t.settings.id+"createInline",text:"Add Inline",icon:"insert-m",click:function(){t.createNewInline()}}],this.type="splitButton"):(delete this.menuButtons,this.type="button"),this.attributes={class:"k-button",title:"New "+t.settings.metadata.label},this.text=t.settings.metadata.label,this.enable=a||i,this.click=function(){n.apply(t)}}},editButton:{type:"button",text:"Edit",attributes:{title:"Toggle inline edit mode"},icon:"pencil",id:"editButton",overflow:"never",togglable:!0,hasSetting:function(t){return t.settings.enableEdit&&t.settings.metadata.getBoolean("updateable")&&e.getSetting(t.settings.pageInfo.objectName,"editButton")!==!1},init:function(e){this.toggle=function(){e.settings.editable=!e.settings.editable,e.settings.editable?e.enterEditMode():e.cancelEditMode()},void 0!=n[e.settings.pageInfo.objectName]&&(this.enable=!0)}},quickSaveView:{text:"Save View",attributes:{class:"k-button",title:"Save View"},featureSecurity:"saveView",icon:"tick",click:function(e){e.settings.isChildGrid?e.settings.parentGrid.quickSaveView():e.quickSaveView()}},saveButton:{type:"splitButton",text:"Save",icon:"tick",id:"saveButton",menuButtons:[],attributes:{class:"k-button",title:"Save all view and data changes"},hasSetting:function(t){return t.settings.editable?t.settings.enableEdit&&t.settings.metadata.getBoolean("updateable")&&e.getSetting(t.settings.pageInfo.objectName,"editButton")!==!1:!t.settings.isChildGrid&&e.getSetting(t.settings.pageInfo.objectName,"saveView")!==!1},init:function(t){var a=[];this.type="splitButton",t.settings.editable?(this.text="Save",this.attributes={class:"k-button",title:"Save"},this.click=function(){t.saveDataAndView()},this.menuButtons=[],a=[d.quickSaveView,d.saveViewButton,d.saveDataButton,d.revertDataButton]):(this.menuButtons=[],a=[d.saveViewButton],d.editButton.hasSetting(t)?(d.editButton.init(t),this.text=d.editButton.text,this.icon=d.editButton.icon,this.attributes=d.editButton.attributes,this.click=d.editButton.toggle,t.settings.isChildGrid?this.type="button":a.unshift(d.quickSaveView)):(this.text=d.quickSaveView.text,this.attributes=d.quickSaveView.attributes,this.click=d.quickSaveView.click));for(var i=0;i<a.length;i++)a[i].featureSecurity&&e.getSetting(t.settings.pageInfo.objectName,a[i].featureSecurity)===!1||a[i].hasSetting&&!a[i].hasSetting(t)||(this.menuButtons.push(a[i]),m.initToolbarItem(a[i],t))},postInit:function(e){e.gridDataSource.hasChanges()&&e.setSaveButtonDirty(!0)}},actionsMenu:{type:"button",text:"Actions",icon:"lightning",id:"actionMenu",overflow:"never",attributes:{class:"k-button",title:"Actions"},init:function(e){this.click=function(t){var a=e.getElement("actionMenu"),i=a.offset(),n=a.height();e.showContextMenu(i.left,i.top+n)}}},viewLabel:{init:function(e){this.template=kendo.format('<strong style="padding-left:0.69em; padding-right: 0.69em;" id="{0}_viewLabel">View:</strong>',e.settings.id)}},saveDataButton:{text:"Save Data",icon:"pencil",id:"saveData",featureSecurity:void 0,attributes:{title:"Save pending data changes"},init:function(e){this.click=function(){e.blurEditCell(),e.saveButtonClick()}}},revertDataButton:{text:"Revert Data",icon:"undo",id:"revertData",featureSecurity:"revertData",attributes:{title:"Revert unsaved changes"},init:function(e){this.click=function(){e.setSaveButtonDirty(!1),e.kendoGrid.cancelChanges()}}},saveViewButton:{text:"Save View As…",icon:"tick",id:"saveView",featureSecurity:"saveView",attributes:{title:"Save View As…"},hasSetting:function(e){return e.settings.enableViews},init:function(e){this.click=function(){e.saveNamedView()}}},newViewButton:{text:"New View",icon:"plus",attributes:{title:"Create a new view"},featureSecurity:"saveView",hasSetting:function(e){return e.settings.enableViews},init:function(e){this.click=function(){e.newView()}}},manageViewsButton:{text:"Manage Views",icon:"manage-views",id:"manageView",attributes:{title:"Manage all current views"},featureSecurity:"manageView",hasSetting:function(e){return e.settings.enableViews},init:function(e){this.click=function(){e.manageViewsClick()}}},viewDropDown:{init:function(e){this.template=kendo.format('<div class="k-button-group crmcViewDropDown"><select class="k-group-start" id="{0}_views" style="width: 200px;"/></div>',e.settings.id)},postInit:function(e){e.settings.enableViews&&e.loadViewDropDown()}},readingPaneButton:{overflow:"never",type:"splitButton",text:"Reading Pane",attributes:{title:"Reading Pane Options"},icon:"chooser",id:"readingPaneMenu",init:function(e){var t=this;this.click=function(a){e.checkForDirtyRows(!1,t.click)?t.postInit(e):(e.settings.readingPane.expanded=!e.settings.readingPane.expanded,e.modifySelectedView(),e.preserveSelectedRows(e.settings.editable,!1,!1,function(){if(e.isReadingPaneShowing()&&e.kendoGrid.select().length<1){var t=e.kendoGrid.table.find("tr[data-uid]").first();t.find("input[name='selectedBox"+e.settings.id+"']").prop("checked",!0),e.settings.lockedColumns&&(t=$("[data-uid="+t.data("uid")+"]")),t.addClass("k-state-selected"),e.selectionChanged()}}))};var a=function(a){var i=e.settings.readingPane.position!=a;!i&&e.isReadingPaneShowing()||(e.settings.readingPane.expanded=!0,e.settings.readingPane.position=a,e.settings.readingPane.showText=!0,e.modifySelectedView(),setTimeout(function(){t.postInit(e),e.initReadingPane(i)},1))};this.menuButtons[0].click=function(){a("top")},this.menuButtons[1].click=function(){a("right")},this.menuButtons[2].click=function(){a("bottom")},this.menuButtons[3].click=function(){a("left")}},postInit:function(t){t.isReadingPaneShowing()?t.getElement("readingPaneMenu").addClass("k-state-active"):t.getElement("readingPaneMenu").removeClass("k-state-active"),t.settings.enableReadingPane&&e.getSetting(t.settings.pageInfo.objectName,"readingPane")!==!1||t.getElement("readingPaneMenu_wrapper").css({display:"none"})},menuButtons:[{attributes:{title:"Top"},text:"Top",icon:"arrowhead-n"},{attributes:{title:"Right"},text:"Right",icon:"arrowhead-e"},{attributes:{title:"Bottom"},text:"Bottom",icon:"arrowhead-s"},{attributes:{title:"Left"},text:"Left",icon:"arrowhead-w"}]},resetToDefaultButton:{attributes:{title:"Reset to default view if it exists otherwise system default"},text:"Reset to Default",icon:"refresh",init:function(e){this.click=function(){e.resetView()}}},clearFiltersButton:{text:"Clear Filters",icon:"funnel-clear",id:"clearFilters",attributes:{title:"Reset only current filters"},init:function(e){this.click=function(){e.clearFilters()}}},clearFormattingButton:{text:"Clear Formatting",icon:"shape",attributes:{title:"Reset only current formatting"},init:function(e){this.click=function(){delete e.settings.conditionalRules,e.refresh()}}},resetButton:{type:"splitButton",text:"Reset View",attributes:{title:"Revert unsaved changes to view"},icon:"refresh",id:"resetAllViews",overflow:"never",init:function(t){this.click=function(){var e=t.getSelectedView();e?t.loadSavedView(e):t.resetView()};var a=[d.resetToDefaultButton,d.clearFiltersButton,d.clearFormattingButton,d.newViewButton];this.menuButtons=[];for(var i=0;i<a.length;i++)a[i].featureSecurity&&e.getSetting(t.settings.pageInfo.objectName,a[i].featureSecurity)===!1||(this.menuButtons.push(a[i]),m.initToolbarItem(a[i],t))}},fieldsButton:{type:"button",text:"Fields",overflow:"never",attributes:{title:"Add or remove columns"},icon:"matrix",id:"fieldButton",featureSecurity:"fieldChooser",hasSetting:function(e){return e.settings.enableFieldChooser},init:function(e){this.click=function(){var t=e;e.settings.isChildGrid&&(t=e.settings.parentGrid),t.fieldSplitter&&!t.fieldSplitter.options.panes[1].collapsed?t.showFieldChooser(!1):(t.showFieldChooser(!0),e.settings.isChildGrid?e.settings.fkRelationship?e.settings.parentGrid.fieldChooser.expandChildFields(e.settings.fkRelationship):e.settings.parentGrid.fieldChooser.showChildRelationshipHelp():e.fieldChooser.expandPrimaryFields())}}},configureButton:{type:"splitButton",label:"Configure",overflow:"never",icon:"custom k-i-chooser",attributes:{title:"ActionGrid configuration options"},id:"configButton",text:"Configure",init:function(t){this.click=function(){t.showConfigure()},this.menuButtons=[];for(var a=[d.fieldsButton,d.conditionalFormatButton,d.formulaButton,d.filterLogic,d.manageViewsButton,d.keyboardControlHelpButton,d.helpButton],i=0;i<a.length;i++)a[i].featureSecurity&&e.getSetting(t.settings.pageInfo.objectName,a[i].featureSecurity)===!1||a[i].hasSetting&&!a[i].hasSetting(t)||(this.menuButtons.push(a[i]),m.initToolbarItem(a[i],t));t.settings.isChildGrid&&(this.click=d.fieldsButton.click)},postInit:function(e){var t=e;e.settings.isChildGrid&&(t=e.settings.parentGrid),t.fieldSplitter&&(t.fieldSplitter.options.panes[1].collapsed?t.getElement("configButton").removeClass("k-state-selected"):t.getElement("configButton").addClass("k-state-selected"))}},filterLogic:{type:"button",text:"Filter Logic",attributes:{title:"Display details of the currently applied filter"},id:"showFilter",featureSecurity:"filterLogic",init:function(e){this.click=function(){a.showFilter(e)},this.icon=a.hasFilter(e)?"funnel-active":"funnel"}},formulaButton:{type:"button",text:"Formulas",attributes:{title:"Create a computed field"
},icon:"sum",id:"formulas",featureSecurity:"formulaFields",init:function(e){this.click=function(){var t="ff",a=$(e.getElementId(t));kendo.destroy(a),$("body").append($(kendo.format('<div id="{0}">',e.settings.id+"_"+t))),$(e.getElementId(t)).kendoFormulaWindow({grid:e})}}},conditionalFormatButton:{type:"button",text:"Conditional Formatting",attributes:{title:"Apply conditional color formatting to cells or rows"},icon:"paint",id:"formatting",featureSecurity:"conditionalFormatting",hasSetting:function(e){return e.settings.enableFormatting},init:function(e){this.click=function(){var t=$(e.getElementId("cf"));0!=t.length?(t.data("kendoConditonalFormatting").destroy(),t.empty()):$("body").append($(kendo.format('<div id="{0}">',e.settings.id+"_cf"))),$(e.getElementId("cf")).kendoConditonalFormatting({grid:e})}}},searchText:{template:function(e){return'<input id="'+e.getElementId("grid")+'searchText" type="search" class="k-textbox" placeholder="Search"/>'},attributes:{title:"Search all searchable text fields"},init:function(e){this.template=function(){var t=$(kendo.format('<input id="{0}_searchText" style="width:130px;" type="search" class="k-textbox" placeholder="🔎 Search {1}"/>',e.settings.id,e.settings.metadata.labelPlural));e.settings.searchText&&t.val(e.settings.searchText);var a,i=function(){clearTimeout(a),a=setTimeout(function(){var a=t.val();if(!e.checkForDirtyRows(!1))if(a.length>1){var i=t.val();e.searchText(i),e.settings.searchText=i}else 1==a.length?(r.showMessage({title:"Search",message:"Length must be greater than 1 character"},"error"),t.focus()):0==a.length&&""!=e.settings.searchText&&(e.settings.searchText="",e.settings.pageInfo.selectedRecordIds=[],e.gridDataSource.read())},300)};return t.on("keypress search",function(){i()}),t.on("keydown",function(e){e&&e.key&&"backspace"==e.key.toLowerCase()&&i()}),t.on("focusin",function(){t.one("mouseup",function(){var e=0==t.parent().parent().siblings().length;e&&t.animate({width:"250px"},300)})}),t.on("focusout",function(){t.animate({width:"130px"},300)}),t}},postInit:function(e,t){$(t.element).off("keydown")}},keyboardControlHelpButton:{type:"button",text:"Keyboard Shortcuts",attributes:{title:"Keyboard shortcut help menu"},icon:"keyboard",id:"help",init:function(e){this.click=function(){e.showKeyboardHelp(!0)}}},helpButton:{type:"button",text:"Help",attributes:{title:"View ActionGrid Guided Tour"},icon:"help",id:"help",init:function(e){this.click=function(){i.start({grid:e})}}}},c={Search:{visible:!0,row:1,index:2}},u={Views:{visible:!0,row:0,index:1},Edit:{visible:!0,row:1,index:0},Configure:{visible:!0,row:1,index:2},"Reading Pane":{visible:!0,row:1,index:1},Search:{visible:!0,row:0,index:0},"Reset View":{visible:!0,row:0,index:2}},p={Views:[d.dragHandle,d.viewLabel,d.viewDropDown],Edit:[d.dragHandle,d.newButton,d.saveButton,d.actionsMenu],Configure:[d.dragHandle,d.configureButton],"Reading Pane":[d.dragHandle,d.readingPaneButton],Search:[d.dragHandle,d.searchText],"Reset View":[d.dragHandle,d.resetButton]},f={Views:"viewGroup",Edit:"editGroup",Configure:"configGroup","Reading Pane":"readingPaneGroup",Search:"searchGroup","Reset View":"resetViewGroup"},m={init:function(e,t,a,i){var n=Object.create(this);n.element=t,n.toolbarGroups=Object.copy(p),n.actionGrid=e,n.groups={},n.loadState(a,i);var o=function(t,o){if("function"==typeof o.isToolbarAvailable){var r=e.getActionContext(),s=o.getLabel&&o.getLabel(r),l=[d.dragHandle,{text:s,id:s,type:"button",init:function(e){this.click=function(){var t=e.getActionContext();o.click(t)},this.isAvailable=function(){var t=e.getActionContext();return o.isToolbarAvailable(t)}}}];p[s]=l,n.toolbarGroups[s]=l,a&&a[s]&&a[s].visible&&n.loadState(a,i)}};return $(window.document).off("addCustomAction."+e.getElementId("toolbar")),$(window.document).on("addCustomAction."+e.getElementId("toolbar"),o),e.getElement("toolbarHandle").on("click",function(t){var a="none"==e.getElement("toolbar").css("display");e.getElement("toolbar").css("display",a?"block":"none"),$(this).css("background-position",a?"2px 0px":"2px -30px"),e.settings.toolbarCollapsed=!a,e.redraw(),e.modifySelectedView()}),n},initToolbarItem:function(e,t){if(e.id&&(e.itemName||(e.itemName=e.id),e.id=t.settings.id+"_"+e.itemName),"function"==typeof e.init&&e.init(t),"function"==typeof e.click){var a=e.click;e.click=function(){var i={type:"Toolbar Button",objectName:t.settings.pageInfo.objectName};l.track(e.text||e.label,i),a(t)}}},saveState:function(){var e={},t=this;return Object.each(p,function(a,i){var n=t.groups[i]&&t.groups[i].element;if(a&&n){var o=t.row1Container.find(n).length>0?1:0,r=n.prevAll().length,s=t.row1Container.find(n).length>0||t.row0Container.find(n).length>0||!1;e[i]={visible:s,row:o,index:r}}else{var l=Object.create(u[i]||{});l.visible=!1,e[i]=l}}),e},getAvailableGroups:function(e){var t=[],a=this,i=this.actionGrid,n=e||this.saveState(),o=[];Object.each(n,function(e,t){e.name=t,o.push(e)});var r=0;return Object.each(p,function(){r++}),o.length!=r&&Object.each(p,function(e,t){var a=Object.first(o,function(e){return e.name==t});if(!a){var i=["Views","Configure","Edit"],n=Object.create(u[t]||{});n.name=t,n&&(i.indexOf(t)>-1&&(n.visible=!1),o.push(n))}}),o=Array.orderBy(o,function(e){return e.index}),Object.each(o,function(e){var n=[],o=p[e.name];if(Object.each(p[e.name],function(e){a.initToolbarItem(e,i),"function"==typeof e.isAvailable?e.isAvailable()&&n.push(e):n.push(e)}),o==p.Views){if(i.settings.enableViews===!1)return}else{if(o==p["Reading Pane"]&&i.settings.isChildGrid)return;if(o==p["Reset View"]&&!i.settings.enableViews)return;if(o==p.Edit){for(var r=[],s=0;s<p.Edit.length;s++)p.Edit[s].hasSetting&&!p.Edit[s].hasSetting(i)||r.push(p.Edit[s]);n=r}}n&&n.length>1&&t.push(e),a.toolbarGroups[e.name]=n}),t},loadState:function(a,i){var n=this.actionGrid,o=this.element,r=this;$(o).empty(),n.settings.isChildGrid&&Object.each(c,function(e,t){void 0!=u[t]&&(u[t]=e)});var s=a||u,l=document.doctype&&document.doctype.publicId&&document.doctype.publicId.toLowerCase().indexOf("transitional")>-1,d='<div id="{0}" style="padding-right:35px;">';l&&(d='<div id="{0}" style="padding:0.3em; padding-right:35px;">');var p=n.getElementId("toolbarRow0").replace("#",""),m=$(kendo.format(d,p));o.append(m);var h=n.getElementId("toolbarRow1").replace("#",""),g=$(kendo.format(d,h));o.append(g);var v=(n.settings.id,t.parseAsObject());if(!n.settings.isChildGrid&&!v.disableFS&&n.settings.enableFullscreen!==!1&&e.getSetting(n.settings.pageInfo.objectName,"fullScreenMode")!==!1){var b=$('<div style="position:absolute; right: 5px; top: 6px;">'),y=$('<button title="Toggle Fullscreen Mode">');y.kendoButton({icon:"restore",click:function(){n.toggleFullscreen()}}),b.append(y),o.append(b)}Object.each(r.getAvailableGroups(s),function(e){if(e&&e.visible){var t=r.toolbarGroups[e.name],a=n.getElementId(f[e.name]).replace("#",""),i=$(kendo.format('<div class="toolbarGroup" id="{0}">',a));e.row>0?g.append(i):m.append(i);var s=i.kendoToolBar({items:t,resizable:!1});r.groups[e.name]=s.data("kendoToolBar"),Object.each(t,function(t){"function"==typeof t.postInit&&t.postInit(n,r.groups[e.name])});i.data("kendoToolBar");o.trigger("resize")}});var k=function(e){return e.clone().css({opacity:"0.4",border:"1px dashed #a6a6a6"})},w=function(e){return e.clone().css({width:"250px",height:"100px","font-size":"11px",overflow:"hidden"}).height(e.height()).width(e.width()+5)},x=function(){var e={"min-height":"33px"};$("#"+p).css(e),$("#"+h).css(e)},I=function(e){var t={"min-height":"inherit"};$("#"+p).css(t),$("#"+h).css(t),n.redraw()},S=function(){n.modifySelectedView()};m.kendoSortable({filter:">div",cursor:"move",handler:".dragHandle",connectWith:"#"+h,placeholder:k,hint:w,start:x,end:I,change:S,ignore:".k-textbox"}),g.kendoSortable({filter:">div",cursor:"move",handler:".dragHandle",connectWith:"#"+p,placeholder:k,hint:w,start:x,end:I,change:S,ignore:".k-textbox"}),r.row0Container=m,r.row1Container=g,i?n.getElement("toolbar").css("display","none"):n.getElement("toolbar").css("display","block")},enable:function(e,t){Object.each(this.groups,function(a){$(a.element).find(e).length>0&&a.enable(e,t)})},toggleGroup:function(e){var t=this.saveState()||{};t&&t[e]?t[e].visible=!t[e].visible:u[e]?t[e]=u[e]:t[e]={visible:!0},this.actionGrid.modifySelectedView(),this.loadState(t),this.actionGrid.redraw()}};return m}),crmc.define("HoverHelp",[],function(){var e="/{0}/m?retURL=%2F{0}&isAjaxRequest=1",t={},a="HoverHelpProxyEvent",i={mouseenter:function(i){setTimeout(function(){if($(":hover").filter($(i.target)).length>0){var n=$(i.target).data("id");if(void 0!=n)var o=n.substring(0,3);void 0==t[o]&&($(i.target).data("content")?$(i.target).trigger(a):$.ajax({url:kendo.format(e,n),type:"GET",success:function(e){$(":hover").filter($(i.target)).length>0&&($(i.target).data("content",e),$(i.target).trigger(a))}}).fail(function(){t[o]=!0}))}},600)},init:function(e){$("#"+e.settings.id).off("mouseenter",this.mouseenter),$("#"+e.settings.id).on("mouseenter","a.agHoverHelp",this.mouseenter),$("#"+e.settings.id).kendoTooltip({filter:"a.agHoverHelp",content:function(e){e.sender.popup.element.removeClass("k-widget"),e.sender.popup.element.addClass("agHoverHelp");var t=$(e.target).data("content");return $(t).css({overflow:"auto","max-height":"320px",width:"370px","min-height":"100px",height:"auto"})},showAfter:0,showOn:a,position:"right"})}};return i}),crmc.define("LightningDelegate",["ActionGridDelegate","KendoEntry","sfdc"],function(e,t,a){var i=function(e,t){window.SfdcApp&&SfdcApp.projectOneNavigator&&"function"==typeof SfdcApp.projectOneNavigator.fireContainerEvent?SfdcApp.projectOneNavigator.fireContainerEvent(e,t):window.parent.postMessage({type:"event",eventName:e,eventArgs:t},"*")},n=Object.create(e);return n.createInNewWindow=function(){var e=this,n=e.settings.metadata&&e.settings.metadata.recordTypeInfos&&e.settings.metadata.recordTypeInfos.length>0;if(n){var o="RecordTypeId",r=Object.first(e.settings.metadata.fields,function(e){return e.name==o});t.entry("Select a Record Type",[{name:o,label:"Record Type",type:"reference",referenceTo:"RecordType",fullMeta:r}],{objectName:this.settings.pageInfo.objectName},void 0,function(t){var n=t[o].value;a.isSalesforceId(n)&&i("force:createRecord",{entityApiName:e.settings.pageInfo.objectName,recordTypeId:n})})}else i("force:createRecord",{entityApiName:this.settings.pageInfo.objectName})},n}),crmc.define("customPanes/detailGrid",["ColumnFactory","FieldChooser","GridDataProvider","CustomSettings","sfdc"],function(e,t,a,i,n){var o,r,s,l=0,d=3,c={},u={fieldNames:[],fieldSettings:{},itemID:"detailGrid",mainDiv:void 0,_update:function(){var e=u.mainDiv?u.mainDiv.find("[name=detailGridDiv]"):void 0;return e&&e.data("kendoGrid")&&e.data("kendoGrid").dataSource.read(),!0},isAvailable:function(e){return e.actionGrid.isReadingPaneTabEnabled("detailGrid")&&i.getSetting(e.objectDescribe.name,this.itemID)!==!1},getLabel:function(e){return"Detail Grid"},select:function(e,t){if(u.mainDiv=t,e){s=e.selectedRows;var a=t.find("[name=detailGridDiv]");a.data("kendoGrid")?a.data("kendoGrid").dataSource.read():this.loadView(e,t,e.actionGrid.saveView())}},saveView:function(e,t,a){u.mainDiv=t,a.readingPane&&(a.readingPane[this.itemID]||(a.readingPane[this.itemID]={}),a.readingPane[this.itemID].fieldNames=this.fieldNames,a.readingPane[this.itemID].fieldSettings=this.fieldSettings)},loadView:function(t,p,f){function m(){function a(e){var t,a=S.data("kendoGrid"),i=a.table.clone(),n=a.wrapper.width(),o=$("<div class='k-grid k-widget'></div>").width(n);return i.find("thead").remove(),i.find("tbody").empty(),i.wrap(o),i.append(e.clone().removeAttr("uid")),t=i.parent()}s=t.selectedRows;var i=new kendo.data.DataSource({schema:{model:{id:"field",fields:{label:{updateable:!1},field:{updateable:!1},value:{}}}},batch:!0,transport:{read:function(a){var i=[];if(s.length>0){var n=s[0],o=!1,u=0;i=h.fieldNames.map(function(a){var i=Object.first(r.config.fieldMeta,function(e){return e.name==a});if(!i)return void(n.fields[a]||(l<d?(t.actionGrid.addRemoveColumn(a,0,!0),o=!0):(console.log("detailgrid field "+a+" definitively not found, was it deleted?"),h.fieldNames.remove(a))));if("REFERENCE"!=i.type&&"CHILD"!=i.type){var a=i.name,s=t.objectDescribe.fields.filter(function(e){return e.name==i.name}),p=s.length>0?s[0]:new sforce.Xml;c[a]||("textarea"==i.type.toLowerCase()?c[a]=function(e,t){var i='style="max-width:'+e.width()+"px; width: "+e.width()+"px; ";h.fieldSettings[a]&&h.fieldSettings[a].height&&(i+="height:"+h.fieldSettings[a].height+"px"),i+='"';var n=$("<textarea "+i+' data-bind="value: '+t.field+'" class="k-input k-textbox"></textarea>'),o="textAreaHover";n.on("keydown",function(e){switch(e.keyCode){case kendo.keys.TAB:t.model.set(t.field,n.val());break;case kendo.keys.UP:case kendo.keys.DOWN:case kendo.keys.ENTER:e.stopPropagation()}}),n.on("dblclick",function(e){n.height()-e.offsetY<10&&n.width()-e.offsetX<10&&(h.fieldSettings[a]||(h.fieldSettings[a]={}),h.fieldSettings[a].height=void 0,n.css("height",""))}),n.on("mouseup",function(){h.fieldSettings[a]||(h.fieldSettings[a]={}),h.fieldSettings[a].height=n.outerHeight()}),n.on("mousemove",function(e){n.height()-e.offsetY<10&&n.width()-e.offsetX<10&&r.trigger(o)});var r=$('<div style="width:'+e.width()+'px" />');return n.appendTo(r),r.kendoTooltip({content:function(e){return $("<div>Double Click to shrink text area</div>")},showAfter:0,width:230,showOn:o}),r.appendTo(e),n}:c[a]=r.createEditor(a));var f;f="textarea"==i.type?function(e){var t="";return h.fieldSettings[a]&&h.fieldSettings[a].height&&(t='style="height:'+h.fieldSettings[a].height+'px"'),e[a]?"<div "+t+">"+e[a]+"</div>":""}:r.createTemplate(a);var m={field:a,label:e.getHeaderTitle(i,r.config.fieldMeta),value:n[a],editor:c[a],template:f,updateable:p.getBoolean("updateable"),type:i.type};if(m[a]=n[a],m.Order=u++,n.dirty&&(m.dirty=!0,m.dirtyFields={value:n[a]},m.dirtyFields[a]=n[a]),a.indexOf(".")>0){names=a.split(".");var g=names[0];try{var v=/__(p?)r$/,b=g+"Id";g.match(v)&&(b=g.replace(v,"__$1c"));var y=Object.first(t.objectDescribe.fields,function(e){return e.name===b});m.updateable=y.getBoolean("updateable");var k=n;for(m[g]=n[g];names.length>0;)g=names.splice(0,1)[0],m.value=k[g],k=k[g];m.idName=b,n.dirty&&(m.dirtyFields[b]=n[b],m.dirtyFields[g]=n[g])}catch(e){console.log("Error in parental Field"+e),m.updateable=!1}}return m}}).filter(function(e){return e}),o?(l++,t.actionGrid.preserveSelectedRows(t.actionGrid.settings.editable,!1,void 0,function(){h.loadView(t,p)})):l=0,a.success(i);try{Object.each(s[0].dirtyFields,function(e,t){var a=S.data("kendoGrid")._data.filter(function(e){return e.field==t||e.idName==t})[0];if(a){var i=$(kendo.format("#{2} tr[data-uid={0}] td:not(.k-group-cell,.k-hierarchy-cell):eq({1})",a.uid,1,p.attr("id")));i&&(i.hasClass("k-dirty-cell")||(i.addClass("k-dirty-cell"),i.prepend("<span class='k-dirty'></span>")))}})}catch(e){console.log(e)}return!0}return a.error(),!1}}}),o=S.kendoGrid({selectable:"multiple cell",allowCopy:!0,resizable:!0,columns:[{field:"label",title:"Label",template:'<span class="handler">#= label #</span>',editable:!1,editor:function(){}},{field:"value",title:"Value",template:function(e){return e.template?e.template(e):null!==e[e.field]?e[e.field]:e.value||""},editor:function(e,t){if(t.model.editor)return t.field=t.model.field,t.model.editor.apply(this,[e,t]);var a=$('<input class="k-input k-textbox" />');a.attr("name",t.model.field),a.appendTo(e)},attributes:{class:"#= editable? '': 'readOnly' #"}}],dataSource:i,editable:!0,dataBound:function(e){$(this.element).is(":visible")&&this.autoFitColumn(0)},save:function(e){var a=e.model.field;"textarea"==e.model.type&&(h.fieldSettings[a]||(h.fieldSettings[a]={}),h.fieldSettings[a].height=e.container.height());var i=e.values.value||e.values[a];e.container.addClass("k-dirty-cell"),e.preventDefault(),e.model[a]=i,s[0].dirtyFields||(s[0].dirtyFields={}),s[0].dirty=!0;var o=function(e){s[0].dirtyFields[e]=i,s[0][e]=i};if(a.indexOf(".")>-1){if(n.isSalesforceId(i)||null==i){var r=a.split(".");s[0][a]=e.model.value,o(n.getIdFieldFromRelationshipName(r[0]))}}else a.indexOf("_input")>-1&&!s[0].hasOwnProperty(a)?o(a.substring(0,a.lastIndexOf("_input"))):"_events"===a||o(a);t.actionGrid.setSaveButtonDirty(!0);for(var l=0,d=t.kendoGrid.columns.length;l<d;l++){var c=t.kendoGrid.columns[l];if(c.field===a){var u=$(kendo.format("{2} tr[data-uid={0}] td:not(.k-group-cell,.k-hierarchy-cell):eq({1})",s[0].uid,l,t.actionGrid.getElementId("grid")));if(u){var p=function(){u.hasClass("k-dirty-cell")||(u.addClass("k-dirty-cell"),u.prepend("<span class='k-dirty'></span>"))};if(a.indexOf(".")>-1){var f=e.container.find('[name="'+e.model.field+'"]');if(f.length>0){var m={};m[e.model.field]=f.data("kendoComboBox").text(),m[e.model.field.split(".")[0]]={Id:f.data("kendoComboBox").value()},u.html(e.model.template(m))}else u.html(e.container.html());setTimeout(p,200)}else t.kendoGrid.editCell(u),t.kendoGrid.closeCell(),p();break}}}},edit:function(e){e.model.updateable&&0!==this.select().index()||this.closeCell()}});o=o.data("kendoGrid"),void 0!==o&&o.table.kendoSortable({hint:a,cursor:"move",placeholder:function(e){return e.clone().addClass("k-state-hover").css("opacity",.65)},handler:".handler",ignore:"input, textarea",container:p.selector+" tbody",filter:">tbody >tr",change:function(e){var t=S.data("kendoGrid"),a=e.oldIndex,i=e.newIndex,n=t.dataSource.view(),o=t.dataSource.getByUid(e.item.data("uid"));if(o.Order=i,o.dirty=!0,a<i)for(var r=a+1;r<=i;r++)n[r].Order--,n[r].dirty=!0;else for(var r=a-1;r>=i;r--)n[r].Order++,n[r].dirty=!0;h.fieldNames=n.sort(function(e,t){return e.Order-t.Order}).map(function(e){return e.field})}})}u.mainDiv=p;var h=this;h.fieldNames=[],t.kendoGrid.dataSource.unbind("change",u._update),t.kendoGrid.dataSource.bind("change",u._update);var g=$(p),v=t.actionGrid,b=function(){t.actionGrid.forceKeyboardFocus()},y=function(e){var t=$(v.getElement("customRP_detailGrid")),a=t.find("[name=detailGridDiv]").data("kendoGrid"),i=$(t.find("tr.k-grid-edit-row"));if(i.length>0){var n;n=e?i.prevAll().first():i.nextAll().first(),0==n.length&&(n=e?i.nextAll().last():i.prevAll().last()),a.editCell(n.children().last())}};g.off("keydown.ag");var k=function(e){var t=$(document.activeElement);t.closest(".k-grid");switch(e.keyCode){case kendo.keys.TAB:setTimeout(function(){y(e.shiftKey)}),e.preventDefault();break;case"S".charCodeAt(0):e.shiftKey||(e.ctrlKey||e.metaKey)&&v.settings.editable&&(setTimeout(function(){v.saveButtonClick()}),e.preventDefault()),e.shiftKey&&(e.ctrlKey||e.metaKey)&&0!=i.getSetting(v.settings.pageInfo.objectName,"saveView")&&(setTimeout(function(){v.quickSaveView()}),e.preventDefault());break;case 191:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){v.showKeyboardHelp(!1)},1e3),e.preventDefault());break;case 219:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){b()}),e.preventDefault());break;case 221:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){b()}),e.preventDefault());break;case 220:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){v.showConfigure()}),e.preventDefault());break;case kendo.keys.UP:setTimeout(function(){y(!0)}),e.preventDefault();break;case kendo.keys.DOWN:setTimeout(function(){y(!1)}),e.preventDefault();break;case kendo.keys.ENTER:setTimeout(function(){y(e.shiftKey)}),e.preventDefault()}};g.on("keydown.ag",k.bind(g)),t.actionGrid.settings.readingPane[h.itemID]?(h.fieldNames=t.actionGrid.settings.readingPane[h.itemID].fieldNames,h.fieldSettings=t.actionGrid.settings.readingPane[h.itemID].fieldSettings||{}):t.actionGrid.settings.readingPane[h.itemID]={};var w=function(e){var a=e.draggable.currentTarget.data().field;if(a){var i=h.fieldNames?h.fieldNames.indexOf(a):-1;i>-1?(h.fieldNames.splice(i,1),delete h.fieldSettings[a]):(h.fieldNames||(h.fieldNames={}),h.fieldNames.push(a),h.fieldSettings[a]={}),t.selectedRows=t.actionGrid.getSelectedItems(),h.select(t,p)}},x=function(e){$(e.target).find("span").removeClass("k-denied"),$(e.target).find("span").addClass("k-i-pin")},I=function(e){$(e.target).find("span").addClass("k-denied"),$(e.target).find("span").removeClass("k-i-pin")};p.kendoDropTarget({group:t.actionGrid.getElement("grid").data().kendoReorderable.options.draggable.options.group,drop:w,dragenter:x,dragleave:I}),p.empty();var S=$('<div name="detailGridDiv" />');p.append(S);var C=$.extend(!0,{},t.actionGrid.settings);a.create(C,{allowParentalEditing:function(){return t.actionGrid.allowParentalEditing()},onReadFieldMetadata:function(a,i,n){r||(r=e.initFactory({settings:C,getRecordTypes:function(e){return t.actionGrid.getRecordTypes(e)},picklistValuesFactory:function(e,a){return t.actionGrid.getPicklistValues(e,a)}})),r.config.fieldMeta=i},onDataSourceReady:function(e,t){r.fieldMeta=t,o=e,m()}})}};return u}),crmc.define("customPanes/chart",["ColumnFactory","FieldChooser","sfdc","CustomSettings"],function(e,t,a,i){var n,o=[],r={templateFunction:function(e){return e},fieldNames:{},itemID:"chart",isAvailable:function(e){return e.actionGrid.isReadingPaneTabEnabled("chart")&&i.getSetting(e.objectDescribe.name,this.itemID)!==!1},getLabel:function(e){return"Quick Graph"},getDataset:function(e,t,a,i){return colors=[{fillColor:"rgba(220,120,120,0.5)",strokeColor:"rgba(220,120,120,1)",pointColor:"rgba(220,120,120,1)",pointStrokeColor:"#f77",pointHighlightFill:"#f77",pointHighlightStroke:"rgba(220,120,120,1)"},{fillColor:"rgba(120,220,120,0.5)",strokeColor:"rgba(120,220,120,1)",pointColor:"rgba(120,220,120,1)",pointStrokeColor:"#7f7",pointHighlightFill:"#7f7",pointHighlightStroke:"rgba(120,220,120,1)"},{fillColor:"rgba(120,120,220,0.5)",strokeColor:"rgba(120,120,220,1)",pointColor:"rgba(120,120,220,1)",pointStrokeColor:"#77f",pointHighlightFill:"#77f",pointHighlightStroke:"rgba(120,120,220,1)"}],e%=colors.length,{type:i,label:t,backgroundColor:colors[e].fillColor,borderColor:colors[e].strokeColor,data:a}},drawChart:function(e,t){var a=this;o=e.selectedRows.length>0?e.selectedRows:e.kendoGrid.dataSource.view();var i="Name",r=e.objectDescribe.fields.filter(function(e){return e.getBoolean("nameField")});r.length>0&&(i=r[0].name,o.length>0&&!o[0].hasOwnProperty(i)&&o[0].aggregates&&o[0].items&&!o[0].items[0].hasOwnProperty(i)&&e.actionGrid.addRemoveColumn(i,0,!0));var s=o.map(function(e){return e.aggregates?"<a>"+e.value+"</a>":'<a href="/'+e.Id+'">'+e[i]+"</a>"}),l=[],d=0;a.templateFunctions=[function(e){return e}];var c=!1;if(Object.each(a.fieldNames,function(t){a.templateFunctions[d]=function(e){return e};var i=e.actionGrid.columns.filter(function(e){return e.field==t.fieldName})[0];i?a.templateFunctions[d]=function(e){var a={};return a[t.fieldName]=e,i.formula?kendo.format("{0:"+i.formula.format+"}",e):"function"==typeof i.template?i.template(a):void 0!=i.format?kendo.format(i.format,e):void 0}:console.log("no field found!");var n=o.map(function(e){return e.aggregates?e.aggregates[t.fieldName].sum||e.aggregates[t.fieldName].count:e[t.fieldName]}),r=Object.first(e.objectDescribe.fields,function(e){return e.name==t.fieldName});l.push(a.getDataset(d++,r?r.label:t.fieldName,n,t.type))}),c)return void console.log("reinit");var u={labels:s,datasets:l};if(t.html('<canvas id="'+this.itemID+'_can" style="width:100%;"></canvas>'),0==u.datasets.length)return void(document.getElementById(this.itemID+"_can").parentNode.innerHTML="Please select a column to graph from the Configure menu.");var p=document.getElementById(this.itemID+"_can").getContext("2d");n=new Chart(p,{type:"bar",data:u,options:{tooltips:{enabled:!0,mode:"label",callbacks:{label:function(e,t){var i=a.templateFunctions[e.datasetIndex](e.yLabel);return $("<p>").html(i).text()}}},maintainAspectRatio:!1,scales:{yAxes:[{ticks:{callback:function(e,t,i){var n=a.templateFunctions[0](e);return $("<p>").html(n).text()}}}],xAxes:[{ticks:{callback:function(e,t,a){return $("<p>").html(e).text()}}}]}}})},select:function(e,t){o=e&&e.selectedRows.length>0?e.selectedRows:e.kendoGrid.dataSource.view(),this.drawChart(e,t)},saveView:function(e,t,a){a.readingPane&&(a.readingPane[this.itemID]||(a.readingPane[this.itemID]={}),a.readingPane[this.itemID].fieldNames=this.fieldNames)},loadView:function(e,t){var i=this;i.fieldNames={},e.actionGrid.settings.readingPane[this.itemID]?i.fieldNames=e.actionGrid.settings.readingPane[this.itemID].fieldNames:e.actionGrid.settings.readingPane[this.itemID]={fieldNames:[]};var n=function(a){var n=a.draggable.currentTarget.data().field;if(n){if(i.fieldNames[n])delete i.fieldNames[n];else{var o=n;Object.each(e.actionGrid.columns,function(e){e.field==n&&(o=e.title||o)}),i.fieldNames[n]={fieldName:n,type:"bar",label:o}}i.drawChart(e,t)}},o=function(e){$(e.target).find("span").removeClass("k-denied"),$(e.target).find("span").addClass("k-i-pin")},r=function(e){$(e.target).find("span").addClass("k-denied"),$(e.target).find("span").removeClass("k-i-pin")};t.kendoDropTarget({group:e.actionGrid.getElement("grid").data().kendoReorderable.options.draggable.options.group,drop:n,dragenter:o,dragleave:r}),window.Chart?this.drawChart(e,t):a.importScript("https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.1/Chart.min.js",function(){i.drawChart(e,t)})}};return r}),crmc.define("ViewHelpers",["sfdc","GridConstants","KendoEntry","KendoPopup","Notification","ColumnFactory"],function(e,t,a,i,n,o){var r=["title","width","isResized","defaultValue","defaultId","readOnly","required","locked","headerTemplate","ordinal"],s={validateView:function(e,t,a,n){var o=e.filterId,r=e.selectedRecordIds&&e.selectedRecordIds.length>0;if(0!=t){var s=[{label:"Yes",click:function(){"function"==typeof a&&a()}},{label:"No",click:function(){"function"==typeof n&&n()}}];if(r){var l=["The current view is based off a set of Record IDs. Saving this view","will only ever display this set of Record IDs. We recommend that you",'"Clear Filters" via the Reset drop-down before you save the view if',"this is not desired. Would you like to continue?"].join("</br>");i.popupWithButtons("WARNING",l,s)}else if(o){var l=["The current view is based off a Salesforce List View. Saving","this view could produce undesirable results for others, including",'the inability to Sort or Filter. We recommend that you "Clear Filters"','via the "Reset" drop-down before you save the view. Would you like',"to continue?"].join("</br>");i.popupWithButtons("WARNING",l,s)}}return!o&&!r},saveMenu:function(o){var r=!1,l=o.settings.pageInfo,d=o.getSelectedView()||{},c=o.saveView(),u={"Reading Pane":o.isReadingPaneShowing(),editable:o.settings.editable,toolbarCollapsed:o.settings.toolbarCollapsed,contextName:o.getContextName(),objectName:l.objectName,hasStaticIds:l.selectedRecordIds&&l.selectedRecordIds.length>0},p=function(e,t){o.delegateEvent("saveView",e),r=!t.Editable.value!=!o.settings.editable||t.ReadingPane.value!=o.isReadingPaneShowing()||!t.Toolbar.value!=!!o.settings.toolbarCollapsed},f=function(e){n.showMessage({title:"View Updated",message:"Successfully updated view"},"success"),o.setSelectedView(e,!1,!0),o.loadViewDropDown(),r&&o.loadSavedView(e)},m=e.getNamespace(!0),h=d[m+"Privacy__c"],g=d.Name,v=d.OwnerId,b=e.getUserInfo(),y={},k=e.getSObjectDescribe(m+"GridView__c");h==t.viewPrivacy.publicReadOnly&&v&&b&&v!=b.userId&&(g+=" (Copy)",h=t.viewPrivacy.private),y.Name=g?g+(u.hasStaticIds?" (Fixed Records)":""):"",y[m+"Privacy__c"]=h||t.viewPrivacy.private,y[m+"Description__c"]=d[m+"Description__c"]||"",y[m+"IsDefault__c"]=!!d.getBoolean&&d.getBoolean([m+"IsDefault__c"]),privacyPicklistValues=[{active:"true",defaultValue:"true",label:"Private",value:"Private"},{active:"true",defaultValue:"false",label:"Public",value:"Public"},{active:"true",defaultValue:"false",label:"Public Read-Only",value:"Public Read-Only"}];var w=[{name:"Name",label:"View Name",type:"string",value:y.Name},{name:m+"Privacy__c",label:"Privacy",type:"picklist",dependentPicklist:function(t){return k.recordTypeInfos&&k.recordTypeInfos.length>0&&(t.model.Id=d.Id),e.getPicklistValueFactory({fieldName:m+"Privacy__c",picklistValues:privacyPicklistValues,objectName:m+"GridView__c",fields:[],recordTypeInfos:k.recordTypeInfos})(t)},values:privacyPicklistValues,value:y[m+"Privacy__c"]},{name:m+"IsDefault__c",label:"Default",type:"boolean",value:y[m+"IsDefault__c"]},{name:m+"Description__c",label:"Description",type:"textarea",value:y[m+"Description__c"]},{name:"Editable",label:"Inline Edit Mode",type:"boolean",value:u.editable},{name:"ReadingPane",label:"Show Reading Pane",type:"boolean",value:u["Reading Pane"]},{name:"Toolbar",label:"Show Toolbar",type:"boolean",value:!u.toolbarCollapsed}];a.entry("Save View / Save View As...",w,{hasDependency:!0,grid:o},null,function(e){var t=Object.first(e,function(e){return"Name"===e.name}),a=Object.first(e,function(e){return e.name===m+"Privacy__c"}),n=Object.first(e,function(e){return e.name===m+"Description__c"}),o=Object.first(e,function(e){return e.name===m+"IsDefault__c"}),r=Object.first(e,function(e){return"Editable"===e.name}),l=Object.first(e,function(e){return"ReadingPane"===e.name}),d=Object.first(e,function(e){return"Toolbar"===e.name});if(t&&t.value&&""!==t.value.trim()&&a){r&&r.value!=c.editable&&(c.editable=r.value),l&&c.readingPane&&l.value!=c.readingPane.expanded&&(c.readingPane.expanded=l.value,c.readingPane.showText=l.value),!d||d.value!=c.toolbarCollapsed&&void 0!=c.toolbarCollapsed||(c.toolbarCollapsed=!d.value),p&&p(c,e);var h={Name:t.value};h[m+"JSON__c"]=JSON.stringify(c),h[m+"ObjectName__c"]=u.objectName,h[m+"Privacy__c"]=a.value||y[m+"Privacy__c"],h[m+"IsDefault__c"]=o.value,h[m+"Description__c"]=n.value,h[m+"Context__c"]=u.contextName;var g=function(e){"function"==typeof f&&f(e)};s.saveAGView(h,g)}else i.popup("Error","Please enter a name for the view!")})},getSavedViews:function(a,i,n){var o=i==t.viewContext.pageLayout;return e.getSavedViews(a,o,n)},saveAGView:function(t,a,o){var r=e.getNamespace(!0),l=function(e){return r+e},d=new sforce.SObject(l("GridView__c"));if(t){d.Name=t.Name,d[l("JSON__c")]=t[l("JSON__c")],d[l("ObjectName__c")]=t[l("ObjectName__c")],d[l("Privacy__c")]=t[l("Privacy__c")],d[l("IsDefault__c")]="function"==typeof t.getBoolean?t.getBoolean(l("IsDefault__c")):t[l("IsDefault__c")]||!1,d[l("Description__c")]=t[l("Description__c")]||"",t[l("Context__c")]&&(d[l("Context__c")]=t[l("Context__c")]);var c=Object.first(s.getSavedViews(t[l("ObjectName__c")],t[l("Context__c")]),function(e){return e.Name==d.Name.trim()});c?(d.Id=c.Id,e.update(d,function(){"function"==typeof a?a(d):n.showMessage({title:"View Updated",message:"Successfully updated view"},"success")},function(e){"function"==typeof o?o(e):i.popup("Error","Unexpected error updating view: "+e)})):e.insert(d,function(){"function"==typeof a?a(d):n.showMessage({title:"View Saved",message:"Successfully saved view"},"success")},function(e){"function"==typeof o?o(e):i.popup("Error","Unexpected error saving view: "+e)})}},restoreColumn:function(e,t){if(void 0!==t){var a=Object.first(t,function(t){return t.field&&e.field&&t.field===e.field});void 0==a&&e.formula&&(a=Object.first(t,function(t){return t.title==e.title})),void 0!==a?Object.each(r,function(t){a[t]&&(e[t]=a[t]),"title"==t&&!e.filterable&&e.headerTemplate&&(e.headerTemplate=o.createNonFilterableHeaderTemplate(a.title))}):e.ordinal=t.length}},saveColumnMeta:function(e){var t={field:e.field};return Object.each(r,function(a){e[a]&&(t[a]=e[a])}),t}};return s}),crmc.define("browser",[],function(){var e={identify:function(){var e,t=navigator.userAgent,a=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(a[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE"):"Chrome"===a[1]&&(e=t.match(/\bOPR\/(\d+)/),null!=e)?"Opera "+e[1]:(a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&a.splice(1,1,e[1]),window.isDebug&&console.log(a),a.join(","))},name:function(){return this.identify().split(",")[0]},version:function(){return parseInt(this.identify().split(",")[1])},isTouch:function(){throw Exception("Not Implemented");
},CHROME:"Chrome",SAFARI:"Safari",IE:"IE",IE9:"MSIE",OPERA:"Opera",FIREFOX:"Firefox"};return e}),crmc.define("../Util/PromisePoly",[],function(){return function(e){function t(){}function a(e,t){return function(){e.apply(t,arguments)}}function i(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],d(e,this)}function n(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void i._immediateFn(function(){var a=1===e._state?t.onFulfilled:t.onRejected;if(null===a)return void(1===e._state?o:r)(t.promise,e._value);var i;try{i=a(e._value)}catch(e){return void r(t.promise,e)}o(t.promise,i)}))}function o(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof i)return e._state=3,e._value=t,void s(e);if("function"==typeof n)return void d(a(n,t),e)}e._state=1,e._value=t,s(e)}catch(t){r(e,t)}}function r(e,t){e._state=2,e._value=t,s(e)}function s(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,a=e._deferreds.length;t<a;t++)n(e,e._deferreds[t]);e._deferreds=null}function l(e,t,a){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=a}function d(e,t){var a=!1;try{e(function(e){a||(a=!0,o(t,e))},function(e){a||(a=!0,r(t,e))})}catch(e){if(a)return;a=!0,r(t,e)}}var c=setTimeout;i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,a){var i=new this.constructor(t);return n(this,new l(e,a,i)),i},i.all=function(e){var t=Array.prototype.slice.call(e);return new i(function(e,a){function i(o,r){try{if(r&&("object"==typeof r||"function"==typeof r)){var s=r.then;if("function"==typeof s)return void s.call(r,function(e){i(o,e)},a)}t[o]=r,0===--n&&e(t)}catch(e){a(e)}}if(0===t.length)return e([]);for(var n=t.length,o=0;o<t.length;o++)i(o,t[o])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(t){t(e)})},i.reject=function(e){return new i(function(t,a){a(e)})},i.race=function(e){return new i(function(t,a){for(var i=0,n=e.length;i<n;i++)e[i].then(t,a)})},i._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){c(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},i._setImmediateFn=function(e){i._immediateFn=e},i._setUnhandledRejectionFn=function(e){i._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=i:e.Promise||(e.Promise=i)}}),crmc.define("Patches",["browser","../Util/PromisePoly"],function(e,t){var a=e.name();if(a===e.CHROME||a===e.IE||a===e.IE9){var i=Array.prototype.sort,n=function(e){e||(e=function(e,t){return e.toString()<t.toString()?-1:e.toString()>t.toString()?1:0});var t=this.map(function(e,t){return{i:t,v:e}}),a=i.bind(t,function(t,a){var i=e(t.v,a.v);return 0==i?t.i-a.i:i});return a(),t.map(function(e){return e.v})};if(Array.prototype.sort=n,a===e.IE||a===e.IE9){t(window);try{kendo.ui.Popup.fn.options.position="top right",kendo.ui.Popup.fn.options.origin="bottom right"}catch(e){}}}}),crmc.define("ConditionalFormat",["KendoPopup","sfdc","JSOperators","ColumnFactory","FormulaHelpers"],function(e,t,a,i,n){var o=kendo.ui,r=o.Widget,s=function(e,t,a){var i=$('<div style="margin:4px; white-space:nowrap">'),n=$(kendo.format('<label style="display:inline-block; clear:left; width:7em;">{0}: </label>',e));i.append(n);var o=$("<span>");return a&&o.append($("<span style='display:inline-block; vertical-align:middle; background-color: #c00; width:3px; height:21px;'></span>")),o.append(t),i.append(o),i};Date.prototype.inLast=function(e,t){var a=!1,i=new Date(Date.now());i=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate()));var n=new Date(Date.UTC(this.getFullYear(),this.getMonth(),this.getDate())),o=function(e,t){return t>0?e>0&&e<=t:e<=0&&e>=t};switch(t.toLowerCase()){case"days":var r=n.getTime(),s=i.getTime();a=o((s-r)/864e5,e);break;case"weeks":var r=n.getTime(),s=i.getTime();a=o((s-r)/6048e5,e);break;case"months":var r=n.getTime(),s=i.getTime();a=o((s-r)/2592e6,e);break;case"years":var r=n.getTime(),s=i.getTime();a=o((s-r)/31536e6,e)}return a},Date.prototype.inNext=function(e,t){return this.inLast(-e,t)},String.prototype.contains=function(e){return e=e?e.toLowerCase():e,this.toLowerCase().indexOf(e)>-1};var l,d,c,u,p,f,m,h,g,v,b,y,k,w,x,I="#000000",S="rgba(255, 255, 255, 0)",C="Untitled Rule",N=r.extend({init:function(e,t){var o=this;u=t,r.fn.init.call(o,e);var w=$('<div style="width:215px; float:left;">'),C=$("<button>New Rule</button>");w.append(C),C.on("click",function(){o.newRule()}),C.kendoButton();var N=$('<button style="margin-left:3px;">Delete Rule</button>');w.append(N),N.on("click",function(){o.deleteRule()}),N.kendoButton(),g=$('<div style="width:215px; float:left; height:341px; margin-top:3px;" data-bind="source: items">'),g.kendoListView({template:"<div style='padding:0.5em; cursor: move;'>#:id#</div>",editTemplate:"<div style='padding:0.5em; cursor: move;'>*#:id#</div>",selectable:!0,change:function(){var e=o.selectedRule();e&&o.setSelected(e)}}),g.kendoSortable({cursor:"move",placeholder:function(e){return e.clone().css("opacity",.1)},hint:function(e){return e.clone().removeClass("k-state-selected")},change:function(e){var t=g.data("kendoListView").options.dataSource,a=(e.oldIndex,e.newIndex),i=(t.data(),t.getByUid(e.item.data("uid")));t.remove(i),t.insert(a,i)}}),$(w).append(g),$(e).append(w),y=$('<div style="width:calc(100% - 220px); float:right; margin-left:5px;">'),$(e).append(y),l=$('<input type="search" data-bind="value: id" style="width:calc(100% - 134px);"  required="required" />'),$(y).append(s("Rule Name",l,!0)),d=$('<input type="text" data-bind="value:field" style="width:calc(100% - 94px); max-width:430px;" required="required">'),$(y).append(s("Field",d,!0)),f=$('<input data-bind="value:backColor">');var _=$('<input  data-bind="value:backColor"/>');$(y).append(s("Cell Color",f)),f.after(_);var T=_.kendoColorPicker({value:I,buttons:!1,opacity:!0}).data("kendoColorPicker");T.wrapper.children().hide();var D=$("<button />");T.wrapper.append(D),D.kendoButton({icon:"colorPicker",click:function(){"rgba(255, 255, 255, 0)"==T.value()&&T.value("rgba(255, 255, 255, 255)"),T.toggle()}}),f.kendoColorPicker({palette:"basic",value:S}),m=$('<input data-bind="value:foreColor">');var O=$('<input data-bind="value:foreColor"/>');$(y).append(s("Text Color",m)),m.after(O);var R=O.kendoColorPicker({value:I,opacity:!0,buttons:!1}).data("kendoColorPicker");R.wrapper.children().hide();var j=$("<button />");R.wrapper.append(j),j.kendoButton({icon:"colorPicker",click:function(){R.toggle()}}),m.kendoColorPicker({palette:"basic",value:I});var P=function(e){return function(t){var a=o.selectedRule();a&&(a[e]=t.checked)}};h=$('<span style="display:inline-block; border:none; background-color:#ffffff;">'),$(y).append(s("Font Style",h)),h.kendoToolBar({resizable:!1,items:[{type:"buttonGroup",buttons:[{spriteCssClass:"k-tool-icon k-bold",text:"Bold",togglable:!0,showText:"overflow",id:"btnBold",toggle:P("bold")},{spriteCssClass:"k-tool-icon k-italic",text:"Italic",togglable:!0,showText:"overflow",id:"btnItalic",toggle:P("italic")},{spriteCssClass:"k-tool-icon k-underline",text:"Underline",togglable:!0,showText:"overflow",id:"btnUnderline",toggle:P("underline")}]}]});var E=$.extend([],t.grid.fieldMeta);E=Object.where(E,function(e){return"function"!=typeof e&&(e.displayName=i.getHeaderTitle(e,E),"reference"!==e.type.toLowerCase())}),Object.each(t.grid.settings.formulaFields,function(e,t){E.push({name:n.getFormulaFieldName(e),type:e.type,displayName:t})}),E=Array.orderBy(E,function(e){return e.displayName}),p=$('<input type="checkbox" data-bind="checked:isRow" />'),$(y).append(s("Apply to Row",p)),k=$("<div>");var F=$("<ul>");F.append($('<li class="k-state-active" id="basicTab">Basic Rule</li>')),F.append($('<li id="advancedTab">Advanced</li>')),k.append(F);var A=$('<div style="padding:5px;">');k.append(A);var L=$('<div style="padding:5px;">');k.append(L),c=$('<textarea style="vertical-align:top; width:calc(100% - 5px); height: 97px; font-family:monospace; font-size:14px;" data-bind="value:expression">');var M=[];Object.each(E,function(e){M.push({text:e.name,type:e.type,value:e.displayName})}),a.initMenu(L,c,E),$(L).append(c);var V=$('<label style="padding-right:5px">Format items with values that</label><br />');A.append(V),v=$('<input style="margin:3px 0px 3px 0px;" data-bind="value:basicOperator">'),A.append(v),v.kendoDropDownList({dataTextField:"label",dataValueField:"expression",valuePrimitive:!0}),b=$("<div>"),A.append(b),y.append(k),k.kendoTabStrip({animation:{open:{effects:"none"},close:{effects:"none"}},activate:function(e){var t=o.selectedRule();t&&(t.isBasic="basicTab"===e.item.id)}}),d.kendoDropDownList({dataTextField:"value",dataValueField:"text",dataSource:M,optionLabel:"Select a field...",template:'<span title="#:value#">#:value#</span>',cascade:function(e){var t=d.data("kendoDropDownList").dataItem(),a=o.selectedRule(),i=e.userTriggered&&$(this)[0].kendoBindingTarget;if(a)if(a.isBasic)i&&(a.set("basicValue",void 0),a.set("basicOperator",void 0)),o.createBasicRuleUI(t);else{var n=d.val()+' == ""';if(t&&t.type)switch(t.type.toLowerCase()){case"string":case"combobox":case"email":case"multipicklist":case"picklist":case"textarea":case"no formatting":case"url":n=d.val()+".contains('')";break;case"date":case"datetime":case"time":n=d.val()+".inLast(30,'days')";break;case"currency":case"decimal":case"integer":case"double":case"percent":n=d.val()+" > 0";break;case"boolean":n=d.val()+" == true"}!i&&a.expression||a.set("expression",n)}}});var G=$('<div style="float:right; margin:3px;">'),B=$('<button class="k-primary" style="margin:3px;">Apply Rules</button>');G.append(B),B.on("click",function(){o.apply()}),B.kendoButton(),$(y).append(G),x=$(e).kendoWindow({title:"Conditional Formatting Rules",width:"800px",minWidth:"400px",minHeight:"400px",resizable:!0,resize:function(){var t=$(e).height()-290;t<97&&(t=97),c.css("height",t);var a=$(e).height()-46;a<330&&(a=330),g.css("height",a)},modal:!0}).data("kendoWindow").center().open(),this.refresh(),this.createBasicRuleUI(d.data("kendoDropDownList").dataItem())},createBasicRuleUI:function(e){var t=e&&e.type?e.type:"string",a=this.operatorsForType(t),i=v.data("kendoDropDownList");i.setDataSource(a);var n,o=this.selectedRule();if(o&&a.length>0){var r=Object.first(a,function(e){return e.expression==o.basicOperator});r||o.set("basicOperator",a[0].expression)}this.valueInputForType(t,n)},valueInputForType:function(e,t){b.empty();var a=this.selectedRule();switch(e.toLowerCase()){case"string":case"no formatting":case"combobox":case"email":case"multipicklist":case"picklist":case"textarea":case"url":default:var i=$('<input type="search" style="width:calc(100% - 7px); max-width:500px" data-bind="value:basicValue">');b.append(i);break;case"date":case"datetime":case"time":if("{0}.inNext({1},'{2}')"==t||"{0}.inLast({1},'{2}')"==t){var i=$('<input style="width:100px;" data-bind="value:basicValue">');b.append(i),i.kendoNumericTextBox({format:"n0"});var n=$('<input style="width:100px;" data-bind="value:basicDateUnits">');b.append(n),n.kendoDropDownList({dataSource:["days","weeks","months","years"]}),a&&!a.basicValue&&(a.set("basicDateUnits","days"),a.set("basicValue","1"))}else if("{0} > new Date('{1}')"==t||"{0} < new Date('{1}')"==t){var i=$('<input data-role="datepicker" style="width:195px;" data-bind="value:basicValue">');if(b.append(i),a&&!a.basicValue){var o=new Date;a.set("basicValue",new Date(o.getFullYear(),o.getMonth(),o.getDay()))}}break;case"currency":case"integer":case"number":case"decimal":case"double":case"percent":var i=$('<input style="width:195px;" data-bind="value:basicValue">');b.append(i),i.kendoNumericTextBox(),a&&!a.basicValue&&a.set("basicValue","0");break;case"boolean":var i=$('<input style="width:195px;" data-bind="value:basicValue">');b.append(i),i.kendoDropDownList({dataSource:["true","false"]}),a&&!a.basicValue&&a.set("basicValue","true")}kendo.bind(b,this.selectedRule())},operatorsForType:function(e){var t={};switch(e.toLowerCase()){case"string":case"combobox":case"email":case"no formatting":case"multipicklist":case"picklist":case"textarea":case"url":t={contains:"{0}.contains('{1}')","does not contain":"!{0}.contains('{1}')",equals:"{0} == '{1}'","does not equal":"{0} != '{1}'","is blank":"{0} == null","is not blank":"{0} != null"};break;case"date":case"datetime":case"time":t={"are in the future":"{0} > new Date()","are in the past":"{0} < new Date()","are in next X":"{0}.inNext({1},'{2}')","are in last X":"{0}.inLast({1},'{2}')","are greater than":"{0} > new Date('{1}')","are less than":"{0} < new Date('{1}')","is blank":"{0} == null","is not blank":"{0} != null"};break;case"currency":case"integer":case"number":case"decimal":case"double":case"percent":t={"are greater than":"{0} > {1}","are less than":"{0} < {1}",equals:"{0} == {1}","does not equal":"{0} != {1}","is blank":"{0} == null","is not blank":"{0} != null"};break;case"boolean":t={equals:"{0} == {1}","does not equal":"{0} != {1}"}}var a=[];return Object.each(t,function(e,t){a.push({label:t,expression:e})}),a},selectedRule:function(){var e=g.data("kendoListView"),t=e.dataItem(e.select());return t},deleteRule:function(){var e=g.data("kendoListView");if(this.selectedRule()){var t=e.select();this.canMoveForward(1,66,28)&&(e.remove(t),this.apply(),0==w.data().length||e.select(e.element.children().eq(0)))}},canMoveForward:function(){return this.arguments=arguments,l.val()&&0!=l.val().length?!(!d.val()||0==d.val().length)||(e.popup("Field Required","Please select a field to apply custom formatting rules to.",void 0,void 0,void 0,{close:{handler:function(){x.setOptions({modal:!0})},scope:this}}),!1):(e.popup("Name Required","Rule Name is required",void 0,void 0,void 0,{close:{handler:function(){x.setOptions({modal:!0})},scope:this}}),!1)},newRule:function(){var e=g.data("kendoListView");e.add(),e.select(e.element.children().first()),y.show()},updateExpression:function(e){if(e.basicOperator&&e.field){var t=e.basicValue;t&&t.toISOString&&(t=t.toISOString()),e.set("expression",kendo.format(e.basicOperator,e.field,t,e.basicDateUnits))}},refresh:function(){var e=g.data("kendoListView"),t=e.select().prevAll().length,a=[],i=this;Object.each(u.grid.settings.conditionalRules,function(e,t){Object.each(e,function(e){var t=new kendo.data.ObservableObject(e);a.push(t)})}),w=new kendo.data.DataSource({data:a.reverse(),change:function(e){if("itemchange"==e.action&&1==e.items.length&&("basicOperator"==e.field||"basicValue"==e.field||"basicDateUnits"==e.field||"field"==e.field)){if("basicOperator"==e.field){var t=d.data("kendoDropDownList").dataItem();t&&t.type&&["date","datetime","time"].indexOf(t.type.toLowerCase())>-1&&(e.items[0].set("basicValue",void 0),i.valueInputForType(t.type,e.items[0].basicOperator))}i.updateExpression(e.items[0])}},schema:{model:{id:"id",fields:{id:{nullable:!1,type:"string",validation:{required:!0},defaultValue:function(){var e=C,t=Object.where(w.data(),function(e){return e.id&&e.id.indexOf(C)>-1});return t&&t.length>0&&(e+=t.length),e}},field:{type:"string",validation:{required:!0}},expression:{type:"string"},basicOperator:{type:"string"},basicDateUnits:{type:"string",defaultValue:"days"},foreColor:{type:"string",defaultValue:I},backColor:{type:"string",defaultValue:S},isRow:{type:"boolean"},isBasic:{type:"boolean",defaultValue:!0},dependentFields:{type:"array",defaultValue:[]}}}}});var n=new kendo.observable({items:w});kendo.bind(g,n),0==a.length?y.hide():y.show(),e.select(e.element.children().eq(t))},apply:function(){if(this.canMoveForward()){u.grid.settings.conditionalRules={};var e=w.data().slice(0);e.reverse(),Object.each(e,function(e){var t=u.grid.settings.conditionalRules[e.field]||{};t[e.id]=e,u.grid.settings.conditionalRules[e.field]=t}),u.grid.refresh(),this.refresh()}},setSelected:function(e){e.property&&("background-color"==e.property?(e.backColor=e.backColor||e.color,e.foreColor=e.foreColor||I):(e.foreColor=e.foreColor||e.color,e.backColor=e.backColor||S)),kendo.bind(y,e),h.data("kendoToolBar").toggle("#btnBold",e.bold===!0),h.data("kendoToolBar").toggle("#btnItalic",e.italic===!0),h.data("kendoToolBar").toggle("#btnUnderline",e.underline===!0),e.isBasic?k.data("kendoTabStrip").activateTab("#basicTab"):k.data("kendoTabStrip").activateTab("#advancedTab")},options:{name:"ConditonalFormatting"}});o.plugin(N)}),crmc.define("SessionHandler",["KendoPopup","sfdc"],function(e,t){var a="3MVG9xOCXq4ID1uE34nf8DNiyztaNiv56eD4cVqdDIBefde_rcT7idkDRmvHm7m9vUUr63EgH.NA8hUmsfjnC",i="https://login.salesforce.com/services/oauth2/authorize",n="https://test.salesforce.com/services/oauth2/authorize",o={authorize:function(){t.executeRemoteAction("getAccessToken",[],function(r,s){if(r){var l=new CustomEvent("gotSessionId",{detail:r});window.dispatchEvent(l)}else{var d=t.getNamespace(!0),c=encodeURIComponent(kendo.format("https://{1}.salesforce.com/apex/{0}OAuthHandler",d,t.isSandbox()?"cs1":"na1"));e.popup("Invalid Session","ActionGrid needs your permission to continue communicating with Salesforce.","Authorize",function(){var e=kendo.format("{0}?response_type=code&scope=full+refresh_token&client_id={1}&redirect_uri={2}",t.isSandbox()?n:i,a,c),r="width=670,height=850,toolbar=no,status=no,directories=no,menubar=no,resizable=yes,scrollable=no";o.win=window.open(e,"authWindow",r)},"Not Now")}})},authorized:function(e){o.win&&o.win.close()}};return $(window).on("getSessionId",function(){o.authorize()}),window.addEventListener("gotSessionId",function(e){o.authorized(e.detail)}),o}),crmc.define("GridBase",["GridDataProvider","FieldChooser","sfdc","SFRest","GridConstants","KendoPopup","KendoEntry","ActionGridDelegate","MultiSelectGridFilter","CustomSettings","tooling","Notification","ColumnFactory","FilterLogic","Toolbar","HoverHelp","FormulaHelpers","LightningDelegate","mixpanel","customPanes/detailGrid","customPanes/chart","ViewHelpers","extensions","Patches","ConditionalFormat","Formula","SessionHandler"],function(e,t,a,i,n,o,r,s,l,d,c,u,p,f,m,h,g,v,b,y,k,w){var x={},I=function(){var e=a.getNamespace(!1),t=e?e+".":"",i={getPageAction:t+n.VF_APEX_CONTROLLER+".getPage",getFieldMetaAction:t+n.VF_APEX_CONTROLLER+".getFieldMetaForObjectColumns",getColumnAction:t+n.VF_APEX_CONTROLLER+".getFieldMetaForObject",isPackageInstalled:t+n.VF_APEX_CONTROLLER+".isPackageInstalled",getDefaultFieldsAction:t+n.VF_APEX_CONTROLLER+".getDefaultFieldsForObject",getFieldSetDescribe:t+n.VF_APEX_CONTROLLER+".getFieldSetDescribe"};return i},S=new Date(Date.now()),C=!1,N=function(e){if(C){var t=new Date(Date.now()).getTime(),a=S.getTime();console.log(e+": "+kendo.format("{0:n0}",parseInt(t-a))+"ms")}},_={pageInfo:{objectName:void 0,columns:[],takeCount:100},metadata:void 0,id:void 0,pageURL:"",fkField:void 0,fkValue:void 0,viewId:void 0,enableNewButton:!0,enableNewInline:!0,enableEdit:!0,enableFieldChooser:!0,enableToolbar:!0,enableActions:!0,enableStickyViews:!0,enableViews:!0,enableDetailGrid:!0,enableAutoFill:!0,enableHover:!a.isLightningExperienceOrSalesforce1(),enableFullscreen:!0,enableFormatting:!0,enableReadingPane:!0,enableActionsColumn:!0,editable:!0,isFullscreen:!0,fieldChooserDelay:1500,groupExpandAll:void 0,lockedColumns:!1,readingPane:{showGraphs:!1,showText:!0,expanded:!1,selectedField:void 0,position:"right",height:150,width:"30%",chart:{fieldNames:{}},detailGrid:{fieldNames:[]}},delegate:{selectionChanged:function(){},rowDoubleClick:function(){},createColumn:function(){},getActionItems:function(){},getColumnNames:function(){},dataReady:function(){}}},T={init:function(e){N("init");var i=Object.create(_);Object.copy(e,i),this.settings=i;var n;n=a.isLightningExperienceOrSalesforce1()?Object.create(v):Object.create(s),Object.copy(e.delegate,n),this.settings.delegate=n,this.settings.remoteActions||(this.settings.remoteActions=I()),this.columnFactory||(this.columnFactory=Object.create(p));var r=$("#"+this.settings.id);if(r){r.empty();var l=this.getElement("contextMenu");if(0==l.length){var c=kendo.template('<ul class="forceNormalStyle" id="#=id#_contextMenu"></ul>'),u=kendo.template('<ul class="forceNormalStyle" id="#=id#_headerMenu"></ul>');$(document.body).append(c({id:this.settings.id})),$(document.body).append(u({id:this.settings.id}))}var f='<div id="#=id#_split" style="height:100%;"><div id="#=id#_paneSplit" class="k-content crmc-grid" style="height:100%;overflow: hidden;"><div id="#=id#_grid"></div></div><div id="#=id#_fieldTreeView"></div>',m=kendo.template(f),g=m({id:this.settings.id});r.append(g)}else console.log("Unable to find parent DOM element with id: "+this.settings.id);if(this.settings.pageURL.indexOf("?")>-1&&(this.settings.pageURL=this.settings.pageURL.split("?")[0]+"?object="+this.settings.pageInfo.objectName),!this.settings.metadata)try{this.settings.metadata=a.getSObjectDescribe(e.pageInfo.objectName),this.settings.metadata.childRelationships=[].concat(this.settings.metadata.childRelationships)}catch(t){t.faultcode&&"sf:INVALID_SESSION_ID"==t.faultcode?o.popup("Expired Session"," Salesforce session has expired, please refresh the page to continue working"):t.faultcode&&"sf:INVALID_TYPE"==t.faultcode?o.popup("Error","sObject type '"+e.pageInfo.objectName+"' is not supported. If you are attempting to use a custom object, be sure to append the '__c' after the entity name. Double check your security to this object."):o.popup("Error",t.toString())}if(this.settings.fkField&&this.settings.fkField.length>0&&this.settings.fkValue&&this.settings.fkValue.length>0&&!this.settings.fkDisplayName){var b=this,y=Object.first(this.settings.metadata.fields,function(e){return e.name==b.settings.fkField});if(y&&y.referenceTo){var k=[].concat(y.referenceTo);try{sforce.connection.retrieve("Name",k[0],[this.settings.fkValue],{onSuccess:function(e){b.settings.fkDisplayName=e&&e.length>0&&e[0]?e[0].Name:""},onFailure:function(){}})}catch(e){}}}var w=this;w.getElement("grid").on("dblclick","td",function(e){w.rowDoubleClick(e)}),this.settings.enableActions&&(this.actionMenuItems={},this.actionMenu=this.initContextMenu("contextMenu"),this.headerMenu=this.initContextMenu("headerMenu",!0),w.getElement("grid").on("contextmenu","tbody a, input, textarea",function(e){e.stopPropagation()}));var x=w.getElementId("grid"),S=x+" .k-footer-template .k-icon.k-i-info",C=x+" .k-group-footer .k-icon.k-i-info";$(document).off("click",S),$(document).on("click",S,function(){w.totalToolTipHandler(this)}),$(document).off("click",C),$(document).on("click",C,function(){w.subTotalToolTipHandler(this)});var T="paste."+w.getElementId("grid");$(document).off(T),$(document).on(T,function(e){$(document.activeElement).closest(".k-grid").attr("id")==w.getElementId("grid").replace("#","")&&w.onPaste(e)});var D="resize."+w.getElementId("grid");if($(window).off(D),$(window).on(D,function(){w.resize()}),w.resize(),1==w.settings.enableStickyViews&&(window.self!==window.top?$(window).on("unload",function(){w.saveStickyView()}):window.onbeforeunload=function(){w.saveStickyView()}),!this.settings.isChildGrid){var O=this.settings.enableFieldChooser&&d.getSetting(this.settings.pageInfo.objectName,"fieldChooser")!==!1;w.fieldSplitter=w.getElement("split").kendoSplitter({orientation:"horizontal",panes:[{collapsible:!1},{collapsible:O,size:"260px",collapsed:!0}]}).data("kendoSplitter"),O&&(this.fieldChooser=Object.create(t),this.fieldChooser.init({elementId:this.getElementId("fieldTreeView"),delegate:this,objectName:this.settings.pageInfo.objectName,objectLabel:this.settings.metadata.label,enableAutoUpdate:!0}),w.fieldSplitter.bind("expand",function(){var e=w.getElement("configButton");e&&e.length>0&&e.addClass("k-state-selected")}),w.fieldSplitter.bind("collapse",function(){var e=w.getElement("configButton");e&&e.length>0&&e.removeClass("k-state-selected"),w.fieldChooser.clearSearch(),w.fieldChooser.collapseRootNodes()}))}this.settings.enableHover&&d.getSetting(this.settings.pageInfo.objectName,"lookupHoverDetail")!==!1&&h.init(this),!a.isInConsole()||window.srcUp||"undefined"!=typeof sforce&&sforce.console||a.importScript("/support/console/34.0/integration.js"),this.loadStickyView()},onPaste:function(e){var t=e&&e.originalEvent&&e.originalEvent.clipboardData;if(t&&t.getData){var a=t.getData("text/html"),n=$(a),r=$(document.activeElement),s=this;if(this.settings.editable&&x.editModeContext&&x.editModeContext.has(r).length>0&&n&&n.length>0){var l=x.editModeContext.prevAll().length,c=x.editModeContext.closest("tr"),u=0,p=c.attr("data-uid"),f=s.gridDataSource.getByUid(p),m=s.kendoGrid.lockedTable&&s.kendoGrid.lockedTable.has(r).length>0,h=s.kendoGrid.lockedTable&&s.kendoGrid.lockedTable.find("tr:eq(0) td").length,g=n.find("tr"),v=".k-footer-template,.k-detail-row,.k-grouping-row,.k-group-footer",y=f&&void 0!=f.Id&&0==f.Id.length,k=d.getSetting(s.settings.pageInfo.objectName,"pasteUpdate")===!0,w=d.getSetting(s.settings.pageInfo.objectName,"pasteInsert")!==!1,I=!0,S=function(e){var t="{0} div.k-grid-header-wrap tr:eq(0) th:eq({1})";return m&&h>0&&(e>=h?e-=h:t="{0} div.k-grid-header-locked tr:eq(0) th:eq({1})"),$(kendo.format(t,s.getElementId("grid"),e))},C=function(e,t){var a=s.getElementId("grid")+" div.k-grid-content",i="{0} tr:not({3}):eq({1}) td:eq({2})";return m&&h>0&&(t>=h?t-=h:a=s.getElementId("grid")+" div.k-grid-content-locked"),$(kendo.format(i,a,e,t,v))},N=function(){I&&$(g).each(function(){s.gridDataSource.insert(0,{})}),$(g).each(function(e,t){setTimeout(function(){var a=$(t).find("td").toArray();a.map(function(t,a){var n=l+a,o=$(t).text().trim(),r=S(n),d=r.attr("data-field");if(d&&d.length>0){var c=C(u,n),f=Object.first(s.fieldMeta,function(e){return e.name.toLowerCase()==d.toLowerCase()});if(f){f.isNameField&&f.parentMeta&&(f=f.parentMeta),p=c.parent("tr").attr("data-uid");var m=s.gridDataSource.getByUid(p);switch(f.type.toLowerCase()){case"reference":i.query(kendo.format("select Id from {0} where {1} = '{2}'",f.relObjectName,d,o),function(e){var t,a;e&&e.length>0&&(t=o,a=e[0].Id),s.kendoGrid.editCell(c),m[d]=t,m[f.relationshipName].Id=a,m.set(d,t),m.set(f.name,a)},function(e){console.log(e)});break;case"boolean":o=o.toLowerCase().trim(),o="true"==o||"yes"==o||"1"==o||"on"==o||"active"==o;break;case"currency":case"integer":case"double":case"integer":case"percent":o=+o.replace(/[^\d\.e\+\-]*/g,"");break;case"date":case"datetime":case"time":o=kendo.parseDate(o),null==o&&(o=Date.parse($(t).text().trim()))}s.kendoGrid.editCell(c),m.set(d,o),m[d]=o,e==g.length-1&&s.kendoGrid.editCell(c)}}}),u++})})},_=0==g.length;if(_|=1==g.length&&1==$(g[0]).find("td").length)return;e.preventDefault(),b.track("Paste",{objectName:s.settings.pageInfo.objectName,numRows:g.length}),g.length>100?o.popup("Max Row Limit","Please paste less than 100 rows at a time"):k&&w&&!y?o.popupWithButtons("Pasting Data","You are pasting structured data into ActionGrid.<br/> Would you like to insert new rows or overwrite existing rows relative to the currently selected cell?",[{label:"Insert Rows",click:function(){N()}},{label:"Overwrite",click:function(){I=!1,u=c.prevAll(kendo.format(":not({0})",v)).length,N()}},{label:"Cancel"}]):w?N():k&&(I=!1,u=c.prevAll(kendo.format(":not({0})",v)).length,N())}}},destroy:function(){this.kendoGrid&&this.kendoGrid.destroy(),this.paneSplitter&&this.paneSplitter.destroy(),this.gridDataSource&&this.gridDataSource.unbind()},toogleSelectedItems:function(e){var t=this;$(this.getElementId("grid")+" .k-grouping-row").each(function(){t.kendoGrid[e](this)})},setupToggleButton:function(e){var t=this;t.settings.groupExpandAll=0!=t.settings.groupExpandAll;var a=$('<button type="button">+/-</button>').css({border:"0px",padding:"5px","font-weight":"bold"});$(e).find(".k-group-cell.k-header").html(""),$(e).find(".k-group-cell.k-header").first().css({padding:"0px"}).html(a),a.on("click",function(){var e="collapseGroup";$('.k-grouping-row > td[aria-expanded="false"]').length>0&&(e="expandGroup"),t.toogleSelectedItems(e),t.settings.groupExpandAll=!t.settings.groupExpandAll})},onKendoDataBound:function(){this.delegateEvent("dataReady",this.getActionContext());var e=this.kendoGrid,t=this,a=this.getElementId("grid");e.dataSource.group()&&e.dataSource.group().length>0&&this.getElement("check-all").attr("checked",!1),this.setupToggleButton(a),this.refreshFormatting();var i=function(e,a){var i=$(e);t.settings.lockedColumns&&(i=$("[data-uid="+i.data("uid")+"]")),a?i.addClass("k-state-selected"):i.removeClass("k-state-selected")};$("input[name='selectedBox"+this.settings.id+"']").change(function(){this.checked=$(this).parent().parent().hasClass("k-state-selected")}),$("input[name='selectedBox"+this.settings.id+"']").parent().on("mousedown",function(e){var a=!$(this).parent().hasClass("k-state-selected");i(this.parentElement,a),this.children[0].checked=a,e.stopPropagation(),t.selectionChanged()}),this.selectionChanged();var n=$(".check-group_"+t.settings.id);n.off("change"),n.on("change",function(){var e=this,a=this.name.split("|");a.length<=1||($(t.kendoGrid.element).find("input[name='selectedBox"+t.settings.id+"']").each(function(){if(0==!$(this).closest(".crmc-grid").attr("id").indexOf(t.settings.id+"_"))return!0;var n=$(this).parents("tr").first().data("uid"),o=t.gridDataSource.getByUid(n),r=""==a[2]?void 0:a[2],s=o[a[1]]==r;s&&(this.checked=e.checked,i(this.parentElement.parentElement,this.checked))}),t.selectionChanged())});var o=$("#"+this.settings.id+"_showFilter").find("span");f.hasFilter(this)?(o.removeClass("k-i-funnel"),o.addClass("k-i-funnel-active")):(o.removeClass("k-i-funnel-active"),o.addClass("k-i-funnel")),0==this.settings.groupExpandAll&&setTimeout(function(){t.toogleSelectedItems("collapseGroup")}),this.setKeyboardFocus(),this.resize(),this.redraw(),$(window).trigger("resize")},setKeyboardFocus:function(){var e=this,t=window.top!=window;if(e.settings.isChildGrid)e.settings.parentGrid.setKeyboardFocus();else if(!t){var a=e.getElement("check-all"),i=a.offset().left<window.scrollX+$(window).width()&&a.offset().left>window.scrollX,n=a.offset().top<window.scrollY+$(window).height()&&a.offset().top>window.scrollY;if(i&&n){var o=$(document.activeElement),r=e.kendoGrid.table.has(o).length>0,s=e.kendoGrid.lockedTable&&e.kendoGrid.lockedTable.has(o).length>0,l=e.getElement("pane").has(o).length>0,d=e.kendoGrid.content.scrollLeft()>0,c=e.getElement("toolbar").has(o).length>0;r||s||l||d||c||e.forceKeyboardFocus()}}},forceKeyboardFocus:function(){var e=this.getElement("check-all");e.length>0&&e[0].focus()},getKendoGridOptions:function(e){var t,i=this,o=kendo&&kendo.support&&kendo.support.mobileOS,r="border:none;",s=kendo.format('<div class="toolbar" id="{0}_toolbar" style="{1}"></div><div id="{0}_toolbarHandle" class="k-icon toolbarHandle">...</div>',i.settings.id,r),l=d.getSetting(this.settings.pageInfo.objectName,"toolBar")!==!1,c={columns:this.columns,toolbar:l&&this.settings.enableToolbar?kendo.template(s):void 0,selectable:o?"row":"multiple",groupable:{showFooter:!0},navigatable:!1,filterable:{extra:!1,operators:n.operators},height:$("#"+this.settings.id).height(),resizable:!0,reorderable:!0,sortable:!0,dataSource:e,autoBind:!1,editable:!!this.settings.editable&&"incell",pageable:{refresh:!0,pageSizes:[50,100,500,1e3],buttonCount:5},excelExport:function(e){Object.each(e.workbook.sheets,function(e){Object.each(e.rows,function(e){(e.type.indexOf("footer")>-1||e.type.indexOf("group-header")>-1)&&Object.each(e.cells,function(e){if(e.value){var t=$(e.value.trim());t.length>0&&(e.value=t.text())}})})})},change:function(e){var a=this,n=i.isReadingPaneShowing(),o=a.select();o=o.length>0&&o;var r=i.checkForDirtyRelatedChildInstance(),s=o?i.kendoGrid.dataItem(String.format("tr[data-uid={0}]",o[0].dataset.uid)):o;
if(!n||0==r.length||r.length>0&&s&&""==s.Id)clearTimeout(t),t=setTimeout(function(){$.each($("input:checked[name='selectedBox"+i.settings.id+"']"),function(e,t){t.checked=!1});for(var e=0;e<o.length;e++){var t=$(o[e]).find("input[name='selectedBox"+i.settings.id+"']");t.length>0&&(t[0].checked=!0)}var a=!0;if(1==o.length&&x.prevSelectedRows&&1==x.prevSelectedRows.length)var a=Object.first(o,function(e){var t=Object.first(x.prevSelectedRows,function(t){return $(t).attr("data-uid")===$(e).attr("data-uid")});return!t});x.prevSelectedRows=o,a&&i.selectionChanged()},300);else{var l=$(i.getElementId("grid")+" .k-grid-content .k-state-selected"),d=$(i.getElementId("grid")+" input[name='selectedBoxgrid']:checked");l.removeClass("k-state-selected"),d.parent().parent().addClass("k-state-selected"),i.saveDirtyRowsPrompt(r,function(){d.parent().parent().removeClass("k-state-selected"),d.prop("checked",!1),i.kendoGrid.select(l)})}},save:function(e){var t=i.kendoGrid.dataItem(String.format("tr[data-uid={0}]",e.model.uid));if(t){var n=Object.create(t);t.dirtyFields||(i.setSaveButtonDirty(!0),t.dirtyFields={}),Object.each(e.values,function(e,o){n[o]=e;var r=function(a){t.dirtyFields[a]=e};if(o.indexOf(".")>-1){var s=o.split(".");if(2!=s.length||!a.isSalesforceId(e)&&null!=e){if(i.allowParentalEditing()){var l=s[0],d=t[l].Id;if(d){var c=s[1],u=Object.first(i.fieldMeta,function(e){return e.relationshipName==l});if(s.length>2){var p=Object.first(i.fieldMeta,function(e){return e.name==o});c=p.parentMeta.name.split(".")[1],i.updateOperationLabels||(i.updateOperationLabels={});var f=$('[name="'+o+'_input"]').val();f&&(i.updateOperationLabels[e]=f)}var m=u.relObjectName,h=a.getSObjectNameField(a.getSObjectDescribe(m));if(c==h||o.indexOf("_input")>-1)return;i.updateOperations||(i.updateOperations={}),i.updateOperations[m]||(i.updateOperations[m]={}),i.updateOperations[m][d]||(i.updateOperations[m][d]={}),i.updateOperations[m][d][c]=e,i.decorateDirtyParents(o,d,m)}}}else r(a.getIdFieldFromRelationshipName(s[0]))}else o.indexOf("_input")>-1&&!t.hasOwnProperty(o)?r(o.substring(0,o.lastIndexOf("_input"))):"_events"===o||r(o)}),i.refreshFormatting(n)}i.toolbar.enable("#"+i.settings.id+"_saveButton",!0)},saveChanges:function(e){x.rowErrors=[],x.dirtyRows=e.sender.dataItems().filter(function(e){return e.dirty||e.isNew()});var t=i.settings.metadata.name;Object.each(x.dirtyRows,function(e){if(e.UID=e.uid,("OpportunityLineItem"==t||"QuoteLineItem"==t)&&e.Quantity&&e.UnitPrice){var a=e.dirtyFields;a.Quantity&&!a.UnitPrice?a.UnitPrice=e.UnitPrice:a.UnitPrice&&!a.Quantity&&(a.Quantity=e.Quantity)}})},dataBound:function(){N("dataBound"),i.onKendoDataBound()},cancel:function(){x.isInEditMode=!1,x.editModeContext=null},edit:function(e){x.isInEditMode=!0,x.editModeContext=e.container,x.rowErrors=[],x.dirtyRows=[],x.grid=this,e.model.isNew()&&Object.each(e.model,function(t,a){if(a.indexOf(".")>=0){var i=a.split(".")[0];e.model[i]||(e.model[i]={})}})},columnReorder:function(e){var t=e.column.headerTemplate,a=t&&t.indexOf("grid_check-all")!=-1,n=t&&t.indexOf("Action")!=-1,o=e.sender.columns[1],r=o.headerTemplate&&o.headerTemplate.indexOf("Action")!=-1?1:0;if(a||n){var s=this;setTimeout(function(){s.reorderColumn(e.oldIndex,e.column)})}else if(e.oldIndex>r&&e.newIndex<=r){var s=this;setTimeout(function(){s.reorderColumn(e.oldIndex,e.column)})}setTimeout(function(){i.modifySelectedView()}),$(document.activeElement).blur(),i.setKeyboardFocus()},columnResize:function(e){e.column.isResized=!0,i.modifySelectedView(),$(kendo.format("input[name='{0}']",e.column.field)).trigger("resize",e.newWidth-7)}};if(1==i.settings.enableDetailGrid&&!i.isReadingPaneShowing()&&!i.settings.lockedColumns){var u=!1;c.detailTemplate=function(e){var t=i.checkForDirtyRelatedChildInstance();return t.length>0&&(u=!0,i.saveDirtyRowsPrompt(t,function(){setTimeout(function(){i.kendoGrid.expandRow("[data-uid='"+e.uid+"']")})})),i.getPreviewTabStripTemplate(e)},c.detailInit=function(e){i.initKendoGridDetail(e)},c.detailExpand=function(e){u?(u=!1,setTimeout(function(){i.kendoGrid.collapseRow(e.masterRow)})):i.onKendoGridDetailExpand(e)}}return c},_readingPaneTextFields:void 0,getReadingPaneTextFields:function(){var e=this;if(void 0==e._readingPaneTextFields){var t=[];Object.each(e.settings.metadata.fields,function(e){("textarea"==e.type||"string"==e.type)&&e.length>255&&t.push({name:e.name,label:e.label})}),t=Array.orderBy(t,function(e){return e.label}),e._readingPaneTextFields=t}return e._readingPaneTextFields},isReadingPaneTabEnabled:function(e,t){var a=!1,i=e;switch(e.contains("vfPage")&&!t&&(i="vfPage"),i){case"readingPane":void 0!==t&&(this.settings.readingPane.showText=t);var n=this.getReadingPaneTextFields();a=this.settings.readingPane.showText&&n.length>0;break;case"quickView":void 0!==t&&(this.settings.readingPane.showChatter=t),a="true"==this.settings.metadata.feedEnabled&&this.settings.readingPane.showChatter!==!1;break;case"detailGrid":void 0!==t&&(this.settings.readingPane.showDetailGrid=t),a=this.settings.readingPane.showDetailGrid&&d.getSetting(this.settings.pageInfo.objectName,"detailGrid")!==!1,t===!1&&(this.settings.readingPane.detailGrid.fieldNames=[],this.getElement("fieldTreeView").data("kendoTreeList").refresh());break;case"chart":void 0!==t&&(this.settings.readingPane.showChart=t),a=this.settings.readingPane.showChart&&d.getSetting(this.settings.pageInfo.objectName,"chart")!==!1,t===!1&&(this.settings.readingPane.chart.fieldNames={},this.getElement("fieldTreeView").data("kendoTreeList").refresh());break;case"vfPage":for(var o=this.settings.readingPane.rpvfPages,r=0;r<o.length;r++)if(o[r].name&&o[r].name==e.replace(i+"_","")){o.splice(r,1);break}}return a},onRPTabFieldChecked:function(e,t,a){var i,n=!1,o=e;switch(Object.each(this.columns,function(e){e.field==t&&(i=e)}),o){case"detailGrid":if(void 0!==a)if(a&&this.settings.readingPane[o].fieldNames&&this.settings.readingPane[o].fieldNames.indexOf(t)<0)this.isReadingPaneTabEnabled(o,a),this.settings.readingPane[o].fieldNames.push(t);else if(0==a){var r=this.settings.readingPane[o].fieldNames.indexOf(t);this.settings.readingPane[o].fieldNames.splice(r,1)}this.modifySelectedView(),this.settings.readingPane[o]&&this.settings.readingPane[o].fieldNames&&(n=this.settings.readingPane[o].fieldNames.indexOf(t)>-1),void 0==i&&void 0!=a&&(console.log("changing columns",t,a,a?0:-1),this.addRemoveColumn(t,a?0:-1,a,!a));break;case"chart":if(void 0!==a)if(a&&this.settings.readingPane[o].fieldNames&&void 0==this.settings.readingPane[o].fieldNames[t]){this.isReadingPaneTabEnabled(o,a);var s=i?i.label:t;this.settings.readingPane[o].fieldNames[t]={fieldName:t,type:"bar",label:s}}else 0==a&&delete this.settings.readingPane[o].fieldNames[t];this.modifySelectedView(),this.settings.readingPane[o]&&this.settings.readingPane[o].fieldNames&&(n=void 0!==this.settings.readingPane[o].fieldNames[t]),a&&void 0==i&&(this.addRemoveColumn(t,0),this.preserveSelectedRows(this.settings.editable,!1,void 0,function(){}))}return n},onVFPageChecked:function(e){var t=this.settings.readingPane.rpvfPages||[],a=Object.first(t,function(t){return t.name==e.name});a?t.splice(t.indexOf(a),1):t.push(e),this.settings.readingPane.rpvfPages=t},getPreviewTabStripTemplate:function(e){e=e||{Id:this.getElementId("rp").replace("#","")};var t=this,i=t.getChildTables(),n=$('<div class="tabstrip"></div>'),o={},r={},s=["readingPane","quickView"],l=$("<ul></ul>");if(this.isReadingPaneTabEnabled("quickView")&&(o.quickView='<li id="quickView__tab__'+e.Id+'" >Chatter</li>'),t.isReadingPaneShowing()){t.getReadingPaneTextFields();t.isReadingPaneTabEnabled("readingPane")&&(o.readingPane='<li id="readingPane">Reading Pane</li>',r.readingPane=kendo.format('<div style="height:100%"><div id="{0}"></div></div>',t.getElementId("readingPane").replace("#",""))),t.isReadingPaneTabEnabled("graphTab")&&(o.graphs='<li id="graphTab">Graphs</li>',r.graphs=kendo.format('<div><div id="{0}" style="height:100%"></div></div>',t.getElementId("graph").replace("#","")))}var c=[];if($.each(i,function(e,i){void 0==i.childRelationship.meta&&(i.childRelationship.meta=a.getSObjectDescribe(i.childRelationship.childSObject));var n=i.childRelationship.meta,o=!1,r=0;$.each(t.settings.metadata.childRelationships,function(e,t){if(t.childSObject==i.childRelationship.childSObject&&void 0!=t.relationshipName&&""!=t.relationshipName&&(r++,r>1))return o=!0,!1});var s;$.each(n.fields,function(e,t){if(t.name==i.childRelationship.field)return s=t.label,!1}),c.push({objectName:i.childRelationship.childSObject,labelPlural:n.labelPlural,relName:i.childRelationship.relationshipName,parentFieldLabel:s,showParentFieldLabel:o})}),$.each(c,function(a,i){var n=i.labelPlural,r=kendo.format("{0}-{1}__tab__{2}",t.settings.pageInfo.objectName,i.relName,e.Id);1==i.showParentFieldLabel&&(n+=" ("+i.parentFieldLabel+")"),o[t.settings.pageInfo.objectName+"-"+i.relName]='<li id="'+r+'"><span class="k-link" >'+n+"</span></li>",s.push(t.settings.pageInfo.objectName+"-"+i.relName)}),"true"==this.settings.metadata.feedEnabled&&this.isReadingPaneTabEnabled("quickView")&&(r.quickView='<div style="overflow:auto;"><div class="quick-view" style="height:calc(100% - 30px); padding:15px;"><span class="crmc-message"><p>Please select a record.</p></span><iframe class="chatterFrame" style="height:100%; width:100%;" seamless="true" width="100%" scrolling="yes"/></div></div>'),$.each(i,function(a,i){var n=t.getChildGridId(i.childRelationship.relationshipName,e.Id),o=$('<div style="height:100%" />');o.append(kendo.format('<div id="{0}"><p>Please select a record.</p></div>',n)),r[t.settings.pageInfo.objectName+"-"+i.childRelationship.relationshipName]=o}),t.settings.readingPane.rpvfPages&&t.settings.readingPane.rpvfPages.length>0&&Object.each(t.settings.readingPane.rpvfPages,function(a){o["vfPage_"+a.name]='<li id="'+kendo.format("vfPage_{0}__tab__{1}",a.name,e.Id)+'"><span class="k-link" >'+a.title+"</span></li>",r["vfPage_"+a.name]='<div style="height:300px;"><iframe seamless="true" width="100%" scrolling="yes" id="'+t.settings.id+"_rpvf_"+a.name+'" style="width: calc(100% - 4px);height: calc(100% - 7px);" /></div>',s.push("vfPage_"+a.name)}),t.customReadingPanes&&t.isReadingPaneShowing()){var u=t.getActionContext();Object.each(t.customReadingPanes,function(a,i){var n=a.getLabel(u);o["customRP_"+i]='<li id="'+kendo.format("{1}_customRP_{0}__tab__",i,e.Id)+'"><span class="k-link" >'+n+"</span></li>",r["customRP_"+i]='<div><div id="'+t.settings.id+"_customRP_"+i+'" style="width: calc(100% - 4px);height: calc(100% - 7px);"></div></div>',s.push("customRP_"+i)})}if(t.settings.childTabOrder&&t.settings.childTabOrder.length>1){var p=$(s).not(t.settings.childTabOrder).get();s=t.settings.childTabOrder,s=s.concat(p)}if(t.settings.childTabOrder=s,n.append(l),Object.each(s,function(e){l.append(o[e]),n.append(r[e])}),0!=d.getSetting(t.settings.pageInfo.objectName,"fieldChooser")){var f=$('<li id="'+t.settings.id+'_rpNewTab">+</li>');l.append(f)}return n.append("<div></div>"),n.append("<style>.quick-view td { border-style: none; } .chatterFrame { border-style: none; } "+(t.isReadingPaneShowing()?"":t.getElementId("grid")+' div.k-tabstrip .k-grid-content { min-height: 200px; max-height:300px; "} ')+"</style>"),n.get(0).outerHTML},isReadingPaneShowing:function(){return this.settings.readingPane&&this.settings.readingPane.expanded},dataSourceHasChanges:function(){return this.gridDataSource&&this.gridDataSource.hasChanges()},decorateDirtyParents:function(e,t,a){var i=this,n=e.split("."),o=n[0],r=n[1];if(n.length>2){var s=Object.first(i.fieldMeta,function(t){return t.name==e});r=s.parentMeta.name.split(".")[1]}if(i.updateOperations&&i.updateOperations[a]&&i.updateOperations[a][t]&&i.updateOperations[a][t][r]){var l=i.updateOperations[a][t][r];n.length>2&&(l=i.updateOperationLabels[l]);var d=i.kendoGrid.editable.element.index();i.kendoGrid.editable.element.addClass("dirtyParent"),Object.each(i.kendoGrid.dataSource.data(),function(a){if(a[o]&&a[o].Id==t){a[o][r]=l,a[e]=l,a.dirty=!0,a.dirtyFields||(a.dirtyFields={}),a.dirtyFields[e]=l;var n=i.kendoGrid.element.find("[data-uid="+a.uid+"]"),s=n.children(":eq("+d+")");s.html(i.kendoGrid.columns[d-1].template(a)),s.prepend('<span class="k-dirty"></span>'),s.addClass("dirtyParent"),setTimeout(function(){s.prepend('<span class="k-dirty"></span>')}),s.on("blur","input",function(){a.dirtyFields[e]&&setTimeout(function(){s.prepend('<span class="k-dirty"></span>')})})}})}},checkForDirtyRows:function(e,t){var a=this,i=$(document.activeElement),n=a&&a.kendoGrid&&a.kendoGrid.table&&a.kendoGrid.table.has(i).length>0,o=a&&a.kendoGrid&&a.kendoGrid.lockedTable&&a.kendoGrid.lockedTable.has(i).length>0;(n||o)&&i.blur();var r=this.checkForDirtyRelatedChildInstance();return this.dataSourceHasChanges()&&r.push(this.settings.id),a.saveDirtyRowsPrompt(r,t,e)},checkForDirtyRelatedChildInstance:function(){var e=[];for(var t in D.instances){var a=t.split("-");if(a[0]==this.getElementId("grid").replace("#","")){var i=D.instances[t];i.blurEditCell(),i.dataSourceHasChanges()&&e.push(t)}}return e},saveDirtyRowsPrompt:function(e,t,a){return e.length>0&&(o.popupWithButtons("Unsaved Related Data","You have unsaved changes, if you continue they will be lost.",[{label:"Revert",click:function(){for(var i=0;i<e.length;i++){var n=D.instances[e[i]];a&&(n.settings.stayInEdit=!1,n.settings.skipRefresh=!1,n.preserveSelectedRows(!1)),n.kendoGrid.cancelChanges()}t&&t()}},{label:"Save",click:function(){for(var a=0;a<e.length;a++)D.instances[e[a]].saveButtonClick(t)}},{label:"Cancel"}]),!0)},getChildGridId:function(e,t){var t=this.isReadingPaneShowing()?"":t;return kendo.format("{0}-{1}-{2}",this.getElementId("grid").replace("#",""),e,t)},initChildGrids:function(e,t){var i=this,n=i.getChildTables();$.each(n,function(n,o){var r=o.childRelationship.field,s=i.getChildGridId(o.childRelationship.relationshipName,e),l=null;for(var d in D.instances){var c=d.split("-");d!=s&&3==c.length&&c[0]==i.getElementId("grid").replace("#","")&&c[1]==o.childRelationship.relationshipName&&(l=D.instances[d])}var u=$("#"+s),p=D.instances[s],f=!0;if(i.isReadingPaneShowing()){var m=u.is(":visible"),h=u.find(".crmc-grid");p&&p.settings.fkValue==e&&h.length>0?f=!1:(p&&p.kendoGrid&&i.saveStickyView(),f=m,u.empty())}if(u&&u.length>0&&f){var g={pageInfo:{objectName:o.childRelationship.childSObject,columns:o.fields.slice()},id:s,fkField:r,fkValue:e,fkDisplayName:t,fkRelationship:o.childRelationship.relationshipName,baseFilter:{field:r,operator:"eq",value:e},pageURL:window.location.href,enableStickyViews:!1,enableToolbar:!0,enableViews:!1,enableDetailGrid:!1,enableReadingPane:!1,editable:i.settings.editable,Partner_Server_URL_290:i.settings.Partner_Server_URL_290,isChildGrid:!0,parentGrid:i,delegate:{getColumnNames:function(){return o.fields.slice()},dataReady:function(){}}};if(null!=l)g.pageInfo.sorts=l.gridDataSource.sort(),g.pageInfo.groups=l.gridDataSource.group(),g.pageInfo.filter=l.gridDataSource.filter(),g.pageInfo.displayColumns=l.kendoGrid.columns,g.conditionalRules=l.settings.conditionalRules,g.toolbarCollapsed=l.toolbarCollapsed,g.formulaFields=l.formulaFields,g.hiddenColumns=l.hiddenColumns,g.searchText=l.settings.searchText,g.groupExpandAll=l.groupExpandAll,g.toolbarState=l.toolbarState,g.lockedColumns=l.lockedColumns;else if(void 0!=i.settings.pageInfo.childGridSettings){var v=i.settings.pageInfo.childGridSettings[o.childRelationship.relationshipName];void 0!=v&&(g.pageInfo.sorts=v.sorts,g.pageInfo.groups=v.groups,g.pageInfo.filter=v.filter,g.pageInfo.displayColumns=v.displayColumns,g.conditionalRules=v.conditionalRules,g.toolbarCollapsed=v.toolbarCollapsed,g.formulaFields=v.formulaFields,g.hiddenColumns=v.hiddenColumns,g.searchText=v.searchText,g.groupExpandAll=v.groupExpandAll,g.toolbarState=v.toolbarState,g.lockedColumns=v.lockedColumns)}var b=D.create(g);crmc.require(["DrillUpMenuItem"],function(e){var t={gridId:b};e.init(t,{remoteActions:{getDrillUpItemsForObject:a.getRemoteAction("DrillUpController","getDrillUpItemsForObject"),getDrillDownItemsForObject:a.getRemoteAction("DrillUpController","getDrillDownItemsForObject")}})})}})},showFieldChooser:function(e){this.fieldSplitter&&this.fieldSplitter.options&&this.fieldSplitter.options.panes&&this.fieldSplitter.options.panes[1]&&this.fieldSplitter.options.panes[1].collapsible&&(e?(this.fieldSplitter.toggle(".k-pane:last",!0),this.fieldSplitter.trigger("expand")):(this.fieldSplitter.toggle(".k-pane:last",!1),this.fieldSplitter.trigger("collapse")))},initPreviewTabStrip:function(e){var t=this,a=$(e).kendoTabStrip({animation:{open:{effects:"fadeIn"}},select:function(a){"+"==$(a.item).text()&&e.find("li").length>1?a.preventDefault():t.settings.selectedReadingPane=a.item.id.replace(t.settings.id+"_","")},activate:function(e){if(t.isReadingPaneShowing()){var a=t.getSelectedItems();a.length>0&&t.updateReadingPane(a[0].Id),t.paneSplitter&&t.paneSplitter.trigger("resize")}$(e.contentElement).find(".crmc-grid").each(function(){var e=$(this).parent().parent().attr("id"),a=D.instances[e];if(a&&a.kendoGrid){a.resize(),a.refreshIfColumnsOutOfSync();var i=$(this).find(t.getElementId("check-all"));i.closest("th").width()>35&&a.adjustColumnWidths()}})}}).data("kendoTabStrip");t.settings.enableFieldChooser&&d.getSetting(t.settings.pageInfo.objectName,"fieldChooser")!==!1&&t.getElement("rpNewTab").on("click",function(e){t.showFieldChooser(!0),t.fieldChooser.showChildRelationshipHelp()});var i=function(e){var a="after";e.newIndex<e.oldIndex&&(a="before"),this.tabGroup.children(".k-item:eq("+e.newIndex+")")[a](this.tabGroup.children(".k-item:eq("+e.oldIndex+")")),this.element.children(".k-content:eq("+e.newIndex+")")[a](this.element.children(".k-content:eq("+e.oldIndex+")")),t.settings.childTabOrder=[],this.tabGroup.children("li").each(function(e,a){var i=a.id.split("__tab__")[0].replace(t.settings.id+"_rp_","");t.settings.childTabOrder.push(i)}),this._updateClasses()};if(a.tabGroup.kendoReorderable({group:"tabs",filter:".k-item[id]",navigatable:!1,hint:function(e){var t=e.clone().wrap('<ul class="k-tabstrip-items k-reset"/>').parent();return t.css({opacity:.8})},change:$.proxy(i,a)}),a.tabGroup.data("kendoReorderable").draggable.bind("dragend",function(e){var i=$(e.currentTarget).closest("li");if(!this.dropped){this.hint.css("display","none");var n=i.attr("id").split("__tab__")[0].replace(t.settings.id+"_rp_customRP_","");if(t.settings.childTabOrder.remove(n),n=n.split("-"),n.length>0)if(1==n.length)t.isReadingPaneTabEnabled(n[0],!1),t.refresh();else{var o=!1;Object.each(t.settings.pageInfo.columns,function(e){e.startsWith("."+n[1]+".")&&(t.onItemChecked(e),o=!0)}),o&&a.disable(a.items())}}}),t.settings.selectedReadingPane){var n=t.getElement(t.settings.selectedReadingPane);0==n.length&&(n=a.element.find("[id^="+t.settings.selectedReadingPane.split("__tab__")[0]+"__tab__]:visible")),n.length>0&&a.select(n.prevAll().length)}return 0==a.select().length&&a.activateTab(a.tabGroup.children("li").first()),a},initPreviewChatter:function(e){var t=$(".chatterFrame"),i="";if(e){t.is(":visible")||t.show();var n=a.getNamespace(!0),o=String.format("/apex/{0}ChatterFeed?entityId={1}",n,e),r=t.attr("src");r!=o&&t.attr("src",o)}else i="<p>Please select a record.</p>",t.is(":visible")&&t.hide();$(".quick-view .crmc-message").html(i)},initKendoGridDetail:function(e){var t=this,a=(this.kendoGrid,t.getChildTables(),e.detailRow);e.detailCell.removeClass("k-detail-cell"),e.detailCell.addClass("k-hierarchy-cell"),this.initPreviewTabStrip(a.find(".tabstrip")),this.initPreviewChatter(e.data.Id),t.saveStickyView(),this.initChildGrids(e.data.Id,e.data.Name),t.settings.readingPane.rpvfPages&&t.settings.readingPane.rpvfPages.length>0&&Object.each(t.settings.readingPane.rpvfPages,function(a){t.getElement("rpvf_"+a.name).attr("src","/apex/"+a.name+"?id="+e.data.Id)})},onKendoGridDetailExpand:function(e){var t=this,a=e.masterRow.attr("data-uid");t.kendoGrid.element.find(".k-master-row").each(function(){var e=$(this).attr("data-uid");e!=a&&(t.kendoGrid.collapseRow(this),$(this).next(".k-detail-row").find(".crmc-grid").each(function(){var e=$(this).parent().parent().attr("id"),t=D.instances[e];t&&t.kendoGrid&&t.kendoGrid.element&&(t.kendoGrid.destroy(),t.kendoGrid=null,delete D.instances[e])}),$(this).next(".k-detail-row").remove())});var i=e.detailRow.find(".k-tabstrip").data("kendoTabStrip"),n=i.select().index();$(i.contentElement(n)).find(".crmc-grid").each(function(){var e=D.instances[$(this).parent().parent().attr("id")];e&&e.kendoGrid&&e.refreshIfColumnsOutOfSync()})},showConfigure:function(){var e=this;this.settings.isChildGrid&&(e=this.settings.parentGrid),e.fieldSplitter&&!e.fieldSplitter.options.panes[1].collapsed?e.showFieldChooser(!1):e.showFieldChooser(!0)},keyEvents:function(e){var t=this,a=$(document.activeElement),i=a.closest(".k-grid");if(0==t.getElement("toolbar").has(a).length&&i.is(t.getElement("grid")))switch(e.keyCode){case kendo.keys.TAB:t.settings.editable&&t.getElementId("check-all").replace("#","")==document.activeElement.id?(t.navigateSelection(e.shiftKey,!0,!0),e.preventDefault()):"#"+$(e.currentTarget).attr("id")===t.getElementId("grid")&&(setTimeout(function(){t.editNextCell(e.shiftKey)}),e.preventDefault());break;case"S".charCodeAt(0):t.settings.editable&&!e.shiftKey?(e.ctrlKey||e.metaKey)&&(setTimeout(function(){t.editNextCell(),t.saveButtonClick()}),e.preventDefault()):e.shiftKey&&(e.ctrlKey||e.metaKey)&&0!=d.getSetting(t.settings.pageInfo.objectName,"saveView")&&(setTimeout(function(){t.quickSaveView()}),e.preventDefault());break;case"I".charCodeAt(0):t.settings.editable&&0!=d.getSetting(t.settings.pageInfo.objectName,"inlineNew")&&(e.ctrlKey||e.metaKey)&&(setTimeout(function(){t.createNewInline()}),e.preventDefault());break;case"D".charCodeAt(0):t.settings.editable&&0!=d.getSetting(t.settings.pageInfo.objectName,"autoFill")&&(e.ctrlKey||e.metaKey)&&(setTimeout(function(){t.editNextCell(),t.fillDown()}),e.preventDefault());break;case"E".charCodeAt(0):0!=d.getSetting(t.settings.pageInfo.objectName,"editButton")&&(e.ctrlKey||e.metaKey)&&(setTimeout(function(){t.toggleEditMode()}),e.preventDefault());break;case 191:(e.ctrlKey||e.metaKey)&&setTimeout(function(){t.showKeyboardHelp(!1)},1e3);break;case 219:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){t.keyNextPrevious(!1)}),e.preventDefault());break;case 221:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){t.keyNextPrevious(!0)}),e.preventDefault());break;case 220:(e.ctrlKey||e.metaKey)&&(setTimeout(function(){t.showConfigure()}),e.preventDefault());break;case kendo.keys.LEFT:case kendo.keys.UP:if(t.settings.editable&&t.getElementId("check-all").replace("#","")==document.activeElement.id){t.navigateSelection(!0,!1,!0);break}case kendo.keys.RIGHT:t.settings.editable&&t.getElementId("check-all").replace("#","")==document.activeElement.id&&t.navigateSelection(!1,!0,!0);break;case kendo.keys.ENTER:case kendo.keys.DOWN:if(t.settings.editable&&t.getElementId("check-all").replace("#","")==document.activeElement.id){t.navigateSelection(e.shiftKey,!0,!0);break}"#"+$(e.currentTarget).attr("id")===t.getElementId("grid")&&(setTimeout(function(){var a=e.keyCode==kendo.keys.UP||e.keyCode==kendo.keys.ENTER&&e.shiftKey;t.navigateSelection(a,e.keyCode==kendo.keys.ENTER)}),e.preventDefault())}},keyNextPrevious:function(e){for(var t,a=this,i=$(".k-grid:visible").not(a.settings.isChildGrid?a.settings.parentGrid.getElementId("fieldTreeView"):a.getElementId("fieldTreeView")),n=0,o=0;o<i.length;o++)if("#"+i[o].id==a.getElementId("grid")){n=o;break}if(i[n+1]&&"detailGridDiv"==$(i[n+1]).attr("name")){var r=$(i[n+1]).data().kendoGrid;r.editCell($(r.items().first()).children().last())}else{t=e?n==i.length-1?0:n+1:0==n?i.length-1:n-1;var s=Object.first(D.instances,function(e){return e.getElementId("grid").replace("#","")==i[t].id});s.forceKeyboardFocus()}},initKeyboardHelp:function(){var e,t=this,a=$(this.kendoGrid.table.parent().parent());a.off("keydown.keyboardHelp keyup.keyboardHelp"),a.on("keydown.keyboardHelp keyup.keyboardHelp",function(a){clearTimeout(e);var i=a.keyCode;"keydown"==a.type&&(91!=i&&17!=i||(e=setTimeout(function(){t.showKeyboardHelp(!1)},2e3)))})},showKeyboardHelp:function(e){var t="<div style='padding-left:1em; font-size:medium;'><table><tr><th> Navigation </th><th> Actions </th></tr><td>"+["<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> TAB</span>: move to next field.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> SHIFT+TAB</span>: move to previous field.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> ENTER</span>: move to next row.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> SHIFT+ENTER</span>: move to previous row.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+[</span>: traverse left through ActionGrids.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+]</span>: traverse right through ActionGrids.</span>"].join("</br>")+"</td><td>"+["<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+SHIFT+S</span>: display the Save View screen.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+\\</span>: expand/collapse field chooser.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+I</span>: insert a new empty row.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+S</span>: save your edits.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+D</span>: fill up or fill down.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+E</span>: enable or disable Edit mode.</span>","<span class='ag-showKeyboardHelp'> <span style='font-weight: bold;'> CTRL+V</span>: paste data from external table.</span>"].join("</br>")+"</td></table>";u.showOverlay({title:"<div style='text-align: center; font-size:large;'> ( CTRL + / ) Keyboard Shortcuts: "+this.settings.metadata.label+"  </div>",message:t},"keyboard",e)},initKendoGrid:function(e,t){var a=this.getElement("grid"),i=this;if(this.kendoGrid&&this.kendoGrid.element)try{this.kendoGrid.destroy()}catch(e){console.log(e),b.trackException(e)}a&&a.length>0&&a.empty();var n=this.getKendoGridOptions(e);if(this.kendoGrid=a.kendoGrid(n).data("kendoGrid"),t(e),this.kendoGrid){this.kendoGrid.wrapper.find(".k-grid-header-wrap").off("scroll.kendoGrid");var o=$(this.kendoGrid.table.parent().parent());o.off("keydown.ag"),o.on("keydown.ag",this.keyEvents.bind(this)),i.initKeyboardHelp();var r=$(this.kendoGrid.content);if(r.off("click.ag"),r.on("click.ag",function(){setTimeout(function(){i.setKeyboardFocus()},300)}),this.kendoGrid.lockedContent&&this.kendoGrid.lockedContent[0]){var s=$(this.kendoGrid.lockedContent[0]);s.off("click.ag"),s.on("click.ag",function(){setTimeout(function(){i.setKeyboardFocus()},300)})}$("#"+this.settings.id+" .k-grid-header:first th.k-header[ag-data-tooltip]").kendoTooltip({showAfter:2e3,position:"top",relative:!0,filter:"a:not(.k-grid-filter)",content:function(e){return r=unescape($(e.target).parent().attr("ag-data-tooltip"))}})}this.getElement("check-all").change(function(){var e=this;if($(a).find("input[name='selectedBox"+i.settings.id+"']").each(function(){return 0==!$(this).closest(".crmc-grid").attr("id").indexOf(i.settings.id+"_")||void(this.checked=e.checked)}),this.checked){var t="tr:not(.k-footer-template):not(.k-detail-row):not(.k-grouping-row):not(.k-group-footer)";i.kendoGrid.tbody.find(t).addClass("k-state-selected"),i.kendoGrid.lockedTable&&i.kendoGrid.lockedTable.length>0&&i.kendoGrid.lockedTable.find(t).addClass("k-state-selected")}else i.kendoGrid.clearSelection();i.delegateEvent("select",i.getActionContext()),i.updateFooter(i.getSelectedItems())}),this.kendoGrid&&(this.kendoGrid.parent=this),this.settings.enableToolbar&&(this.toolbar=m.init(this,this.getElement("toolbar"),this.settings.toolbarState,this.settings.toolbarCollapsed)),a&&a.length>0&&a.data().kendoReorderable.draggable.bind("dragend",function(e){var t=$(e.target).find("span").hasClass("k-denied")&&!this.dropped;if(t){$(".k-header.k-drag-clue").css("display","none");var a=e.currentTarget.data("field");if(a){var n=i.toggleColumn(a);n&&i.settings.isChildGrid&&i.settings.parentGrid.refreshWithDisabledFieldChooser(),i.refreshWithDisabledFieldChooser()}}}),i.initReadingPane()},addFormulaDependentFields:function(){var e=this;this.settings.formulaFields&&Object.each(this.settings.formulaFields,function(t){Object.each(t.dependentFields,function(t){"string"==typeof t&&e.settings.pageInfo.columns&&e.settings.pageInfo.columns.indexOf(t)<0&&e.addRemoveColumn(t,void 0,!0)})}),this.settings.conditionalRules&&Object.each(this.settings.conditionalRules,function(t,a){Object.each(t,function(t){Object.each(t.dependentFields,function(t){"string"==typeof t&&e.settings.pageInfo.columns&&e.settings.pageInfo.columns.indexOf(t)<0&&e.addRemoveColumn(t,void 0,!0)})})})},initDataSource:function(t,i){this.addFormulaDependentFields();var n=Object.create(this.settings);this.columns=[];var r=[];void 0!==i&&(n.restoreColumns=i);var s=this,l=function(e,t){if(x.dirtyRows=Object.where(x.dirtyRows,function(t){return t.uid!==e}),0==x.dirtyRows.length&&x.rowErrors.length>0){var a="<style>div.overflow{overflow: auto; max-height: 600px;} </style><div> The following errors have occurred: <br /><div class='overflow'><ul><li>"+x.rowErrors.join("</li><br/><li>")+"</li></ul></div></div>";o.popup("Errors!",a),s.settings.enableToolbar&&s.toolbar.enable("#"+s.settings.id+"_saveButton",!0)}};e.create(n,{allowParentalEditing:function(){return s.allowParentalEditing()},getUpdateOperations:function(){return!!s.allowParentalEditing()&&s.updateOperations},onReadFieldMetadata:function(e,t,a){if(s.factory||(s.factory=p.initFactory({settings:s.settings,getRecordTypes:function(e){return s.getRecordTypes(e)},picklistValuesFactory:function(e,t){return s.getPicklistValues(e,t)},decorateDirtyParents:function(e,t,a){s.decorateDirtyParents(e,t,a)}})),s.factory.config.fieldMeta=t,!s.settings.hiddenColumns||s.settings.hiddenColumns.indexOf(e.name)<0){var n=s.delegateEvent("createColumn",e,t,a)||s.columnFactory.createColumn.apply(s,[e,t,a]);void 0!==n&&(w.restoreColumn(n,i),r.push(n))}},onSync:function(e){s.settings.stayInEdit||(s.settings.editable=!1),s.settings.skipRefresh||s.refresh()},onRowSuccess:function(e){s.kendoGrid.table.find("tr[data-uid="+e+"]").find(".k-dirty").removeClass("k-dirty"),s.kendoGrid.table.find("tr[data-uid="+e+"]").find(".k-dirty-cell").removeClass("k-dirty-cell"),l(e)},onRowFailure:function(e,t){t&&x.rowErrors.push(t.message||t),l(e),s.kendoGrid.select(s.kendoGrid.table.find("tr[data-uid="+e+"]"))},onDataSourceReady:function(e,l){s.fieldMeta=l,s.gridDataSource=e,s.allowParentalEditing()&&(s.updateOperations={},s.updateOperationLabels={}),s.columns=r,s.settings.formulaFields&&Object.each(s.settings.formulaFields,function(e){var t=s.columnFactory.createFormulaColumn(e),a=g.getFormulaFieldName(e);if(w.restoreColumn(t,i),s.settings.conditionalRules&&s.settings.conditionalRules[a]){var n=s.settings.conditionalRules[a];s.columnFactory.decorateColumnConditionalFormatting(t,n)}s.columns.push(t)}),s.setDataSourceAggregates(),s.columns=Array.orderBy(s.columns,function(e){return e.ordinal}),s.settings.enableActionsColumn&&d.getSetting(s.settings.pageInfo.objectName,"actionColumn")!==!1&&s.columns.unshift({editable:!1,locked:s.settings.lockedColumns,headerTemplate:'<a class="k-link" href="#">Action</a>',template:function(e){var t="";if(e.Id){var i=a.getRecordURL(e.Id),n=0==i.indexOf("javascript:"),o=kendo.format('<a class="recordLink" href="{0}" {1}>View</a> ',i,n?"":'target="_blank"'),r=kendo.format('<a class="recordLink" href="{0}" {1}>Edit</a>',a.getRecordURL(e.Id,!0,"/"+e.Id),n?"":'target="_blank"'),s=' <span style="vertical-align:top;">{0}</span>';t+=kendo.format(s,o+r);
}return t},width:"95px",attributes:{class:"selectedBox"}}),s.columns.unshift({headerTemplate:kendo.format('<input type="checkbox" id="{0}_check-all"/>',s.settings.id),editable:!1,type:"boolean",locked:s.settings.lockedColumns,template:function(e){var t=kendo.format('<input type="checkbox" name="selectedBox{0}" data-id="{1}"/>',s.settings.id,e.Id);return t},width:d.getSetting(s.settings.pageInfo.objectName,"checkboxColumn")!==!1?"35px":"1px",attributes:{class:"selectedBox"},headerAttributes:{class:"selectedBox"}}),s.columns.push({headerTemplate:"",headerAttributes:{style:"pointer-events:none;"},editable:!1,filterable:!1,groupable:!1,sortable:!1,template:"",width:"1px",attributes:{class:"fillerColumn",style:"background-color:white !important;pointer-events:none;"}}),s.initKendoGrid(e,t),s.fieldChooser&&s.fieldChooser.refresh();var c="",u=a.getUserInfo();u&&u.organizationId&&(c=u.organizationId);s.getElementId("fieldTreeView");e.bind("requestStart",function(e){N("requestStart");var t=!1;if(s.showCancelLoadButton(!0),"read"==e.type&&s.checkForDirtyRows())return t=!0,void e.preventDefault();if(s.settings.pageInfo.filterId){var a=this.sort(),i=this.filter();if(a&&a.length>0||i&&(i.length>0||i.filters&&i.filters.length>0)){var r=!1,l=c+"SystemViewWarning";try{r=localStorage.getItem(l)}catch(e){}r?delete n.pageInfo.filterId:(o.popupWithButtons("Cannot modify a system view","You can view saved system views but you cannot modify them.<br/> Would you like to reset the view to all records and customize it?<br/> You could then save an ActionGrid view.",[{label:"Dismiss"},{label:"Never Show Again",click:function(){try{localStorage.setItem(l,!0)}catch(e){}}},{label:"Reset View",click:function(){s.resetView()}}]),e.preventDefault(),t=!0)}}}),e.bind("requestEnd",function(e){s.showCancelLoadButton(!1)}),e.bind("change",function(e){if(s.kendoGrid){s.gridDataSource!==s.kendoGrid.dataSource&&s.kendoGrid.setDataSource(s.gridDataSource);var t=e.action&&"itemchange"==e.action,a=e.action&&"sync"==e.action,i=e.action&&"add"==e.action,n=e.action&&"remove"==e.action;!s.selectedViewIsLoaded||t||a||i||n||void 0!=s.firstDataSync&&s.firstDataSync&&!s.selectedViewIsDirty||s.modifySelectedView(),s.firstDataSync&&delete s.firstDataSync,a&&(s.firstDataSync=!0),s.selectedViewIsLoaded=!0;var o=this.group();if(o){var r=o.slice(0);Object.each(s.kendoGrid.columns,function(e){var t=Object.first(o,function(t){return t.field==e.field&&r.remove(t),t.field==e.field});void 0!==t?s.kendoGrid.hideColumn(t.field):e.hidden&&!e.forceHidden&&s.kendoGrid.showColumn(e.field)}),Object.each(r,function(e){o.remove(e)})}var l=s.kendoGrid.element.find(".k-group-indicator");if(l&&l.length>0){var d=l[0];d.children&&d.children.length>0&&(d.children[0].innerHTML+=" ("+s.gridDataSource.view().length+")")}if(s.adjustColumnWidths(),Object.each(o,function(e){e.aggregates=s.gridDataSource.aggregate()}),s.settings.readingPane.expanded&&s.kendoGrid.select().length<1&&!s.preservedRows){var c=s.kendoGrid.table.find("tr[data-uid]").first();s.settings.lockedColumns&&(c=$("[data-uid="+c.data("uid")+"]")),c.find("input[name='selectedBox"+s.settings.id+"']").prop("checked",!0),c.addClass("k-state-selected"),s.selectionChanged()}}})}})},resize:function(){if(this.settings.isFullscreen){var e=$("#"+this.settings.id);if(this.settings.isChildGrid)e.css({height:"100%"});else{var t=e.offset();t=t||{top:0};var a=$("#AppBodyHeader").length>0&&!this.settings.fkValue,i=a?$(window).height()-n.SFDC_HEADER_PX:$(window).height()-t.top-10;e.css({height:Math.floor(i)+"px"})}this.getElement("grid").css({height:"100%"}),this.getElement("paneSplit").css({height:"100%"});var o=$(this.getElementId("fieldTreeView")+">div.k-pager-wrap").outerHeight(),r=$(this.getElementId("fieldTreeView")+">div.k-grid-header").outerHeight();$(this.getElementId("fieldTreeView")+">div.k-grid-content").css({"max-height":i-(r+o)})}},refreshIfColumnsOutOfSync:function(){var e=this,t=Object.first(e.settings.pageInfo.columns,function(t){var a=Object.first(e.kendoGrid.columns,function(e){return e.field==t});return!a});t||(t=Object.first(e.kendoGrid.columns,function(t){if(t.field)var a=Object.first(e.settings.pageInfo.columns,function(e){return t.field==e});return!a&&t.field})),t&&e.refresh()},showCancelLoadButton:function(e){var t=this,a=$(kendo.format("{0} a.k-pager-refresh span.k-icon",t.getElementId("grid")));a.length>0&&(e?(a.addClass("k-i-close"),a.removeClass("k-i-refresh"),a.one("click",function(e){a.hasClass("k-i-close")&&(t.kendoGrid.setDataSource([]),t.showCancelLoadButton(!1),e.preventDefault(),a.one("click",function(e){t.kendoGrid.setDataSource(t.gridDataSource)}))})):(a.removeClass("k-i-close"),a.addClass("k-i-refresh")))},adjustColumnWidths:function(){if(!this.settings.lockedColumns){var e=this,t=e.kendoGrid.parent.getElementId("grid"),a=0,i=["date","datetime","time","currency","integer","double","percent","boolean"];$.each(e.kendoGrid.options.columns,function(e,t){t.width&&(a+=parseInt(t.width))});var n=!1,o=$(t+" .k-grid-header-wrap > table"),r=$(t+" .k-grid-content > table"),s=$(t+" .k-grid-footer-wrap > table"),l=a<$(t).width(),d=e.gridDataSource.group(),c=[];$.each(e.kendoGrid.columns,function(e,t){var a=t.field,i=$.grep(d,function(e){return e.field==a});0==i.length?0==e?c.push("checkbox"):c.push(a):c.unshift(a)});var u=e.settings.enableDetailGrid&&!e.isReadingPaneShowing();if($.each(e.kendoGrid.columns,function(t,a){var p=a.field,f=$.grep(d,function(e){return e.field==p});if(t>0&&p){var m=$.grep(e.kendoGrid.parent.fieldMeta,function(e){return e.name==p});if(m&&m.length>0&&$.inArray(m[0].type.toLowerCase(),i)==-1&&0==f.length){var h=$.inArray(p,c)+(u?1:0),g=l&&!a.isResized?"":a.width;0!=o.length&&o.find("colgroup col").eq(h).css("width",g),0!=r.length&&r.find("colgroup col").eq(h).css("width",g),0!=s.length&&s.find("colgroup col").eq(h).css("width",g),""==g&&(n=!0)}}}),e.kendoGrid.columns.length>1){var p=n?"1px":"";o.find("colgroup col").eq(e.kendoGrid.columns.length-1+(u?1:0)).css("width",p),r.find("colgroup col").eq(e.kendoGrid.columns.length-1+(u?1:0)).css("width",p),s.find("colgroup col").eq(e.kendoGrid.columns.length-1+(u?1:0)).css("width",p)}0!=o.length&&o.css("width",""),0!=r.length&&r.css("width",""),0!=s.length&&s.css("width","")}},getChildTables:function(){var e=this,t={fields:[],childRelationship:{relationshipName:"Opportunities"}},a=window.isDebug?[t]:[];return e.settings.pageInfo.columns&&$.each(e.settings.pageInfo.columns,function(t,i){var n=i.match(/^\./);if(null!=n){var o,r=i.split("."),s=r[1],l=r.slice(2).join(".");if($.each(a,function(e,t){if(t.childRelationship.relationshipName==s)return o=t,!1}),void 0===o){var d;if($.each(e.settings.metadata.childRelationships,function(e,t){if(t.relationshipName==s)return d=t,!1}),void 0==d&&"Account"==e.settings.pageInfo.objectName&&"TasksAccountId"==s&&(d=Object.first(e.settings.metadata.childRelationships,function(e){return"Task"==e.childSObject&&"AccountId"==e.field}),d.relationshipName="TasksAccountId"),void 0!=d){var c=[];l&&l.length>0&&c.push(l),a.push({childRelationship:d,fields:c})}}else o.fields.push(l)}}),a},enterEditMode:function(){this.preserveSelectedRows(!0)},preserveSelectedRows:function(e,t,a,i){var n=this,o=n.kendoGrid.select(),r=[];if(a&&a.length>0?r=a:o&&o.length>0&&o.each(function(e,t){return r.push($(t).prevAll().length),!0}),r.length>0){var s=r[0],l=$(kendo.format("{0} tr:eq({1}) td:not(.k-group-cell,.k-hierarchy-cell,.selectedBox,.readOnly,.fillerColumn)",n.getElementId("grid"),s));if(l&&l.length>0)var d=$(l[0]).prevAll().length}return t||(n.preservedRows=r,n.refresh(function(){n.settings.editable=e;try{r&&(Object.each(r,function(e){var t=n.kendoGrid.table.find(kendo.format("tr:eq({0})",e)).first();t.find("input[name='selectedBox"+n.settings.id+"']").prop("checked",!0),n.settings.lockedColumns&&(t=$("[data-uid="+t.data("uid")+"]")),t.addClass("k-state-selected")}),n.selectionChanged()),e&&s&&d&&(n.settings.lockedColumns?s+=2:s++,n.kendoGrid.editCell($(kendo.format("{2} tr:eq({0}) td:eq({1})",s,d,n.getElementId("grid")))),n.syncScrollContent(!0)),"function"==typeof i&&i(n)}catch(e){}delete n.preservedRows})),r},cancelEditMode:function(){var e=this;e.gridDataSource.hasChanges()?e.checkForDirtyRows(!0):(e.settings.stayInEdit=!1,e.settings.skipRefresh=!1,e.preserveSelectedRows(!1),e.kendoGrid.cancelChanges())},toggleEditMode:function(){this.settings.editable=!this.settings.editable,$(kendo.format("#{0}_fieldTreeView_tt_active",this.settings.id)).hide(),this.settings.editable?this.enterEditMode():this.cancelEditMode()},saveButtonClick:function(e){var t=this,a=t.getElement("saveButton");if(a&&a.length>0&&!a.hasClass("k-state-disabled")){this.toolbar.enable("#"+t.settings.id+"_saveButton",!1),t.settings.skipRefresh=!0,t.settings.stayInEdit=!0;var i=$(document.activeElement);i.length>0&&i.blur(),t.delegateEvent("save",t.getActionContext()),t.kendoGrid.trigger("saveChanges");var n=t.preserveSelectedRows(!0,!0);t.settings.groupExpandAll=void 0;var o=function(){t.gridDataSource.sync().done(function(){t.preserveSelectedRows(!0,!1,n,e)})},r=t.checkForDirtyRelatedChildInstance();!t.settings.isChildGrid&&r.length>0?t.saveDirtyRowsPrompt(r,function(){o()},!1):o()}},setSaveButtonDirty:function(e){var t=this.getElement("saveButton");t.length>0&&(e?t.addClass("k-primary"):t.removeClass("k-primary"))},searchText:function(e){var t=this,a=/[\?\&\|\!\{\}\[\]\(\)\^\~\*\:\\\"\'\+\-]/g,n=kendo.format("FIND {{0}*} IN ALL FIELDS RETURNING {1}",e.replace(a,"\\$&"),t.settings.pageInfo.objectName);n+=t.settings.fkValue?kendo.format(" (Id WHERE {0} = '{1}')",t.settings.fkField,t.settings.fkValue):" (Id WHERE Id != null)";var o=function(e){var a=e.searchRecords.map(function(e){return e.Id}),i=function(){var e=t.getElement("searchText");e&&e.length>0&&e.focus()};a.length>0?(t.settings.pageInfo.selectedRecordIds=a,t.gridDataSource.read().then(function(){t.redraw()})):0==a.length&&(u.showMessage({title:"Search",message:"No records were found"},"error"),i())},r=function(e){var t=e.responseJSON||JSON.parse(e.responseText);console.log(t),t.length>0&&(t=t[0]),u.showMessage({title:"Search Failed",message:t.message},"error")};i.search(n,o,r)},toggleFullscreen:function(e){var t=a.parseAsObject(),i="isdtp",n=t[i],o=this.settings.pageName,r=this.settings.pageNamespace||"c",s=window.top!=window;if(this.settings.fkValue&&this.settings.pageLayoutId){var l=this.settings.pageLayoutId;a.isSalesforceId(l)&&(t.id=l)}n?(delete t[i],delete t.agFS):(t[i]="vw",t.agFS=1),this.checkForDirtyRows(!1)||(o&&s?(t.disableFS=1,a.navigateToVFPage(r,o,t,s)):a.navigateToPage(window.location.pathname.substring(1),t,s,void 0,window.location.hash))},createInNewWindow:function(){this.delegateEvent("createInNewWindow")},createNewInline:function(){var e=this,t=(this.isReadingPaneShowing(),this.checkForDirtyRelatedChildInstance()),i=function(){var t=!1,i=function(){if(e.settings.editable)if(t)e.gridDataSource.hasChanges()?o.popupWithButtons("Required Fields","Required fields needed to add inline. Would you like to save your pending changes?",[{label:"Save",click:function(){e.saveButtonClick(function(){e.kendoGrid.addRow()})}},{label:"Revert",click:function(){e.refreshWithDisabledFieldChooser(function(){e.kendoGrid.addRow()})}}]):e.refreshWithDisabledFieldChooser(function(){e.kendoGrid.addRow()});else{e.kendoGrid.addRow();var a=e.gridDataSource.data().filter(function(e){return e.dirty});Object.each(a,function(t){var a=e.kendoGrid.table.find("[data-uid="+t.uid+"]");Object.each(t.dirtyFields,function(e,t){var i=a.find("[headers=grid_col"+t+"]");i.addClass("k-dirty-cell"),i.prepend($("<span class='k-dirty'></span>"))})})}else e.settings.editable=!0,e.refreshWithDisabledFieldChooser(function(){e.kendoGrid.addRow()})},r=[],s=e.settings.metadata;Object.each(s.fields,function(t){if("boolean"!=t.type&&"false"==t.nillable&&"true"==t.createable&&n.ignoreRequiredFields.indexOf(t.name)<0)if(t.relationshipName){var i=t.referenceTo;i instanceof Array&&(i=i[0]);var o=a.getSObjectNameField(a.getSObjectDescribe(i));e.settings.pageInfo.columns.indexOf(t.relationshipName+"."+o)<0&&r.push(t.relationshipName+"."+o)}else e.settings.pageInfo.columns.indexOf(t.name)<0&&r.push(t.name)}),r.length>0&&Object.each(r,function(a){t|=e.toggleColumn(a)}),s.recordTypeInfos&&s.recordTypeInfos.length>1&&e.settings.pageInfo.columns.indexOf("RecordType.Name")<0?e.getRecordTypes(function(a){a&&a.selectorRequired&&(t|=e.toggleColumn("RecordType.Name",0)),i()}):i()};t.length>0?this.saveDirtyRowsPrompt(t,i):i()},destroyReadingPane:function(e){var t=this.getElement("paneSplit"),a=t.data("kendoSplitter"),i=this.getElement("pane");a&&(a.unbind(),a.remove(i))},updateReadingPane:function(e){var t=this,a=$(t.getElementId("pane")+" .k-item.k-state-active");if(a&&a.length>0&&0==a.attr("id").indexOf("vfPage")&&e&&t.settings.readingPane.rpvfPages&&t.settings.readingPane.rpvfPages.length>0){var i=Object.first(t.settings.readingPane.rpvfPages,function(e){return a.attr("id").indexOf(e.name)>-1});i&&i.name&&t.getElement("rpvf_"+i.name).attr("src","/apex/"+i.name+"?id="+e)}var n=this.getElement("readingPane"),o=$(".quick-view");if(n&&n.is(":visible"))this.setReadingPaneText(this.settings.readingPane.selectedField);else if(o&&o.is(":visible"))this.initPreviewChatter(e);else if(e){var r=this.getSelectedItems();r.length>0&&this.initChildGrids(e,r[0].Name)}else;},initCustomPane:function(e,t,a){var i=this;i.getElement(kendo.format("rp_customRP_{0}__tab__",t)).html('<span class="k-link" >'+e.getLabel(a)+"</span>");var n=i.getElement("customRP_"+t);e.saveData&&i.subscribeEvent("save",t,function(a){var n=i.getElement("customRP_"+t);i.settings.readingPane.expanded&&n.length>0&&e.saveData(a,n)}),e.saveView&&i.subscribeEvent("saveView",t,function(a,n){var o=i.getElement("customRP_"+t);i.settings.readingPane.expanded&&o.length>0&&e.saveView(i.getActionContext(),o,n)}),e.loadView&&i.subscribeEvent("loadView",t,function(a){var n=i.getElement("customRP_"+t);i.settings.readingPane.expanded&&n.length>0&&e.loadView(i.getActionContext(),n,a)}),e.select&&i.subscribeEvent("select",t,function(){var a=i.getElement("customRP_"+t);i.settings.readingPane.expanded&&a.length>0&&e.select(i.getActionContext(),a)}),n.is(":parent")||e.loadView(i.getActionContext(),n,i.saveView())},initReadingPane:function(e){if(!this.settings.isChildGrid&&this.settings.enableReadingPane&&d.getSetting(this.settings.pageInfo.objectName,"readingPane")!==!1){var t=this;!t.customReadingPanes&&t.settings.readingPane.expanded&&a.getLicensedPackages(this.settings.delegate.appNameSpaces,function(e,i){t.customReadingPanes={},$(document).off("customRPLoad").on("customRPLoad",function(e,t,a){$(kendo.format("[id$=_rp_customRP_{0}__tab__]",t)).each(function(e,i){var n=D.instances[i.id.split("_rp_customRP_")[0]],o=n.getActionContext();if(n.customReadingPanes[t]=a,a.isAvailable(o))n.initCustomPane(a,t,o);else{var r=$(i);r.parent().parent().data("kendoTabStrip").remove(r)}})});t.customReadingPanes.detailGrid=y,t.customReadingPanes.chart=k,Object.each(e,function(e){if(!(e.indexOf("CustomPane:")<0)){var i=e.split("CustomPane:")[1];t.customReadingPanes[i]={getLabel:function(){return i},loadView:function(){}},a.importScript(String.format("/resource/{0}/{1}",1e5*Math.floor((new Date).valueOf()/1e5),i),function(){})}}),t.initReadingPane(),crmc.addReadingPane(y),crmc.addReadingPane(k)});var i="vertical",n={collapsible:!1,size:t.settings.readingPane.height,collapsed:!0,resizable:!0};if($.inArray(this.settings.readingPane.position,["left","right"])>-1&&(i="horizontal",n.size=t.settings.readingPane.width),t.paneSplitter&&t.paneSplitter.element&&(t.paneSplitter.orientation=i,this.destroyReadingPane(),e))return t.modifySelectedView(),t.saveStickyView(),t.paneSplitter.destroy(),void t.init(t.settings);if(t.settings.readingPane.expanded){var o=this.getElement("paneSplit"),r='<div id="'+this.settings.id+'_pane" style="width:100%;"></div>',s=[{collapsible:!1,resizable:!0}];$.inArray(this.settings.readingPane.position,["bottom","right"])>-1?(o.append(r),s.push(n)):(o.prepend(r),s.unshift(n));var l=$(this.getPreviewTabStripTemplate());l.css({height:"calc(100% - 2px)",width:"calc(100% - 2px)",position:"absolute",overflow:"hidden"});var c=function(){var e=l.data("kendoTabStrip");e.resize(!0);var t=e.element.find("div.k-state-active");t.length>0&&t.css({height:"calc(100% - 3em)",width:"100%",position:"absolute"})};this.getElement("pane").append(l),l.id=this.getElementId("readingPaneTabs").replace("#",""),this.initPreviewTabStrip(l);var u=this.getElement("readingPane"),p=this.getElement("graph");if(this.paneSplitter=o.kendoSplitter({orientation:i,collapse:function(e){t.settings.readingPane.expanded=!1},expand:function(e){t.settings.readingPane.expanded=!0},resize:function(e){t.adjustColumnWidths(),t.settings.readingPane.expanded&&c(),"vertical"==this.orientation?t.getElement("pane").height()&&(t.settings.readingPane.height=t.getElement("pane").height()):t.getElement("pane").width()&&(t.settings.readingPane.width=t.getElement("pane").width())},panes:s}).data("kendoSplitter"),t.settings.readingPane.showText){var f=$('<input id="'+t.settings.id+'_readingPaneTextDropdown" />');f.css("margin","2px");var m=$('<iframe id="'+t.settings.id+'_readingPaneText" />');m.css({width:"calc(100% - 7px)",height:"calc(100% - 38px)",position:"absolute"}),u.append(f),u.append("<br />"),u.append(m),u.append('<span id="'+t.settings.id+'_readingPaneDirty" class="k-dirty" style="margin: 5px; display:none;"></span>');var h=f.kendoDropDownList({valueTemplate:'<span title="#:label#">#:label#</span>',dataSource:t.getReadingPaneTextFields(),dataTextField:"label",dataValueField:"name",value:t.settings.readingPane.selectedField,change:function(){t.setReadingPaneText(this.value())}}).data("kendoDropDownList");t.setReadingPaneText(h.value())}t.settings.readingPane.showGraphs&&(p.empty(),Object.each(t.columns,function(e){if(e.attributes&&"number"==e.attributes.class){var a=$('<div id="visualizer_'+e.field+'" style="float:left; width:50%; height:100%"/>');a.kendoChart({dataSource:t.gridDataSource,title:{text:e.title},valueAxis:[{labels:{format:e.format}}],autoBind:!1,series:[{field:e.field}],tooltip:{visible:!0,template:"#= dataItem.Name #:#= value #"}}),a.appendTo(p),a.data().kendoChart.refresh()}}));var g=t.getActionContext();Object.each(t.customReadingPanes,function(e,a){if(e.isAvailable)if(e.isAvailable(g)){var i=t.getElement("customRP_"+a);i.is(":parent")||t.initCustomPane(e,a,g)}else{var n=t.getElement("rp_customRP_"+a+"__tab__");l.data("kendoTabStrip").select().attr("id")==n.attr("id")&&setTimeout(function(){l.data("kendoTabStrip")&&l.data("kendoTabStrip").select(0)},300),n.parent().parent().data("kendoTabStrip")&&n.parent().parent().data("kendoTabStrip").remove(n)}}),t.settings.readingPane.expanded&&(t.paneSplitter.expand(t.getElement("pane")),t.paneSplitter.trigger("resize"));var n=$(t.getElement("pane"));n.off("keydown"),n.on("keydown",t.keyEvents.bind(t))}}},setReadingPaneText:function(e){var t=e,i="";if(t){var n;if(this.kendoGrid.element&&(n=this.getSelectedItems()[0]),n)if(n.hasOwnProperty(t))i=n[t];else try{var o,r=this.settings.metadata.getBoolean("queryable");if(this.settings.readingPane.selectedField=e,r)o=a.query("Select {0}, Id FROM {1} WHERE Id = '{2}'",t,this.settings.pageInfo.objectName,n.Id),o.length>0&&(i=o[0][t]);else{if(!this.settings.fkObjectParent){var s=a.getDescribeGlobal(),l=this.settings.fkValue.substring(0,3),c=Object.first(s.sobjects,function(e){return e.keyPrefix==l});this.settings.fkObjectParent=c.name}o=a.query("Select (select {0} FROM {3} WHERE Id = '{4}'), Id FROM {1} WHERE Id = '{2}'",t,this.settings.fkObjectParent,this.settings.fkValue,this.settings.fkRelationship,n.Id),o.length>0&&(i=o[0][this.settings.fkRelationship].records[t])}}catch(e){i=e.toString(),delete this.settings.readingPane.selectedField}else i="Please select a record.";this.settings.readingPane.selectedField=e}var u=this.getElement("readingPaneText");i=i||"";var p=!1,f=!1,m=!1,h=this;if(Object.each(this.settings.metadata.fields,function(e){return e.name!=t||(d.getSetting(h.settings.pageInfo.objectName,t,"fieldInlineEdit")!==!1&&(f=e.getBoolean("updateable")),p="richtextarea"==e.extraTypeInfo,!1)}),n&&this.settings.editable&&f){$("#"+this.settings.id+"_readingPaneRichText").data("kendoEditor")&&$("#"+this.settings.id+"_readingPaneRichText").data("kendoEditor").destroy(),n.dirtyFields&&n.dirtyFields[t]&&(m=!0);var g=function(){for(n.dirty=!0,$("#"+h.settings.id+"_readingPaneDirty").css("display","inline"),n.dirtyFields||(n.dirtyFields={}),n.dirtyFields[t]=n[t],idx=0,length=h.kendoGrid.columns.length;idx<length;idx++){var e=h.kendoGrid.columns[idx];if(e.field===t){var a=$(kendo.format("{2} tr[data-uid={0}] td:not(.k-group-cell,.k-hierarchy-cell):eq({1})",n.uid,idx,h.getElementId("grid")));if(a){a.hasClass("k-dirty-cell")||(a.addClass("k-dirty-cell"),a.prepend("<span class='k-dirty'></span>"));break}}}};$("#"+this.settings.id+"_readingPaneDirty").css("display",m?"inline":"none"),p?($("#"+this.settings.id+"_readingPaneDirty").css("margin","70px 0px 0px 11px"),u.replaceWith('<div id="'+this.settings.id+'_readingPaneText"><textarea style="height:100%;" id="'+this.settings.id+'_readingPaneRichText">'+i+"</textarea></div>"),$("#"+this.settings.id+"_readingPaneRichText").kendoEditor({change:function(e){n[t]=this.value(),g()}})):($("#"+this.settings.id+"_readingPaneDirty").css("margin","5px"),u.replaceWith('<textarea onmouseover = "this.style.cursor = \'pointer\'"onfocus = "this.style.cursor = \'text\'" id="'+this.settings.id+'_readingPaneText">'+i+"</textarea>"),$("#"+this.settings.id+"_readingPaneText").bind("change",function(e){n[t]=$("#"+h.settings.id+"_readingPaneText").val(),g()}),$("#"+this.settings.id+"_readingPaneText").css({cursor:"pointer","font-family":"'Salesforce Sans', Arial, sans-serif"}))}else i=i.toLowerCase().indexOf("<html")<0?'<div id="'+this.settings.id+'_readingPaneText" style="margin:5px; white-space: pre-wrap;overflow: auto">'+i+"</div>":'<iframe id="'+this.settings.id+'_readingPaneText"  src="data:text/html;charset=utf-8,'+encodeURI(i||"")+'" />',u.replaceWith(i);this.settings.editable&&!f&&$("#"+this.settings.id+"_readingPaneText").addClass("readOnly"),$("#"+this.settings.id+"_readingPaneText").css({width:"calc(100% - 2.4em)",height:"calc(100% - 4.6em)",position:"absolute",margin:"5px"})},getSavedViewById:function(e){var t;try{t=a.query("select Id, Name, {0}JSON__c from {0}GridView__c where Id = '{1}' and isDeleted = false order by Name limit 1",a.getNamespace(!0),e)[0]}catch(e){}return t},getSavedViews:function(e){return w.getSavedViews(this.settings.pageInfo.objectName,this.getContextName(),e)},modifySelectedView:function(){var e=!0;if(this.settings.isChildGrid)this.settings.parentGrid.modifySelectedView();else if(this.settings.enableViews&&this.settings.enableToolbar){var t=this.getElement("views");if(t&&t.length>0){var a=t.data("kendoDropDownList"),i=this.getElement("modifiedFlag");if(this.selectedViewJSON&&this.selectedViewJSON.length>0)try{var n=JSON.stringify(this.saveView());e=this.selectedViewJSON!=n}catch(e){console.log(e)}this.selectedViewName?i&&i.length>0&&e&&i.show():a.text({Name:"*Unsaved View"})}this.selectedViewName&&e&&(this.selectedViewIsDirty=!0)}},manageViewsClick:function(){var e=this.getSavedViews();a.getUserInfo()?a.getUserInfo().userId:"";if(e&&e.length>0){var t,i="manageGrid"+n.UNIQUE_ID,r=a.getNamespace(!0),s=this,l=function(){var a=t.getSelectedItems();if(1===a.length){var i=Object.first(e,function(e){return e.Id===a[0].Id});i&&(s.settings.pageInfo={objectName:s.settings.pageInfo.objectName},s.loadSavedView(i))}else o.popup("Select View","You must select only a single view to load.")},d=$(this.getElementId("grid")).height();d>415?d=415:d<250?d=250:d-=.2*d;var c={resizable:!0,width:1100,height:d,maxHeight:415,minHeight:200};o.popupWithButtons("Manage Views",String.format("<div id='{0}' style='height:{1}px;'></div>",i,d-70),[{label:"Load View",click:l},{label:"Open View",click:function(){t.openSelectedRecord()}},{label:"Delete View",click:function(){return crmc.require(["BatchDelete"],function(e){e.click(t.getActionContext())}),!1}},{label:"Share View",click:function(){var e=t.getActionContext();if(1==e.selectedRows.length){var a=e.selectedRows[0].Id;window.open(kendo.format("/p/share/CustomObjectSharingDetail?parentId={0}",a))}else o.popup("Select A View","Please select one view to share.");return!1}}],c),t=D.create({pageInfo:{objectName:r+"GridView__c"},baseFilter:{logic:"and",filters:[{field:r+"ObjectName__c",operator:"eq",value:s.settings.pageInfo.objectName},{logic:"or",filters:[{field:r+"Context__c",operator:"eq",value:""},{field:r+"Context__c",operator:this.getContextName()==n.viewContext.pageLayout?"eq":"neq",value:n.viewContext.pageLayout}]}]},id:i,editable:!0,enableDetailGrid:!1,enableStickyViews:!1,enableFormatting:!1,enableNewButton:!1,enableNewInline:!1,enableViews:!1,enableHover:!1,isFullscreen:!1,enableFullscreen:!1})}else o.popup("No Saved Views","There are no saved views for "+this.settings.metadata.label)},loadViewDropDown:function(){var e=[],t=a.getUserInfo()?a.getUserInfo().userId:"",i=a.getNamespace(!0),n=a.parseAsObject(),o=w.validateView(this.settings.pageInfo,!1),r=this,s={transport:{read:function(a){r.getSavedViews(function(n){var o=Array.orderBy(Object.where(n,function(e){return"Private"===e[i+"Privacy__c"]&&e.OwnerId===t}),function(e){return e.Name.toLowerCase()}),r=Array.orderBy(Object.where(n,function(e){return"Private"===e[i+"Privacy__c"]&&e.OwnerId!==t}),function(e){return e.Name.toLowerCase()}),s=Array.orderBy(Object.where(n,function(e){return"Private"!==e[i+"Privacy__c"]}),function(e){return e.Name.toLowerCase()});o.length>0&&(e.push({Name:"My Views:"}),Object.each(o,function(t){e.push(t)})),s.length>0&&(e.push({Name:"Public Views:"}),Object.each(s,function(t){e.push(t)})),r.length>0&&(e.push({Name:"Shared Views:"}),Object.each(r,function(t){e.push(t)})),0===e.length&&e.push({Name:"No Saved Views"}),a.success(e)})}}},l=this,d=this.getElement("views");if(d&&d.length>0){var c=d.kendoDropDownList({autoBind:!1,optionLabel:{Name:"*Unsaved View"},valueTemplate:function(e){var t=l.selectedViewIsDirty,a=e.Name,i=t?"block":"none";return kendo.format('<div style="overflow: hidden;"><div id="{0}_modifiedFlag" style="display: {1}; float: right;">(Modified)</div><div style="text-overflow: ellipsis; overflow: hidden;" title="{2}">{2}</div></div>',l.settings.id,i,n&&n.viewTitle&&!o?decodeURIComponent(n.viewTitle):a)},dataSource:s,dataTextField:"Name",dataValueField:"Name",template:function(e){return e.Id?e[i+"IsDefault__c"]===!0?kendo.format('<div style="overflow: hidden; padding-left:10px;"><div style="display: true; float: right;"><b>(Default)</b></div><div style="text-overflow: ellipsis; overflow: hidden;" title="{0}">{0}</div></div>',e.Name):kendo.format('<div style="padding-left:10px;" title="{0}">{0}</div>',e.Name):"<strong>"+e.Name+"</strong>"},change:function(){var t=this.value();if(t){var a=Object.first(e,function(e){return e.Name===t});a&&a.Id&&(a.Id!=l.selectedViewId||a.Id==l.selectedViewId&&l.selectedViewIsDirty)&&(l.settings.pageInfo={objectName:l.settings.pageInfo.objectName},l.loadSavedView(a))}}}).data("kendoDropDownList");l.selectedViewName&&c.value(l.selectedViewName)}},setDataSourceAggregates:function(){var e=this;Object.each(this.columns,function(t){if(void 0!==t.aggregates&&t.aggregates.length>0)for(var a=e.gridDataSource.aggregates(),i=0;i<t.aggregates.length;i++)void 0!==a&&void 0!==a[t.field]||(jQuery.isEmptyObject(a)&&e.gridDataSource.aggregate([]),e.gridDataSource.aggregate().push({field:t.field,aggregate:t.aggregates[i]}))})},initContextMenu:function(e,t){var a=this.getElement(e);if(a){var i=a.data("kendoContextMenu");i&&i.destroy(),a.empty()}var n=this,o=a.kendoContextMenu({animation:{open:{effects:"fadeIn"},duration:300},open:function(a){if(a.item&&a.item.length>0&&"#"+a.item[0].id==n.getElementId(e)){var i=$(a.target).attr("data-field");if(i)var o=Object.first(n.kendoGrid.columns,function(e){return e.field==i});n.addActionItems(n.getActionContext(t,o))}},target:this.getElementId("grid"),filter:t?"thead th":"tbody tr:not(.k-detail-row)",select:function(e){var t=n.getSelectedItems();e.item.classList||(e.item.classList=e.item.className.split(" "));var a=Object.first(e.item.classList,function(e){return 0==e.indexOf("menuItem")}),i=n.menuItems;if(void 0!==i[a]&&"function"==typeof i[a].click){i[a].click({selection:t,grid:n,menuItem:i[a]});var o=a;"string"==typeof i[a].text&&(o=i[a].text);var r={selectedRows:t&&t.length,objectName:n.settings.pageInfo.objectName,type:"Action"};i[a].isCustom&&(r.label=o,o="Custom Action"),b.track(o,r)}}}).data("kendoContextMenu");return o},getElement:function(e){return $(this.getElementId(e))},getElementId:function(e){return kendo.format("#{0}_{1}",this.settings.id,e)},addMenuItems:function(e,t,a){void 0===this.menuId&&(this.menuId=0);var i="menuItem"+this.menuId++;if(t.cssClass=t.cssClass?t.cssClass+" "+i:i,t.encoded=!1,t.isChild=a,t.__proto__={},void 0===t.text&&(t.text=t.label),e[i]=t,void 0!==t.items&&t.items.length>0){var n=this;Object.each(t.items,function(t){n.addMenuItems(e,t,!0)})}},addContextMenuItem:function(e){this.actionMenuItems||(this.actionMenuItems={}),this.addMenuItems(this.actionMenuItems,e)},addActionItems:function(e){var t=e.isHeader?this.headerMenu:this.actionMenu;t.element.empty();var a=this.delegateEvent("getActionItems",e);if(this.menuItems=e.isHeader?[]:Object.copy(this.actionMenuItems),a&&a.length>0){var i=this;Object.each(a,function(e){i.addMenuItems(i.menuItems,e)})}var n=[];Object.each(this.menuItems,function(e){e.isChild||n.push(e)}),n=Array.orderBy(n,function(e){return e.customOrder||e.text}),Object.each(n,function(e){t.append(e)})},showContextMenu:function(e,t){this.addActionItems(this.getActionContext()),this.actionMenu.open(e,t),this.getElement("contextMenu").attr("style","")},getActionContext:function(e,t){var a=this;return{selectedRows:this.getSelectedItems(),objectDescribe:this.settings.metadata,selectedColumn:t,isHeader:!!e&&e,kendoGrid:this.kendoGrid,actionGrid:this,subscribeEvent:function(e,t,i){return a.subscribeEvent(e,t,i)},unsubscribeEvent:function(e,t,i){return a.unsubscribeEvent(e,t,i)}}},isItemChecked:function(e){var t=this.settings.pageInfo.columns&&this.settings.pageInfo.columns.indexOf(e)>-1,a=this.settings.hiddenColumns&&this.settings.hiddenColumns.indexOf(e)>-1;return t&&!a},onToolbarItemChecked:function(e){this.toolbar&&this.toolbar.toggleGroup(e)},getColumns:function(e){var t=this;return e.unshift({title:" ",field:"check",sortable:{compare:function(e,a){var i=t.isItemChecked(e.name),n=t.isItemChecked(a.name),o=0;return i&&!n?o=1:!i&&n&&(o=-1),o}},filterable:!1,width:"45px",headerTemplate:'<span class="k-icon k-i-kpi"/>',template:function(e){if(e.showCheckbox===!1)return"";var a,i=e.name,n=e.parentModel,o=[],r=!1,s=!1;if("childgridnode"==n.type)i="."+e.name,a=kendo.format("$('{0}').data('kendoTreeList').parent.onChildGridNodeChecked('{1}','{2}')",t.getElementId("fieldTreeView"),e.relObjectName,e.name);else if(void 0!=e.tabName)r=t.isReadingPaneTabEnabled(e.tabName),i=void 0,"quickView"==e.tabName&&"true"!=t.settings.metadata.feedEnabled&&(s=!0),a=kendo.format("$('{0}').data('kendoTreeList').parent.onRPTabChecked('{1}')",t.getElementId("fieldTreeView"),e.tabName);else if("pagenode"==e.type){i=void 0;var l=t.settings.readingPane.rpvfPages;r=l&&l.length>0&&Object.first(l,function(t){return t.name==e.name}),a=kendo.format("$('{0}').data('kendoTreeList').parent.onVFPageChecked({name:'{1}', title:'{2}'})",t.getElementId("fieldTreeView"),e.name,e.nodeName)}else if("toolbargroupnode"==e.type){i=void 0;var d=t.toolbar&&t.toolbar.saveState()||t.settings.toolbarState;r=d&&d[e.nodeName]&&d[e.nodeName].visible,a=kendo.format("$('{0}').data('kendoTreeList').parent.onToolbarItemChecked('{1}')",t.getElementId("fieldTreeView"),e.nodeName)}if(e.isChild===!0){for(var c=["objectnode","readingpanenode","detailgridnode","chartnode"];n&&c.indexOf(n.type)==-1;)o.unshift(n.relationshipName),
n=n.parentModel;i=kendo.format("{0}.{1}",o.join("."),i)}var u;if(n&&(u=n.type),i)switch(u){case"detailgridnode":r=t.settings.readingPane.detailGrid&&t.settings.readingPane.detailGrid.fieldNames&&t.settings.readingPane.detailGrid.fieldNames.indexOf(i)>-1;break;case"chartnode":r=t.settings.readingPane.chart&&t.settings.readingPane.chart.fieldNames&&void 0!==t.settings.readingPane.chart.fieldNames[i];break;default:r=t.isItemChecked(i)}var p=r?'checked="true" ':"";switch(p+=s?'disabled="disabled" ':"",u){case"detailgridnode":a=a||kendo.format("return $('{0}').data('kendoTreeList').parent.onRPTabFieldChecked('detailGrid', '{1}')",t.getElementId("fieldTreeView"),i);break;case"chartnode":a=a||kendo.format("return $('{0}').data('kendoTreeList').parent.onRPTabFieldChecked('chart', '{1}')",t.getElementId("fieldTreeView"),i);break;default:a=a||kendo.format("return $('{0}').data('kendoTreeList').parent.onItemChecked('{1}','{0}')",t.getElementId("fieldTreeView"),i)}return kendo.format('<input type="checkbox" onclick="{0}" {1} data-field-name="{2}"/>',a,p,i)}}),e},onChildGridNodeChecked:function(e,t){var a=this;this.fieldQueue=this.fieldQueue||[],this.loadDefaultFieldSet(e,function(e){Object.each(e,function(e){a.fieldQueue.push("."+t+"."+e)}),a.onItemChecked()})},onItemChecked:function(e){var t=this;if(this.checkForDirtyRows(!1,function(){t.onItemChecked(e)}))return!1;this.fieldQueue=this.fieldQueue||[];var a=this.fieldQueue;e&&a.push(e),clearTimeout(this.fieldTimer),this.settings.fieldChooserDelay>=0&&a.length>0&&(this.fieldTimer=setTimeout(function(){for(var e=!1,i={};a.length>0;){var n=a.shift();t.addRemoveColumn(n);var o=0==n.lastIndexOf(".",0);if(o){var r=n.split("."),s=r[1];e=t.addRemoveChildColumn(n);var l=t.findChildGrid(s);l&&(i[s]=l)}else e=!0}e&&($(t.getElementId("fieldTreeView")+" :checkbox").attr("disabled",!0),t.preserveSelectedRows(t.settings.editable,!1,void 0,function(){$(t.getElementId("fieldTreeView")+" :checkbox").attr("disabled",!1)})),Object.each(i,function(e){e&&e.kendoGrid&&e.kendoGrid.element&&$(e.kendoGrid.element).is(":visible")&&($(t.getElementId("fieldTreeView")+" :checkbox").attr("disabled",!0),e.refresh(function(){$(t.getElementId("fieldTreeView")+" :checkbox").attr("disabled",!1)}))})},this.settings.fieldChooserDelay))},autoUpdateChecked:function(e){e?(this.settings.fieldChooserDelay=1500,this.onItemChecked()):this.settings.fieldChooserDelay=-1},toggleColumn:function(e,t){if(this.settings.isChildGrid){var a=this.settings.id.split("-")[1];e="."+a+"."+e;var i=this.settings.parentGrid;return i.addRemoveColumn(e,t),i.addRemoveChildColumn(e,t)}return this.addRemoveColumn(e,t),!0},addRemoveColumn:function(e,t,a,i){this.settings.pageInfo.columns=this.settings.pageInfo.columns||[];var n=this.settings.hiddenColumns&&this.settings.hiddenColumns.indexOf(e)>-1;n&&(this.settings.pageInfo.columns.splice(this.settings.pageInfo.columns.indexOf(e),1),this.settings.hiddenColumns.splice(this.settings.hiddenColumns.indexOf(e),1));var o=this.settings.pageInfo.columns.indexOf(e);if(i)o>-1&&this.settings.pageInfo.columns.splice(o,1);else if(o<0)t="number"==typeof t?t:this.settings.pageInfo.columns.length,this.settings.pageInfo.columns.splice(t,0,e),a&&(this.settings.hiddenColumns||(this.settings.hiddenColumns=[]),this.settings.hiddenColumns.push(e));else{this.settings.pageInfo.columns.splice(o,1);var r=this.gridDataSource.group();Object.each(r,function(t){t.field==e&&r.remove(t)})}},findChildGrid:function(e){var t=this;for(var a in D.instances){var i=a.split("-");if(3==i.length&&i[0]==t.getElementId("grid").replace("#","")&&i[1]==e){var n=D.instances[a];break}}return n},addRemoveChildColumn:function(e,t){var a=!1,i=e.split("."),n=i[1],o=i.slice(2).join("."),r=!1,s=!1,l=this.findChildGrid(n);return l&&(r=!0,l.addRemoveColumn(o,t),0==l.settings.pageInfo.columns.length&&(s=!0,l.kendoGrid&&(l.kendoGrid.destroy(),l.kendoGrid=null),Object.each(D,function(e,t){e===l&&delete D.instances[t]}))),!r&&this.kendoGrid&&(this.kendoGrid.element.find(".k-detail-row").length>0||!s)||s?a=!0:this.fieldChooser.fieldTreeView.refresh(),a},getItemAtIndex:function(e){var t=kendo.format("tr:eq({0})",e);return this.kendoGrid.dataItem(t)},updateFooter:function(e){$("#selectedCount"+this.settings.id).length<1&&$("#"+this.settings.id+"_grid>[data-role=pager]").append($('<span id="selectedCount'+this.settings.id+'" />'));var t="";e||(e=this.getSelectedItems()),e.length>0&&(t=e.length+" row"+(1!=e.length?"s":"")+" selected"),$("#selectedCount"+this.settings.id).text(t)},getRecordTypes:function(e){i.getDescribeLayout(this.settings.pageInfo.objectName,function(t){var i=a.getPicklistsForRecordTypes(t);"function"==typeof e&&e(i)},function(e){console.log(e),b.trackException(e)})},getPicklistValues:function(e,t,i){var n={fieldName:e,picklistValues:t,objectName:this.settings.pageInfo.objectName,fields:this.settings.metadata.fields,recordTypeInfos:this.settings.metadata.recordTypeInfos};return a.getPicklistValueFactory(n)},getSelectedItems:function(){var e,t={};if(this.kendoGrid)try{e=this.kendoGrid.select()}catch(e){console.log(e),b.trackException(e)}if(e&&e.length>0)for(var a=0;a<e.length;a++)t[e[a].dataset.uid]||(t[e[a].dataset.uid]=this.kendoGrid.dataItem(e[a]));return $.map(t,function(e){return e})},getLockedColumns:function(){var e=this.columns;return this.kendoGrid&&(e=this.kendoGrid.columns),e.filter(function(e){return e.locked})},getSelectedView:function(){var e=this.selectedViewName,t=Object.first(this.getSavedViews(),function(t){return t.Name===e});return t},newView:function(){var e=this,t=function(){e.loadDefaultFieldSet(e.settings.pageInfo.objectName,function(t){e.resetViewSettings(),e.settings.pageInfo.columns=t,e.refresh(function(){e.modifySelectedView(),e.saveNamedView()})})};this.selectedViewIsDirty?o.popupWithButtons("Unsaved View","Your view is modified, if you continue changes will be lost.",[{label:"New View",click:function(){t()}},{label:"Cancel"}]):t()},saveNamedView:function(){var e=this,t=function(){w.saveMenu(e)};w.validateView(this.settings.pageInfo,!0,t)&&t()},blurEditCell:function(){this.getElement("grid").has($(document.activeElement)).length>0&&$(".k-edit-cell").find("input, textarea").blur()},quickSaveView:function(e){var t=this,i=e?e:this.getSelectedView();if(i){var n=a.getUserInfo().userId;if(n==i.OwnerId||"Public"==i.Privacy__c){var o=function(){w.saveMenu(t)};if(w.validateView(this.settings.pageInfo,!1,o)){var r=this.saveView();i[a.getNamespace(!0)+"JSON__c"]=JSON.stringify(r),i[a.getNamespace(!0)+"ObjectName__c"]=this.settings.pageInfo.objectName;var s=function(e){u.showMessage({title:"View Updated",message:"Successfully updated view"},"success"),t.setSelectedView(e,!1,!0)};w.saveAGView(i,s)}}else if(n!=i.OwnerId&&"Public Read-Only"==i.Privacy__c){var l=t.getElementId("grid")+"_SaveViewAs_Alert";u.showMessage({title:"Public Read-Only View",message:kendo.format(' (<a id="{0}" href="#" >Click to Save View As…</a>)',l.replace("#",""))},"success"),$(l).parent().parent().on("click",function(){w.saveMenu(t)})}}else w.saveMenu(this)},saveDataAndView:function(e){var t=this;if(this.blurEditCell(),!e&&this.gridDataSource.hasChanges()&&this.saveButtonClick(),this.settings.isChildGrid)this.settings.parentGrid.saveDataAndView(!0);else if(d.getSetting(this.settings.pageInfo.objectName,"saveView")!==!1&&this.settings.enableViews){var a=this.getSelectedView();if(a){var i=t.getElementId("grid")+"_SaveView_Alert";u.showMessage({title:"View has been modified",message:kendo.format(' (<a id="{0}" href="#" >Click to save view</a>)',i.replace("#",""))},"success"),$(i).parent().parent().on("click",function(){t.quickSaveView(a)})}else{var i=this.getElementId("grid")+"_SaveViewAs_Alert";u.showMessage({title:"No Saved Views",message:kendo.format(' (<a id="{0}" href="#" >Click to save new view</a>)',i.replace("#",""))},"success"),$(i).parent().parent().on("click",function(){w.saveMenu(t)})}}},saveView:function(){var e=this,t={};if(Object.copy(this.settings.pageInfo,t),t.readingPane=this.settings.readingPane,t.childTabOrder=this.settings.childTabOrder,t.selectedReadingPane=this.settings.selectedReadingPane,t.lockedColumns=this.settings.lockedColumns,t.groupExpandAll=this.settings.groupExpandAll,t.hiddenColumns=this.settings.hiddenColumns,this.kendoGrid&&this.kendoGrid.columns){var i=[];Object.each(this.kendoGrid.columns,function(e,t){var a=w.saveColumnMeta(e);a.ordinal=parseInt(t),i.push(a)}),t.displayColumns=i}return this.settings.conditionalRules&&(t.conditionalRules=this.settings.conditionalRules),this.settings.formulaFields&&(t.formulaFields=this.settings.formulaFields),this.settings.editable&&(t.editable=this.settings.editable),this.settings.fkField&&(t.fkField=this.settings.fkField),this.toolbar&&(t.toolbarState=this.toolbar.saveState()),this.settings.searchText&&(t.searchText=this.settings.searchText),t.toolbarCollapsed=this.settings.toolbarCollapsed,void 0!==this.gridDataSource&&(t.filter=this.gridDataSource.filter(),a.convertDateFilters(t.filter,this.fieldMeta),t.groups=this.gridDataSource.group(),t.takeCount=this.gridDataSource.pageSize(),t.skipCount=(this.gridDataSource.page()-1)*t.takeCount,t.sorts=this.gridDataSource.sort(),e.settings.isChildGrid!==!0&&$.each(this.getChildTables(),function(a,i){for(var n in D.instances){var o=D.instances[n],r=n.split("-");if(3==r.length&&r[0]==e.getElementId("grid").replace("#","")&&r[1]==i.childRelationship.relationshipName){void 0==t.childGridSettings&&(t.childGridSettings={}),o.kendoGrid?t.childGridSettings[r[1]]=o.saveView():delete t.childGridSettings[r[1]];break}}})),t},saveStickyView:function(){if(this.settings.enableStickyViews){var e=this.saveView();this.delegateEvent("saveView",e),this.selectedViewName&&(e.selectedViewName=this.selectedViewName,e.isDirty=this.selectedViewIsDirty,e.viewId=this.selectedViewId);try{localStorage.setItem(this.getStickViewId(),JSON.stringify(e))}catch(e){}}},loadSavedView:function(e){var t=a.getNamespace(!0),i=this.deserializeView(e[t+"JSON__c"]);this.resetViewSettings(),this.loadView(i),this.setSelectedView(e)},setSelectedView:function(e,t,i){var n=a.getNamespace(!0);this.selectedViewName=e.Name,this.selectedViewJSON=e[n+"JSON__c"],this.selectedViewId=e.Id,void 0!=i?this.selectedViewIsLoaded=i:this.selectedViewIsLoaded=!1,void 0!=t?this.selectedViewIsDirty=t:this.selectedViewIsDirty=!1,this.selectedViewIsDirty||this.getElement("modifiedFlag").hide()},loadView:function(e,t){if(null!==e&&void 0!==e){var a=e.filter,i=e.groups,n=e.takeCount,o=e.skipCount,r=e.sorts;this.settings.pageInfo.objectName=e.objectName,this.settings.pageInfo.columns=e.columns,this.settings.pageInfo.sorts=e.sorts,this.settings.pageInfo.groups=i,this.settings.pageInfo.takeCount=n,this.settings.pageInfo.skipCount=o,this.settings.pageInfo.childGridSettings=e.childGridSettings,this.settings.pageInfo.scope=e.scope,this.settings.hiddenColumns=e.hiddenColumns,this.settings.groupExpandAll=e.groupExpandAll,this.settings.readingPane=e.readingPane,this.settings.childTabOrder=e.childTabOrder,this.settings.selectedReadingPane=e.selectedReadingPane,this.settings.conditionalRules=e.conditionalRules,this.settings.formulaFields=e.formulaFields,this.settings.searchText=e.searchText,this.settings.editable=e.editable,(this.settings.editable&&this.settings.metadata&&this.settings.metadata.getBoolean("updateable")===!1||d.getSetting(this.settings.pageInfo.objectName,"editButton")===!1)&&(this.settings.editable=!1),this.settings.lockedColumns=e.lockedColumns,this.settings.toolbarState=e.toolbarState,this.settings.toolbarCollapsed=e.toolbarCollapsed,delete e.conditionalRules,delete e.editable;var s=this,l=[];if(this.settings.readingPane||(this.settings.readingPane=Object.copy(_.readingPane)),Object.each(this.settings.pageInfo.columns,function(t){d.getSetting(e.objectName,t,"field")===!1&&l.push(t)}),Object.each(l,function(e){s.settings.pageInfo.columns.remove(e)}),e.selectedRecordIds&&e.selectedRecordIds.length>0){var c=Object.first(e.selectedRecordIds,function(e){return e&&e.length>0});c&&(this.settings.pageInfo.selectedRecordsPassed?(a=void 0,delete this.settings.pageInfo.filter,delete this.settings.pageInfo.filterId):this.settings.pageInfo.selectedRecordIds=e.selectedRecordIds)}else e.filterId&&e.filterId.length>0?(this.settings.pageInfo.filterId=e.filterId,delete this.settings.pageInfo.sorts,delete this.settings.pageInfo.filter):this.settings.pageInfo.selectedRecordsPassed?(a=void 0,delete this.settings.pageInfo.filter,delete this.settings.pageInfo.filterId):(this.settings.pageInfo.filter=a,delete this.settings.pageInfo.filterId);this.initDataSource(function(e){var l={page:1,group:[],aggregate:e.aggregate()};a&&(l.filter=a),o&&o>0&&n>0&&(l.page=o/n+1),i&&i.length>0&&(Object.each(i,function(e){e.aggregates=l.aggregate}),l.group=i),r&&r.length>0&&(l.sort=r),n?l.pageSize=n:l.pageSize=_.pageInfo.takeCount,s.delegateEvent("beforeQuery",l);var d=e.query(l),c=d.then(function(){$(".k-context-menu").data("kendoContextMenu")&&$(".k-context-menu").data("kendoContextMenu").close()});"function"==typeof t&&c.then(t)},e.displayColumns),this.delegateEvent("loadView",e)}else{var u=this;this.loadDefaultFieldSet(u.settings.pageInfo.objectName,function(e){u.settings.pageInfo.columns=e,u.refresh()})}},getStickViewId:function(){var e="",t=a.getUserInfo();return t&&t.organizationId&&(e+=t.organizationId),e+=this.settings.viewId&&""!==this.settings.viewId?this.settings.viewId:this.settings.fkField&&""!==this.settings.fkField?this.settings.pageInfo.objectName+this.settings.fkField:window.location.pathname.indexOf("Explorer")>-1?this.settings.pageInfo.objectName+"Explorer":this.settings.pageInfo.objectName},getContextName:function(){var e=n.viewContext.vfPage;return window.location.pathname.indexOf("Explorer")>-1?e=n.viewContext.explorer:this.settings.fkField&&""!==this.settings.fkField&&(e=n.viewContext.pageLayout),e},deserializeView:function(e){var t;try{t=JSON.parse(e)}catch(a){t=JSON.parse(unescape(e))}return t},loadStickyView:function(){var e=void 0;if(this.settings.enableStickyViews)try{e=localStorage.getItem(this.getStickViewId())}catch(e){}if(e&&e.length>0){var t=this.deserializeView(e);if(this.settings.pageInfo.selectedRecordsPassed&&this.settings.pageInfo.selectedRecordIds&&this.settings.pageInfo.selectedRecordIds.length>0)return this.loadDefaultView(),this.selectedViewIsLoaded=void 0,this.selectedViewIsDirty=void 0,void(this.selectedViewId=void 0);if(this.settings.pageInfo.filterId&&(delete t.sorts,delete t.filter,delete t.selectedRecordIds,t.isDirty=!0,t.filterId=this.settings.pageInfo.filterId),t.selectedViewName&&(this.selectedViewName=t.selectedViewName,this.selectedViewIsLoaded=!0,this.selectedViewIsDirty=!0,this.selectedViewId=t.viewId),this.settings.viewId&&this.settings.viewId.length>0&&(this.settings.viewId!=t.viewId||!t.isDirty))return void this.loadDefaultView();if(!t.isDirty&&t.viewId){var a=this.getSavedViewById(t.viewId);if(a)return void this.loadSavedView(a)}t.columns&&t.columns.length>0?this.loadView(t):(this.selectedViewName=void 0,this.selectedViewIsLoaded=void 0,this.selectedViewIsDirty=void 0,this.selectedViewId=void 0,this.loadDefaultView())}else this.loadDefaultView()},loadDefaultView:function(){var e;if(this.delegateEvent("getColumnNames"))return this.settings.pageInfo.columns=this.settings.delegate.getColumnNames(),void this.refresh();if(this.settings.viewId&&this.settings.viewId.length>0)e=[this.getSavedViewById(this.settings.viewId)];else{var e,t=a.getNamespace(!0),i=this.getContextName(),o=[];switch(i){case n.viewContext.vfPage:case n.viewContext.explorer:o.push(kendo.format("'{0}'",n.viewContext.vfPage)),o.push(kendo.format("'{0}'",n.viewContext.explorer));break;default:case n.viewContext.pageLayout:o.push(kendo.format("'{0}'",i))}try{e=a.query("select {0}JSON__c, Name, Id from {0}GridView__c where {0}ObjectName__c = '{1}' and {0}Context__c in ({2}) and {0}IsDefault__c = true and isDeleted = false",t,this.settings.pageInfo.objectName,o.join(","))}catch(e){console.log(e),b.trackException(e)}}if(e&&e.length>0)this.loadSavedView(e[0]);else{var r=this;this.loadDefaultFieldSet(r.settings.pageInfo.objectName,function(e){r.settings.pageInfo.columns=e,r.settings.metadata.getBoolean("updateable")&&(r.settings.editable=!0),r.refresh()})}},loadDefaultFieldSet:function(e,t){a.executeRemoteAction("getDefaultFieldsForObject",[e],function(e,a){a.status?t(e):o.popup("Error",String.format("Failed getting default columns for {0} with error: {1}",grid.settings.metadata.label,a.message))},{escape:!1,buffer:!1})},resetViewSettings:function(){try{localStorage.removeItem(this.getStickViewId())}catch(e){}this.selectedViewName=void 0,this.selectedViewIsLoaded=void 0,this.selectedViewIsDirty=void 0,this.selectedViewId=void 0,this.settings.pageInfo.filter=void 0,this.settings.pageInfo.groups=void 0,this.settings.pageInfo.skipCount=0,this.settings.pageInfo.takeCount=100,this.settings.pageInfo.sorts=void 0,this.settings.pageInfo.selectedRecordsPassed||(this.settings.pageInfo.selectedRecordIds=[]),this.settings.pageInfo.filterId=void 0,this.settings.pageInfo.childGridSettings=void 0,this.settings.selectedReadingPane=void 0,this.settings.childTabOrder=void 0,this.settings.hiddenColumns=[],this.settings.toolbarState=void 0,this.settings.readingPane=void 0,this.settings.searchText=void 0,this.settings.groupExpandAll=void 0,this.settings.formulaFields=void 0,this.settings.conditionalRules=void 0,this.gridDataSource=void 0,this.destroyReadingPane();var e=this;for(var t in D.instances){var a=t.split("-");3==a.length&&a[0]==e.getElementId("grid").replace("#","")&&delete D.instances[t]}},resetView:function(){this.resetViewSettings(),this.loadStickyView()},refresh:function(e){this.loadView(this.saveView(),e)},redraw:function(){kendo.resize($(".k-splitter"),!0),kendo.resize($(".k-grid"),!0)},clearFilters:function(){var e=this,t=this.getElement("searchText");t&&t.length>0&&t.val(""),delete e.settings.pageInfo.filter,delete e.settings.pageInfo.filterId,delete e.settings.pageInfo.selectedRecordIds,delete e.settings.pageInfo.scope,e.gridDataSource.filter({})},refreshWithDisabledFieldChooser:function(e){var t=this.getElementId("fieldTreeView");this.settings.isChildGrid&&(t=this.settings.parentGrid.getElementId("fieldTreeView")),$(t+" :checkbox").attr("disabled",!0),this.refresh(function(){$(t+" :checkbox").attr("disabled",!1),"function"==typeof e&&e()})},refreshFormatting:function(e){var t=this;if(e){var a=function(a,i){return $(kendo.format("{2} tr[data-uid={0}] td:not(.k-group-cell,.k-hierarchy-cell):eq({1})",e.uid,i,t.getElementId("grid")))},i=function(t,a){var i=kendo.template(a.template);t.html(i(e))};Object.each(this.settings.conditionalRules,function(n,o){for(var r,s,l=0,d=t.kendoGrid.columns.length;l<d;l++)if(s=t.kendoGrid.columns[l],s.field===o&&!s.hidden){var c=$(kendo.format("{1} tr[data-uid={0}]",e.uid,t.getElementId("grid")));c.find("a").removeAttr("style"),c.removeAttr("style");var r=a(e.uid,l);r.removeAttr("style"),i(r,s);break}}),Object.each(this.settings.formulaFields,function(n,o){for(var r,s,l=0,d=t.kendoGrid.columns.length;l<d;l++){var s=t.kendoGrid.columns[l];if(s&&s.formula&&s.formula.id&&s.formula.id===o){var c=s.formula,u=g.getFormulaFieldName(c);e[u]=g.parseFormula(c,e);var r=a(e.uid,l);i(r,s);break}}})}Object.each(this.settings.conditionalRules,function(e,a){var i=0;Object.each(e,function(e,n){var o={};e.property&&(o[e.property]=e.color),e.backColor&&"rgba(255, 255, 255, 0)"!=e.backColor&&(o["background-color"]=e.backColor),e.foreColor&&(o.color=e.foreColor),e.italic&&(o["font-style"]="italic"),e.bold&&(o["font-weight"]="bold"),e.underline&&(o["text-decoration"]="underline");var r=".crmc_"+a.replace(/[^A-Z0-9a-z]*/g,"")+i++;if(e.isRow)for(var s=$(r).parent().parent("tr[data-uid]"),l=0;l<s.length;l++){var d=s[l],c=$(d).attr("data-uid");d=$(kendo.format("{1} tr[data-uid={0}]",c,t.getElementId("grid"))),d.css(o),d.attr("title",e.id),d.find("a").css(o)}else $(r).parent().css(o),$(r).parent().attr("title",e.id),$(r).parent().find("a").css(o)})})},rowDoubleClick:function(e){this.settings.editable||this.delegateEvent("rowDoubleClick")||this.openSelectedRecord(e.ctrlKey)},fillDown:function(){var e=this,t=e.getSelectedItems(),a=Object.where(t,function(e){return e.dirtyFields});if(a&&a.length>0)if(t&&t.length>0){var i=a[0],n=t[t.length-1];e.kendoGrid._progress&&e.kendoGrid._progress(!0),Object.each(t,function(t,a){setTimeout(function(){Object.each(i.dirtyFields,function(a,o){var r=Object.first(e.fieldMeta,function(e){return e.name==o}),s=o;if(r&&"REFERENCE"===r.type){var l=Object.first(e.fieldMeta,function(e){return e.parentMeta&&e.parentMeta.name==o});l&&(s=l.name)}for(idx=0,length=e.kendoGrid.columns.length;idx<length;idx++){var d=e.kendoGrid.columns[idx];if(d.field===s){var c=$(kendo.format("{2} tr[data-uid={0}] td:not(.k-group-cell,.k-hierarchy-cell):eq({1})",t.uid,idx,e.getElementId("grid")));if(c){e.kendoGrid.editCell(c);break}}}var u=t===n;if(u||(e.kendoGrid.editable={}),o!=s){var p=i[s];t[l.name]=p,l.parentMeta&&l.parentMeta.relationshipName&&t[l.parentMeta.relationshipName]&&(t[l.parentMeta.relationshipName].Id=a),t.set(s,p)}t.set(o,a),u?(e.kendoGrid._progress&&e.kendoGrid._progress(!1),e.kendoGrid.editCell(c)):delete e.kendoGrid.editable})})})}else o.popup("Selection Required","Auto Fill requires at least one row selected to fill to.");else o.popup("Auto Fill Unavailable","Auto Fill works by copying edited values to all selected rows, <br/>however you must have at least one row selected with modified values.")},editNextCell:function(e){if(x.isInEditMode&&(!this.kendoGrid.editable||this.kendoGrid.editable&&this.kendoGrid.editable.validatable.validate())){var t=x.editModeContext,a=":not(.k-group-cell,.k-hierarchy-cell,.fillerColumn,.selectedBox,.readOnly):visible",i=e?t.prevAll(a+":first"):t.nextAll(a+":first"),n=!1;if(!i.length){if(i=t.parent(),this.settings.lockedColumns){var o=t.parents(".k-grid-content-locked").length>0,r=$(t.parent()).data("uid");i=o?$("[data-uid="+r+"]:last"):$("[data-uid="+r+"]:first"),n=!0}(!this.settings.lockedColumns||this.settings.lockedColumns&&(o&&e||!o&&!e))&&(i=$(i)[e?"prevAll":"nextAll"]("tr:not(.k-grouping-row):not(.k-detail-row):visible:first")),i=i.children(a+(e?":last":":first")),i&&i.length>0&&(this.kendoGrid.clearSelection(),this.kendoGrid.select(i.parent()))}if(t.find("input").blur(),this.kendoGrid.editCell(i&&i.length>0?i:t),n){this.kendoGrid.content&&this.kendoGrid.content.length>0&&this.kendoGrid.lockedContent&&this.kendoGrid.lockedContent.length>0;this.syncScrollContent(!e)}var s=i.find("input:visible");s.length>0&&s[0].select()}},syncScrollContent:function(e){this.kendoGrid&&this.kendoGrid.lockedContent&&(e?this.kendoGrid.content[0].scrollTop=this.kendoGrid.lockedContent[0].scrollTop:this.kendoGrid.lockedContent[0].scrollTop=this.kendoGrid.content[0].scrollTop)},navigateSelection:function(e,t,a){var i=this.kendoGrid.select();if(i.length>0&&!a){var n=$(document.activeElement),o=i.has(n);if(i.length>1&&(i=o&&o.length>0?o:i.first()),0==o.length||n.is("input[type=checkbox]")||t){var r="tr:not(.k-grouping-row,.k-group-footer)";if(i=e?$(i).prevAll(r):$(i).nextAll(r),i&&i.length>0){this.kendoGrid.clearSelection(),this.kendoGrid.select(i[0]);var s=i.position().top,l=this.kendoGrid.content.height();if(s>l||s<0){var d=this.kendoGrid.content.scrollTop();this.kendoGrid.content.scrollTop(d+s)}if(t&&this.kendoGrid.editable){var c=this.kendoGrid.editable.element.index();this.kendoGrid.editable.element.find("input").blur();var u=$(i.children(":eq("+c+")"));this.kendoGrid.editCell(u);var p=u.find("input:visible");p.length>0&&p[0].select()}}}}else if(a){for(var f,m,h=0,g=this.kendoGrid.items(),v=this.kendoGrid.columns,b=0;b<v.length;b++)if(v[b].schema&&v[b].schema.editable){h=b;break}if(i.length>0)f=i[0];else{var y=e?g.length-1:0;f=$(kendo.format("tr[data-uid={0}]",$(this.kendoGrid.items()[y]).attr("data-uid")))}if(this.settings.lockedColumns){var k=this.getElement("grid").find($(kendo.format("tr[data-uid={0}]",$(i.first()).attr("data-uid")))),w=k.first().children();m=w.length>=h+1?w[h]:$(f).children()[$(f).children().length-w.length]}else this.settings.isChildGrid||this.isReadingPaneShowing()||h++,m=$(f).children()[h];this.kendoGrid.select(f),this.kendoGrid.editCell(m),e&&this.syncScrollContent(!0)}},selectionChanged:function(){if(!this.delegateEvent("selectionChanged")){var e=this.getSelectedItems();if(this.updateFooter(e),this.isReadingPaneShowing()&&e&&e.length>0){var t=e[0].Id;this.updateReadingPane(t)}}this.delegateEvent("select",this.getActionContext())},openSelectedRecord:function(e){var t=this.kendoGrid.dataItem(this.kendoGrid.select());if(t&&void 0!==t.Id){var i={retURL:this.settings.pageURL};e?a.navigateToPage(t.Id,i,!1,"_BLANK"):a.navigateToPage(t.Id,i)}},delegateEvent:function(e,t){var a=this.settings.delegate;return a&&a[e]&&"function"==typeof a[e]?a[e].apply(this,[t]):void this.getElement("grid").trigger(e,t)},subscribeEvent:function(e,t,a){this.getElement("grid").off(e+"."+t).on(e+"."+t,a)},unSubscribeEvent:function(e,t,a){this.getElement("grid").off(e+"."+t)},allowParentalEditing:function(){return d.getSetting(this.settings.pageInfo.objectName,"editParents")!==!1},totalToolTipHandler:function(e){var t=$(e).attr("data-title"),a=this,i=$("<div>").kendoTooltip({position:"left",autoHide:!1,content:function(){var e=$('<div style="text-align:left;">Totals are for this page only </div>'),i=$('<a href="javascript:void(0);">(see all)</a>');return i.click(function(){a.summarizeColumn(t)}),e.append(i),e}}).data("kendoTooltip");i.show($(e))},subTotalToolTipHandler:function(e){var t=$("<div>").kendoTooltip({position:"left",autoHide:!1,content:"<div style='text-align:left;'>Subtotals for grouping are for this page only</div>"}).data("kendoTooltip");t.show($(e))},summarizeColumn:function(e,t,i){var n=this,s={objectName:this.settings.pageInfo.objectName,columns:[e],filter:this.settings.pageInfo.filter,selectedRecordIds:t||this.settings.pageInfo.selectedRecordIds,filterId:this.settings.pageInfo.filterId},l=Object.first(this.kendoGrid.columns,function(t){return t.field==e}),d=function(e,t,a,i,o,s){r.entry(e,[{label:"Count",name:"Count",help:kendo.format("Count of non-empty records for '{0}'.",l.title),attributes:"readonly",value:t},{label:"Sum",name:"Sum",attributes:"readonly",value:a},{label:"Average",name:"Average",attributes:"readonly",value:i},{label:"Minimum",name:"Minimum",attributes:"readonly",value:o},{label:"Maximum",name:"Maximum",attributes:"readonly",value:s}],{grid:n,width:300,buttons:[{name:"Dismiss",label:"Dismiss"}]})},c=t?l.title+" summary for selected records":l.title+" summary for all results";if(i){var u=this.getSelectedItems(),p=u.length,f=0,m=parseFloat(u[0][e]),h=parseFloat(u[0][e]),g=function(e){return kendo.format("{0:"+l.formula.format+"}",e)};Object.each(u,function(t){var a=parseFloat(t[e]);f+=a,m=m<a?m:a,h=h>a?h:a}),d(c,p,g(f),g(f/p),g(m),g(h))}else a.executeRemoteAction("getResultSOQL",[s],function(i,n){if(n.status){var r=["IsDeleted = false"];i.whereSOQL&&i.whereSOQL.length>0&&r.push(i.whereSOQL);var c=kendo.format("select sum({0}) sum, count({0}) c, avg({0}) avg, min({0}) min, max({0}) max from {1} where ",e,s.objectName)+r.join(" and ");try{var u=a.query(c)}catch(e){return void o.popup("Error","Error running aggregate query:"+e)}if(u&&u.length>0){var i=u[0],p=t?l.title+" summary for selected records":l.title+" summary for all results",f=kendo.format("{0:n0}",parseInt(i.c)||0),m=kendo.format(l.format,parseFloat(i.sum)||0),h=kendo.format(l.format,parseFloat(i.avg)||0),g=kendo.format(l.format,parseFloat(i.min)||0),v=kendo.format(l.format,parseFloat(i.max)||0);d(p,f,m,h,g,v)}}else o.popup("Error",String.format("Unable to summarize {0} with error: {1}",e,n.message))},{escape:!1,buffer:!1})}},D={instances:{},create:function(e){var t=Object.create(T);return t.init(e),this.instances[e.id]=t,b.track("ActionGrid Initialized",{context:t.getContextName(),objectName:e&&e.pageInfo&&e.pageInfo.objectName,pageName:e&&e.pageName,pageLayoutId:e&&e.pageLayoutId,fkField:e&&e.fkField,newButtonURL:e&&e.newButtonURL,viewId:e&&e.viewId,enableNewButton:e&&e.enableNewButton,enableNewInline:e&&e.enableNewInline,enableEdit:e&&e.enableEdit,enableFieldChooser:e&&e.enableFieldChooser,enableToolbar:e&&e.enableToolbar,enableActions:e&&e.enableActions,enableStickyViews:e&&e.enableStickyViews,enableViews:e&&e.enableViews,enableFormatting:e&&e.enableFormatting,enableReadingPane:e&&e.enableReadingPane,isFullscreen:e&&e.isFullscreen}),t}};return D}),crmc.define("GridAdmin",["ObjectList","KendoPopup","admin","KendoEntry","sfdc","FieldChooser","ActionItem","GridConstants","CustomSettings","FileSaver","SFRest","GridBase","Notification","ExpressionTree","ForeignKeyControl"],function(e,t,a,i,n,o,r,s,l,d,c,u,p,f,m){var h={actionOwner:"",actionOwnerLabel:"",actionOwnerType:"global",objectName:"global",objectLabel:"Global",userList:void 0,profileList:void 0,permissionSetName:"ActionGrid_Visualforce_Pages",resizeDivs:function(){var e=$("#mainOutput"),t=e.offset();t=t||{top:0};var a=$("#AppBodyHeader").length>0,i=a?$(window).height()-s.SFDC_HEADER_PX:$(window).height()-t.top-10;$("#bPageTitle").length>0&&(i-=$("#bPageTitle").height()),e.height(i);var n=$("#ObjectList > .k-block");if(n.css("max-height",i-45+"px"),n.height(i+"px"),$("#rightPane").height(i+"px"),$("#fieldFeatures").height(i-122+"px"),$("#actionFeatures").height(i-59+"px"),$("#explorerFeatures").height(i-59+"px"),$("#vfPagesList").is(":visible")){var o=$("#vfPagesList").offset().top-95;$("#vfPagesList").height(i-o+"px")}},getCustomObject:function(e,t){var a=["integration","field","buttons","defaultViews","views","vfPages"],i=["global","explorer"],n=function(e,t){var a=$("#tabstrip").kendoTabStrip().data("kendoTabStrip"),i=-1;Object.each(e,function(e){var t=$("#"+e);a.enable(t),$(t).css("display",""),i<0&&(i=t.index())}),Object.each(t,function(e){var t=$("#"+e);a.select().index()==t.index()&&a.select(i),a.disable(t),t.css("display","none")})},o=$("#tabstrip").kendoTabStrip().data("kendoTabStrip");h.objectName=e,h.objectLabel=t?t:e;o.select().prop("id");"global"==e?(h.objectLabel="Global",$("#action").children()[1].innerText="Feature Security",$("#field").children()[1].innerText="Fields",n(i,a),$("#globalFeatureDefaultContainer").css("display","block")):($("#action").children()[1].innerText=h.objectLabel+" Features",$("#field").children()[1].innerText=h.objectLabel+" Fields",n(a,i)),h.initTab(o.select().prop("id")),document.getElementById("rightPane").style.display="block"},getProfiles:function(){return a.getProfiles()},getUsers:function(){return a.getUsers()},createButton:function(){h.showLoader(function(){a.createButton(h.objectName,function(e){"true"==e.success?(document.getElementById("hasButton").style.display="block",document.getElementById("noButton").style.display="none"):t.popup("Error Creating Button",e.errors.message),h.hideLoader()},function(e,a){h.hideLoader(),t.popup("Button Code",'Copy the following to a new Button: <br /><textarea cols="100" rows="10">'+a+"</textarea>")})})},addToSearchResult:function(){a.addToSearchResult(h.objectName,function(e){"true"==e.success?(document.getElementById("hasSearchResults").style.display="block",document.getElementById("noSearchResults").style.display="none"):"INVALID_CROSS_REFERENCE_KEY"==e.errors.statusCode?t.popup("Error Adding Button","Please create button first"):t.popup("Error Adding Button",e.errors.message)})},addToListViewButtons:function(){a.addToListViewButtons(h.objectName,function(e){"true"==e.success?(document.getElementById("hasListView").style.display="block",document.getElementById("noListView").style.display="none"):"INVALID_CROSS_REFERENCE_KEY"==e.errors.statusCode?t.popup("Error Adding Button","Please create button first"):t.popup("Error Adding Button",e.errors.message)})},createRelatedList:function(){h.createVFPage(!0)},createCustomPage:function(){h.createVFPage(!1)},createMultiTabRelatedList:function(){h.createVFPage(!0,!0)},createMultiTabCustomPage:function(){
h.createVFPage(!1,!0)},createQuickGrid:function(e,t){var a={},o=0,r=0,l=0,d={};sforce.connection.serverUrl="/services/Soap/u/36.0";var c=function(e){return function(t,a){t.append('<div id="'+e+'" />');var i=$("#"+e).kendoProgressBar({type:"percent",animation:!1});this.getValue=function(){return i.data().kendoProgressBar.value()}}};i.entry("Automatic Quick ActionGrid",[{name:"progress",label:"Scanning Objects",type:"custom",init:c("quickProgressBar")}],{width:500,buttons:[]},null,function(){}),$("#quickProgressBar").data("kendoProgressBar").value(!1),n.getDescribeGlobal(function(c){l=c.sobjects.length;var u=function(c){var u=c.name;try{if(["ServiceFieldDataType","ContentFolderMember","Vote","CollaborationGroupRecord","ContentDocumentLink","ContentFolderItem","UserRecordAccess","OwnedContentDocument"].indexOf(u)>-1)return void l--;var p=n.getSObjectDescribe(u);if(p.getBoolean("customSetting")||p.getBoolean("deprecatedAndHidden")||!p.getBoolean("layoutable")||!p.getBoolean("queryable")||!p.fields||!p.fields.length)return void l--;d[u]=p;var f=p.fields.filter(function(e){return e.hasOwnProperty("aggregatable")?e.getBoolean("aggregatable"):["multipicklist","boolean","location","encryptedstring","anyType","address","byte","base64","textarea"].indexOf(e.type)<0&&["Password","ConsumerSecret","VoteScore","VoteTotal","ActivityDate"].indexOf(e.name)<0||void 0}).map(function(e){return"COUNT("+e.name+") "+e.name+"_COUNT"});if(0==f.length)return void l--;f=f.slice(0,100),o++,$("#quickProgressBar").data("kendoProgressBar").value(o/l*100);sforce.connection.query("SELECT "+f.join()+" FROM "+u,function(o){if(a[u]=o.records,r++,console.log(u+": "+r+" of "+l),r==l){var c=[];Object.each(a,function(e,t){var a=[],i=0;Object.each(e,function(e,t){var n=t.substr(0,t.lastIndexOf("_COUNT"));try{var o=parseInt(e);!isNaN(o)&&o>0&&(o>i&&(i=o),["Id","CreatedDate","CreatedById","LastModifiedDate","SystemModstamp","LastModifiedById","OwnerId"].indexOf(n)<0&&a.push({name:n,count:o}))}catch(e){console.log(e)}});var n=0;if(a.length>0){a=a.sort(function(e,t){return t.count-e.count});var o=0;Object.each(a,function(e){o+=e.count}),n=o/a.length}c.push({name:t,fields:a,numRows:i,mean:n})}),c=c.sort(function(e,t){return t.numRows-e.numRows});$("#quickProgressBar").parentsUntil(".k-window").last().data("kendoWindow").close();var p=[];Object.each(c,function(e){p.push({name:e.name,label:d[e.name].label+" ("+e.numRows+" rows)",type:"boolean",value:p.length<8})});var f=function(a){var i=[];if(e){var o=a.filter(function(e){return e.value});Object.each(c,function(e){Object.each(o,function(t){t.name==e.name&&i.push(e)})})}else Object.each(c,function(e){a[e.name].value&&i.push(e)});var r="QuickGrid",l=n.query("select Id from ApexPage where Name LIKE '{0}%' AND NamespacePrefix = null",r);l.length>0&&(r+=l.length+1);for(var u=0;u<i.length;u++){var p=i[u];console.log(p.name,p.fields.map(function(e){return e.name+": "+e.count}).join());var f,m=[],g=h.multiTabPageFunctionFactory(i.length,!1);p.fields&&(f={objectName:p.name,editable:!0,columns:[],toolbarState:h.getDefaultToolbarState()},Object.each(p.fields,function(e){if(!(e.count<p.mean)){var t=e.name,a=Object.first(d[p.name].fields,function(t){return t.name==e.name});a&&a.referenceTo&&(t=a.referenceTo instanceof Array?a.relationshipName+".Name":a.relationshipName+"."+n.getSObjectNameField(n.getSObjectDescribe(a.referenceTo))),f.columns.push(t)}}));var v=function(e,a){return function(i){var n={pageLabel:d[a.name].label,objectName:a.name,delayLoad:m.length>0,enableNewButton:!0,enableNewInline:!0,enableEdit:!0,enableActions:!0,enableFieldChooser:!0,enableStickyViews:!0,enableToolbar:!0,enableViews:!0,enableFormatting:!0,enableReadingPane:!0,viewID:i.id};m[e]=n,g(m,{name:{value:r},label:{value:"Quick Grid"},description:{value:"Created based on what data is populated in this org"}},t)}};h.createView(p.name,"Quick Grid",f,s.viewPrivacy.public,!1,"Default view for Quick Grid",s.viewContext.pageLayout,v(u,p))}};e===!0?f(p):i.entry("Select Objects",p,{width:500},null,f)}})}catch(e){l--,console.log(e)}},p=function(e){if(e<c.sobjects.length){var t=c.sobjects[e];setTimeout(function(){u(t),p(e+1)},e%10==0?100:0)}};p(0)})},getDefaultToolbarState:function(){return{Views:{visible:!0,row:0,index:1},Edit:{visible:!0,row:1,index:0},Search:{visible:!0,row:0,index:0},Configure:{visible:!0,row:1,index:2},"Reading Pane":{visible:!0,row:1,index:1}}},getPageName:function(e){var t=e.replace(/ |\(|\)/g,"_").replace(/__/g,"_").slice(0,40);0!==t.indexOf("AG_")&&(t="AG_"+t.slice(0,37));n.query("select Id from ApexPage where Name LIKE '{0}%'",t);return{name:t,label:"AG "+e}},checkPageNameFunctionFactory:function(e){return function(t){var a=null;if((!e||t.createPage.value)&&(a=i.requiredValidation.call(this,t),null==a)){var o=n.query("select Id from ApexPage where Name LIKE '{0}' AND NamespacePrefix = null",this.value);o.length>0&&(a='The name "'+this.value+'" is already in use.  Please enter another one')}return a}},successVFCodePrompt:function(e,a,i,n,o){var r="VisualForce page"+(n?"s":"")+' "'+e+'" created successfully!';o&&(r="VisualForce page"+(n?"s":"")+' "'+e+'" was created, but with errors.  Please go to <a href="https://support.getconga.com/Conga_ActionGrid" target="_blank">The Documentation</a> for help'),t.popupWithButtons("VisualForce Page Created!",r,[{label:"View VF Page",click:function(){window.open("/"+a,"_blank")}},{label:i?"Page Layout":"Tabs",click:i?h.navigateLayouts:function(){window.open("/setup/ui/customtabs.jsp?setupid=CustomTabs","_blank")}}])},failVFCodePrompt:function(e,a){h.hideLoader(),t.popup("VisualForce Code",'Copy the following to a new Visual Force Page: <br /><textarea cols="100" rows="10">'+a+"</textarea>")},getAGPermissionSetId:function(e){if(h.AGPermissionSetId)e(h.AGPermissionSetId);else{var t=n.query("SELECT Id FROM PermissionSet WHERE Name = '"+h.permissionSetName+"'");if(t.length>0)h.AGPermissionSetId=t[0].Id,e(h.AGPermissionSetId);else{var a=new sforce.SObject("PermissionSet");a.Name=h.permissionSetName,a.Label="ActionGrid Visualforce Pages",n.insert(a,function(t){e(t.id)},function(){console.log(arguments)}),h.AGPermissionSetId=void 0}}},createCustomTab:function(e,i,n){var o=[];a.createCustomTab(e,function(r){h.logItem("Inserted","CustomTab",e,r,!0),r instanceof Array||(r=[r]),console.log(arguments),r[0].success!==!0?o.push("Tab Error: "+r[0].responseText):i&&!r[0].notCreated&&h.getAGPermissionSetId(function(i){a.addCustomTabToSet(e.FullName,i,!0,function(e){e instanceof Array||(e=[e]),console.log(arguments),e[0].success!==!0&&t.popup("Error","Unexpected error adding tab to Permission Set: "+e[0].responseText)})}),n(e.Metadata.page,o,r)})},createVFPagePrompt:function(e,i,o,r){a.createVFPage(e,i,o,function(e){if("true"==e.success){var a=e.fullName,i=n.query("select Id from ApexPage where Name = '{0}'",a);i.length>0&&(i=i[0].Id),i&&(a=String.format('<a href="/{0}" target="_blank">{1}</a>',i,a)),r&&h.getAGPermissionSetId(function(e){var a=new sforce.SObject("SetupEntityAccess");a.ParentId=e,a.SetupEntityId=i,n.insert(a,function(e){p.showMessage({title:"Success",message:"Successfully added page to Permission Set"},"success")},function(e){t.popup("Error","Unexpected error adding page to Permission Set: "+e)})}),h.successVFCodePrompt(a,i,o)}else t.popup("VisualForce Page Error","VisualForce page not created: "+e.errors.message);h.hideLoader()},function(e,a){h.hideLoader(),t.popup("VisualForce Code",'Copy the following to a new Visual Force Page: <br /><textarea cols="100" rows="10">'+a+"</textarea>")})},multiTabPageFunctionFactory:function(e,i,o,r){var s=0;return function(l,d,c){if(s++,s>=e){var u={pageName:d.name.value,pageLabel:d.label.value,description:d.description.value,sideBar:!1,showHeader:!1,standardController:o},f=0;Object.each(l,function(e){e.isCommented&&f++});for(var m=8,g=0,v=[],b=0;b<l.length;b+=m)a.createMultiTabVFPage(u,l.slice(b,b+m),i,function(e){if(g+=m,"true"==e.success){if(v.push(e.fullName),g>=l.length){var a="",i=n.query("select Id, Name from ApexPage where Name in ('{0}')",v.join("','"));i&&(r&&h.getAGPermissionSetId(function(e){var a=[];Object.each(i,function(t){var i=new sforce.SObject("SetupEntityAccess");i.ParentId=e,i.SetupEntityId=t.Id,a.push(i)}),n.insert(a,function(e){p.showMessage({title:"Success",message:"Successfully added page to Permission Set"},"success")},function(e){t.popup("Error","Unexpected error adding page to Permission Set: "+e)})}),a=i.map(function(e){return String.format('<a href="/{0}" target="_blank">{1}</a>',e.Id,e.Name)}).join(", ")),c?c(e,a,i,f):h.successVFCodePrompt(a,i[0].Id,!0,i.length>1,f>0)}}else t.popup("VisualForce Page Error","VisualForce page not created: "+e.errors.message);h.hideLoader()},h.failVFCodePrompt),u.pageName=d.name.value+"_"+(b/m+2),u.pageLabel=d.label.value+" "+(b/m+2),u.description=d.description.value+" Part "+(g/m+2)}}},convertListView:function(e,t){var a=void 0;if(e.columns){if(a={objectName:e.sobjectType,editable:t.editable,columns:[],toolbarState:h.getDefaultToolbarState()},e.scope&&(a.scope=e.scope),a.readingPane={showGraphs:!1,showText:t.readingPane,expanded:t.readingPane,selectedField:void 0,position:"right",height:150,width:"30%",chart:{fieldNames:{}},detailGrid:{fieldNames:[]}},a.toolbarCollapsed=!t.toolbar,Object.each(e.columns,function(e){var t=e.fieldNameOrPath;e.hidden||a.columns.push(t)}),a.filter={logic:"and",filters:[{logic:"and",filters:[]}]},e.whereCondition){var i={equals:"eq",notEquals:"neq",like:"contains",greaterThanOrEqualTo:"gte",greaterThan:"gt",lessThan:"lt",lessThanOrEqualTo:"lte"},n=function(e){var t={filters:[],logic:e.conjunction?e.conjunction:"and"};if(e.values){var a=e.values.map(function(e){return 0==e.indexOf("'")?e.substr(1,e.length-2):e}).join();t.filters.push({field:e.field,operator:i[e.operator],value:a})}else e.conditions&&Object.each(e.conditions,function(e){if(e.conditions)t.filters.push(n(e));else{e.condition&&(e=e.condition);var a=e.values.map(function(e){return 0==e.indexOf("'")?e.substr(1,e.length-2):e}).join();t.filters.push({field:e.field,operator:i[e.operator],value:a})}});return t};a.filter.filters[0]=n(e.whereCondition)}var o={ascending:"asc",descending:"desc"};a.sorts=e.orderBy.map(function(e){return{field:e.fieldNameOrPath,dir:o[e.sortDirection]}})}return a},createListViewGrid:function(e,o){var r={},l=[],d=function(i){var d=[],u=!!i.createPage&&i.createPage.value,f=i.name?i.name.value:h.objectName,m=i.label?i.label.value:h.objectLabel,g=!i.addToPermissionSet||i.addToPermissionSet.value;d=!i.allListViews||i.allListViews.value?l:[i.listview.value],settings={privacy:i.privacy?i.privacy.value.value:s.viewPrivacy.public,editable:!i.inlineEdit||i.inlineEdit.value,readingPane:!!i.readingPane&&i.readingPane.value,toolbar:!i.toolbar||i.toolbar.value};var v=0,b=[];h.showLoader(function(){for(var i=0;i<d.length;i++)c.getListView(h.objectName,d[i],function(i){var l=h.convertListView(i,settings),c=function(i){if(b.push(i),v++,u){var r={pageLabel:m,sideBar:!1,showHeader:!0,objectName:h.objectName,enableNewButton:!0,enableNewInline:!0,enableEdit:!0,enableActions:!0,enableFieldChooser:!0,enableStickyViews:!0,enableToolbar:!0,enableViews:!0,enableFormatting:!0,enableReadingPane:!0,viewID:i.id};h.createVFPagePrompt(f,r,!1,g)}else if(v==d.length)if(h.hideLoader(),e){var r={pageLabel:m,sideBar:!1,showHeader:!0,objectName:h.objectName,enableNewButton:!0,enableNewInline:!0,enableEdit:!0,enableActions:!0,enableFieldChooser:!0,enableStickyViews:!0,enableToolbar:!0,enableViews:!0,enableFormatting:!0,enableReadingPane:!0,viewID:i.id};a.createVFPage(f,r,!1,function(e){if("true"==e.success){var t=e.fullName,a=n.query("select Id from ApexPage where Name = '{0}'",t);a.length>0&&(a=a[0].Id),a&&(t=String.format('<a href="/{0}" target="_blank">{1}</a>',a,t)),g&&h.getAGPermissionSetId(function(e){var t=new sforce.SObject("SetupEntityAccess");t.ParentId=e,t.SetupEntityId=a,n.insert(t,function(e){},function(e){})})}var i={FullName:"ag_"+h.objectName.replace("__c",""),Metadata:{label:h.objectLabel+" (AG)",page:f,motif:"Custom71: Headset"}};h.createCustomTab(i,g,function(e,t,a){o&&o(b,f,a)}),h.hideLoader()},function(e,a){h.hideLoader(),t.popup("VisualForce Code",'Copy the following to a new Visual Force Page: <br /><textarea cols="100" rows="10">'+a+"</textarea>")})}else o?o(b):p.showMessage({title:"Success",message:String.format("Successfully created {0} Views.",v)},"success")},y=r[i.id];h.createView(h.objectName,y.label,l,settings.privacy,!1,kendo.format("View based on List View '{0}'",y.label),s.viewContext.vfPage,c)})})};c.getListViews(h.objectName,function(t){if(Object.each(t.listviews,function(e){r[e.id.substr(0,15)]=e,l.push(e.id)}),e===!0)d({});else{var a=h.getPageName(h.objectName+" "+t.listviews[0].developerName),n=[];Object.each(s.viewPrivacy,function(e){n.push({label:e,value:e})}),fields=[{name:"allListViews",label:"All List Views?",type:"boolean",help:"Create ActionGrid views for every List View",change:function(e,t){var a=$("#allListViews_"+t)[0].checked;$("#listview_"+t).data("kendoDropDownList").enable(!a),a?($("#createPage_"+t).attr("checked",!1),$("#createPage_"+t).attr("disabled",!0)):$("#createPage_"+t).removeAttr("disabled"),$("#createPage_"+t).trigger("change")}},{name:"listview",label:"List View",type:"picklist",values:t.listviews.map(function(e){return{label:e.label,value:e.id}}),change:function(e,t){if($("#listview_"+t).data("kendoDropDownList")){$("#label_"+t)[0].value=h.getPageName(h.objectName+" "+$("#listview_"+t).data("kendoDropDownList").text()).label,$("#name_"+t)[0].value="";try{DeveloperNameInputElement.setName($("#label_"+t)[0],$("#name_"+t)[0])}catch(e){$("#name_"+t)[0].value=$("#label_"+t)[0].value}}}},{name:"createPage",label:"Create VF Page?",type:"boolean",help:"Create a visual force page for the view",value:!0,change:function(e,t){var a=$("#createPage_"+t)[0].checked;$("#label_"+t).data("kendoMaskedTextBox").enable(a),$("#name_"+t).data("kendoMaskedTextBox").enable(a),a?($("#description_"+t).removeAttr("disabled"),$("#addToPermissionSet_"+t).removeAttr("disabled")):($("#description_"+t).attr("disabled",!0),$("#addToPermissionSet_"+t).attr("checked",!1),$("#addToPermissionSet_"+t).attr("disabled",!0))}},{name:"label",label:"Label",type:"text",maxLength:80,value:a.label,change:function(e,t){$("#name_"+t)[0].value="";try{DeveloperNameInputElement.setName(e.target,$("#name_"+t)[0])}catch(e){$("#name_"+t)[0].value=e.target.value}}},{name:"name",label:"Name",type:"text",maxLength:40,validate:h.checkPageNameFunctionFactory(!0),value:a.name},h.makeField("description","Description",void 0,"textarea"," "),{name:"privacy",label:"Privacy",type:"picklist",values:n,value:{label:s.viewPrivacy.public,value:s.viewPrivacy.public}},h.makeField("addToPermissionSet","Add Page To AG Users Permission Set","Created Page will be added to ActionGrid Users Permission Set","boolean",!0),h.makeField("inlineEdit","Inline Edit Mode","Created Views will have Edit Mode enabled","boolean",!0),h.makeField("readingPane","Reading Pane","Created Views will have the Reading Pane visible","boolean",!0),h.makeField("toolbar","Toolbar","Created Views will have the Toolbar visible","boolean",!0)],i.entry("New ActionGrid From List View",fields,{width:500},null,d)}})},createViewsFromListView:function(e,a,i){var o=n.getNamespace(!0),r=e.listviews.length,l=[];Object.each(e.listviews,function(d){c.getListView(e.sobjectType,d.id,function(c){var u=new sforce.SObject(o+"GridView__c");u.Name=d.label,u[o+"JSON__c"]=escape(JSON.stringify(h.convertListView(c,i))),u[o+"ObjectName__c"]=e.sobjectType,u[o+"Privacy__c"]=i.privacy,u[o+"IsDefault__c"]=!1,u[o+"Description__c"]=kendo.format("View based on List View '{0}'",d.label),u[o+"Context__c"]=s.viewContext.vfPage,l.push(u),l.length==r&&n.insert(l,a,function(e){t.popup("Error","Unexpected error saving view: "+e),h.hideLoader()})},function(e){console.log(e),r--,l.length==r&&r>0?n.insert(l,a,function(e){t.popup("Error","Unexpected error saving view: "+e),h.hideLoader()},!0):a()})})},parseCustomTabs:function(e,i){for(var n=[],o=[],r=e.tab,s=0;s<r.length;s+=10)a.getCustomTab(r.slice(s,s+10),function(a){if(n=n.concat(a.records),n.length==r.length){if(Object.each(n,function(e){var t;if("true"==e.customObject)try{t=sforce.connection.describeSObject(e.fullName),o.push(t)}catch(e){}else if(0==e.fullName.indexOf("standard-")){var a=e.fullName.split("standard-")[1];try{t=sforce.connection.describeSObject(a),o.push(t)}catch(e){}}t&&(e.objDesc=t)}),0==o.length)return t.popup("No Usable Tabs!","The selected App doesn't have any tabs that can be converted!."),void h.hideLoader();i(o,e,n)}})},createReportGrid:function(e,r,l,d){var u=function(u){var f;if(e){f=h.getPageName(l).name.replace("/","_");var m=n.query("select Id from ApexPage where Name LIKE '{0}%' AND NamespacePrefix = null",f);m.length>0&&(f+=m.length+1)}else u&&(f=u.name.value);var g=u?u.report.value:r,v=!u||u.createPage.value,b=u?u.label.value:l,y=!u||u.addToPermissionSet.value;c.getReport(g,function(e){var r=e.reportMetadata.reportType.type;r.indexOf("__c")==r.length-3&&(r=r.replace("__c","")),a.getReportType(r,function(r){var l=n.getNamespace(!0),c=e.reportMetadata.detailColumns,u=c.concat(e.reportMetadata.reportFilters.map(function(e){return e.column})),m=e.reportMetadata.reportType.type;r.records&&"true"!=r.records["xsi:nil"]?m=r.records.baseObject:m.indexOf("$")>-1?m=m.split("$")[1]:m.lastIndexOf("List")==m.length-4&&(m=m.substring(0,m.lastIndexOf("List")));var g=n.getSObjectDescribe(m),k=g.fields.map(function(e){return{label:e.referenceTo?e.referenceTo+" ("+e.label+")":e.label,value:e.name}}).sort(function(e,t){return e.label.localeCompare(t.label)}),w=function(i){var o={};Object.each(u,function(e){var t=i[e.replace(m+".","")];if(!t){var a=e.replace(".","__parent__");t=i.hasOwnProperty(a)?i[a]:i[e.replace(".","__unrec__")]}o[e]={name:t.value}});var r=h.convertReport(m,e,o),c=new sforce.SObject(l+"GridView__c");c.Name=e.reportMetadata.name,c[l+"JSON__c"]=escape(JSON.stringify(r)),c[l+"ObjectName__c"]=r.objectName,c[l+"Privacy__c"]=s.viewPrivacy.public,c[l+"IsDefault__c"]=!1,c[l+"Description__c"]=kendo.format("View based on Report '{0}'",e.reportMetadata.name),c[l+"Context__c"]=s.viewContext.vfPage,n.insert(c,function(e){if(v){var i={pageLabel:b,sideBar:!1,showHeader:!0,objectName:r.objectName,enableNewButton:!0,enableNewInline:!0,enableEdit:!0,enableActions:!0,enableFieldChooser:!0,enableStickyViews:!0,enableToolbar:!0,enableViews:!0,enableFormatting:!0,enableReadingPane:!0,viewID:e.id};d?a.createVFPage(f,i,!1,function(e){if("true"==e.success){var a=e.fullName,i=n.query("select Id from ApexPage where Name = '{0}'",a);i.length>0&&(i=i[0].Id),y&&h.getAGPermissionSetId(function(o){var r=new sforce.SObject("SetupEntityAccess");r.ParentId=o,r.SetupEntityId=i,n.insert(r,function(t){h.hideLoader(),d(a,e,t)},function(e){t.popup("Error","Unexpected error adding page to Permission Set: "+e),h.hideLoader()})})}else t.popup("VisualForce Page Error","VisualForce page not created: "+e.errors.message);h.hideLoader()},function(e,a){h.hideLoader(),t.popup("VisualForce Code",'Copy the following to a new Visual Force Page: <br /><textarea cols="100" rows="10">'+a+"</textarea>")}):h.createVFPagePrompt(f,i,!1,y)}p.showMessage({title:"Success",message:"Successfully created Report View"},"success"),h.hideLoader()},function(e){t.popup("Error","Unexpected error saving view: "+e),h.hideLoader()})},x=[],I={},S=[],C=function(){};Object.each(u,function(t){var a=t.replace(m+".","");switch(0==t.indexOf(m.toUpperCase())&&(a=t.replace(m.toUpperCase()+".","")),a){case"CUST_NAME":a="Name";break;case"CUST_ID":a="Id";break;case"CUST_LAST_UPDATE":a="LastModifiedDate";break;case"CUST_CREATED_DATE":case"CREATED_DATE":a="CreatedDate";break;case"CUST_CREATED_NAME":a="CreatedById";break;case"CUST_OWNER_ROLE":a="Owner.UserRole.Name";break;case"CUST_CURRENCY_ISO_CODE":a="CurrencyIsoCode";break;case"USERS.NAME":a="Owner.Name"}if(Object.each(g.fields,function(i){a==i.name&&(I[t]={field:i,score:-1});var n=t.toLowerCase().distance(i.name.toLowerCase()),o=e.reportExtendedMetadata.detailColumnInfo[t];if(o){var r=e.reportExtendedMetadata.detailColumnInfo[t].label.toLowerCase().distance(i.label.toLowerCase());r<n&&(n=r)}(!I[t]||I[t].score>n)&&(I[t]={field:i,score:n})}),S.indexOf(a)<0){var i=e.reportExtendedMetadata.detailColumnInfo[t],r=I[t].field.name;if(a.indexOf(".")>-1){var s=a.split(".");try{Object.each(g.fields,function(e){if(e.relationshipName&&e.relationshipName.toLowerCase()==s[0].toLowerCase()){t=t.replace(".","__parent__");var a=n.getSObjectDescribe(e.referenceTo),i=Object.first(a.fields,function(e){return e.name.toLowerCase()==s[1].toLowerCase()});r=e.relationshipName+"."+i.name||r}})}catch(e){console.log(e)}}if(S.indexOf(a)>-1)return;t=t.replace(".","__unrec__"),x.push({name:t,label:i?i.label:a,type:"custom",values:k,getValue:function(){return $("#"+t+"_"+this.unique+"__text").val()},init:function(e,a){this.unique=a;var i=$(String.format("<input style='width:calc(97% - 37px);' id='{0}' value=\"{1}\" />",t+"_"+a+"__text",r));i.kendoMaskedTextBox(),e.append(i);var n=$("<span>");n.kendoButton({spriteCssClass:"k-icon k-i-hbars",click:function(){var e=$('<div id="'+t+"_"+a+'__fcWin" />');e.append('<div id="'+t+"_"+a+'__fcDiv" />'),$("body").append(e);var i=Object.create(o);i.init({elementId:"#"+t+"_"+a+"__fcDiv",delegate:{dataBound:C,getColumns:function(e){return e.unshift({attributes:{style:"text-align: center;"},title:e[0].title,filterable:!1,sortable:!1,width:50,headerTemplate:"Map",template:function(e){var i=e.name;if(e.isChild===!0){for(var n=e.parentModel,o=[],r=["objectnode","readingpanenode","detailgridnode","chartnode"];n&&r.indexOf(n.type)==-1;)o.unshift(n.relationshipName),n=n.parentModel;i=kendo.format("{0}.{1}",o.join("."),i)}var s='<input type="radio" name="selectedMappedValue" value="'+i+'" onclick="$(\'#'+t+"_"+a+"__text').val('"+i+"');  $('#"+t+"_"+a+"__fcWin').data('kendoWindow').close();\" />";return s}}),e}},objectName:m,objectLabel:g.label,overrideSecurity:!0,hideRootNodes:!0,expandFK:!0}),e.kendoWindow({width:.8*$(window).height(),height:.8*$(window).width(),draggable:!0,modal:!0,resizable:!0,actions:["Close"],title:"Map Column",maxHeight:$(window).height()-100,maxWidth:$(window).width()-100,close:function(e){this.destroy()}}).data("kendoWindow").center().open(),i.refresh()}}),e.append(n)},value:r}),S.push(a)}}),i.entry("Map Columns",x,{width:500},null,w)})},console.log)};e?h.showLoader(u):h.promptForReports(u)},convertReport:function(e,t,a){var i=void 0;if(t.reportMetadata.detailColumns){i={objectName:e,editable:!0,columns:[],toolbarState:h.getDefaultToolbarState()},t.reportMetadata.scope&&(i.scope=t.reportMetadata.scope);var n=function(t){var i=t.replace(e+".",""),n=a[t];return n&&(i=n.name,n.relationshipName&&(i=n.relationshipName+".Name")),i};Object.each(t.reportMetadata.detailColumns,function(e){var t=n(e);t&&i.columns.push(t)}),i.filter={logic:"and",filters:[{logic:"and",filters:[]}]};var o={equals:"eq",notEqual:"neq",like:"contains",greaterThanOrEqualTo:"gte",greaterThan:"gt",lessThan:"lt",lessOrEqual:"lte"},r={filters:[],logic:"and"};t.reportMetadata.reportFilters&&t.reportMetadata.reportFilters.length>0&&(r.filters=t.reportMetadata.reportFilters.map(function(e){return{field:n(e.column),operator:o[e.operator]||e.operator,value:e.value}}));var s=t.reportMetadata.reportBooleanFilter;if(s){var l=f.parseBooleanExpression(s.toUpperCase());r=m.evaluateBooleanFilterLogic(l,r.filters)}i.filter.filters[0]=r}return i},promptForReports:function(e){var t="";fields=[{name:"report",label:"Report",type:"combobox",values:new kendo.data.DataSource({serverFiltering:!0,transport:{read:function(e){filterText="",e.data.filter.filters&&e.data.filter.filters.length>0&&(filterText=e.data.filter.filters[0].value);var t=n.query("select Id, Name, FolderName from Report where Name like '%{0}%' LIMIT 50",filterText);e.success(t.map(function(e){return{label:e.FolderName+"/"+e.Name,value:e.Id}}))}}}),change:function(e,t){if($("#report_"+t).data("kendoComboBox")){$("#label_"+t)[0].value=h.getPageName(h.objectName+" "+$("#report_"+t).data("kendoComboBox").text()).label,$("#name_"+t)[0].value="";try{DeveloperNameInputElement.setName($("#label_"+t)[0],$("#name_"+t)[0])}catch(e){$("#name_"+t)[0].value=$("#label_"+t)[0].value}}}},{name:"createPage",label:"Create VF Page?",type:"boolean",help:"Create a visual force page for the view",value:!0,change:function(e,t){var a=$("#createPage_"+t)[0].checked;$("#label_"+t).data("kendoMaskedTextBox").enable(a),$("#name_"+t).data("kendoMaskedTextBox").enable(a),a?($("#description_"+t).removeAttr("disabled"),$("#addToPermissionSet_"+t).removeAttr("disabled")):($("#description_"+t).attr("disabled",!0),$("#addToPermissionSet_"+t).attr("checked",!1),$("#addToPermissionSet_"+t).attr("disabled",!0))}},{name:"label",label:"Label",type:"text",maxLength:80,value:t.label,change:function(e,t){$("#name_"+t)[0].value="";try{DeveloperNameInputElement.setName(e.target,$("#name_"+t)[0])}catch(e){$("#name_"+t)[0].value=e.target.value}}},{name:"name",label:"Name",type:"text",maxLength:40,validate:h.checkPageNameFunctionFactory(!0),value:t.name},h.makeField("description","Description",void 0,"textarea"," "),h.makeField("addToPermissionSet","Add Page To AG Users Permission Set","Created Page will be added to ActionGrid Users Permission Set","boolean",!0)],i.entry("New ActionGrid From Report",fields,{width:500},null,e)},getAllReports:function(e){a.listFolders("Report",function(t){var i=t.result.length,n=0,o=[];Object.each(t.result,function(t){a.listReports(t.fullName,function(t){n++,t.result instanceof Array?o=o.concat(t.result):t.result&&o.push(t.result),i==n&&e(o)})})})},getAppLabel:function(e){var t=e.fullName;if(e.label)t=e.label;else{var a={standard__AppLauncher:"App Launcher",standard__Chatter:"Salesforce Chatter",standard__Community:"Community",standard__Content:"Content",standard__Marketing:"Marketing",standard__Platform:"Platform",standard__Sales:"Sales",standard__Service:"Service",standard__ServiceConsole:"Service Console",standard__Sites:"Site.com",standard__Work:"Call Center"};t=a[e.fullName]||t}return t.indexOf("__")>-1&&(t=t.split("__")[1]),t},createCustomAppGrid:function(e,o){var r=function(e){h.showLoader(function(){var i=[],r=e.appName.value,l=!e.createViews||e.createViews.value,d=!!e.convertTabs&&e.convertTabs.value,u=!e.addToPermissionSet||e.addToPermissionSet.value,f=e.privacy?e.privacy.value.value:s.viewPrivacy.public,m=!e.inlineEdit||e.inlineEdit.value,g=!!e.readingPane&&e.readingPane.value,v=!e.toolbar||e.toolbar.value,b=function(r,s,b){var y,k=0;y=d?h.multiTabPageFunctionFactory(r.length,!1,void 0,u):function(e,i,r){for(var l=[],d=0;d<b.length;d++)b[d].objDesc?l.push("ag_"+b[d].objDesc.name.replace("__c","")):l.push(b[d].fullName);var c=s.fullName;c.indexOf("__")>-1&&(c=c.split("__")[1]);var u={label:h.getAppLabel(s)+" (AG)",tab:l};a.createCustomApplication(c+"_ag",u,function(e){if("true"==e.success){h.logItem("Inserted","CustomApplication",u,e,!0);var a=n.query("SELECT ApplicationId FROM AppMenuItem WHERE Name = '"+e.fullName+"'");if(0==a.length)return t.popup("Error","Unexpected error creating App: "+error),void h.hideLoader();h.getAGPermissionSetId(function(e){var i=new sforce.SObject("SetupEntityAccess");i.ParentId=e,i.SetupEntityId=a[0].ApplicationId,n.insert(i,function(){o?o(u,a[0].ApplicationId):t.popup("Success","Successfully created AG App!"),h.hideLoader()},function(e){t.popup("Error","Unexpected error adding App to Permission Set: "+e)})})}})};for(var w=function(o,s){var b;if(d)b=function(t,a,n){return function(o){var r={pageLabel:escapeHTML(a.label),objectName:a.name,delayLoad:i.length>0,enableNewButton:!0,enableNewInline:!0,enableEdit:!0,enableActions:!0,enableFieldChooser:!0,enableStickyViews:!0,enableToolbar:!0,enableViews:!0,enableFormatting:!0,enableReadingPane:!0,viewID:""};i[t]=r,n(i,e)}}(o,s,y);else{var w=function(e){if("true"==e.success){var a=function(){var t={FullName:"ag_"+s.name.replace("__c",""),Metadata:{label:s.label+" (AG)",page:e.fullName,motif:"Custom71: Headset"}};h.createCustomTab(t,u,function(t){console.log(arguments),k++,i[o]=e,k==r.length&&y(i)}),p.showMessage({title:"Success",message:"Successfully added page to Permission Set"},"success")},l=e.fullName,d=n.query("select Id from ApexPage where Name = '{0}'",l);d.length>0&&(d=d[0].Id),d&&(l=String.format('<a href="/{0}" target="_blank">{1}</a>',d,l)),u?h.getAGPermissionSetId(function(e){var i=new sforce.SObject("SetupEntityAccess");i.ParentId=e,i.SetupEntityId=d,n.insert(i,a,function(e){t.popup("Error","Unexpected error adding page to Permission Set: "+e)})}):a()}else k++,t.popup("VisualForce Page Error","VisualForce page not created: "+e.errors.message);h.hideLoader()};b=function(){var e={pageLabel:escapeHTML(s.label),sideBar:!1,showHeader:!0,objectName:s.name,enableNewButton:!0,enableNewInline:!0,enableEdit:!0,enableActions:!0,enableFieldChooser:!0,enableStickyViews:!0,enableToolbar:!0,enableViews:!0,enableFormatting:!0,enableReadingPane:!0,viewID:""},i=s.name.replace("__c","");i.indexOf("__")>0&&(i=i.split("__")[1]),i="AG_"+i,i=i.slice(0,38);var o=n.query("select Id from ApexPage where Name LIKE '{0}%'",i);i+=o.length>0?o.length:"",a.createVFPage(i,e,!1,w,function(e,a){h.hideLoader(),t.popup("VisualForce Code",'Copy the following to a new Visual Force Page: <br /><textarea cols="100" rows="10">'+a+"</textarea>")})}}l?c.getListViews(s.name,function(e){e.listviews.length>0?(settings={privacy:f,editable:m,readingPane:g,toolbar:v},h.createViewsFromListView(e,b,settings)):b()},function(e){console.log(e),t.popup("Error","Unexpected error: "+e),h.hideLoader()}):b()},x=0;x<r.length;x++){var I=r[x];n.getNamespace(!0);w(x,I)}};a.getCustomApplication(r,function(e){return e.records&&e.records.tab?void h.parseCustomTabs(e.records,b):void console.log("nothing to do here!")})})};if(e)r({appName:{value:e}});else{var l=function(e){e=e.sort(function(e,t){return e.label.localeCompare(t.label)}),fields=[];var t=h.getPageName(e[0].fullName);if(e.length>1){var a={name:"appName",label:"App",type:"picklist",required:!0,validate:i.requiredValidation,values:e.map(function(e){return{label:e.label,value:e.fullName}}),change:function(e,t){if($("#appName_"+t).data("kendoDropDownList")){$("#label_"+t)[0].value=h.getPageName($("#appName_"+t).data("kendoDropDownList").text()).label,$("#name_"+t)[0].value="";try{DeveloperNameInputElement.setName($("#label_"+t)[0],$("#name_"+t)[0])}catch(e){$("#name_"+t)[0].value=$("#label_"+t)[0].value}}}};fields.push(a)}var n=[];Object.each(s.viewPrivacy,function(e){n.push({label:e,value:e})}),fields=fields.concat([h.makeField("convertTabs","Convert To MultiTab","Convert App to VisualFore MultiTab Grid","boolean"," "),{name:"label",label:"Label",type:"text",required:!0,maxLength:80,value:t.label,validate:i.requiredValidation,change:function(e,t){$("#name_"+t)[0].value="";try{DeveloperNameInputElement.setName(e.target,$("#name_"+t)[0])}catch(e){$("#name_"+t)[0].value=e.target.value}}},{name:"name",label:"Name",type:"text",required:!0,maxLength:40,validate:h.checkPageNameFunctionFactory(),value:t.name},h.makeField("description","Description",void 0,"textarea"," "),h.makeField("createViews","Create Views","Create AG Views based on ListView","boolean"," "),{name:"privacy",label:"Privacy",type:"picklist",values:n,value:{label:s.viewPrivacy.public,value:s.viewPrivacy.public}},h.makeField("inlineEdit","Inline Edit Mode","Created Views will have Edit Mode enabled","boolean",!0),h.makeField("readingPane","Reading Pane","Created Views will have the Reading Pane visible","boolean",!0),h.makeField("toolbar","Toolbar","Created Views will have the Toolbar visible","boolean",!0),h.makeField("addToPermissionSet","Add Page To AG Users Permission Set","Created Page will be added to ActionGrid Users Permission Set","boolean",!0)]),i.entry("New ActionGrid App",fields,{width:500},null,r)};h.getCustomApplications(l)}},getCustomApplications:function(e){
a.listCustomApplications(function(t){var i=[],n=t.result.map(function(e){return e.fullName}),o=function(t){a.getCustomApplication(n.slice(10*t,10*t+10),function(a){i=i.concat(a.records),i.length<n.length?o(t+1):(Object.each(i,function(e){e.label=h.getAppLabel(e)}),e(i))})};o(0)})},getReadOnlyObjects:function(e){return{OpenActivity:[{sobject:"Task",label:"Tasks",Name:"Tasks",field:e},{sobject:"Event",label:"Events",Name:"Events",field:e}],CombinedAttachment:[{sobject:"Note",label:"Notes",Name:"Notes",field:"ParentId"},{sobject:"Attachment",label:"Attachments",Name:"Attachments",field:"ParentId"}],ActivityHistory:[{sobject:"Task",label:"Tasks",Name:"Tasks",field:e},{sobject:"Event",label:"Events",Name:"Events",field:e}]}},getFieldSplitMap:function(){return{Contact:{Name:[{field:"FirstName"},{field:"LastName"}]},CampaignMember:{_default_columns:[{field:"",lookupId:!0,name:"Campaign.Name"},{field:"",lookupId:!0,name:"Contact.Name"},{field:"",lookupId:!0,name:"Lead.Name"},{field:"",lookupId:!0,name:"Status"}]}}},createMultiTabAuto:function(){var e=[],o={},r=[],l=function(a){h.showLoader(function(){var i,l=[],d=[];i=a.layout?o[a.layout.value]:o[r[0]];var c=["Contact","Lead"].indexOf(h.objectName)>-1?"WhoId":"WhatId";"Account"==h.objectName&&(c="AccountId");var u=h.getReadOnlyObjects(c);i.relatedLists instanceof Array||(i.relatedLists=[i.relatedLists]),Object.each(i.relatedLists,function(e){if(e){var t=[e];u[e.sobject]&&(t=u[e.sobject]),Object.each(t,function(e){for(var t=!1,a=0;a<d.length;a++)if(d[a].sobject==e.sobject){t=!0;break}t||d.push(e)})}});for(var f=h.getFieldSplitMap(),m=0;m<d.length;m++)if(f[d[m].sobject]){var g=f[d[m].sobject],v=[];if(g._default_columns)v=v.concat(g._default_columns);else for(var b=0;b<d[m].columns.length;b++){var y=d[m].columns[b],k=y.field.replace(d[m].sobject+".","");y.lookupId&&(k=y.name),g[k]?v=v.concat(g[k]):v.push(y)}d[m].columns=v}var w=h.multiTabPageFunctionFactory(d.length,!0,h.objectName,a.addToPermissionSet.value);if(0==d.length)return t.popup("No Related Lists!","The selected Page Layout has no Related Lists."),void h.hideLoader();i.relatedLists instanceof Array||(i.relatedLists=[i.relatedLists]);for(var b=0;b<d.length;b++){var x=d[b],I="";if(x.columns){x.columns instanceof Array||(x.columns=[x.columns]);var S={objectName:x.sobject,editable:!0,columns:[],toolbarState:h.getDefaultToolbarState()};Object.each(x.columns,function(e){var t=e.field.replace(x.sobject+".","");e.lookupId&&(t=e.name),S.columns.push(t)}),I=escape(JSON.stringify(S))}var C=function(t,i){return function(o){var r={pageLabel:escapeHTML(i.label),objectName:i.sobject,FKName:i.field,delayLoad:l.length>0,enableNewButton:!0,enableNewInline:!0,enableEdit:!0,enableActions:!0,enableFieldChooser:!0,enableStickyViews:!0,enableToolbar:!0,enableViews:!0,enableFormatting:!0,enableReadingPane:!0,viewID:""};a.hardcodeView.value&&o&&(r.viewID=o.id);var s=n.getSObjectDescribe(i.sobject);s.getBoolean("queryable")||(r.relationshipName=i.name),null!=r.FKName&&(l[t]=r),a.addToLayout.value?w(l,a,function(t,a,i,n){var o=e.filter(function(e){return e.Id==D})[0].Name;h.addPageToLayout(h.objectName+"-"+o,i[0].Name,function(e){p.showMessage({title:"Successfully Added Page ",message:String.format('"{0}" to layout "{1}".',i[0].Name,o)},"success")}),h.successVFCodePrompt(a,i[0].Id,!0,i.length>1,n>0)}):w(l,a)}};if(a.hardcodeView.value||a.defaultView.value){var N,_=n.getNamespace(!0),T=a.defaultView.value,D=a.layout?a.layout.value:r[0],O=x.label+" - Related List",R=x.label+" - All",j=n.query("SELECT Id, Name,{0}ObjectName__c, {0}IsDefault__c FROM {0}GridView__c where  IsDeleted = false AND (Name like '{1}%' or Name like '{2}%' or ({0}ObjectName__c = '{3}' and {0}isDefault__c = true))",_,O,R,x.sobject),P=0,E=0;if(j.length>0){for(var m=0;m<j.length;m++)j[m].Name.indexOf(O)>-1&&(P++,N=j[m].Id),j[m].Name.indexOf(R)>-1&&E++,j[m][_+"ObjectName__c"]==x.sobject&&j[m][_+"IsDefault__c"]&&(T=!1);P>0&&(O+=" ("+(P+1)+")"),E>0&&(R+=" ("+(E+1)+")")}if(0==P){var F=[];F[0]=new sforce.SObject(_+"GridView__c"),F[0].Name=O,F[0][_+"JSON__c"]=I,F[0][_+"ObjectName__c"]=x.sobject,F[0][_+"Privacy__c"]=s.viewPrivacy.public,F[0][_+"IsDefault__c"]=T,F[0][_+"Description__c"]=kendo.format("Default view for Related List '{0}'",a.name.value),F[0][_+"Context__c"]=s.viewContext.pageLayout,0==E&&(F[1]=new sforce.SObject(_+"GridView__c"),F[1].Name=R,F[1][_+"JSON__c"]=I,F[1][_+"ObjectName__c"]=x.sobject,F[1][_+"Privacy__c"]=s.viewPrivacy.public,F[1][_+"IsDefault__c"]=T&&0==E,F[1][_+"Description__c"]=kendo.format("Default view for '{0}'",x.sobject),F[1][_+"Context__c"]=s.viewContext.explorer),n.insert(F,C(b,x),function(e){t.popup("Error","Unexpected error saving view: "+e)})}else C(b,x)({id:N})}else C(b,x)()}})},d=n.getDescribeLayout(h.objectName);d.layouts instanceof Array?Object.each(d.layouts,function(e){o[e.id]=e,r.push(e.id)}):(o[d.layouts.id]=d.layouts,r.push(d.layouts.id)),a.getLayoutNames(r,function(t){e=t,fields=[];var a=h.getPageName(e[0].Name);e.length>1&&fields.push({name:"layout",label:"Page Layout",type:"picklist",required:!0,validate:i.requiredValidation,values:e.map(function(e){return{label:e.Name,value:e.Id}}),change:function(e,t){if($("#layout_"+t).data("kendoDropDownList")){$("#label_"+t)[0].value=h.getPageName($("#layout_"+t).data("kendoDropDownList").text()).label,$("#name_"+t)[0].value="";try{DeveloperNameInputElement.setName($("#label_"+t)[0],$("#name_"+t)[0])}catch(e){$("#name_"+t)[0].value=$("#label_"+t)[0].value}}}}),fields=fields.concat([{name:"label",label:"Label",type:"text",required:!0,maxLength:80,value:a.label,validate:i.requiredValidation,change:function(e,t){$("#name_"+t)[0].value="";try{DeveloperNameInputElement.setName(e.target,$("#name_"+t)[0])}catch(e){$("#name_"+t)[0].value=e.target.value}}},{name:"name",label:"Name",type:"text",required:!0,maxLength:40,validate:h.checkPageNameFunctionFactory(),value:a.name},h.makeField("description","Description",void 0,"textarea"," "),h.makeField("defaultView","Make views Default?",void 0,"boolean",!0),h.makeField("hardcodeView","Hardcode views in the VF Page?",void 0,"boolean",!0),h.makeField("addToLayout","Add Page To Layout?","Add the created grid to the selected page layout?","boolean",!1),h.makeField("addToPermissionSet","Add Page To AG Users Permission Set","Created Page will be added to ActionGrid Users Permission Set","boolean",!0)]),i.entry("New ActionGrid Related Lists MultiTab",fields,{width:500},null,l)})},addPageToLayout:function(e,t,i){a.readPageLayout(e,function(n){var o,r=n.records,s={height:"500",page:t,showLabel:"false",showScrollbars:"false",width:"100%"};Object.each(r.layoutSections,function(e){"CustomLinks"!=e.style&&(o=e)});var l=o.layoutColumns;l instanceof Array&&(l=l[l.length-1]),l.layoutItems instanceof Array||(l.layoutItems=[l.layoutItems]),l.layoutItems.push(s),a.updatePageLayout(e,r,i,i)})},createMyRecentView:function(){var e=n.getNamespace(!0),a=["'Visualforce Page'","'Explorer'"];c.getSObjectDescribe(h.objectName,function(i){var n=String.format("select {0}JSON__c, Name, Id from {0}GridView__c where {0}ObjectName__c = '{1}' and {0}Context__c in ({2}) and {0}IsDefault__c = true and isDeleted = false",e,h.objectName,a.join(","));c.query(n,function(a){if(a.length<1)t.popup("Error!",String.format("Please create a Default View for {0} in order to use those fields for this view.",h.objectLabel));else{var n=JSON.parse(unescape(a[0][e+"JSON__c"])),o=["Owner.Name","LastViewedDate"];Object.each(o,function(e){n.columns.indexOf(e)<0&&n.columns.push(e)});var r={objectName:h.objectName,columns:n.columns,sorts:[{field:"LastViewedDate",dir:"desc"}],filter:{logic:"and",filters:[{logic:"and",filters:[{field:"Owner.Name",operator:"dynamic",value:"me"},{field:"LastViewedDate",operator:"gt",value:"LAST_WEEK"}]}]}};h.createView(h.objectName,"My Recently Viewed "+i.labelPlural,r,"publicReadOnly",!1,kendo.format("My Recently Viewed {0}",h.labelPlural),"explorer")}})})},createView:function(e,a,i,o,r,l,d,c){var u;i&&(u=escape(JSON.stringify(i)));var f=n.getNamespace(!0),m=new sforce.SObject(f+"GridView__c");m.Name=a?a:e,m[f+"JSON__c"]=u,m[f+"ObjectName__c"]=e,m[f+"Privacy__c"]=o?s.viewPrivacy[o]:s.viewPrivacy.private,m[f+"IsDefault__c"]=!!r,m[f+"Description__c"]=l,m[f+"Context__c"]=d?s.viewContext[d]:s.viewContext.pageLayout,n.insert(m,function(t){if(c)c(t);else{var i=String.format('<a href="/{0}" target="_blank">{1}</a>',t.id,a?a:e);p.showMessage({title:"Success",message:String.format('Successfully created "{0}".',i)},"success")}},function(e){c?c(e):t.popup("Error","Unexpected error saving view: "+e)})},getAvailableViews:function(e,t){var a=n.getSavedViews(e,t),i=[{label:"",value:""},{label:"*Create new view for this Page",value:1}];return Object.each(a,function(e){i.push({label:e.Name,value:e.Id})}),i},makeField:function(e,t,a,i,n){var o={name:e,label:t?t:e,type:i?i:"boolean",value:void 0==n||n};return a&&(o.help=a),o},getFieldOrganizer:function(){return{fields:{},fieldOrder:[],get:function(e){return this.fields[e]},getFields:function(){var e=this;return this.fieldOrder.map(function(t){return e.fields[t]})},push:function(e){if(e instanceof Array){var t=this;Object.each(e,function(e){t.push(e)})}else this.fields[e.name]=e,this.fieldOrder.push(e.name);return this},remove:function(e){var t=this.fieldOrder.indexOf(e);if(t>-1){var a=this.fields[e];return this.fieldOrder.splice(t,1),delete this.fields[e],a}},setField:function(e,t,a){return this.fields[e][t]=a,this},insert:function(e,t){return this.fields[e.name]=e,this.fieldOrder.splice(t,0,e.name),this}}},createVFPage:function(e,o){var r,l,d,c=[],u=!0,f=this,m=function(t,a){var i=t,n=a?" ":"_";return 0!==t.indexOf("AG_")&&(i="AG"+(o?n+"MultiTab":""),void 0!==t&&t.length>0&&(e?i="AG"+n+t+n+"Related"+n+"List":i+=n+t)),i.lastIndexOf("_")==i.length-1&&(i=i.slice(0,i.length-2)),i},g=h.getFieldOrganizer();if(g.push([{name:"label",label:"Label",type:"text",required:!0,maxLength:80,change:function(e,t){if($("#name_"+t).length>0){$("#name_"+t)[0].value="";try{DeveloperNameInputElement.setName(e.target,$("#name_"+t)[0])}catch(e){$("#name_"+t)[0].value=e.target.value}0!==$("#name_"+t)[0].value.indexOf("AG_")&&($("#name_"+t)[0].value="AG_"+$("#name_"+t)[0].value.slice(0,37))}},validate:i.requiredValidation},{name:"name",label:"Name",type:"text",required:!0,maxLength:40,validate:h.checkPageNameFunctionFactory()},h.makeField("enableNewButton","Enable New Button","Display the button to create a new object"),h.makeField("enableNewInline","Enable New Inline","Display the button to create a new object within the ActionGrid"),h.makeField("enableEdit","Enable Edit Button","Display the edit button"),h.makeField("enableActions","Enable Actions","Enable Action Menu on ActionGrid results"),h.makeField("enableFieldChooser","Enable Field Chooser","Allow user to customize displayed fields"),h.makeField("enableStickyViews","Enable Sticky Views","Remember the last configured view for the user"),h.makeField("enableToolbar","Enable Toolbar","Display the ActionGrid toolbar buttons"),h.makeField("enableViews","Enable Views","Enables View options on the toolbar"),h.makeField("enableFormatting","Enable Formatting","Allow user to apply conditional formatting to the ActionGrid"),h.makeField("enableReadingPane","Enable Reading Pane","Enables the Reading Pane on the toolbar")]),e){var v=n.getSObjectDescribe(h.objectName),b=[];d=Array.orderBy(v.childRelationships,function(e){return e.relationshipName});var y=n.getDescribeGlobal().getArray("sobjects"),k=[];Object.each(y,function(e){!e.getBoolean("deprecatedAndHidden")&&e.getBoolean("queryable")&&e.getBoolean("retrieveable")&&k.push(e.name)}),Object.each(d,function(e,t){k.indexOf(e.childSObject)>-1&&b.push({value:t,label:kendo.format("{0} ({1})",(e.relationshipName?e.relationshipName:e.childSObject).prettifyAPIName(),e.field)})}),b=Array.orderBy(b,function(e){return e.label});var w=function(t,a){Object.each(d,function(i,n){if(t.target&&n===t.target.value){$("#viewID_"+a).data("kendoDropDownList").setDataSource(f.getAvailableViews(i.childSObject,e));var o=(i.relationshipName?i.relationshipName:i.childSObject).prettifyAPIName();$("#label_"+a).val(o).blur()}})};g.insert({name:"viewID",label:"Default View",type:"picklist",values:f.getAvailableViews(d[0].childSObject,e),help:"If a specific grid view is required, specify the id"},0),l="New Related List";var x=d[0].relationshipName?d[0].relationshipName:d[0].childSObject;o&&(x=h.objectName);var I=n.query("select Id from ApexPage where Name LIKE '{0}%'",m(x)),S=x.prettifyAPIName()+(I.length>0?I.length:"");g.setField("label","value",m(x.prettifyAPIName(),!0)+(I.length>0?I.length:"")),g.setField("name","value",(m(x)+(I.length>0?I.length:"")).replace(/ /g,"_").replace(/__/g,"_").slice(0,40)),g.setField("name","required",!1).setField("label","required",!1),g.insert({name:"relationship",label:"Select Relationship",type:"picklist",values:b,change:w},0),g.push(h.makeField("addToPermissionSet","Add Page To AG Users Permission Set","Created Page will be added to ActionGrid Users Permission Set","boolean",!0));var C=String.format("To configure the New Button to pass in defaults values from the Parent {0} refer to the <a target='new' href='https://support.getconga.com/Conga_ActionGrid/ActionGrid_Essentials/ActionGrid_Configuration/04ActionGrid_Buttons'>documentation here</a>.",v.label);g.push({label:"",type:"html",html:C})}else{Object.each(n.getAvailableObjects(),function(e){c.push({value:e.name,label:e.labelPlural})});var x="global"==h.objectName?"":h.objectName,I=n.query("select Id from ApexPage where Name LIKE '{0}%'",m(x)),S=x+(I.length>0?I.length:"");g.setField("label","value",m(S,!0)).setField("name","value",m(S).replace(/ /g,"_").replace(/__/g,"_").slice(0,40)),l="New ActionGrid Page",o?g.insert({name:"viewID",label:"Default View",type:"picklist",values:f.getAvailableViews(c[0].value,e),help:"If a specific grid view is required, specify the id"},0):(g.insert({name:"viewID",label:"Default View",type:"picklist",values:f.getAvailableViews("global"==h.objectName?"":h.objectName,e),help:"If a specific grid view is required, specify the id"},0),g.push({name:"sideBar",label:"Show the Side Bar",type:"boolean",value:!1,help:"Shows the SalesForce.com side bar"}),g.push({name:"showHeader",label:"Show the Header",type:"boolean",value:!0,help:"Shows the SalesForce.com header"}),g.push(h.makeField("addToPermissionSet","Add Page To AG Users Permission Set","Created Page will be added to ActionGrid Users Permission Set","boolean",!0)))}var N=[],_={},T=function(e,t,a){var i={},o=e.relationship.value;return Object.each(t,function(t,r){if(r===o){if(!(e.label&&e.label.value&&e.name&&e.name.value)){var s=t.childSObject;s=s.replace("__c",""),s.indexOf("__")>0&&(s=s.split("__")[1]);var l=t.field;l=l.replace("__c",""),l.indexOf("__")>0&&(l=l.split("__")[1]);var d="AG_"+a+"_"+s+"_"+l,c=n.query("select Id from ApexPage where Name LIKE '{0}%'",d);d+=c.length>0?c.length:"",i.pageLabel=e.label.value||d,i.pageName=i.pageName||d.slice(0,40)}var u=n.getSObjectDescribe(t.childSObject);u.getBoolean("queryable")||(i.relationshipName=t.relationshipName),i.objectName=t.childSObject,i.FKName=t.field}}),i},D=function(a,i){if("1"===a.viewID){var o=n.getNamespace(!0),r=new sforce.SObject(o+"GridView__c");r.Name=a.pageLabel,r[o+"ObjectName__c"]=a.objectName,r[o+"Privacy__c"]=s.viewPrivacy.public,r[o+"IsDefault__c"]=!1,r[o+"Description__c"]=kendo.format("Default view for VF page '{0}'",S),r[o+"Context__c"]=e?s.viewContext.pageLayout:s.viewContext.vfPage,n.insert(r,function(e){a.viewID=e.id,i()},function(e){t.popup("Error","Unexpected error saving view: "+e)})}else i()};if(r=function(i){h.showLoader(function(){var r=i.name?i.name.value:"",s={pageLabel:i.label.value,sideBar:i.sideBar&&i.sideBar.value,showHeader:i.showHeader&&i.showHeader.value,enableNewButton:i.enableNewButton.value,enableNewInline:i.enableNewInline.value,enableEdit:i.enableEdit.value,enableActions:i.enableActions.value,enableFieldChooser:i.enableFieldChooser.value,enableStickyViews:i.enableStickyViews.value,enableToolbar:i.enableToolbar.value,enableViews:i.enableViews.value,enableFormatting:i.enableFormatting.value,enableReadingPane:i.enableReadingPane.value,viewID:i.viewID.value};if(o?(s.objectName=i.objectName?i.objectName.value:void 0,s.delayLoad=!0):(u=i.addToPermissionSet.value,s.objectName=h.objectName),e){var l=T(i,d,h.objectName);s.standardController=h.objectName,s.objectName=l.objectName,s.FKName=l.FKName,s.pageLabel&&""!=s.pageLabel||(s.pageLabel=l.pageLabel),l.relationshipName&&(s.relationshipName=l.relationshipName),r&&""!=r||(r=l.pageName)}var c=function(){o?(N.push(s),a.createMultiTabVFPage(_,N,e,function(a){if("true"==a.success){var i=a.fullName,o=n.query("select Id from ApexPage where Name = '{0}'",i);o.length>0&&(o=o[0].Id),o&&(i=String.format('<a href="/{0}" target="_blank">{1}</a>',o,i)),u&&h.getAGPermissionSetId(function(e){var a=new sforce.SObject("SetupEntityAccess");a.ParentId=e,a.SetupEntityId=o,n.insert(a,function(e){p.showMessage({title:"Success",message:"Successfully added page to Permission Set"},"success")},function(e){t.popup("Error","Unexpected error adding page to Permission Set: "+e)})}),h.successVFCodePrompt(i,o,e)}else t.popup("VisualForce Page Error","VisualForce page not created: "+a.errors.message);h.hideLoader()},function(e,a){h.hideLoader(),t.popup("VisualForce Code",'Copy the following to a new Visual Force Page: <br /><textarea cols="100" rows="10">'+a+"</textarea>")})):h.createVFPagePrompt(r,s,e,u)};D(s,c)})},o){var O=function(t){var a={pageLabel:t.label.value,objectName:t.objectName?t.objectName.value:void 0,enableNewButton:t.enableNewButton.value,enableNewInline:t.enableNewInline.value,enableEdit:t.enableEdit.value,enableActions:t.enableActions.value,enableFieldChooser:t.enableFieldChooser.value,enableStickyViews:t.enableStickyViews.value,enableToolbar:t.enableToolbar.value,enableViews:t.enableViews.value,enableFormatting:t.enableFormatting.value,enableReadingPane:t.enableReadingPane.value,viewID:t.viewID.value,delayLoad:N.length>0};if(e){var n=T(t,d,t.objectName);a.objectName=n.objectName,a.FKName=n.FKName,a.pageLabel&&""!=a.pageLabel||(a.pageLabel=n.pageLabel),n.relationshipName&&(a.relationshipName=n.relationshipName)}D(a,function(){N.push(a),i.entry("New ActionGrid MultiTab Page",g.getFields(),{width:500,buttons:R},null,r)})},R=[{name:"addTab",label:"Add Another Tab",click:O},{name:"finish",label:"Save and Finish",click:r},{name:"cancel",label:"Cancel"}],j=[{name:"label",label:"Label",type:"text",required:!0,maxLength:80,validate:i.requiredValidation,change:function(e,t){$("#name_"+t)[0].value="";try{DeveloperNameInputElement.setName(e.target,$("#name_"+t)[0])}catch(e){$("#name_"+t)[0].value=e.target.value}}},{name:"name",label:"Name",type:"text",required:!0,maxLength:40,validate:h.checkPageNameFunctionFactory()},{name:"description",label:"Description",type:"textarea"}];j[1].value=g.get("name").value,j[0].value=g.get("label").value,g.setField("name","value",""),e||(g.insert({name:"objectName",label:"Select Object",type:"picklist",values:c,change:function(t,a){Object.each(c,function(i,n){t.target&&i.value==t.target.value&&($("#viewID_"+a).data("kendoDropDownList").setDataSource(f.getAvailableViews(i.value,e)),$("#label_"+a).val(i.label).blur())})}},0),j.push({name:"sideBar",label:"Show the Side Bar",type:"boolean",value:!1}),j.push({name:"showHeader",label:"Show the Header",type:"boolean",value:!0})),j.push(h.makeField("addToPermissionSet","Add Page To AG Users Permission Set","Created Page will be added to ActionGrid Users Permission Set","boolean",!0)),g.remove("name"),g.remove("addToPermissionSet"),i.entry("New ActionGrid MultiTab Page",j,{width:500},null,function(t){u=t.addToPermissionSet.value,_={pageName:t.name.value,pageLabel:t.label.value,description:t.description.value,sideBar:t.sideBar&&t.sideBar.value,showHeader:t.showHeader&&t.showHeader.value},e&&(_.standardController=h.objectName),i.entry("New ActionGrid MultiTab Page",g.getFields(),{width:500,buttons:R},null,r)})}else i.entry(l,g.getFields(),{width:500},null,r)},navigateLayouts:function(){h.objectName.toLowerCase().indexOf("__c")==h.objectName.length-3?a.getCustomObjectId(h.objectName,function(e){window.open("/"+e+"?setupid=CustomObjects","_blank")}):window.open("/ui/setup/layout/PageLayouts?type="+h.objectName,"_blank")},navigateSearchLayout:function(e){h.objectName.toLowerCase().indexOf("__c")==h.objectName.length-3?a.getCustomObjectId(h.objectName,function(t){t=t.substring(0,15),e?window.open(String.format("/p/setup/layout/ListButtonsEdit?LayoutEntity={0}&setupid=CustomObjects&retURL={1}",t,window.location),"_blank"):window.open(String.format("/p/setup/layout/ListLayoutEdit?LayoutEntity={0}&LayoutType=SearchResult&setupid=CustomObjects&retURL={1}",t,window.location),"_blank")}):e?window.open(String.format("/p/setup/layout/ListButtonsEdit?LayoutEntity={0}&setupid=AccountSearchLayouts&retURL={1}",h.objectName,window.location),"_blank"):window.open(String.format("/p/setup/layout/ListLayoutEdit?LayoutEntity={0}&LayoutType=SearchResult&setupid=AccountSearchLayouts&retURL={1}",h.objectName,window.location),"_blank")},saveHandlerFactory:function(e){return function(i){i.sender.enable(!1),h.showLoader(function(){var n;"explorer"==e?h.setSetting("globalObject",$("#globalObjectDefault").prop("checked")):"action"==e&&"global"===h.objectName&&h.setSetting("globalFeature",$("#globalFeatureDefault").prop("checked")),"field"==e?(n=[],h.getFieldSettingTypes().every(function(e){return Object.each(h.settingsData[e.name],function(e,t){e.dirty&&(e.settingName=t,n.push(e))}),!0})):n=$("#"+e+"Features").data("kendoGrid").dataSource.data();var o=n.length;o<1&&(i.sender.enable(!0),h.hideLoader());for(var r=[],s=0,l=0;l<o;l++){var d=n[l],c=void 0,u=e;"field"==e?(c=d.setting,u=d.settingType):d.exclude?c=!1:d.include&&(c=!0);var f=function(a){s++,a.getBoolean&&a.getBoolean("success")||r.push(a),s==o&&(0==r.length?(p.showMessage({title:"Settings Saved",message:"Your changes have been saved!"},"success"),"field"==e?($("#fieldFeatures").empty(),h.initFieldSecurityTab()):$("#"+e+"Features").data("kendoGrid").dataSource.read()):t.popup("Save Error!","\n The following errors occurred: <br /><ul><li>"+r.join("\n</li><li>")+"</li></ul>"),i.sender.enable(!0),h.hideLoader())},m={name:d.name,settingName:d.settingName,tableName:h.objectName,owner:h.actionOwner,ownerLabel:h.actionOwnerLabel,ownerType:h.actionOwnerType,settingType:u,setting:c,id:d.id};a.setCustomSetting(m,f)}})}},getTypeSettings:function(e){return a.getCustomSettings(h.objectName,h.actionOwner,h.actionOwnerType,e)},getSetting:function(e,t,i){t||(t="global"),i||(i=i);var n=a.getCustomSettings(t,void 0,"global",i);return n&&n[e]?n[e].setting:n},setSetting:function(e,t,i,n,o){i||(i="global"),n||(n="globalDefault");var r,s=a.getCustomSettings(i,void 0,"global",n);s[e]&&(r=s[e].id);var l={settingName:e,tableName:"global",owner:void 0,ownerLabel:"",ownerType:"global",settingType:n,setting:t,id:r};a.setCustomSetting(l,o)},actionOwnerTypeChange:function(e){return function(t){h.actionOwnerType=t.target.value,h.resetOwners(e),h.initActions(e)}},showLoader:function(e){$("#loadingMask").show(0),$("#loadingMask").find(".k-loading-image").focus(),$("#loadingMask")[0].offsetHeight,setTimeout(e,50)},hideLoader:function(){$("#loadingMask").hide()},resetOwners:function(e){switch(e||(e="action"),h.actionOwner=void 0,h.actionOwnerLabel="",document.getElementById(e+"Users").style.display="none",document.getElementById(e+"Profiles").style.display="none",document.getElementById(e+"Owner").style.display="none",h.actionOwnerType){case"profile":document.getElementById(e+"Profiles").style.display="block",document.getElementById(e+"Owner").style.display="",h.profileList.kendoListView.select(h.profileList.kendoListView.element.children().first());break;case"user":document.getElementById(e+"Users").style.display="block",document.getElementById(e+"Owner").style.display="",h.userList.kendoListView.select(h.userList.kendoListView.element.children().first())}},initObjectSecurityTab:function(){var e=this,t=new kendo.data.DataSource({transport:{read:function(t){var a=h.getTypeSettings("explorer"),i=[];allObjects=n.getAvailableObjects(),Object.each(allObjects,function(t){i.push(e.makeRow(a,t.name,t.label))}),i=Array.orderBy(i,function(e){return e.feature}),t.success(i)}}}),a=[{field:"feature",title:"Object",width:160},{field:"include",title:"Show",width:80,headerTemplate:'<span style="position:absolute; top: 6px;">Show</span> <span style="display: block; width: 20px; margin: 0 auto"><input type="radio" class="gridRadio include header" name="headerRadio" value="include"></span>',template:'<input type="radio" class="gridRadio include" name="#= settingName #" value="include" #=include? checked="checked": "" #>',attributes:{style:"text-align: center;"}},{field:"exclude",title:"Hide",width:80,headerTemplate:'<span style="position:absolute; top: 6px;">Hide</span> <span style="display: block; width: 20px; margin: 0 auto"><input type="radio" class="gridRadio exclude header" name="headerRadio" value="exclude"></span>',template:'<input type="radio" class="gridRadio exclude" name="#= settingName #" value="exclude" #=exclude? checked="checked": "" #>',attributes:{style:"text-align: center;"}},{field:"inactive",title:"Inherit",width:80,headerTemplate:'<span style="position:absolute; top: 6px;">Inherit</span> <span style="display: block; width: 20px; margin: 0 auto"><input type="radio" class="gridRadio inactive header" name="headerRadio" value="inactive"></span>',template:'<input type="radio" class="gridRadio inactive" name="#= settingName #" value="inactive"  #=inactive? checked="checked": "" #>',attributes:{style:"text-align: center;"}},{field:"settingName",title:"Name",hidden:!0}],i=function(e){var t=[];return $(e.target).hasClass("header")?t=$("#explorerFeatures").data("kendoGrid").dataSource.data():(t.push(Object.first($("#explorerFeatures").data("kendoGrid").dataSource.data(),function(t){return t.settingName==e.target.name})),$("input.header").each(function(e,t){t.checked=!1})),Object.each(t,function(t){t.include=!1,t.exclude=!1,t.inactive=!1,t[e.target.value]=!0}),e.stopPropagation(),$("#explorerFeatures").data("kendoGrid").refresh(),!0},o='<div id="globalMenu"/>';switch($("#explorerFeatures").kendoGrid({dataSource:t,toolbar:kendo.template(o),sortable:!0,columns:a,resizable:!0,dataBound:function(e){$(".gridRadio").off("click",i),$(".gridRadio").on("click",i)}}),$("#globalMenu").kendoToolBar({items:[{template:'<button style="float:left;" id="btnglobalSave" class="k-primary">Save</button>'},{template:'<div style="float: left; left: 10px; position: relative; ">Apply to: <br /><input type="radio" class="explorerRadio" name="explorerRadio" id="globalRadio_global" value="global" checked="checked" /><label for="globalnRadio_global">All Users</label><input type="radio" class="explorerRadio" name="explorerRadio" id="globalRadio_profile" value="profile" /><label for="globalRadio_profile">Profile</label><input type="radio" class="explorerRadio" name="explorerRadio" id="globalRadio_user" value="user" /><label for="globalRadio_user">User</label></div><div style="float: left; left: 10px; position: relative; width:100%"><input type="checkbox" id="globalObjectDefault" /><label for="globalObjectDefault">Default Visible</label><span class="k-icon k-i-note globalInheritDefaultTooltip"></span></div>'}]}),$("#btnglobalSave").data("kendoButton")&&$("#btnglobalSave").data("kendoButton").destroy(),$("#btnglobalSave").kendoButton({spriteCssClass:"k-icon k-i-tick",click:h.saveHandlerFactory("explorer")}),$(".globalInheritDefaultTooltip").off("click"),$(".globalInheritDefaultTooltip").on("click",function(){var e=$("<div>").kendoTooltip({filter:"label",width:225,position:"right",autoHide:!1,content:'This controls the Inherit functionality for all objects (or features). For example, if you uncheck Default Visible, Inherit will be interpreted as "Hide by defaults"'}).data("kendoTooltip");e.show($(this))}),h.actionOwnerType){case"global":$("#globalRadio_global").prop("checked",!0);break;case"profile":$("#globalRadio_profile").prop("checked",!0);break;case"user":$("#globalRadio_user").prop("checked",!0)}$(".explorerRadio").unbind("click"),$(".explorerRadio").on("click",h.actionOwnerTypeChange("explorer"))},initFeatureSecurityTab:function(){var e="action",i=this,o=new kendo.data.DataSource({transport:{read:function(t){var n=h.getTypeSettings(),o=[];Object.each(a.getFeatureSecurityItems(!0,h.objectName),function(t){if(!n[t.name]||n[t.name].settingType==e||"action"==e&&void 0==n[t.name].settingType){var a=i.makeRow(n,t.name,t.label);t.type?(a.itemId=t.Id,a.type=t.type):t.Id&&(a.StaticResourceId=t.Id),o.push(a)}}),o=Array.orderBy(o,function(e){return e.feature}),t.success(o)}}}),s=[{field:"feature",title:"Feature",width:160,template:function(e){var t=e.feature;return e.StaticResourceId?t=String.format('<a href="/{0}" target="_blank">{1}</a> (<a id="edit{1}" href="javascript:void(0);">Edit</a>)',e.StaticResourceId,e.feature):"congaConductor"!=e.type&&"congaComposer"!=e.type||(t=String.format('{1} (<a id="edit{0}" class="congaEdit" href="javascript:void(0);">Edit</a>) (<a id="delete{0}" value="{1}" class="congaDelete" href="javascript:void(0);">Delete</a>)',e.itemId,e.feature)),t}},{field:"include",title:"Enable",width:80,headerTemplate:'<span style="position:absolute; top: 6px;">Enable</span> <span style="display: block; width: 20px; margin: 0 auto"><input type="radio" class="gridRadio include header" name="headerRadio" value="include"></span>',template:'<input type="radio" class="gridRadio include" name="#= settingName #" value="include" #=include? checked="checked": "" #>',attributes:{style:"text-align: center;"}},{field:"exclude",title:"Disable",width:80,headerTemplate:'<span style="position:absolute; top: 6px;">Disable</span> <span style="display: block; width: 20px; margin: 0 auto"><input type="radio" class="gridRadio exclud header" name="headerRadio" value="exclude"></span>',template:'<input type="radio" class="gridRadio exclude" name="#= settingName #" value="exclude" #=exclude? checked="checked": "" #>',attributes:{style:"text-align: center;"}},{field:"inactive",title:"Inherit",headerTemplate:'<span style="position:absolute; top: 6px;">Inherit</span> <span style="display: block; width: 20px; margin: 0 auto"><input type="radio" class="gridRadio inactive header" name="headerRadio" value="inactive"></span>',width:80,template:'<input type="radio" class="gridRadio inactive" name="#= settingName #" value="inactive"  #=inactive? checked="checked": "" #>',attributes:{style:"text-align: center;"}},{field:"settingName",title:"Name",hidden:!0}],d=function(t){var a=[];return $(t.target).hasClass("header")?a=$("#"+e+"Features").data("kendoGrid").dataSource.data():(a.push(Object.first($("#"+e+"Features").data("kendoGrid").dataSource.data(),function(e){return e.settingName==t.target.name})),$("input.header").each(function(e,t){t.checked=!1})),Object.each(a,function(e){e.include=!1,e.exclude=!1,e.inactive=!1,e[t.target.value]=!0}),t.stopPropagation(),$("#"+e+"Features").data("kendoGrid").refresh(),!0},c='<div id="newMenu" />';$("#"+e+"Features").empty(),$("#"+e+"Features").kendoGrid({dataSource:o,toolbar:kendo.template(c),sortable:!0,columns:s,resizable:!0,dataBound:function(e){$(".gridRadio").off("click",d),$(".gridRadio").on("click",d)}});var i=this;$("#"+e+"Features table tr td:first-child").delegate("a","click",function(e){var a=e.target.id.replace("edit","");if($(e.target).hasClass("congaEdit")){var o=n.getNamespace(!0),r=n.query("SELECT Id, Name, {0}JSON__c, {0}Setting_Name__c, {0}Table_Name__c, {0}Setting_Type__c FROM {0}Grid_Setting__c WHERE isDeleted = false AND Id = '{1}'",o,a);if(r&&r[0])return i.editCongaAction(a,l.convertSetting(r[0]),!1),!1}else{if($(e.target).hasClass("congaDelete"))return t.popupWithButtons("Confirm Deletion",kendo.format('<p style="font-size:125%;font-weight:bold">Are you sure you want to delete {0}?</p>',$(e.target).attr("value")),[{
label:"Yes",click:function(){n.batchDelete([a.replace("delete","")],function(e){for(var a=0,n=0,o=[],r=0;r<e.length;r++){var s=e[r];if(s&&"true"==s.success)n++;else{var l=s.getArray("errors");l.length>0&&o.push(l[0].message.replace(/\r\n/g,"<br/>").replace(/[\r\n]/g,"<br/>")),a++}}var d;d=a>0?"Delete failed due to "+o.join("<br/>"):"Delete successful!",t.popup("Deletion Results",d),i.initActions("action")})}},{label:"Cancel",click:function(){}}]),!1;var s=n.query("select contentType,Body from StaticResource where Name = '{0}'",a);if(s&&s[0]){var d=atob(s[0].Body),c="ActionGridRP/javascript"==s[0].ContentType;return i.editCustomAction(a,d,!1,c),!1}}return!0}),$("#newMenu").kendoToolBar({items:[{template:'<button style="float:left;" id="btnactionSave" class="k-primary">Save</button>'},{type:"button",text:"New Custom Action",icon:"plus",overflow:"never",click:function(){i.editCustomAction("",r.toJSON(),!0)}},{type:"button",text:"Conga Action",enable:"global"!=h.objectName,icon:"restore",click:function(){i.editCongaAction("",void 0,!0)}},{type:"button",text:"New Custom Pane",icon:"plus",overflow:"never",click:function(){i.editCustomAction("",r.toJSON(),!0,!0)}},{template:'<div><div style="float: left; left: 10px; position: relative; ">Apply to: <br /><input type="radio" class="actionRadio" name="actionRadio" id="actionRadio_global" value="global" checked="checked" /><label for="actionRadio_global">All Users</label><input type="radio" class="actionRadio" name="actionRadio" id="actionRadio_profile" value="profile" /><label for="actionRadio_profile">Profile</label><input type="radio" class="actionRadio" name="actionRadio" id="actionRadio_user" value="user" /><label for="actionRadio_user">User</label></div> <br /><div id="globalFeatureDefaultContainer" style="float: left; left: 10px; position: relative; "><input type="checkbox" id="globalFeatureDefault" /><label for="globalFeatureDefault">Default Visible</label><span class="k-icon k-i-note globalInheritDefaultTooltip"></span></div></div>'}]}),$("#globalFeatureDefaultContainer").css("display","global"==h.objectName?"block":"none"),$(".globalInheritDefaultTooltip").off("click"),$(".globalInheritDefaultTooltip").on("click",function(){var e=$("<div>").kendoTooltip({filter:"label",width:225,position:"right",autoHide:!1,content:'This controls the Inherit functionality for all objects (or features). For example, if you uncheck Default Visible, Inherit will be interpreted as "Hide by defaults"'}).data("kendoTooltip");e.show($(this))})},editCustomAction:function(e,t,a,n){var o={resizable:!0,height:"520px",width:"90%",saveShortcut:!0},r=this,s=n?"Pane":"Action",l='<strong>For a cookbook of example ActionGrid code recipes, <a href="https://support.getconga.com/Conga_ActionGrid/Code_Examples_for_Custom_Actions_in_ActionGrid" target="new">click here</a>.</strong>';i.entry("Custom "+s,[{name:"name",label:s+" Name",required:!0,type:"text",validate:i.requiredValidation,value:e},{label:"",type:"html",html:l},{name:"js",required:!0,validate:i.requiredValidation,label:"JavaScript",type:"javascript",height:"400px",value:t}],o,void 0,function(e){r.saveCustomActionClick(e,a,n)})},editCongaAction:function(e,t,a){var o={resizable:!0,width:"500px"},r=this,s=[],l=n.getSObjectDescribe(h.objectName),d=n.getNamespace(!0),c=n.query("SELECT Id, Name, {0}JSON__c, {0}Setting_Name__c, {0}Table_Name__c, {0}Setting_Type__c FROM {0}Grid_Setting__c WHERE isDeleted = false AND {0}Table_Name__c = '{1}' AND ({0}Setting_Type__c = 'congaConductor' OR {0}Setting_Type__c = 'congaComposer')",d,h.objectName),u={};Object.each(c,function(e){u[e[d+"Setting_Name__c"]]=!0});var p=n.query("SELECT Id, MasterLabel, Name FROM WebLink WHERE  LinkType = 'url' AND PageOrSobjectType ='"+h.objectName+"'");Object.each(p,function(e){(!u["buttonId__"+e.Id]||t&&t.settingName=="buttonId__"+e.Id)&&s.push({label:"Button: "+e.MasterLabel+"("+e.Name+")",value:"buttonId__"+e.Id})}),Object.each(l.fields,function(e){"true"==e.calculated&&(!u[e.name]||t&&t.settingName==e.name)&&s.push({label:"Formula Field: "+e.label,value:e.name})}),i.entry("Conga Action",[{name:"label",label:"Conga Action Label",required:!0,type:"text",validate:i.requiredValidation,value:t?t.setting:""},{name:"type",label:"Type of Conga Action",required:!0,type:"picklist",value:t?t.settingType:"",values:[{label:"Conga Composer",value:"congaComposer"},{label:"Conga Conductor",value:"congaConductor"}],validate:i.requiredValidation},{name:"field",required:!0,validate:i.requiredValidation,label:"Select Button/Formula Field",type:"picklist",values:s,value:t?t.settingName:""}],o,void 0,function(e){r.saveCongaActionClick(e,t)})},saveCustomActionClick:function(e,i,n){var o=this,r=Object.first(e,function(e){return"name"==e.name}),s=Object.first(e,function(e){return"js"==e.name}),l=n?"ActionGridRP/javascript":"ActionGrid/javascript",d=n?"Custom Pane":"Action Item",c=function(e){var a=e.errors&&e.errors.message?e.errors.message:"";t.popup("Error Saving "+d,"There was an error saving the static resource: <br/>"+a)};if(r&&r.value.length>0&&s&&s.value.length>0){r=r.value,s=s.value;var u=i?a.createStaticResource:a.updateStaticResource;h.showLoader(function(){u(r,l,s,function(e){e.errors?c(e):(p.showMessage({title:"Saved "+d,message:String.format("Successfully saved {1} as Static Resource named '{0}'",e.fullName,d)},"success"),i&&o.initActions("action")),h.hideLoader()},c)})}},saveCongaActionClick:function(e,a){var i=this,n=e.label,o=e.field,r=e.type,s=function(e){var a=e.errors&&e.errors.message?e.errors.message:"";t.popup("Error Saving Conga Action Item","There was an error saving the Conga Action: <br/>"+a)};n&&n.value.length>0&&o&&o.value.length>0&&r&&r.value.length>0&&(n=n.value,o=o.value,r=r.value,h.showLoader(function(){var e=!1;a&&a.id||(a={},e=!0),a.settingName=o,a.tableName=h.objectName,a.settingType=r,a.setting=n;var t=function(t){t.errors?s(t):(p.showMessage({title:"Saved Conga Action",message:"Successfully saved Conga Action!"},"success"),e&&i.initActions("action")),h.hideLoader()};l.setSetting(a,t,t)}))},fieldSettingFactory:function(e,t,a){return{name:e,label:t,templateFunction:function(){return function(t){var a="",i={item:t};if(t.name){var n;h.settingsData[e][t.name]&&(n=h.settingsData[e][t.name].setting),"Sum"==e&&"CURRENCY"!=t.type&&"DOUBLE"!=t.type&&"INTEGER"!=t.type||(a+='<input type="checkbox" name="#= item.name #" class="securityCheckbox field'+e+'" value="'+(n===!0?2:n===!1?0:1)+'" />',i.include=n===!0,i.exclude=n===!1,i.inactive=void 0===n)}var o=kendo.template(a);return o(i)}},makeColumn:function(){return{attributes:{style:"text-align: center;"},title:t,filterable:!1,sortable:!1,width:a?a:100,headerTemplate:t+' <input type="checkbox" class="securityCheckbox field'+e+' header" />',template:this.templateFunction()}}}},getFieldSettingTypes:function(){return h.fieldSettingTypes||(h.fieldSettingTypes=[this.fieldSettingFactory("Available","Visible",70),this.fieldSettingFactory("Sum","Don't Sum",90),this.fieldSettingFactory("MassUpdate","Mass Update"),this.fieldSettingFactory("InlineEdit","Inline Edit")]),h.fieldSettingTypes},initFieldSecurityTab:function(){var e="field";h.settingsData={},h.getFieldSettingTypes().every(function(e){var t="field";return"Available"!=e.name&&(t+=e.name),h.settingsData[e.name]=h.getTypeSettings(t),!0});var t=function(e){var t=$(".securityCheckbox");t.each(function(e,t){var a=$(t);2==t.value?(a.data("checked",2),a.prop("indeterminate",!1),a.prop("checked",!0)):0==t.value?(a.data("checked",0),a.prop("indeterminate",!1),a.prop("checked",!1)):(a.data("checked",1),a.prop("indeterminate",!0))}),t.off("click"),t.click(function(e){var t,a=$(this),i=[];t=a.data("checked"),a.hasClass("header")?h.getFieldSettingTypes().every(function(e){return!a.hasClass("field"+e.name)||(i=$(".field"+e.name),!1)}):i.push(this);for(var n=0;n<i.length;n++){var o,r=$(i[n]);switch(t){case 0:r.data("checked",1),r.prop("indeterminate",!0);break;case 1:r.data("checked",2),r.prop("indeterminate",!1),r.prop("checked",!0),o=!0;break;default:r.data("checked",0),r.prop("indeterminate",!1),r.prop("checked",!1),o=!1}var s,l;h.getFieldSettingTypes().every(function(e){return!r.hasClass("field"+e.name)||(l=e.name,!1)}),s=h.settingsData[l][r.attr("name")],s||(s={owner:h.actionOwner,ownerType:h.actionOwnerType,ownerLabel:h.actionOwnerLabel,settingType:"Available"==l?"field":"field"+l,tableName:h.objectName}),s.dirty=!0,s.setting=o,h.settingsData[l][r.attr("name")]=s}})};"global"!=h.objectName&&(this.fieldChooser=Object.create(o),this.fieldChooser.init({elementId:"#"+e+"Features",delegate:{dataBound:t,getColumns:function(e){return h.getFieldSettingTypes().every(function(t){return e.unshift(t.makeColumn()),!0}),e}},objectName:h.objectName,objectLabel:h.objectName,overrideSecurity:!0,hideRootNodes:!0}),this.fieldChooser.refresh())},makeRow:function(e,t,a){var i={feature:a,settingName:t,inactive:void 0===e[t],exclude:!1,include:!1};return e[t]&&(i.name=e[t].name,i.id=e[t].id,i.inactive=void 0===e[t].setting,i.exclude=e[t].setting===!1,i.include=e[t].setting===!0),i},initActions:function(e){e||(e="action"),$("#"+e+"Features").empty();switch(e){case"explorer":this.initObjectSecurityTab();break;case"action":this.initFeatureSecurityTab();break;case"field":this.initFieldSecurityTab()}switch($("#btn"+e+"Save").data("kendoButton")&&$("#btn"+e+"Save").data("kendoButton").destroy(),$("#btn"+e+"Save").kendoButton({spriteCssClass:"k-icon k-i-tick",click:h.saveHandlerFactory(e)}),h.actionOwnerType){case"global":$("#"+e+"Radio_global").prop("checked",!0);break;case"profile":$("#"+e+"Radio_profile").prop("checked",!0);break;case"user":$("#"+e+"Radio_user").prop("checked",!0)}$("."+e+"Radio").unbind("click"),$("."+e+"Radio").on("click",h.actionOwnerTypeChange(e)),"global"===h.objectName&&($("#globalObjectDefault").prop("checked",h.getSetting("globalObject")!==!1),$("#globalFeatureDefault").prop("checked",h.getSetting("globalFeature")!==!1)),h.hideLoader()},initTab:function(t){if("integration"==t||"buttons"==t){var i=function(e){document.getElementById("hasButton").style.display=e.hasButton?"block":"none",document.getElementById("noButton").style.display=e.hasButton?"none":"block",document.getElementById("hasSearchResults").style.display=e.hasSearchResults?"block":"none",document.getElementById("noSearchResults").style.display=e.hasSearchResults?"none":"block",document.getElementById("hasListView").style.display=e.hasListView?"block":"none",document.getElementById("noListView").style.display=e.hasListView?"none":"block",Object.each(document.getElementsByName("errIcon"),function(t){t.style&&(t.style.display=e.custObj.searchLayouts?"none":"block"),h.hideLoader()}),e.custObj.searchLayouts||Object.each(document.getElementsByName("noErr"),function(e){e.style&&(e.style.display="none")}),$("#globalFeatureDefaultContainer").css("display","none")};a.getCustomObject(h.objectName,i,function(e,t){var a=n.getSObjectDescribe(h.objectName);i({custObj:{fullName:a.name,label:a.label}})})}else"global"!=t&&$("#"+t+"Users").length>0&&(h.profileList=new e({elementId:"#"+t+"Profiles ",filterField:"Name",listViewTemplate:"<div style='padding:0.5em;'>#:Name#</div>",delegate:{onSelectedChanged:function(e,a){h.actionOwnerType="profile",h.actionOwner=a.Id,h.actionOwnerLabel=a.Name,h.initActions(t)},dataSource:new kendo.data.DataSource({transport:{read:function(e){var t=h.getProfiles();t=Array.orderBy(t,function(e){return e.Name}),e.success(t)}}})}}),h.userList=new e({elementId:"#"+t+"Users",filterField:"Name",listViewTemplate:"<div style='padding:0.5em;'>#:Name#</div>",delegate:{onSelectedChanged:function(e,a){h.actionOwnerType="user",h.actionOwner=a.Id,h.actionOwnerLabel=a.Name,h.initActions(t)},dataSource:new kendo.data.DataSource({transport:{read:function(e){var t=h.getUsers();t=Array.orderBy(t,function(e){return e.Name}),e.success(t)}}})}}),h.resetOwners(t));h.initActions(t),h.resizeDivs()},initPageList:function(){var e=[{field:"Name",title:"VF Page",template:'<a href="/#= Id #" target="_BLANK">#= Name #</a> (<a href="/#= Id #/e" target="_BLANK">Edit</a>)'},{field:"LastModifiedDate",title:"Last Modified Date",template:'#= kendo.toString(new Date(LastModifiedDate), "F")#'},{field:"CreatedDate",title:"Created Date",template:'#= kendo.toString(new Date(CreatedDate), "F")#'}],t=new kendo.data.DataSource({transport:{read:function(e){results=n.query("SELECT Id, Name, LastModifiedDate, CreatedDate FROM ApexPage WHERE Name like 'AG%' AND (ControllerKey = '"+h.objectName+"' OR Description like '%AG_"+h.objectName+"%')"),e.success(results),h.resizeDivs()}}});$("#vfPagesList").data("kendoGrid")&&($("#vfPagesList").data("kendoGrid").destroy(),$("#vfPagesList").empty()),$("#vfPagesList").kendoGrid({dataSource:t,sortable:!0,columns:e,resizable:!0})},exportAG:function(){var e=function(){h.showLoader(function(){a.getVisualForcePages(function(e){try{var i,o,r,s=n.getNamespace(!0),l={},u=[],p=function(e){t.popup("Error","An Error occurred: "+e),console.log(e),h.hideLoader()},f=function(){for(var t=0;t<r.length;t++)r[t].Body=l[r[t].Id];var a=new JSZip;a.file("views.txt",JSON.stringify(i)),a.file("settings.txt",JSON.stringify(o)),a.file("pages.txt",JSON.stringify(e)),a.file("customActions.txt",JSON.stringify(r)),a.file("tabs.txt",JSON.stringify(u)),d(a.generate({type:"blob"}),"ActionGrid.zip"),h.hideLoader()},m=function(e){var t=0;0==e.length&&v();for(var i=0;i<e.length;i++){var n=e[i];!function(i){a.getCustomTabFull(i,function(a){t++,console.log(a),u.push(a[0]),t>=e.length&&v()},p)}(n)}},g=function(){a.listCustomTabs(function(e){var t=e?e.result:[];e.result instanceof Array||(t=[e.result]),h.popupGrid("selectivePrompt",t,"Select Tabs to Export",function(e){h.showLoader(function(){t=t.filter(function(t){return e[t.id].isChecked}),Object.each(t,function(e){delete e.isChecked}),m(t.map(function(e){return e.id}))})},"fullName","id"),h.hideLoader()},p)},v=function(){c.query(String.format("SELECT Id, Name, {0}JSON__c, {0}Owner__c , {0}Owner_Type__c, {0}Setting_Name__c, {0}Table_Name__c, {0}Setting_Type__c FROM {0}Grid_Setting__c WHERE isDeleted = false",s),function(e){h.selectivePromptFactory(e,"Settings",function(e){o=e,b()},"Select Settings to Export")(),h.hideLoader()},p)},b=function(){c.query(String.format("SELECT Id,OwnerId,Name,LastModifiedById,LastModifiedDate,CreatedById,CreatedDate,IsDeleted,SystemModstamp,{0}Description__c, {0}IsDefault__c,{0}JSON__c,{0}Category__c,{0}Context__c,{0}ObjectName__c,{0}Privacy__c FROM {0}GridView__c WHERE IsDeleted = false",s),function(e){h.selectivePromptFactory(e,"Views",function(e){i=e,k()},"Select Views to Export")(),h.hideLoader()},p)},y=function(e){var t=0;0==e.length&&f();for(var a=0;a<e.length;a++){var i=e[a];!function(a){c.getBinaryField("StaticResource",a,"body",function(i){t++,l[a]=btoa(i),t>=e.length&&f()},p)}(i)}},k=function(){c.query("SELECT Body,BodyLength,ContentType,CreatedById,CreatedDate, Description,Id,LastModifiedById,LastModifiedDate,Name,NamespacePrefix,SystemModstamp FROM StaticResource where ContentType = 'ActionGrid/javascript' OR ContentType = 'ActionGridRP/javascript'",function(e){h.selectivePromptFactory(e,"Custom Actions/Panes",function(e){r=e,y(e.map(function(e){return e.Id}))},"Select Custom Actions/Panes to Export")(),h.hideLoader()},p)};h.selectivePromptFactory(e,"Pages",function(t){e=t,g()},"Select Pages to Export")(),h.hideLoader()}catch(e){console.log(e)}h.hideLoader()})})};if("undefined"!=typeof JSZip)e();else{var i=document.getElementsByTagName("HEAD").item(0),o=document.createElement("script");o.type="text/javascript",i.appendChild(o),o.src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.4.0/jszip.js",o.onerror=function(){t.popup("Export Failed","Export failed, contact support@getactiongrid.com")},o.onload=function(){e()}}},finishPromptFactory:function(e,a,i,n,o,r){return function(s){i&&h.logItem(o||"Inserted",n||i[0].type,i,s,r),h.hideLoader(),s instanceof Array||(s=[s]);for(var l=0,d=[],c=0;c<s.length;c++)s[c].getBoolean("success")?l++:d.push(s[c]);var u="Successfully imported "+l+" "+e;d.length>0&&(u+=" and found the following "+d.length+" errors: < br/><ul><li>",u+=d.join("</li><li>")+"</li></ul>"),t.popup("Results",u,"Continue",a,"Cancel Import",{close:function(){h.hideLoader()}})}},popupGrid:function(e,t,a,i,n,o){n||(n="Name"),o||(o="Id");$("#"+e).data("kendoWindow")&&($("#"+e).data("kendoWindow").destroy(),$("#"+e).empty());var r="<div id='"+e+"' style='display:none; display: inline-block; padding: 0px; padding-bottom:0.6em; text-align:center;'><div style='max-width: 485px; overflow-y:auto; padding:0.6em;'><div id='"+e+"_grid' /></div><span id='"+e+"_continue' class='k-button'>Continue</span> &nbsp; &nbsp;<span id='"+e+"_cancel' class='k-button'>Cancel</span></div>",s={},l=function(){var a=$("#"+e+" input.cmChk");Object.each(a,function(e){var a=e.id;if(a){a=a.split("_")[1];var i=t.filter(function(e){return e[o]==a});1==i.length&&(s[a]=i[0],s[a].isChecked=e.checked)}})},d=function(){return l(),s};$("body").append(r),$("#"+e).kendoWindow({draggable:!0,modal:!0,actions:["Close"],title:a,height:347,width:500,resizable:!1}),$("#"+e+"_cancel").bind("click",function(){$("#"+e).data("kendoWindow").close().destroy()}),$("#"+e+"_continue").bind("click",function(){i(d()),$("#"+e).data("kendoWindow").close().destroy()});var c=[{title:"",headerTemplate:'<input class="cmChkHd" id="'+e+'_headerCheck" type="checkbox">',template:'<input class="cmChk" id="cmChk_#= '+o+' #" type="checkbox" #=data.isChecked?"checked":""# >',width:"35px"},{field:n,title:"",template:"#= "+n+" #",headerTemplate:'<input id="gridTextSearch" type="search" class="k-textbox" placeholder="Search"/>',attributes:{style:"text-align: left;"}}],u=new kendo.data.DataSource({transport:{read:function(e){l();var a=$("#gridTextSearch").val(),i=t.filter(function(e){return e[n].indexOf(a)>-1});Object.each(i,function(e){e.isChecked=s[e[o]]&&s[e[o]].isChecked}),e.success(i)}}});$("#"+e+"_grid").data("kendoGrid")&&($("#"+e+"_grid").data("kendoGrid").destroy(),$("#"+e+"_grid").empty()),$("#"+e+"_grid").kendoGrid({dataSource:u,sortable:!0,height:300,columns:c,resizable:!0}),$("#gridTextSearch").bind("propertychange keyup input paste",function(){($("#gridTextSearch").val().length>2||0==$("#gridTextSearch").val().length)&&(clearTimeout($(this).data("timeout")),$(this).data("timeout",setTimeout(function(){$("#"+e+"_grid").data("kendoGrid").dataSource.read()},500)))}),$("#"+e).data("kendoWindow").center().open(),$("#"+e+"_headerCheck").change(function(){var t=this;$("#"+e+" input.cmChk").each(function(){this.checked=t.checked})}),$("#"+e+" input.cmChk").change(function(){$("#"+e+"_headerCheck")[0].checked=!1}),$(document).on("click","#"+e+"_grid > div.k-grid-content > table > tbody > tr > td:nth-child(2)",function(){var e=$(this.parentElement.children).find('input[type="checkbox"]');e.prop("checked",!e.prop("checked"))}),$("#gridTextSearch").on("click",function(e){e.stopPropagation()})},selectivePromptFactory:function(e,t,a,i){return function(){return h.popupGrid("selectivePrompt",e,i?i:"Select "+t+" To Import",function(t){h.showLoader(function(){e=e.filter(function(e){return t[e.Id].isChecked}),Object.each(e,function(e){delete e.isChecked}),"function"==typeof a&&a(e)})})}},cleanViews:function(e,t,a){var i=[];return Object.each(e,function(e){a.push(e.Id),delete e.CreatedById,delete e.CreatedDate,delete e.Id,delete e.IsDeleted,delete e.LastModifiedById,delete e.LastModifiedDate,delete e.LastReferencedDate,delete e.LastViewedDate,delete e.SystemModstamp,delete e.OwnerId,delete e.attributes;var n=new sforce.SObject(t+"GridView__c");Object.each(e,function(e,a){"type"!=a&&(t.length<1&&a.indexOf("CRMC_PP__")>-1?n[a.split("CRMC_PP__")[1]]=e:n[a]=e)}),i.push(n)}),i},importAG:function(e,o,r){h.clearLog();var s=function(e){try{var s=new JSZip(e),l={};$.each(s.files,function(e,t){l[e]=JSON.parse(t.asText())});var d={},c=n.getNamespace(!0);o||h.hideLoader();var u=function(e,i,s){var u=[],f=0;Object.each(e,function(e){if(!e.NamespacePrefix){Object.each(d,function(t,a){0==c.length&&(e.Markup=e.Markup.replace(/CRMC_PP:/g,"C:")),e.Markup.indexOf(a)>-1&&(e.Markup=e.Markup.replace(new RegExp(a,"g"),t),f++)}),delete e.CreatedById,delete e.CreatedDate,delete e.Id,delete e.IsDeleted,delete e.LastModifiedById,delete e.LastModifiedDate,delete e.LastReferencedDate,delete e.LastViewedDate,delete e.NamespacePrefix,delete e.SystemModstamp,delete e.OwnerId,delete e.attributes;var t=new sforce.SObject("ApexPage");Object.each(e,function(e,a){t[a]=e}),u.push(t)}}),Object.each(s,function(e){Object.each(d,function(t,a){e.Markup.indexOf(a)>-1&&(e.Markup=e.Markup.replace(new RegExp(a,"g"),t),f++)})});var m=function(e){return function(s){h.logItem("Inserted","ApexPage",e,s);for(var d=0,c=[],u=[],m=0;m<s.length;m++)if(s[m].getBoolean("success")){var g=new sforce.SObject("SetupEntityAccess");g.SetupEntityId=s[m].id,u.push(g),d++}else c.push(e[m].MasterLabel+": "+s[m].errors.message);var v="Successfully Imported "+i+" AG views and "+d+" Pages. ("+f+" viewID references fixed)";c.length>0&&(v+="The following errors occurred: <ul><li>",v+=c.join("</li>\n<li>"),v+="</li></ul>",t.popup("Import Complete",v)),o&&u.length>0&&h.getAGPermissionSetId(function(e){Object.each(u,function(t){t.ParentId=e}),n.insert(u,function(e){h.logItem("Inserted","SetupEntityAccess",u,e),o||p.showMessage({title:"Success",message:"Successfully added page to Permission Set"},"success")},function(e){t.popup("Error","Unexpected error adding page to Permission Set: "+e)})});var b=function(e,s,l){console.log(h.stringifyLog());var u="Successfully Imported "+i+" AG views and "+d+" Pages. ("+f+" had their viewIDs fixed)",m=function(){r?r(h.log,e,s,c,l):c.length>0?(u+="The following errors occurred: <ul><li>",u+=c.join("</li>\n<li>"),u+="</li></ul>",t.popup("Import Complete",u)):e?t.popupWithButtons("Import Complete",u,[{label:"Go To Tab",click:function(){n.navigateToVFPage("c",e,{},!1,"_BLANK")}}]):p.showMessage({title:"Import Complete",message:u},"success")};o?(u="Successfully installed template!",s?a.addTabToCustomApplication(n.getNamespace(!0)+"Grid",s.FullName,function(e){console.log(e),m()},function(e){console.log("err",e)}):m()):m(),h.hideLoader()};if(!l["tabs.txt"]||l["tabs.txt"].length<1)b();else{var y=l["tabs.txt"],k=function(e){for(var t=0,a=0;a<e.length;a++){var i={FullName:e[a].FullName,Metadata:e[a].Metadata};h.createCustomTab(i,o,function(a,n,o){t++,t>=e.length&&b(a,i,o)})}};o?k(y):(h.popupGrid("selectivePrompt",l["tabs.txt"],"Select Tabs to Import",function(e){h.showLoader(function(){var t=l["tabs.txt"].filter(function(t){return e[t.Id].isChecked});Object.each(t,function(e){delete e.isChecked}),k(t)})},"FullName","Id"),h.hideLoader())}}};s&&s.length>0?n.batchUpdate(s,function(e){h.logItem("Updated","ApexPage",s,e);var a=0,i=[];Object.each(e,function(e){e.getBoolean("success")?a++:(console.log(e),i.push(e.errors?e.errors.message:e))});var r="Successfully updated "+a+" existing Pages.";i.length>0&&(r+="The following errors occurred: <ul><li>",r+=i.join("</li>\n<li>"),r+="</li></ul>"),o?u.length>0?n.batchInsert(u,m(u)):m(u)([]):t.popup("Update Complete",r,"Continue",function(){u.length>0?n.batchInsert(u,m(u)):m(u)([])},"Cancel Import",{close:function(){h.hideLoader()}})}):n.batchInsert(u,m(u))},f=function(e,t){if(l["views.txt"]){var a=[];Object.each(e,function(e){a.push(e.Name.replace(/'/g,"\\'"))});var o=[];viewObjs=[];var r=function(e){e instanceof Array||(e=[e]),h.logItem("Inserted",c+"GridView__c",viewObjs,e);for(var a=0,r=0;r<e.length;r++)d[o[r]]=e[r].id,e[r].getBoolean("success")&&a++;if(t){var s=[],l=[],p=[{name:"selectAll",label:"Page Name - Overwrite Existing",type:"boolean",value:!0,change:function(e,t){$('input[id$="'+t+'"]').prop("checked",$(e.target).prop("checked"))}}];Object.each(t,function(e){s.push(e.Name.replace(/'/g,"\\'"))});var f=n.query("SELECT Id, Name,Markup, NamespacePrefix FROM ApexPage WHERE Name in ('{1}')",c,s.join("','"));Object.each(f,function(e){if(!e.NamespacePrefix){var a=Object.first(t,function(t){return t.Name==e.Name});a.Id=e.Id,a.type=e.type,delete a.CreatedById,delete a.CreatedDate,delete a.IsDeleted,delete a.LastModifiedById,delete a.LastModifiedDate,delete a.LastReferencedDate,delete a.LastViewedDate,delete a.NamespacePrefix,delete a.SystemModstamp,delete a.OwnerId,delete a.attributes;var i=new sforce.SObject(e.type);Object.each(a,function(e,t){i[t]=e}),l.push(i),p.push({name:a.Id,label:a.Name,type:"boolean",value:!0})}}),l.length>0?(h.hideLoader(),i.entry("Duplicate VF Pages",p,{width:"50%",resizable:!0},null,function(e){h.showLoader(function(){var i=[],n=[];Object.each(l,function(t){e[t.Id].value?i.push(t.Name):n.push(t.Name)}),t=t.filter(function(e){return n.indexOf(e.Name)>-1&&(e.Name=e.Name.substr(0,32)+"imported"),i.indexOf(e.Name)<0}),l=l.filter(function(e){return i.indexOf(e.Name)>-1}),u(t,a,l)})})):u(t,a)}},s=n.query("SELECT Id, name,{0}ObjectName__c FROM {0}GridView__c WHERE IsDeleted = false AND Name in ('{1}')",c,a.join("','"));if(s.length>0){var p=[{name:"selectAll",label:"View Name - Use Existing",type:"boolean",value:!0,change:function(e,t){$('input[id$="'+t+'"]').prop("checked",$(e.target).prop("checked"))}}];Object.each(s,function(e){p.push({name:e.Id,label:e.Name+" ("+e[c+"ObjectName__c"]+")",type:"boolean",value:!0})}),h.hideLoader();var f=function(t){h.showLoader(function(){var a={},i=[];Object.each(s,function(e){t[e.Id].value?a[e.Name]=e.Id:i.push(e.Name)}),e=e.filter(function(e){return i.indexOf(e.Name)>-1&&(e.Name+=" (imported)"),!a[e.Name]||(d[e.Id]=a[e.Name],!1)});var l=h.cleanViews(e,c,o);l.length>0?n.batchInsert(l,r):r([])})};i.entry("Duplicate Views",p,{width:"50%",resizable:!0},null,f)}else viewObjs=h.cleanViews(e,c,o),viewObjs.length>0?n.batchInsert(viewObjs,r):r([])}else u(t,0)},m=h.selectivePromptFactory(l["views.txt"],"Views",function(e){h.selectivePromptFactory(l["pages.txt"],"Pages",function(t){f(e,t)})(),h.hideLoader()}),g=function(e){var t=[];Object.each(e,function(e){delete e.NamespacePrefix,delete e.BodyLength,delete e.CreatedById,delete e.CreatedDate,delete e.Id,delete e.IsDeleted,delete e.LastModifiedById,delete e.LastModifiedDate,delete e.LastReferencedDate,delete e.LastViewedDate,delete e.SystemModstamp,delete e.OwnerId,delete e.attributes;var a=new sforce.SObject("StaticResource");Object.each(e,function(e,t){a[t]=e}),t.push(a)});var a;a=o?function(e){h.logItem("Inserted","StaticResource",t,e,!0),f(l["views.txt"],l["pages.txt"])}:h.finishPromptFactory("Custom Actions",m,t,"StaticResource","Inserted",!0),t.length>0?n.batchInsert(t,a):a([])},v=h.selectivePromptFactory(l["customActions.txt"],"Custom Actions",g),b=function(e){var t=[];Object.each(e,function(e){delete e.CreatedById,delete e.CreatedDate,delete e.Id,delete e.IsDeleted,delete e.LastModifiedById,delete e.LastModifiedDate,delete e.LastReferencedDate,delete e.LastViewedDate,delete e.SystemModstamp,delete e.OwnerId,delete e.attributes;var a=new sforce.SObject(c+"Grid_Setting__c");Object.each(e,function(e,t){c.length<1&&t.indexOf("CRMC_PP__")>-1?a[t.split("CRMC_PP__")[1]]=e:a[t]=e}),t.push(a)});var a;a=o?function(e){h.logItem("Inserted","Setting",t,e),g(l["customActions.txt"]),h.hideLoader()}:h.finishPromptFactory("Settings",v,t,"Setting","Inserted"),t.length>0?n.batchInsert(t,a):a([])};o?b(l["settings.txt"]):h.selectivePromptFactory(l["settings.txt"],"Settings",b)()}catch(e){console.log(e),h.hideLoader()}};if(e.target){var l=e.target.files[0],d=new FileReader;d.onload=function(e){s(e.target.result)},d.readAsArrayBuffer(l)}else s(e)},log:{},logItem:function(e,t,a,i,n){var o=h.log;if(n&&(o.meta||(o.meta={}),o=o.meta),o[e]||(o[e]={}),o[e][t]||(o[e][t]=[]),a instanceof Array)for(var r=0;r<a.length;r++){var s=$.extend({},a[r]);i[r]&&i[r].id&&(s.id=i[r].id),i[r]&&i[r].Id&&(s.Id=i[r].Id),o[e][t].push(s)}else{var s=$.extend({},a);i.id&&(s.id=i.id),i.Id&&(s.Id=i.Id),o[e][t].push(s)}},stringifyLog:function(){var e="Successfully ",t=function(t,a){e+="\n "+a,Object.each(t,function(t,a){e+="\n  "+t.length+" "+a+":",Object.each(t,function(t){e+="\n   ",e+=t.name||t.Name||t.fullName||"(No Name)",e+=": ",e+=t.id||t.Id||"(No Id)"})})};return Object.each(h.log,function(e,a){"meta"!=a&&t(e,a)}),e+="\nThe following Metadata: \n",Object.each(h.log.meta,function(e,a){t(e,a)}),e},clearLog:function(){var e=h.log;return h.log={},e},undo:function(e){e||(e=h.clearLog());var t=!1;if(e.Inserted){var i=[],o={};Object.each(e.Inserted,function(e,a){Object.each(e,function(e){var n=e.id||e.Id;if(n)i.push(n);else{var r=e.fullName||e.FullName||e.name||e.Name;r&&(t=!0,o[a]||(o[a]=[]),o[a].push(r))}})})}e.meta&&e.meta.Inserted&&Object.each(e.meta.Inserted,function(e,a){Object.each(e,function(e){var i=e.fullName||e.FullName||e.name||e.Name;i&&(t=!0,o[a]||(o[a]=[]),o[a].push(i))})}),finishedNoIds={};var r=function(){n.batchDelete(i,function(e){console.log(e)})};t?Object.each(o,function(e,t){e.length>0&&(finishedNoIds[t]=!1,a.deleteMetadata(t,e,function(e){finishedNoIds[t]=!0,console.log(e);var a=!0;Object.each(finishedNoIds,function(e){e===!1&&(a=!1)}),a&&r()}))}):r()}};return h.actionOwner=void 0,h.actionOwnerType="global",h.actionOwnerLabel="",h}),crmc.define("ListButton",["sfdc","GridConstants"],function(e,t){return{getColumns:function(e){return[]},showInGrid:function(a,i,n,o){var r;try{if(void 0!==ListViewport&&void 0!==ListViewport.instances){var s=Object.first(ListViewport.instances,function(e){return!0});void 0!==s.filter&&void 0!==s.filter.id&&(r=s.filter.id)}}catch(e){}var l={object:a,filterId:void 0===r?"":r,FKName:n,FKValue:o},d=t.namespace;if(i.length>200){var c={Ids:i.join()};e.postToVFPage(d,t.VF_PAGE_NAME,l,c)}else l.Ids=i.join(),e.navigateToVFPage(d,t.VF_PAGE_NAME,l)}}});
//# sourceMappingURL=Admin.resource.map